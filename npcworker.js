/*! For license information please see npcworker.js.LICENSE.txt */
(()=>{"use strict";var __webpack_modules__={2072:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var __dirname="/";function asyncGeneratorStep(t,e,r,i,s,n,o){try{var a=t[n](o),h=a.value}catch(t){return void r(t)}a.done?e(h):Promise.resolve(h).then(i,s)}function _async_to_generator(t){return function(){var e=this,r=arguments;return new Promise((function(i,s){var n=t.apply(e,r);function o(t){asyncGeneratorStep(n,i,s,o,a,"next",t)}function a(t){asyncGeneratorStep(n,i,s,o,a,"throw",t)}o(void 0)}))}}function _type_of(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function _ts_generator(t,e){var r,i,s,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(h){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(n=0)),n;)try{if(r=1,i&&(s=2&a[0]?i.return:a[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,a[1])).done)return s;switch(i=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,i=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(!((s=(s=n.trys).length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){n=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){n.label=a[1];break}if(6===a[0]&&n.label<s[1]){n.label=s[1],s=a;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(a);break}s[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(t){a=[6,t],i=0}finally{r=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,h])}}}__webpack_require__.d(__webpack_exports__,{uP:()=>trace});var fs=null,path=null,logFilePath=null,helperBuffer=[];function initNodeModules(){if(null===fs)try{"undefined"==typeof window&&"undefined"!=typeof process&&(fs=eval("require('fs')"),path=eval("require('path')"))}catch(t){}}function getSessionId(){try{var t="undefined"!=typeof window?window:null;if(t){if(!t.__trajectorySessionId){var e=Math.random().toString(36).slice(2,8),r=Date.now().toString(36);t.__trajectorySessionId="s-".concat(r,"-").concat(e)}return t.__trajectorySessionId}var i=void 0!==__webpack_require__.g?__webpack_require__.g:null;if(i){if(!i.__trajectorySessionId){var s=Math.random().toString(36).slice(2,8),n=Date.now().toString(36);i.__trajectorySessionId="s-".concat(n,"-").concat(s)}return i.__trajectorySessionId}}catch(t){}return"s-".concat(Date.now().toString(36))}function getBrowserId(){try{var t="undefined"!=typeof window?window:null;if(t&&!t.__trajectoryBrowserId){var e=new Date,r=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0"),h=Math.random().toString(36).slice(2,6);t.__trajectoryBrowserId="".concat(r).concat(i).concat(s).concat(n).concat(o).concat(a,"-").concat(h)}return(null==t?void 0:t.__trajectoryBrowserId)||"unknown"}catch(t){}return"unknown"}function getOrCreateLogFile(){if(!fs||!path)return null;if(logFilePath)return logFilePath;try{for(var t=__dirname,e=null,r=0;r<10;r++){var i=path.join(t,"package.json");if(fs.existsSync(i)){e=path.join(t,"logs");break}t=path.dirname(t)}e||(e=path.resolve(process.cwd(),"logs")),fs.existsSync(e)||fs.mkdirSync(e,{recursive:!0});var s=new Date,n=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0"),h=String(s.getHours()).padStart(2,"0"),l=String(s.getMinutes()).padStart(2,"0"),c=String(s.getSeconds()).padStart(2,"0"),u=Math.random().toString(36).slice(2,6),p=getSessionId();return logFilePath=path.join(e,"test-trajectory-".concat(n).concat(o).concat(a).concat(h).concat(l).concat(c,"-").concat(u,"-").concat(p,".log"))}catch(t){return null}}function writeToNodeFile(t){if(fs)try{var e=getOrCreateLogFile();if(!e)return void console.log("[trace] could not get log file path");fs.appendFileSync(e,t+"\n","utf8")}catch(t){}else console.log("[trace] fs not available, skipping file write")}function simplifyVectorXYZ(t){return t&&"object"===(void 0===t?"undefined":_type_of(t))&&"x"in t&&"y"in t&&"z"in t&&"number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.z?{x:t.x,y:t.y,z:t.z}:null}function safeStringify(t){var e=new WeakSet;return JSON.stringify(t,(function(t,r){var i=simplifyVectorXYZ(r);if(i)return i;if(r&&"object"===(void 0===r?"undefined":_type_of(r))){if(e.has(r))return"[Circular]";e.add(r)}return r}))}function postLog(t){return _async_to_generator((function(){return _ts_generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,fetch("/__log",{method:"POST",headers:{"Content-Type":"application/json"},body:t})];case 1:case 2:return e.sent(),[3,3];case 3:return[2]}}))}))()}function trace(t,e){try{var r="undefined"!=typeof window?window:null,i=void 0!==__webpack_require__.g?__webpack_require__.g:null,s=(null==r?void 0:r.__trajectoryTrace)||(null==i?void 0:i.__trajectoryTrace);if(!s)return;if("helper_shot"===t)return void(helperBuffer=[{label:t,data:e}]);if("helper_event"===t)return 0===helperBuffer.length&&helperBuffer.push({label:"helper_shot",data:void 0}),void helperBuffer.push({label:t,data:e});if("shot"===t){if(helperBuffer.length>0){var n=!0,o=!1,a=void 0;try{for(var h,l=helperBuffer[Symbol.iterator]();!(n=(h=l.next()).done);n=!0){var c=h.value;if(c){var u=c.label,p=c.data;u&&writeTraceEntry(u,p,r,i,s)}}}catch(t){o=!0,a=t}finally{try{n||null==l.return||l.return()}finally{if(o)throw a}}helperBuffer=[]}return void writeTraceEntry(t,e,r,i,s)}writeTraceEntry(t,e,r,i,s)}catch(t){}}function writeTraceEntry(t,e,r,i,s){try{var n=(null==r?void 0:r.__trajectoryTraceWrite)||(null==i?void 0:i.__trajectoryTraceWrite);if(n&&"function"==typeof n)return void n(t,e);var o=getSessionId(),a=Date.now(),h=r?getBrowserId():void 0,l=h?{label:t,data:e,sid:o,ts:a,bid:h}:{label:t,data:e,sid:o,ts:a};if(!0===s)return void console.log("[trace]",t,e);var c=safeStringify(l);if("json"===s)return void console.log(c);if("file"===s){if(r)return void postLog(c);if(i&&fs)return void writeToNodeFile(c)}}catch(t){}}"undefined"==typeof window&&initNodeModules();var __WEBPACK_DEFAULT_EXPORT__=trace}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var r=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(t,e)=>{for(var r in e)__webpack_require__.o(e,r)&&!__webpack_require__.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var __webpack_exports__={},g=9.8,mu=.00985,muS=.16,constants_muC=.85,rho=.04,e=.86,constants_ee=.97,constants_s=.212,constants_w=.12,magnusCoeff=.001,tableRestitution=.3,magnusAirborneMultiplier=1.2,magnusTableMultiplier=.3,airDensity=1.2,dragCoefficient=.47,airDragDamping=.15,Mz,Mxy,I,constants_sin_=null,constants_cos_=Math.sqrt(21)/5,airborneThresholdFactor=.06,elevationVerticalImpulseScale=1;function setAirborneThresholdFactor(t){airborneThresholdFactor=t}function setElevationVerticalImpulseScale(t){elevationVerticalImpulseScale=t}var topHitJumpDirectionalGain=0,topHitJumpElevationRef=.3;function setTopHitJumpDirectionalGain(t){topHitJumpDirectionalGain=t}function setTopHitJumpElevationRef(t){topHitJumpElevationRef=Math.max(1e-6,t)}var spinDirCouplingStrongScale=1,spinDirStrongSpeed=3,spinDirWeakSpeed=1.5;function setSpinDirCouplingStrongScale(t){spinDirCouplingStrongScale=Math.max(0,Math.min(1,t))}function setSpinDirStrongSpeed(t){spinDirStrongSpeed=Math.max(0,t)}function setSpinDirWeakSpeed(t){spinDirWeakSpeed=Math.max(0,Math.min(spinDirStrongSpeed,t))}var CAROM_TABLE_LENGTH=2.84,CAROM_TABLE_WIDTH=1.42,CAROM_BALL_DIAMETER=.0615,BALL_MASS=.165,POOL_BALL_RADIUS=.028575,SNOOKER_BALL_RADIUS=.02625,CAROM_BALL_RADIUS=.03075,POOL_BALL_MASS=.17,SNOOKER_BALL_MASS=.142,CAROM_BALL_MASS=.21,POOL_PHYSICS={R:POOL_BALL_RADIUS,m:POOL_BALL_MASS},SNOOKER_PHYSICS={R:SNOOKER_BALL_RADIUS,m:SNOOKER_BALL_MASS},CAROM_PHYSICS={R:CAROM_BALL_RADIUS,m:CAROM_BALL_MASS,mu:.0063,rho:.09,muS:.09,spinStopThreshold:.05,rollingTransition:.1},constants_R=POOL_BALL_RADIUS,constants_m=POOL_BALL_MASS;function setR(t){constants_R=t,null==refresh||refresh()}function refresh(){Mz=mu*constants_m*g*2/3*rho,Mxy=7/(5*Math.sqrt(2))*constants_R*mu*constants_m*g,I=.4*constants_m*constants_R*constants_R}function refreshWithContext(t){var e,r,i=null!==(e=t.mu)&&void 0!==e?e:mu,s=null!==(r=t.rho)&&void 0!==r?r:rho;return{Mz:i*t.m*g*2/3*s,Mxy:7/(5*Math.sqrt(2))*t.R*i*t.m*g,I:.4*t.m*t.R*t.R}}function getPhysicsContext(t){switch(t){case"threecushion":return CAROM_PHYSICS;case"snooker":return SNOOKER_PHYSICS;default:return POOL_PHYSICS}}function setm(t){constants_m=t,null==refresh||refresh()}function setmu(t){mu=t,refresh()}function setrho(t){rho=t,refresh()}function setmuS(t){muS=t}function sete(t){e=t}function setmuC(t){constants_muC=t}function setμs(t){constants_s=t}function setμw(t){constants_w=t}function setee(t){constants_ee=t}function setMagnusCoeff(t){magnusCoeff=t}function setTableRestitution(t){tableRestitution=t}function setMagnusAirborneMultiplier(t){magnusAirborneMultiplier=t}function setMagnusTableMultiplier(t){magnusTableMultiplier=t}function setAirDensity(t){airDensity=t}function setDragCoefficient(t){dragCoefficient=t}function setAirDragDamping(t){airDragDamping=t}function _class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _create_class(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function getDefaultPoolDimensions(t){var e=43*t,r=21*t;return{tableX:e,tableY:r,X:e+t,Y:r+t}}refresh();var initialDimensions=getDefaultPoolDimensions(constants_R),TableGeometry=function(){function t(){_class_call_check(this,t)}return _create_class(t,null,[{key:"scaleToRadius",value:function(e){var r=getDefaultPoolDimensions(e);t.tableX=r.tableX,t.tableY=r.tableY,t.X=r.X,t.Y=r.Y,t.hasPockets=!0}},{key:"setCaromDimensions",value:function(t,e,r){this.hasPockets=!1,this.X=t/2,this.Y=e/2,this.tableX=this.X-r,this.tableY=this.Y-r}}]),t}();_define_property(TableGeometry,"tableX",initialDimensions.tableX),_define_property(TableGeometry,"tableY",initialDimensions.tableY),_define_property(TableGeometry,"X",initialDimensions.X),_define_property(TableGeometry,"Y",initialDimensions.Y),_define_property(TableGeometry,"hasPockets",!0);const REVISION="179",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,AgXToneMapping=6,NeutralToneMapping=7,AttachedBindMode="attached",DetachedBindMode="detached",UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,UnsignedInt5999Type=35902,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,BasicDepthPacking=3200,RGBADepthPacking=3201,RGBDepthPacking=3202,RGDepthPacking=3203,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",LinearTransfer="linear",SRGBTransfer="srgb",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001,TimestampQuery={COMPUTE:"compute",RENDER:"render"},InterpolationSamplingType={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},InterpolationSamplingMode={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};class EventDispatcher{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)}hasEventListener(t,e){const r=this._listeners;return void 0!==r&&void 0!==r[t]&&-1!==r[t].indexOf(e)}removeEventListener(t,e){const r=this._listeners;if(void 0===r)return;const i=r[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){const e=this._listeners;if(void 0===e)return;const r=e[t.type];if(void 0!==r){t.target=this;const e=r.slice(0);for(let r=0,i=e.length;r<i;r++)e[r].call(this,t);t.target=null}}}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(_lut[255&t]+_lut[t>>8&255]+_lut[t>>16&255]+_lut[t>>24&255]+"-"+_lut[255&e]+_lut[e>>8&255]+"-"+_lut[e>>16&15|64]+_lut[e>>24&255]+"-"+_lut[63&r|128]+_lut[r>>8&255]+"-"+_lut[r>>16&255]+_lut[r>>24&255]+_lut[255&i]+_lut[i>>8&255]+_lut[i>>16&255]+_lut[i>>24&255]).toLowerCase()}function clamp(t,e,r){return Math.max(e,Math.min(r,t))}function euclideanModulo(t,e){return(t%e+e)%e}function mapLinear(t,e,r,i,s){return i+(t-e)*(s-i)/(r-e)}function inverseLerp(t,e,r){return t!==e?(r-t)/(e-t):0}function lerp(t,e,r){return(1-r)*t+r*e}function damp(t,e,r,i){return lerp(t,e,1-Math.exp(-r*i))}function pingpong(t,e=1){return e-Math.abs(euclideanModulo(t,2*e)-e)}function smoothstep(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)}function smootherstep(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)}function randInt(t,e){return t+Math.floor(Math.random()*(e-t+1))}function randFloat(t,e){return t+Math.random()*(e-t)}function randFloatSpread(t){return t*(.5-Math.random())}function seededRandom(t){void 0!==t&&(_seed=t);let e=_seed+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}function degToRad(t){return t*DEG2RAD}function radToDeg(t){return t*RAD2DEG}function isPowerOfTwo(t){return!(t&t-1)&&0!==t}function ceilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function floorPowerOfTwo(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function setQuaternionFromProperEuler(t,e,r,i,s){const n=Math.cos,o=Math.sin,a=n(r/2),h=o(r/2),l=n((e+i)/2),c=o((e+i)/2),u=n((e-i)/2),p=o((e-i)/2),d=n((i-e)/2),m=o((i-e)/2);switch(s){case"XYX":t.set(a*c,h*u,h*p,a*l);break;case"YZY":t.set(h*p,a*c,h*u,a*l);break;case"ZXZ":t.set(h*u,h*p,a*c,a*l);break;case"XZX":t.set(a*c,h*m,h*d,a*l);break;case"YXY":t.set(h*d,a*c,h*m,a*l);break;case"ZYZ":t.set(h*m,h*d,a*c,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function denormalize(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function normalize(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID,clamp,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize,denormalize};class Vector2{constructor(t=0,e=0){Vector2.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,r=this.y,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6],this.y=i[1]*e+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=clamp(this.x,t.x,e.x),this.y=clamp(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=clamp(this.x,t,e),this.y=clamp(this.y,t,e),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(clamp(r,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(clamp(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y;return e*e+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const r=Math.cos(e),i=Math.sin(e),s=this.x-t.x,n=this.y-t.y;return this.x=s*r-n*i+t.x,this.y=s*i+n*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Quaternion{constructor(t=0,e=0,r=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=r,this._w=i}static slerpFlat(t,e,r,i,s,n,o){let a=r[i+0],h=r[i+1],l=r[i+2],c=r[i+3];const u=s[n+0],p=s[n+1],d=s[n+2],m=s[n+3];if(0===o)return t[e+0]=a,t[e+1]=h,t[e+2]=l,void(t[e+3]=c);if(1===o)return t[e+0]=u,t[e+1]=p,t[e+2]=d,void(t[e+3]=m);if(c!==m||a!==u||h!==p||l!==d){let t=1-o;const e=a*u+h*p+l*d+c*m,r=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const s=Math.sqrt(i),n=Math.atan2(s,e*r);t=Math.sin(t*n)/s,o=Math.sin(o*n)/s}const s=o*r;if(a=a*t+u*s,h=h*t+p*s,l=l*t+d*s,c=c*t+m*s,t===1-o){const t=1/Math.sqrt(a*a+h*h+l*l+c*c);a*=t,h*=t,l*=t,c*=t}}t[e]=a,t[e+1]=h,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,r,i,s,n){const o=r[i],a=r[i+1],h=r[i+2],l=r[i+3],c=s[n],u=s[n+1],p=s[n+2],d=s[n+3];return t[e]=o*d+l*c+a*p-h*u,t[e+1]=a*d+l*u+h*c-o*p,t[e+2]=h*d+l*p+o*u-a*c,t[e+3]=l*d-o*c-a*u-h*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,r,i){return this._x=t,this._y=e,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const r=t._x,i=t._y,s=t._z,n=t._order,o=Math.cos,a=Math.sin,h=o(r/2),l=o(i/2),c=o(s/2),u=a(r/2),p=a(i/2),d=a(s/2);switch(n){case"XYZ":this._x=u*l*c+h*p*d,this._y=h*p*c-u*l*d,this._z=h*l*d+u*p*c,this._w=h*l*c-u*p*d;break;case"YXZ":this._x=u*l*c+h*p*d,this._y=h*p*c-u*l*d,this._z=h*l*d-u*p*c,this._w=h*l*c+u*p*d;break;case"ZXY":this._x=u*l*c-h*p*d,this._y=h*p*c+u*l*d,this._z=h*l*d+u*p*c,this._w=h*l*c-u*p*d;break;case"ZYX":this._x=u*l*c-h*p*d,this._y=h*p*c+u*l*d,this._z=h*l*d-u*p*c,this._w=h*l*c+u*p*d;break;case"YZX":this._x=u*l*c+h*p*d,this._y=h*p*c+u*l*d,this._z=h*l*d-u*p*c,this._w=h*l*c-u*p*d;break;case"XZY":this._x=u*l*c-h*p*d,this._y=h*p*c-u*l*d,this._z=h*l*d+u*p*c,this._w=h*l*c+u*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const r=e/2,i=Math.sin(r);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,r=e[0],i=e[4],s=e[8],n=e[1],o=e[5],a=e[9],h=e[2],l=e[6],c=e[10],u=r+o+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-a)*t,this._y=(s-h)*t,this._z=(n-i)*t}else if(r>o&&r>c){const t=2*Math.sqrt(1+r-o-c);this._w=(l-a)/t,this._x=.25*t,this._y=(i+n)/t,this._z=(s+h)/t}else if(o>c){const t=2*Math.sqrt(1+o-r-c);this._w=(s-h)/t,this._x=(i+n)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+c-r-o);this._w=(n-i)/t,this._x=(s+h)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let r=t.dot(e)+1;return r<1e-8?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const r=this.angleTo(t);if(0===r)return this;const i=Math.min(1,e/r);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const r=t._x,i=t._y,s=t._z,n=t._w,o=e._x,a=e._y,h=e._z,l=e._w;return this._x=r*l+n*o+i*h-s*a,this._y=i*l+n*a+s*o-r*h,this._z=s*l+n*h+r*a-i*o,this._w=n*l-r*o-i*a-s*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const r=this._x,i=this._y,s=this._z,n=this._w;let o=n*t._w+r*t._x+i*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=n,this._x=r,this._y=i,this._z=s,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*n+e*this._w,this._x=t*r+e*this._x,this._y=t*i+e*this._y,this._z=t*s+e*this._z,this.normalize(),this}const h=Math.sqrt(a),l=Math.atan2(h,o),c=Math.sin((1-e)*l)/h,u=Math.sin(e*l)/h;return this._w=n*c+this._w*u,this._x=r*c+this._x*u,this._y=i*c+this._y*u,this._z=s*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,r){return this.copy(t).slerp(e,r)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(t),i*Math.cos(t),s*Math.sin(e),s*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class three_core_Vector3{constructor(t=0,e=0,r=0){three_core_Vector3.prototype.isVector3=!0,this.x=t,this.y=e,this.z=r}set(t,e,r){return void 0===r&&(r=this.z),this.x=t,this.y=e,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(_quaternion$4.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,r=this.y,i=this.z,s=t.elements;return this.x=s[0]*e+s[3]*r+s[6]*i,this.y=s[1]*e+s[4]*r+s[7]*i,this.z=s[2]*e+s[5]*r+s[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,r=this.y,i=this.z,s=t.elements,n=1/(s[3]*e+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*e+s[4]*r+s[8]*i+s[12])*n,this.y=(s[1]*e+s[5]*r+s[9]*i+s[13])*n,this.z=(s[2]*e+s[6]*r+s[10]*i+s[14])*n,this}applyQuaternion(t){const e=this.x,r=this.y,i=this.z,s=t.x,n=t.y,o=t.z,a=t.w,h=2*(n*i-o*r),l=2*(o*e-s*i),c=2*(s*r-n*e);return this.x=e+a*h+n*c-o*l,this.y=r+a*l+o*h-s*c,this.z=i+a*c+s*l-n*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,r=this.y,i=this.z,s=t.elements;return this.x=s[0]*e+s[4]*r+s[8]*i,this.y=s[1]*e+s[5]*r+s[9]*i,this.z=s[2]*e+s[6]*r+s[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=clamp(this.x,t.x,e.x),this.y=clamp(this.y,t.y,e.y),this.z=clamp(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=clamp(this.x,t,e),this.y=clamp(this.y,t,e),this.z=clamp(this.z,t,e),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(clamp(r,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const r=t.x,i=t.y,s=t.z,n=e.x,o=e.y,a=e.z;return this.x=i*a-s*o,this.y=s*n-r*a,this.z=r*o-i*n,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return _vector$c.copy(this).projectOnVector(t),this.sub(_vector$c)}reflect(t){return this.sub(_vector$c.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(clamp(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return e*e+r*r+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,r){const i=Math.sin(e)*t;return this.x=i*Math.sin(r),this.y=Math.cos(e)*t,this.z=i*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,r=Math.sqrt(1-e*e);return this.x=r*Math.cos(t),this.y=e,this.z=r*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$c=new three_core_Vector3,_quaternion$4=new Quaternion;class Matrix3{constructor(t,e,r,i,s,n,o,a,h){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,r,i,s,n,o,a,h)}set(t,e,r,i,s,n,o,a,h){const l=this.elements;return l[0]=t,l[1]=i,l[2]=o,l[3]=e,l[4]=s,l[5]=a,l[6]=r,l[7]=n,l[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this}extractBasis(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,i=e.elements,s=this.elements,n=r[0],o=r[3],a=r[6],h=r[1],l=r[4],c=r[7],u=r[2],p=r[5],d=r[8],m=i[0],f=i[3],y=i[6],g=i[1],_=i[4],v=i[7],x=i[2],b=i[5],M=i[8];return s[0]=n*m+o*g+a*x,s[3]=n*f+o*_+a*b,s[6]=n*y+o*v+a*M,s[1]=h*m+l*g+c*x,s[4]=h*f+l*_+c*b,s[7]=h*y+l*v+c*M,s[2]=u*m+p*g+d*x,s[5]=u*f+p*_+d*b,s[8]=u*y+p*v+d*M,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],h=t[7],l=t[8];return e*n*l-e*o*h-r*s*l+r*o*a+i*s*h-i*n*a}invert(){const t=this.elements,e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=l*n-o*h,u=o*a-l*s,p=h*s-n*a,d=e*c+r*u+i*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const m=1/d;return t[0]=c*m,t[1]=(i*h-l*r)*m,t[2]=(o*r-i*n)*m,t[3]=u*m,t[4]=(l*e-i*a)*m,t[5]=(i*s-o*e)*m,t[6]=p*m,t[7]=(r*a-h*e)*m,t[8]=(n*e-r*s)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,r,i,s,n,o){const a=Math.cos(s),h=Math.sin(s);return this.set(r*a,r*h,-r*(a*n+h*o)+n+t,-i*h,i*a,-i*(-h*n+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(_m3.makeScale(t,e)),this}rotate(t){return this.premultiply(_m3.makeRotation(-t)),this}translate(t,e){return this.premultiply(_m3.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,r,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,r=t.elements;for(let t=0;t<9;t++)if(e[t]!==r[t])return!1;return!0}fromArray(t,e=0){for(let r=0;r<9;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(t,e){return new TYPED_ARRAYS[t](e)}function createElementNS(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function createCanvasElement(){const t=createElementNS("canvas");return t.style.display="block",t}const _cache={};function warnOnce(t){t in _cache||(_cache[t]=!0,console.warn(t))}function probeAsync(t,e,r){return new Promise((function(i,s){setTimeout((function n(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:s();break;case t.TIMEOUT_EXPIRED:setTimeout(n,r);break;default:i()}}),r)}))}const LINEAR_REC709_TO_XYZ=(new Matrix3).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),XYZ_TO_LINEAR_REC709=(new Matrix3).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function createColorManagement(){const t={enabled:!0,workingColorSpace:LinearSRGBColorSpace,spaces:{},convert:function(t,e,r){return!1!==this.enabled&&e!==r&&e&&r?(this.spaces[e].transfer===SRGBTransfer&&(t.r=SRGBToLinear(t.r),t.g=SRGBToLinear(t.g),t.b=SRGBToLinear(t.b)),this.spaces[e].primaries!==this.spaces[r].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[r].fromXYZ)),this.spaces[r].transfer===SRGBTransfer&&(t.r=LinearToSRGB(t.r),t.g=LinearToSRGB(t.g),t.b=LinearToSRGB(t.b)),t):t},workingToColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},colorSpaceToWorking:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===NoColorSpace?LinearTransfer:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,r){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[r].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(e,r){return warnOnce("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),t.workingToColorSpace(e,r)},toWorkingColorSpace:function(e,r){return warnOnce("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),t.colorSpaceToWorking(e,r)}},e=[.64,.33,.3,.6,.15,.06],r=[.2126,.7152,.0722],i=[.3127,.329];return t.define({[LinearSRGBColorSpace]:{primaries:e,whitePoint:i,transfer:LinearTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:r,workingColorSpaceConfig:{unpackColorSpace:SRGBColorSpace},outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}},[SRGBColorSpace]:{primaries:e,whitePoint:i,transfer:SRGBTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:r,outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}}}),t}const ColorManagement=createColorManagement();function SRGBToLinear(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function LinearToSRGB(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let _canvas;class ImageUtils{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let r;if(t instanceof HTMLCanvasElement)r=t;else{void 0===_canvas&&(_canvas=createElementNS("canvas")),_canvas.width=t.width,_canvas.height=t.height;const e=_canvas.getContext("2d");t instanceof ImageData?e.putImageData(t,0,0):e.drawImage(t,0,0,t.width,t.height),r=_canvas}return r.toDataURL(e)}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=createElementNS("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const i=r.getImageData(0,0,t.width,t.height),s=i.data;for(let t=0;t<s.length;t++)s[t]=255*SRGBToLinear(s[t]/255);return r.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*SRGBToLinear(e[t]/255)):e[t]=SRGBToLinear(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let _sourceId=0;class Source{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):null!==e?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,r=i.length;e<r;e++)i[e].isDataTexture?t.push(serializeImage(i[e].image)):t.push(serializeImage(i[e]))}else t=serializeImage(i);r.url=t}return e||(t.images[this.uuid]=r),r}}function serializeImage(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?ImageUtils.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;const _tempVec3=new three_core_Vector3;class Texture extends EventDispatcher{constructor(t=Texture.DEFAULT_IMAGE,e=Texture.DEFAULT_MAPPING,r=ClampToEdgeWrapping,i=ClampToEdgeWrapping,s=LinearFilter,n=LinearMipmapLinearFilter,o=RGBAFormat,a=UnsignedByteType,h=Texture.DEFAULT_ANISOTROPY,l=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=n,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(_tempVec3).x}get height(){return this.source.getSize(_tempVec3).y}get depth(){return this.source.getSize(_tempVec3).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const r=t[e];if(void 0===r){console.warn(`THREE.Texture.setValues(): parameter '${e}' has value of undefined.`);continue}const i=this[e];void 0!==i?i&&r&&i.isVector2&&r.isVector2||i&&r&&i.isVector3&&r.isVector3||i&&r&&i.isMatrix3&&r.isMatrix3?i.copy(r):this[e]=r:console.warn(`THREE.Texture.setValues(): property '${e}' does not exist.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),e||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==UVMapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case RepeatWrapping:t.x=t.x-Math.floor(t.x);break;case ClampToEdgeWrapping:t.x=t.x<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case RepeatWrapping:t.y=t.y-Math.floor(t.y);break;case ClampToEdgeWrapping:t.y=t.y<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}Texture.DEFAULT_IMAGE=null,Texture.DEFAULT_MAPPING=UVMapping,Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(t=0,e=0,r=0,i=1){Vector4.prototype.isVector4=!0,this.x=t,this.y=e,this.z=r,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,r,i){return this.x=t,this.y=e,this.z=r,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,r=this.y,i=this.z,s=this.w,n=t.elements;return this.x=n[0]*e+n[4]*r+n[8]*i+n[12]*s,this.y=n[1]*e+n[5]*r+n[9]*i+n[13]*s,this.z=n[2]*e+n[6]*r+n[10]*i+n[14]*s,this.w=n[3]*e+n[7]*r+n[11]*i+n[15]*s,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,r,i,s;const n=.01,o=.1,a=t.elements,h=a[0],l=a[4],c=a[8],u=a[1],p=a[5],d=a[9],m=a[2],f=a[6],y=a[10];if(Math.abs(l-u)<n&&Math.abs(c-m)<n&&Math.abs(d-f)<n){if(Math.abs(l+u)<o&&Math.abs(c+m)<o&&Math.abs(d+f)<o&&Math.abs(h+p+y-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(h+1)/2,a=(p+1)/2,g=(y+1)/2,_=(l+u)/4,v=(c+m)/4,x=(d+f)/4;return t>a&&t>g?t<n?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(t),i=_/r,s=v/r):a>g?a<n?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(a),r=_/i,s=x/i):g<n?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(g),r=v/s,i=x/s),this.set(r,i,s,e),this}let g=Math.sqrt((f-d)*(f-d)+(c-m)*(c-m)+(u-l)*(u-l));return Math.abs(g)<.001&&(g=1),this.x=(f-d)/g,this.y=(c-m)/g,this.z=(u-l)/g,this.w=Math.acos((h+p+y-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=clamp(this.x,t.x,e.x),this.y=clamp(this.y,t.y,e.y),this.z=clamp(this.z,t.z,e.z),this.w=clamp(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=clamp(this.x,t,e),this.y=clamp(this.y,t,e),this.z=clamp(this.z,t,e),this.w=clamp(this.w,t,e),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(clamp(r,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this.w=t.w+(e.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(t=1,e=1,r={}){super(),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},r),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=r.depth,this.scissor=new Vector4(0,0,t,e),this.scissorTest=!1,this.viewport=new Vector4(0,0,t,e);const i={width:t,height:e,depth:r.depth},s=new Texture(i);this.textures=[];const n=r.count;for(let t=0;t<n;t++)this.textures[t]=s.clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;this._setTextureOptions(r),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}_setTextureOptions(t={}){const e={minFilter:LinearFilter,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==t.mapping&&(e.mapping=t.mapping),void 0!==t.wrapS&&(e.wrapS=t.wrapS),void 0!==t.wrapT&&(e.wrapT=t.wrapT),void 0!==t.wrapR&&(e.wrapR=t.wrapR),void 0!==t.magFilter&&(e.magFilter=t.magFilter),void 0!==t.minFilter&&(e.minFilter=t.minFilter),void 0!==t.format&&(e.format=t.format),void 0!==t.type&&(e.type=t.type),void 0!==t.anisotropy&&(e.anisotropy=t.anisotropy),void 0!==t.colorSpace&&(e.colorSpace=t.colorSpace),void 0!==t.flipY&&(e.flipY=t.flipY),void 0!==t.generateMipmaps&&(e.generateMipmaps=t.generateMipmaps),void 0!==t.internalFormat&&(e.internalFormat=t.internalFormat);for(let t=0;t<this.textures.length;t++)this.textures[t].setValues(e)}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==t&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e,r=1){if(this.width!==t||this.height!==e||this.depth!==r){this.width=t,this.height=e,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=r,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,r=t.textures.length;e<r;e++){this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;const r=Object.assign({},t.textures[e].image);this.textures[e].source=new Source(r)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(t=1,e=1,r={}){super(t,e,r),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(t=null,e=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:r,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(t=1,e=1,r=1,i={}){super(t,e,i),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new DataArrayTexture(null,t,e,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(t=null,e=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:r,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(t=1,e=1,r=1,i={}){super(t,e,i),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new Data3DTexture(null,t,e,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Box3{constructor(t=new three_core_Vector3(1/0,1/0,1/0),e=new three_core_Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e+=3)this.expandByPoint(_vector$b.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,r=t.count;e<r;e++)this.expandByPoint(_vector$b.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const r=_vector$b.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const r=t.geometry;if(void 0!==r){const i=r.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,r=i.count;e<r;e++)!0===t.isMesh?t.getVertexPosition(e,_vector$b):_vector$b.fromBufferAttribute(i,e),_vector$b.applyMatrix4(t.matrixWorld),this.expandByPoint(_vector$b);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),_box$4.copy(t.boundingBox)):(null===r.boundingBox&&r.computeBoundingBox(),_box$4.copy(r.boundingBox)),_box$4.applyMatrix4(t.matrixWorld),this.union(_box$4)}const i=t.children;for(let t=0,r=i.length;t<r;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,_vector$b),_vector$b.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(t.a,_center),_v1$7.subVectors(t.b,_center),_v2$4.subVectors(t.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let e=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!!satForAxes(e,_v0$2,_v1$7,_v2$4,_extents)&&(e=[1,0,0,0,1,0,0,0,1],!!satForAxes(e,_v0$2,_v1$7,_v2$4,_extents)&&(_triangleNormal.crossVectors(_f0,_f1),e=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(e,_v0$2,_v1$7,_v2$4,_extents)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_vector$b).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(_vector$b).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_points)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const _points=[new three_core_Vector3,new three_core_Vector3,new three_core_Vector3,new three_core_Vector3,new three_core_Vector3,new three_core_Vector3,new three_core_Vector3,new three_core_Vector3],_vector$b=new three_core_Vector3,_box$4=new Box3,_v0$2=new three_core_Vector3,_v1$7=new three_core_Vector3,_v2$4=new three_core_Vector3,_f0=new three_core_Vector3,_f1=new three_core_Vector3,_f2=new three_core_Vector3,_center=new three_core_Vector3,_extents=new three_core_Vector3,_triangleNormal=new three_core_Vector3,_testAxis=new three_core_Vector3;function satForAxes(t,e,r,i,s){for(let n=0,o=t.length-3;n<=o;n+=3){_testAxis.fromArray(t,n);const o=s.x*Math.abs(_testAxis.x)+s.y*Math.abs(_testAxis.y)+s.z*Math.abs(_testAxis.z),a=e.dot(_testAxis),h=r.dot(_testAxis),l=i.dot(_testAxis);if(Math.max(-Math.max(a,h,l),Math.min(a,h,l))>o)return!1}return!0}const _box$3=new Box3,_v1$6=new three_core_Vector3,_v2$3=new three_core_Vector3;class Sphere{constructor(t=new three_core_Vector3,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const r=this.center;void 0!==e?r.copy(e):_box$3.setFromPoints(t).getCenter(r);let i=0;for(let e=0,s=t.length;e<s;e++)i=Math.max(i,r.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const r=this.center.distanceToSquared(t);return e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;_v1$6.subVectors(t,this.center);const e=_v1$6.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),r=.5*(t-this.radius);this.center.addScaledVector(_v1$6,r/t),this.radius+=r}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(_v2$3.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(_v1$6.copy(t.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(t.center).sub(_v2$3))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}const _vector$a=new three_core_Vector3,_segCenter=new three_core_Vector3,_segDir=new three_core_Vector3,_diff=new three_core_Vector3,_edge1=new three_core_Vector3,_edge2=new three_core_Vector3,_normal$1=new three_core_Vector3;class Ray{constructor(t=new three_core_Vector3,e=new three_core_Vector3(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,_vector$a)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=_vector$a.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(_vector$a.copy(this.origin).addScaledVector(this.direction,e),_vector$a.distanceToSquared(t))}distanceSqToSegment(t,e,r,i){_segCenter.copy(t).add(e).multiplyScalar(.5),_segDir.copy(e).sub(t).normalize(),_diff.copy(this.origin).sub(_segCenter);const s=.5*t.distanceTo(e),n=-this.direction.dot(_segDir),o=_diff.dot(this.direction),a=-_diff.dot(_segDir),h=_diff.lengthSq(),l=Math.abs(1-n*n);let c,u,p,d;if(l>0)if(c=n*a-o,u=n*o-a,d=s*l,c>=0)if(u>=-d)if(u<=d){const t=1/l;c*=t,u*=t,p=c*(c+n*u+2*o)+u*(n*c+u+2*a)+h}else u=s,c=Math.max(0,-(n*u+o)),p=-c*c+u*(u+2*a)+h;else u=-s,c=Math.max(0,-(n*u+o)),p=-c*c+u*(u+2*a)+h;else u<=-d?(c=Math.max(0,-(-n*s+o)),u=c>0?-s:Math.min(Math.max(-s,-a),s),p=-c*c+u*(u+2*a)+h):u<=d?(c=0,u=Math.min(Math.max(-s,-a),s),p=u*(u+2*a)+h):(c=Math.max(0,-(n*s+o)),u=c>0?s:Math.min(Math.max(-s,-a),s),p=-c*c+u*(u+2*a)+h);else u=n>0?-s:s,c=Math.max(0,-(n*u+o)),p=-c*c+u*(u+2*a)+h;return r&&r.copy(this.origin).addScaledVector(this.direction,c),i&&i.copy(_segCenter).addScaledVector(_segDir,u),p}intersectSphere(t,e){_vector$a.subVectors(t.center,this.origin);const r=_vector$a.dot(this.direction),i=_vector$a.dot(_vector$a)-r*r,s=t.radius*t.radius;if(i>s)return null;const n=Math.sqrt(s-i),o=r-n,a=r+n;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return!(t.radius<0)&&this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null}intersectPlane(t,e){const r=this.distanceToPlane(t);return null===r?null:this.at(r,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let r,i,s,n,o,a;const h=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,u=this.origin;return h>=0?(r=(t.min.x-u.x)*h,i=(t.max.x-u.x)*h):(r=(t.max.x-u.x)*h,i=(t.min.x-u.x)*h),l>=0?(s=(t.min.y-u.y)*l,n=(t.max.y-u.y)*l):(s=(t.max.y-u.y)*l,n=(t.min.y-u.y)*l),r>n||s>i?null:((s>r||isNaN(r))&&(r=s),(n<i||isNaN(i))&&(i=n),c>=0?(o=(t.min.z-u.z)*c,a=(t.max.z-u.z)*c):(o=(t.max.z-u.z)*c,a=(t.min.z-u.z)*c),r>a||o>i?null:((o>r||r!=r)&&(r=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(r>=0?r:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,_vector$a)}intersectTriangle(t,e,r,i,s){_edge1.subVectors(e,t),_edge2.subVectors(r,t),_normal$1.crossVectors(_edge1,_edge2);let n,o=this.direction.dot(_normal$1);if(o>0){if(i)return null;n=1}else{if(!(o<0))return null;n=-1,o=-o}_diff.subVectors(this.origin,t);const a=n*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(a<0)return null;const h=n*this.direction.dot(_edge1.cross(_diff));if(h<0)return null;if(a+h>o)return null;const l=-n*_diff.dot(_normal$1);return l<0?null:this.at(l/o,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Matrix4{constructor(t,e,r,i,s,n,o,a,h,l,c,u,p,d,m,f){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,r,i,s,n,o,a,h,l,c,u,p,d,m,f)}set(t,e,r,i,s,n,o,a,h,l,c,u,p,d,m,f){const y=this.elements;return y[0]=t,y[4]=e,y[8]=r,y[12]=i,y[1]=s,y[5]=n,y[9]=o,y[13]=a,y[2]=h,y[6]=l,y[10]=c,y[14]=u,y[3]=p,y[7]=d,y[11]=m,y[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this}copyPosition(t){const e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,r=t.elements,i=1/_v1$5.setFromMatrixColumn(t,0).length(),s=1/_v1$5.setFromMatrixColumn(t,1).length(),n=1/_v1$5.setFromMatrixColumn(t,2).length();return e[0]=r[0]*i,e[1]=r[1]*i,e[2]=r[2]*i,e[3]=0,e[4]=r[4]*s,e[5]=r[5]*s,e[6]=r[6]*s,e[7]=0,e[8]=r[8]*n,e[9]=r[9]*n,e[10]=r[10]*n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,r=t.x,i=t.y,s=t.z,n=Math.cos(r),o=Math.sin(r),a=Math.cos(i),h=Math.sin(i),l=Math.cos(s),c=Math.sin(s);if("XYZ"===t.order){const t=n*l,r=n*c,i=o*l,s=o*c;e[0]=a*l,e[4]=-a*c,e[8]=h,e[1]=r+i*h,e[5]=t-s*h,e[9]=-o*a,e[2]=s-t*h,e[6]=i+r*h,e[10]=n*a}else if("YXZ"===t.order){const t=a*l,r=a*c,i=h*l,s=h*c;e[0]=t+s*o,e[4]=i*o-r,e[8]=n*h,e[1]=n*c,e[5]=n*l,e[9]=-o,e[2]=r*o-i,e[6]=s+t*o,e[10]=n*a}else if("ZXY"===t.order){const t=a*l,r=a*c,i=h*l,s=h*c;e[0]=t-s*o,e[4]=-n*c,e[8]=i+r*o,e[1]=r+i*o,e[5]=n*l,e[9]=s-t*o,e[2]=-n*h,e[6]=o,e[10]=n*a}else if("ZYX"===t.order){const t=n*l,r=n*c,i=o*l,s=o*c;e[0]=a*l,e[4]=i*h-r,e[8]=t*h+s,e[1]=a*c,e[5]=s*h+t,e[9]=r*h-i,e[2]=-h,e[6]=o*a,e[10]=n*a}else if("YZX"===t.order){const t=n*a,r=n*h,i=o*a,s=o*h;e[0]=a*l,e[4]=s-t*c,e[8]=i*c+r,e[1]=c,e[5]=n*l,e[9]=-o*l,e[2]=-h*l,e[6]=r*c+i,e[10]=t-s*c}else if("XZY"===t.order){const t=n*a,r=n*h,i=o*a,s=o*h;e[0]=a*l,e[4]=-c,e[8]=h*l,e[1]=t*c+s,e[5]=n*l,e[9]=r*c-i,e[2]=i*c-r,e[6]=o*l,e[10]=s*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(_zero,t,_one)}lookAt(t,e,r){const i=this.elements;return _z.subVectors(t,e),0===_z.lengthSq()&&(_z.z=1),_z.normalize(),_x.crossVectors(r,_z),0===_x.lengthSq()&&(1===Math.abs(r.z)?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(r,_z)),_x.normalize(),_y.crossVectors(_z,_x),i[0]=_x.x,i[4]=_y.x,i[8]=_z.x,i[1]=_x.y,i[5]=_y.y,i[9]=_z.y,i[2]=_x.z,i[6]=_y.z,i[10]=_z.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,i=e.elements,s=this.elements,n=r[0],o=r[4],a=r[8],h=r[12],l=r[1],c=r[5],u=r[9],p=r[13],d=r[2],m=r[6],f=r[10],y=r[14],g=r[3],_=r[7],v=r[11],x=r[15],b=i[0],M=i[4],w=i[8],S=i[12],A=i[1],T=i[5],C=i[9],I=i[13],k=i[2],B=i[6],P=i[10],z=i[14],R=i[3],V=i[7],E=i[11],F=i[15];return s[0]=n*b+o*A+a*k+h*R,s[4]=n*M+o*T+a*B+h*V,s[8]=n*w+o*C+a*P+h*E,s[12]=n*S+o*I+a*z+h*F,s[1]=l*b+c*A+u*k+p*R,s[5]=l*M+c*T+u*B+p*V,s[9]=l*w+c*C+u*P+p*E,s[13]=l*S+c*I+u*z+p*F,s[2]=d*b+m*A+f*k+y*R,s[6]=d*M+m*T+f*B+y*V,s[10]=d*w+m*C+f*P+y*E,s[14]=d*S+m*I+f*z+y*F,s[3]=g*b+_*A+v*k+x*R,s[7]=g*M+_*T+v*B+x*V,s[11]=g*w+_*C+v*P+x*E,s[15]=g*S+_*I+v*z+x*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[4],i=t[8],s=t[12],n=t[1],o=t[5],a=t[9],h=t[13],l=t[2],c=t[6],u=t[10],p=t[14];return t[3]*(+s*a*c-i*h*c-s*o*u+r*h*u+i*o*p-r*a*p)+t[7]*(+e*a*p-e*h*u+s*n*u-i*n*p+i*h*l-s*a*l)+t[11]*(+e*h*c-e*o*p-s*n*c+r*n*p+s*o*l-r*h*l)+t[15]*(-i*o*l-e*a*c+e*o*u+i*n*c-r*n*u+r*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,r){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=r),this}invert(){const t=this.elements,e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=t[9],u=t[10],p=t[11],d=t[12],m=t[13],f=t[14],y=t[15],g=c*f*h-m*u*h+m*a*p-o*f*p-c*a*y+o*u*y,_=d*u*h-l*f*h-d*a*p+n*f*p+l*a*y-n*u*y,v=l*m*h-d*c*h+d*o*p-n*m*p-l*o*y+n*c*y,x=d*c*a-l*m*a-d*o*u+n*m*u+l*o*f-n*c*f,b=e*g+r*_+i*v+s*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/b;return t[0]=g*M,t[1]=(m*u*s-c*f*s-m*i*p+r*f*p+c*i*y-r*u*y)*M,t[2]=(o*f*s-m*a*s+m*i*h-r*f*h-o*i*y+r*a*y)*M,t[3]=(c*a*s-o*u*s-c*i*h+r*u*h+o*i*p-r*a*p)*M,t[4]=_*M,t[5]=(l*f*s-d*u*s+d*i*p-e*f*p-l*i*y+e*u*y)*M,t[6]=(d*a*s-n*f*s-d*i*h+e*f*h+n*i*y-e*a*y)*M,t[7]=(n*u*s-l*a*s+l*i*h-e*u*h-n*i*p+e*a*p)*M,t[8]=v*M,t[9]=(d*c*s-l*m*s-d*r*p+e*m*p+l*r*y-e*c*y)*M,t[10]=(n*m*s-d*o*s+d*r*h-e*m*h-n*r*y+e*o*y)*M,t[11]=(l*o*s-n*c*s-l*r*h+e*c*h+n*r*p-e*o*p)*M,t[12]=x*M,t[13]=(l*m*i-d*c*i+d*r*u-e*m*u-l*r*f+e*c*f)*M,t[14]=(d*o*i-n*m*i-d*r*a+e*m*a+n*r*f-e*o*f)*M,t[15]=(n*c*i-l*o*i+l*r*a-e*c*a-n*r*u+e*o*u)*M,this}scale(t){const e=this.elements,r=t.x,i=t.y,s=t.z;return e[0]*=r,e[4]*=i,e[8]*=s,e[1]*=r,e[5]*=i,e[9]*=s,e[2]*=r,e[6]*=i,e[10]*=s,e[3]*=r,e[7]*=i,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}makeTranslation(t,e,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const r=Math.cos(e),i=Math.sin(e),s=1-r,n=t.x,o=t.y,a=t.z,h=s*n,l=s*o;return this.set(h*n+r,h*o-i*a,h*a+i*o,0,h*o+i*a,l*o+r,l*a-i*n,0,h*a-i*o,l*a+i*n,s*a*a+r,0,0,0,0,1),this}makeScale(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,e,r,i,s,n){return this.set(1,r,s,0,t,1,n,0,e,i,1,0,0,0,0,1),this}compose(t,e,r){const i=this.elements,s=e._x,n=e._y,o=e._z,a=e._w,h=s+s,l=n+n,c=o+o,u=s*h,p=s*l,d=s*c,m=n*l,f=n*c,y=o*c,g=a*h,_=a*l,v=a*c,x=r.x,b=r.y,M=r.z;return i[0]=(1-(m+y))*x,i[1]=(p+v)*x,i[2]=(d-_)*x,i[3]=0,i[4]=(p-v)*b,i[5]=(1-(u+y))*b,i[6]=(f+g)*b,i[7]=0,i[8]=(d+_)*M,i[9]=(f-g)*M,i[10]=(1-(u+m))*M,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,r){const i=this.elements;let s=_v1$5.set(i[0],i[1],i[2]).length();const n=_v1$5.set(i[4],i[5],i[6]).length(),o=_v1$5.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),t.x=i[12],t.y=i[13],t.z=i[14],_m1$2.copy(this);const a=1/s,h=1/n,l=1/o;return _m1$2.elements[0]*=a,_m1$2.elements[1]*=a,_m1$2.elements[2]*=a,_m1$2.elements[4]*=h,_m1$2.elements[5]*=h,_m1$2.elements[6]*=h,_m1$2.elements[8]*=l,_m1$2.elements[9]*=l,_m1$2.elements[10]*=l,e.setFromRotationMatrix(_m1$2),r.x=s,r.y=n,r.z=o,this}makePerspective(t,e,r,i,s,n,o=WebGLCoordinateSystem,a=!1){const h=this.elements,l=2*s/(e-t),c=2*s/(r-i),u=(e+t)/(e-t),p=(r+i)/(r-i);let d,m;if(a)d=s/(n-s),m=n*s/(n-s);else if(o===WebGLCoordinateSystem)d=-(n+s)/(n-s),m=-2*n*s/(n-s);else{if(o!==WebGPUCoordinateSystem)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-n/(n-s),m=-n*s/(n-s)}return h[0]=l,h[4]=0,h[8]=u,h[12]=0,h[1]=0,h[5]=c,h[9]=p,h[13]=0,h[2]=0,h[6]=0,h[10]=d,h[14]=m,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,r,i,s,n,o=WebGLCoordinateSystem,a=!1){const h=this.elements,l=2/(e-t),c=2/(r-i),u=-(e+t)/(e-t),p=-(r+i)/(r-i);let d,m;if(a)d=1/(n-s),m=n/(n-s);else if(o===WebGLCoordinateSystem)d=-2/(n-s),m=-(n+s)/(n-s);else{if(o!==WebGPUCoordinateSystem)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);d=-1/(n-s),m=-s/(n-s)}return h[0]=l,h[4]=0,h[8]=0,h[12]=u,h[1]=0,h[5]=c,h[9]=0,h[13]=p,h[2]=0,h[6]=0,h[10]=d,h[14]=m,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,r=t.elements;for(let t=0;t<16;t++)if(e[t]!==r[t])return!1;return!0}fromArray(t,e=0){for(let r=0;r<16;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}const _v1$5=new three_core_Vector3,_m1$2=new Matrix4,_zero=new three_core_Vector3(0,0,0),_one=new three_core_Vector3(1,1,1),_x=new three_core_Vector3,_y=new three_core_Vector3,_z=new three_core_Vector3,_matrix$2=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(t=0,e=0,r=0,i=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=r,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,r,i=this._order){return this._x=t,this._y=e,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,r=!0){const i=t.elements,s=i[0],n=i[4],o=i[8],a=i[1],h=i[5],l=i[9],c=i[2],u=i[6],p=i[10];switch(e){case"XYZ":this._y=Math.asin(clamp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-n,s)):(this._x=Math.atan2(u,h),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-c,s),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-n,h)):(this._y=0,this._z=Math.atan2(a,s));break;case"ZYX":this._y=Math.asin(-clamp(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,p),this._z=Math.atan2(a,s)):(this._x=0,this._z=Math.atan2(-n,h));break;case"YZX":this._z=Math.asin(clamp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-clamp(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(u,h),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-l,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,e,r){return _matrix$2.makeRotationFromQuaternion(t),this.setFromRotationMatrix(_matrix$2,e,r)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let _object3DId=0;const _v1$4=new three_core_Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new three_core_Vector3,_position$3=new three_core_Vector3,_scale$2=new three_core_Vector3,_quaternion$2=new Quaternion,_xAxis=new three_core_Vector3(1,0,0),_yAxis=new three_core_Vector3(0,1,0),_zAxis=new three_core_Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"},_childaddedEvent={type:"childadded",child:null},_childremovedEvent={type:"childremoved",child:null};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const t=new three_core_Vector3,e=new Euler,r=new Quaternion,i=new three_core_Vector3(1,1,1);e._onChange((function(){r.setFromEuler(e,!1)})),r._onChange((function(){e.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return _q1.setFromAxisAngle(t,e),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(t,e){return _q1.setFromAxisAngle(t,e),this.quaternion.premultiply(_q1),this}rotateX(t){return this.rotateOnAxis(_xAxis,t)}rotateY(t){return this.rotateOnAxis(_yAxis,t)}rotateZ(t){return this.rotateOnAxis(_zAxis,t)}translateOnAxis(t,e){return _v1$4.copy(t).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(_xAxis,t)}translateY(t){return this.translateOnAxis(_yAxis,t)}translateZ(t){return this.translateOnAxis(_zAxis,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(t,e,r){t.isVector3?_target.copy(t):_target.set(t,e,r);const i=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),i&&(_m1$1.extractRotation(i.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(_addedEvent),_childaddedEvent.child=t,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(_removedEvent),_childremovedEvent.child=t,this.dispatchEvent(_childremovedEvent),_childremovedEvent.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(t.parent.matrixWorld)),t.applyMatrix4(_m1$1),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(_addedEvent),_childaddedEvent.child=t,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let r=0,i=this.children.length;r<i;r++){const i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e,r=[]){this[t]===e&&r.push(this);const i=this.children;for(let s=0,n=i.length;s<n;s++)i[s].getObjectsByProperty(t,e,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,t,_scale$2),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].updateMatrixWorld(t)}updateWorldMatrix(t,e){const r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,r=t.length;e<r;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};function s(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map((t=>({...t,boundingBox:t.boundingBox?t.boundingBox.toJSON():void 0,boundingSphere:t.boundingSphere?t.boundingSphere.toJSON():void 0}))),i.instanceInfo=this._instanceInfo.map((t=>({...t}))),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(t),i.indirectTexture=this._indirectTexture.toJSON(t),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(i.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(i.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const r=e.shapes;if(Array.isArray(r))for(let e=0,i=r.length;e<i;e++){const i=r[e];s(t.shapes,i)}else s(t.shapes,r)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let r=0,i=this.material.length;r<i;r++)e.push(s(t.materials,this.material[r]));i.material=e}else i.material=s(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const r=this.animations[e];i.animations.push(s(t.animations,r))}}if(e){const e=n(t.geometries),i=n(t.materials),s=n(t.textures),o=n(t.images),a=n(t.shapes),h=n(t.skeletons),l=n(t.animations),c=n(t.nodes);e.length>0&&(r.geometries=e),i.length>0&&(r.materials=i),s.length>0&&(r.textures=s),o.length>0&&(r.images=o),a.length>0&&(r.shapes=a),h.length>0&&(r.skeletons=h),l.length>0&&(r.animations=l),c.length>0&&(r.nodes=c)}return r.object=i,r;function n(t){const e=[];for(const r in t){const i=t[r];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const r=t.children[e];this.add(r.clone())}return this}}Object3D.DEFAULT_UP=new three_core_Vector3(0,1,0),Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0,Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new three_core_Vector3,_v1$3=new three_core_Vector3,_v2$2=new three_core_Vector3,_v3$2=new three_core_Vector3,_vab=new three_core_Vector3,_vac=new three_core_Vector3,_vbc=new three_core_Vector3,_vap=new three_core_Vector3,_vbp=new three_core_Vector3,_vcp=new three_core_Vector3,_v40=new Vector4,_v41=new Vector4,_v42=new Vector4;class Triangle{constructor(t=new three_core_Vector3,e=new three_core_Vector3,r=new three_core_Vector3){this.a=t,this.b=e,this.c=r}static getNormal(t,e,r,i){i.subVectors(r,e),_v0$1.subVectors(t,e),i.cross(_v0$1);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(t,e,r,i,s){_v0$1.subVectors(i,e),_v1$3.subVectors(r,e),_v2$2.subVectors(t,e);const n=_v0$1.dot(_v0$1),o=_v0$1.dot(_v1$3),a=_v0$1.dot(_v2$2),h=_v1$3.dot(_v1$3),l=_v1$3.dot(_v2$2),c=n*h-o*o;if(0===c)return s.set(0,0,0),null;const u=1/c,p=(h*a-o*l)*u,d=(n*l-o*a)*u;return s.set(1-p-d,d,p)}static containsPoint(t,e,r,i){return null!==this.getBarycoord(t,e,r,i,_v3$2)&&_v3$2.x>=0&&_v3$2.y>=0&&_v3$2.x+_v3$2.y<=1}static getInterpolation(t,e,r,i,s,n,o,a){return null===this.getBarycoord(t,e,r,i,_v3$2)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(s,_v3$2.x),a.addScaledVector(n,_v3$2.y),a.addScaledVector(o,_v3$2.z),a)}static getInterpolatedAttribute(t,e,r,i,s,n){return _v40.setScalar(0),_v41.setScalar(0),_v42.setScalar(0),_v40.fromBufferAttribute(t,e),_v41.fromBufferAttribute(t,r),_v42.fromBufferAttribute(t,i),n.setScalar(0),n.addScaledVector(_v40,s.x),n.addScaledVector(_v41,s.y),n.addScaledVector(_v42,s.z),n}static isFrontFacing(t,e,r,i){return _v0$1.subVectors(r,e),_v1$3.subVectors(t,e),_v0$1.cross(_v1$3).dot(i)<0}set(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this}setFromPointsAndIndices(t,e,r,i){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,r,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),.5*_v0$1.cross(_v1$3).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Triangle.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Triangle.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,r,i,s){return Triangle.getInterpolation(t,this.a,this.b,this.c,e,r,i,s)}containsPoint(t){return Triangle.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Triangle.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const r=this.a,i=this.b,s=this.c;let n,o;_vab.subVectors(i,r),_vac.subVectors(s,r),_vap.subVectors(t,r);const a=_vab.dot(_vap),h=_vac.dot(_vap);if(a<=0&&h<=0)return e.copy(r);_vbp.subVectors(t,i);const l=_vab.dot(_vbp),c=_vac.dot(_vbp);if(l>=0&&c<=l)return e.copy(i);const u=a*c-l*h;if(u<=0&&a>=0&&l<=0)return n=a/(a-l),e.copy(r).addScaledVector(_vab,n);_vcp.subVectors(t,s);const p=_vab.dot(_vcp),d=_vac.dot(_vcp);if(d>=0&&p<=d)return e.copy(s);const m=p*h-a*d;if(m<=0&&h>=0&&d<=0)return o=h/(h-d),e.copy(r).addScaledVector(_vac,o);const f=l*d-p*c;if(f<=0&&c-l>=0&&p-d>=0)return _vbc.subVectors(s,i),o=(c-l)/(c-l+(p-d)),e.copy(i).addScaledVector(_vbc,o);const y=1/(f+m+u);return n=m*y,o=u*y,e.copy(r).addScaledVector(_vab,n).addScaledVector(_vac,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}class Color{constructor(t,e,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,r)}set(t,e,r){if(void 0===e&&void 0===r){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=SRGBColorSpace){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,ColorManagement.colorSpaceToWorking(this,e),this}setRGB(t,e,r,i=ColorManagement.workingColorSpace){return this.r=t,this.g=e,this.b=r,ColorManagement.colorSpaceToWorking(this,i),this}setHSL(t,e,r,i=ColorManagement.workingColorSpace){if(t=euclideanModulo(t,1),e=clamp(e,0,1),r=clamp(r,0,1),0===e)this.r=this.g=this.b=r;else{const i=r<=.5?r*(1+e):r+e-r*e,s=2*r-i;this.r=hue2rgb(s,i,t+1/3),this.g=hue2rgb(s,i,t),this.b=hue2rgb(s,i,t-1/3)}return ColorManagement.colorSpaceToWorking(this,i),this}setStyle(t,e=SRGBColorSpace){function r(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const n=i[1],o=i[2];switch(n){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const r=i[1],s=r.length;if(3===s)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,e);if(6===s)return this.setHex(parseInt(r,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=SRGBColorSpace){const r=_colorKeywords[t.toLowerCase()];return void 0!==r?this.setHex(r,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this}copyLinearToSRGB(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=SRGBColorSpace){return ColorManagement.workingToColorSpace(_color.copy(this),t),65536*Math.round(clamp(255*_color.r,0,255))+256*Math.round(clamp(255*_color.g,0,255))+Math.round(clamp(255*_color.b,0,255))}getHexString(t=SRGBColorSpace){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ColorManagement.workingColorSpace){ColorManagement.workingToColorSpace(_color.copy(this),e);const r=_color.r,i=_color.g,s=_color.b,n=Math.max(r,i,s),o=Math.min(r,i,s);let a,h;const l=(o+n)/2;if(o===n)a=0,h=0;else{const t=n-o;switch(h=l<=.5?t/(n+o):t/(2-n-o),n){case r:a=(i-s)/t+(i<s?6:0);break;case i:a=(s-r)/t+2;break;case s:a=(r-i)/t+4}a/=6}return t.h=a,t.s=h,t.l=l,t}getRGB(t,e=ColorManagement.workingColorSpace){return ColorManagement.workingToColorSpace(_color.copy(this),e),t.r=_color.r,t.g=_color.g,t.b=_color.b,t}getStyle(t=SRGBColorSpace){ColorManagement.workingToColorSpace(_color.copy(this),t);const e=_color.r,r=_color.g,i=_color.b;return t!==SRGBColorSpace?`color(${t} ${e.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*i)})`}offsetHSL(t,e,r){return this.getHSL(_hslA),this.setHSL(_hslA.h+t,_hslA.s+e,_hslA.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,r){return this.r=t.r+(e.r-t.r)*r,this.g=t.g+(e.g-t.g)*r,this.b=t.b+(e.b-t.b)*r,this}lerpHSL(t,e){this.getHSL(_hslA),t.getHSL(_hslB);const r=lerp(_hslA.h,_hslB.h,e),i=lerp(_hslA.s,_hslB.s,e),s=lerp(_hslA.l,_hslB.l,e);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*e+s[3]*r+s[6]*i,this.g=s[1]*e+s[4]*r+s[7]*i,this.b=s[2]*e+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;let _materialId=0;class Material extends EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const r=t[e];if(void 0===r){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[e]=r:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const r={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const r in t){const i=t[r];delete i.metadata,e.push(i)}return e}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(r.dispersion=this.dispersion),void 0!==this.iridescence&&(r.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(r.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(r.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapRotation&&(r.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(r.blending=this.blending),this.side!==FrontSide&&(r.side=this.side),!0===this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(r.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(r.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(r.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(r.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(r.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(r.depthFunc=this.depthFunc),!1===this.depthTest&&(r.depthTest=this.depthTest),!1===this.depthWrite&&(r.depthWrite=this.depthWrite),!1===this.colorWrite&&(r.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(r.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(r.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(r.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(r.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(r.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaHash&&(r.alphaHash=!0),!0===this.alphaToCoverage&&(r.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=!0),!0===this.forceSinglePass&&(r.forceSinglePass=!0),!0===this.wireframe&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData),e){const e=i(t.textures),s=i(t.images);e.length>0&&(r.textures=e),s.length>0&&(r.images=s)}return r}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let r=null;if(null!==e){const t=e.length;r=new Array(t);for(let i=0;i!==t;++i)r[i]=e[i].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class MeshBasicMaterial extends Material{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const _tables=_generateTables();function _generateTables(){const t=new ArrayBuffer(4),e=new Float32Array(t),r=new Uint32Array(t),i=new Uint32Array(512),s=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(i[t]=0,i[256|t]=32768,s[t]=24,s[256|t]=24):e<-14?(i[t]=1024>>-e-14,i[256|t]=1024>>-e-14|32768,s[t]=-e-1,s[256|t]=-e-1):e<=15?(i[t]=e+15<<10,i[256|t]=e+15<<10|32768,s[t]=13,s[256|t]=13):e<128?(i[t]=31744,i[256|t]=64512,s[t]=24,s[256|t]=24):(i[t]=31744,i[256|t]=64512,s[t]=13,s[256|t]=13)}const n=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,r=0;for(;!(8388608&e);)e<<=1,r-=8388608;e&=-8388609,r+=947912704,n[t]=e|r}for(let t=1024;t<2048;++t)n[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)o[t]=t<<23;o[31]=1199570944,o[32]=2147483648;for(let t=33;t<63;++t)o[t]=2147483648+(t-32<<23);o[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(a[t]=1024);return{floatView:e,uint32View:r,baseTable:i,shiftTable:s,mantissaTable:n,exponentTable:o,offsetTable:a}}function toHalfFloat(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=clamp(t,-65504,65504),_tables.floatView[0]=t;const e=_tables.uint32View[0],r=e>>23&511;return _tables.baseTable[r]+((8388607&e)>>_tables.shiftTable[r])}function fromHalfFloat(t){const e=t>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[e]+(1023&t)]+_tables.exponentTable[e],_tables.floatView[0]}class DataUtils{static toHalfFloat(t){return toHalfFloat(t)}static fromHalfFloat(t){return fromHalfFloat(t)}}const _vector$9=new three_core_Vector3,_vector2$1=new Vector2;let _id$2=0;class BufferAttribute{constructor(t,e,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=r,this.usage=StaticDrawUsage,this.updateRanges=[],this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,r){t*=this.itemSize,r*=e.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[t+i]=e.array[r+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,r=this.count;e<r;e++)_vector2$1.fromBufferAttribute(this,e),_vector2$1.applyMatrix3(t),this.setXY(e,_vector2$1.x,_vector2$1.y);else if(3===this.itemSize)for(let e=0,r=this.count;e<r;e++)_vector$9.fromBufferAttribute(this,e),_vector$9.applyMatrix3(t),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(t){for(let e=0,r=this.count;e<r;e++)_vector$9.fromBufferAttribute(this,e),_vector$9.applyMatrix4(t),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(t){for(let e=0,r=this.count;e<r;e++)_vector$9.fromBufferAttribute(this,e),_vector$9.applyNormalMatrix(t),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(t){for(let e=0,r=this.count;e<r;e++)_vector$9.fromBufferAttribute(this,e),_vector$9.transformDirection(t),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let r=this.array[t*this.itemSize+e];return this.normalized&&(r=denormalize(r,this.array)),r}setComponent(t,e,r){return this.normalized&&(r=normalize(r,this.array)),this.array[t*this.itemSize+e]=r,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=denormalize(e,this.array)),e}setX(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=denormalize(e,this.array)),e}setY(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=denormalize(e,this.array)),e}setZ(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=denormalize(e,this.array)),e}setW(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,r){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),r=normalize(r,this.array)),this.array[t+0]=e,this.array[t+1]=r,this}setXYZ(t,e,r,i){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),r=normalize(r,this.array),i=normalize(i,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this}setXYZW(t,e,r,i,s){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),r=normalize(r,this.array),i=normalize(i,this.array),s=normalize(s,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==StaticDrawUsage&&(t.usage=this.usage),t}}class Int8BufferAttribute extends BufferAttribute{constructor(t,e,r){super(new Int8Array(t),e,r)}}class Uint8BufferAttribute extends BufferAttribute{constructor(t,e,r){super(new Uint8Array(t),e,r)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(t,e,r){super(new Uint8ClampedArray(t),e,r)}}class Int16BufferAttribute extends BufferAttribute{constructor(t,e,r){super(new Int16Array(t),e,r)}}class Uint16BufferAttribute extends BufferAttribute{constructor(t,e,r){super(new Uint16Array(t),e,r)}}class Int32BufferAttribute extends BufferAttribute{constructor(t,e,r){super(new Int32Array(t),e,r)}}class Uint32BufferAttribute extends BufferAttribute{constructor(t,e,r){super(new Uint32Array(t),e,r)}}class Float16BufferAttribute extends BufferAttribute{constructor(t,e,r){super(new Uint16Array(t),e,r),this.isFloat16BufferAttribute=!0}getX(t){let e=fromHalfFloat(this.array[t*this.itemSize]);return this.normalized&&(e=denormalize(e,this.array)),e}setX(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize]=toHalfFloat(e),this}getY(t){let e=fromHalfFloat(this.array[t*this.itemSize+1]);return this.normalized&&(e=denormalize(e,this.array)),e}setY(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+1]=toHalfFloat(e),this}getZ(t){let e=fromHalfFloat(this.array[t*this.itemSize+2]);return this.normalized&&(e=denormalize(e,this.array)),e}setZ(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+2]=toHalfFloat(e),this}getW(t){let e=fromHalfFloat(this.array[t*this.itemSize+3]);return this.normalized&&(e=denormalize(e,this.array)),e}setW(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+3]=toHalfFloat(e),this}setXY(t,e,r){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),r=normalize(r,this.array)),this.array[t+0]=toHalfFloat(e),this.array[t+1]=toHalfFloat(r),this}setXYZ(t,e,r,i){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),r=normalize(r,this.array),i=normalize(i,this.array)),this.array[t+0]=toHalfFloat(e),this.array[t+1]=toHalfFloat(r),this.array[t+2]=toHalfFloat(i),this}setXYZW(t,e,r,i,s){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),r=normalize(r,this.array),i=normalize(i,this.array),s=normalize(s,this.array)),this.array[t+0]=toHalfFloat(e),this.array[t+1]=toHalfFloat(r),this.array[t+2]=toHalfFloat(i),this.array[t+3]=toHalfFloat(s),this}}class Float32BufferAttribute extends BufferAttribute{constructor(t,e,r){super(new Float32Array(t),e,r)}}let _id$1=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new three_core_Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$8=new three_core_Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$1++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(arrayNeedsUint32(t)?Uint32BufferAttribute:Uint16BufferAttribute)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,r=0){this.groups.push({start:t,count:e,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const e=(new Matrix3).getNormalMatrix(t);r.applyNormalMatrix(e),r.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return _m1.makeRotationFromQuaternion(t),this.applyMatrix4(_m1),this}rotateX(t){return _m1.makeRotationX(t),this.applyMatrix4(_m1),this}rotateY(t){return _m1.makeRotationY(t),this.applyMatrix4(_m1),this}rotateZ(t){return _m1.makeRotationZ(t),this.applyMatrix4(_m1),this}translate(t,e,r){return _m1.makeTranslation(t,e,r),this.applyMatrix4(_m1),this}scale(t,e,r){return _m1.makeScale(t,e,r),this.applyMatrix4(_m1),this}lookAt(t){return _obj.lookAt(t),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];e.push(i.x,i.y,i.z||0)}this.setAttribute("position",new Float32BufferAttribute(e,3))}else{const r=Math.min(t.length,e.count);for(let i=0;i<r;i++){const r=t[i];e.setXYZ(i,r.x,r.y,r.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new three_core_Vector3(-1/0,-1/0,-1/0),new three_core_Vector3(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const r=e[t];_box$2.setFromBufferAttribute(r),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new three_core_Vector3,1/0);if(t){const r=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const r=e[t];_boxMorphTargets.setFromBufferAttribute(r),this.morphTargetsRelative?(_vector$8.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$8),_vector$8.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$8)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(r);let i=0;for(let e=0,s=t.count;e<s;e++)_vector$8.fromBufferAttribute(t,e),i=Math.max(i,r.distanceToSquared(_vector$8));if(e)for(let s=0,n=e.length;s<n;s++){const n=e[s],o=this.morphTargetsRelative;for(let e=0,s=n.count;e<s;e++)_vector$8.fromBufferAttribute(n,e),o&&(_offset.fromBufferAttribute(t,e),_vector$8.add(_offset)),i=Math.max(i,r.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const r=e.position,i=e.normal,s=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*r.count),4));const n=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<r.count;t++)o[t]=new three_core_Vector3,a[t]=new three_core_Vector3;const h=new three_core_Vector3,l=new three_core_Vector3,c=new three_core_Vector3,u=new Vector2,p=new Vector2,d=new Vector2,m=new three_core_Vector3,f=new three_core_Vector3;function y(t,e,i){h.fromBufferAttribute(r,t),l.fromBufferAttribute(r,e),c.fromBufferAttribute(r,i),u.fromBufferAttribute(s,t),p.fromBufferAttribute(s,e),d.fromBufferAttribute(s,i),l.sub(h),c.sub(h),p.sub(u),d.sub(u);const n=1/(p.x*d.y-d.x*p.y);isFinite(n)&&(m.copy(l).multiplyScalar(d.y).addScaledVector(c,-p.y).multiplyScalar(n),f.copy(c).multiplyScalar(p.x).addScaledVector(l,-d.x).multiplyScalar(n),o[t].add(m),o[e].add(m),o[i].add(m),a[t].add(f),a[e].add(f),a[i].add(f))}let g=this.groups;0===g.length&&(g=[{start:0,count:t.count}]);for(let e=0,r=g.length;e<r;++e){const r=g[e],i=r.start;for(let e=i,s=i+r.count;e<s;e+=3)y(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const _=new three_core_Vector3,v=new three_core_Vector3,x=new three_core_Vector3,b=new three_core_Vector3;function M(t){x.fromBufferAttribute(i,t),b.copy(x);const e=o[t];_.copy(e),_.sub(x.multiplyScalar(x.dot(e))).normalize(),v.crossVectors(b,e);const r=v.dot(a[t])<0?-1:1;n.setXYZW(t,_.x,_.y,_.z,r)}for(let e=0,r=g.length;e<r;++e){const r=g[e],i=r.start;for(let e=i,s=i+r.count;e<s;e+=3)M(t.getX(e+0)),M(t.getX(e+1)),M(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let r=this.getAttribute("normal");if(void 0===r)r=new BufferAttribute(new Float32Array(3*e.count),3),this.setAttribute("normal",r);else for(let t=0,e=r.count;t<e;t++)r.setXYZ(t,0,0,0);const i=new three_core_Vector3,s=new three_core_Vector3,n=new three_core_Vector3,o=new three_core_Vector3,a=new three_core_Vector3,h=new three_core_Vector3,l=new three_core_Vector3,c=new three_core_Vector3;if(t)for(let u=0,p=t.count;u<p;u+=3){const p=t.getX(u+0),d=t.getX(u+1),m=t.getX(u+2);i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,d),n.fromBufferAttribute(e,m),l.subVectors(n,s),c.subVectors(i,s),l.cross(c),o.fromBufferAttribute(r,p),a.fromBufferAttribute(r,d),h.fromBufferAttribute(r,m),o.add(l),a.add(l),h.add(l),r.setXYZ(p,o.x,o.y,o.z),r.setXYZ(d,a.x,a.y,a.z),r.setXYZ(m,h.x,h.y,h.z)}else for(let t=0,o=e.count;t<o;t+=3)i.fromBufferAttribute(e,t+0),s.fromBufferAttribute(e,t+1),n.fromBufferAttribute(e,t+2),l.subVectors(n,s),c.subVectors(i,s),l.cross(c),r.setXYZ(t+0,l.x,l.y,l.z),r.setXYZ(t+1,l.x,l.y,l.z),r.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,r=t.count;e<r;e++)_vector$8.fromBufferAttribute(t,e),_vector$8.normalize(),t.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function t(t,e){const r=t.array,i=t.itemSize,s=t.normalized,n=new r.constructor(e.length*i);let o=0,a=0;for(let s=0,h=e.length;s<h;s++){o=t.isInterleavedBufferAttribute?e[s]*t.data.stride+t.offset:e[s]*i;for(let t=0;t<i;t++)n[a++]=r[o++]}return new BufferAttribute(n,i,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new BufferGeometry,r=this.index.array,i=this.attributes;for(const s in i){const n=t(i[s],r);e.setAttribute(s,n)}const s=this.morphAttributes;for(const i in s){const n=[],o=s[i];for(let e=0,i=o.length;e<i;e++){const i=t(o[e],r);n.push(i)}e.morphAttributes[i]=n}e.morphTargetsRelative=this.morphTargetsRelative;const n=this.groups;for(let t=0,r=n.length;t<r;t++){const r=n[t];e.addGroup(r.start,r.count,r.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const r=this.attributes;for(const e in r){const i=r[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let s=!1;for(const e in this.morphAttributes){const r=this.morphAttributes[e],n=[];for(let e=0,i=r.length;e<i;e++){const i=r[e];n.push(i.toJSON(t.data))}n.length>0&&(i[e]=n,s=!0)}s&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const n=this.groups;n.length>0&&(t.data.groups=JSON.parse(JSON.stringify(n)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere=o.toJSON()),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const r=t.index;null!==r&&this.setIndex(r.clone());const i=t.attributes;for(const t in i){const r=i[t];this.setAttribute(t,r.clone(e))}const s=t.morphAttributes;for(const t in s){const r=[],i=s[t];for(let t=0,s=i.length;t<s;t++)r.push(i[t].clone(e));this.morphAttributes[t]=r}this.morphTargetsRelative=t.morphTargetsRelative;const n=t.groups;for(let t=0,e=n.length;t<e;t++){const e=n[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray,_sphere$6=new Sphere,_sphereHitAt=new three_core_Vector3,_vA$1=new three_core_Vector3,_vB$1=new three_core_Vector3,_vC$1=new three_core_Vector3,_tempA=new three_core_Vector3,_morphA=new three_core_Vector3,_intersectionPoint=new three_core_Vector3,_intersectionPointWorld=new three_core_Vector3;class Mesh extends Object3D{constructor(t=new BufferGeometry,e=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const r=t[e[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=r.length;t<e;t++){const e=r[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,n=r.morphTargetsRelative;e.fromBufferAttribute(i,t);const o=this.morphTargetInfluences;if(s&&o){_morphA.set(0,0,0);for(let r=0,i=s.length;r<i;r++){const i=o[r],a=s[r];0!==i&&(_tempA.fromBufferAttribute(a,t),n?_morphA.addScaledVector(_tempA,i):_morphA.addScaledVector(_tempA.sub(e),i))}e.add(_morphA)}return e}raycast(t,e){const r=this.geometry,i=this.material,s=this.matrixWorld;if(void 0!==i){if(null===r.boundingSphere&&r.computeBoundingSphere(),_sphere$6.copy(r.boundingSphere),_sphere$6.applyMatrix4(s),_ray$3.copy(t.ray).recast(t.near),!1===_sphere$6.containsPoint(_ray$3.origin)){if(null===_ray$3.intersectSphere(_sphere$6,_sphereHitAt))return;if(_ray$3.origin.distanceToSquared(_sphereHitAt)>(t.far-t.near)**2)return}_inverseMatrix$3.copy(s).invert(),_ray$3.copy(t.ray).applyMatrix4(_inverseMatrix$3),null!==r.boundingBox&&!1===_ray$3.intersectsBox(r.boundingBox)||this._computeIntersections(t,e,_ray$3)}}_computeIntersections(t,e,r){let i;const s=this.geometry,n=this.material,o=s.index,a=s.attributes.position,h=s.attributes.uv,l=s.attributes.uv1,c=s.attributes.normal,u=s.groups,p=s.drawRange;if(null!==o)if(Array.isArray(n))for(let s=0,a=u.length;s<a;s++){const a=u[s],d=n[a.materialIndex];for(let s=Math.max(a.start,p.start),n=Math.min(o.count,Math.min(a.start+a.count,p.start+p.count));s<n;s+=3)i=checkGeometryIntersection(this,d,t,r,h,l,c,o.getX(s),o.getX(s+1),o.getX(s+2)),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=a.materialIndex,e.push(i))}else for(let s=Math.max(0,p.start),a=Math.min(o.count,p.start+p.count);s<a;s+=3)i=checkGeometryIntersection(this,n,t,r,h,l,c,o.getX(s),o.getX(s+1),o.getX(s+2)),i&&(i.faceIndex=Math.floor(s/3),e.push(i));else if(void 0!==a)if(Array.isArray(n))for(let s=0,o=u.length;s<o;s++){const o=u[s],d=n[o.materialIndex];for(let s=Math.max(o.start,p.start),n=Math.min(a.count,Math.min(o.start+o.count,p.start+p.count));s<n;s+=3)i=checkGeometryIntersection(this,d,t,r,h,l,c,s,s+1,s+2),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=o.materialIndex,e.push(i))}else for(let s=Math.max(0,p.start),o=Math.min(a.count,p.start+p.count);s<o;s+=3)i=checkGeometryIntersection(this,n,t,r,h,l,c,s,s+1,s+2),i&&(i.faceIndex=Math.floor(s/3),e.push(i))}}function checkIntersection$1(t,e,r,i,s,n,o,a){let h;if(h=e.side===BackSide?i.intersectTriangle(o,n,s,!0,a):i.intersectTriangle(s,n,o,e.side===FrontSide,a),null===h)return null;_intersectionPointWorld.copy(a),_intersectionPointWorld.applyMatrix4(t.matrixWorld);const l=r.ray.origin.distanceTo(_intersectionPointWorld);return l<r.near||l>r.far?null:{distance:l,point:_intersectionPointWorld.clone(),object:t}}function checkGeometryIntersection(t,e,r,i,s,n,o,a,h,l){t.getVertexPosition(a,_vA$1),t.getVertexPosition(h,_vB$1),t.getVertexPosition(l,_vC$1);const c=checkIntersection$1(t,e,r,i,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(c){const t=new three_core_Vector3;Triangle.getBarycoord(_intersectionPoint,_vA$1,_vB$1,_vC$1,t),s&&(c.uv=Triangle.getInterpolatedAttribute(s,a,h,l,t,new Vector2)),n&&(c.uv1=Triangle.getInterpolatedAttribute(n,a,h,l,t,new Vector2)),o&&(c.normal=Triangle.getInterpolatedAttribute(o,a,h,l,t,new three_core_Vector3),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const e={a,b:h,c:l,normal:new three_core_Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,e.normal),c.face=e,c.barycoord=t}return c}class BoxGeometry extends BufferGeometry{constructor(t=1,e=1,r=1,i=1,s=1,n=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:i,heightSegments:s,depthSegments:n};const o=this;i=Math.floor(i),s=Math.floor(s),n=Math.floor(n);const a=[],h=[],l=[],c=[];let u=0,p=0;function d(t,e,r,i,s,n,d,m,f,y,g){const _=n/f,v=d/y,x=n/2,b=d/2,M=m/2,w=f+1,S=y+1;let A=0,T=0;const C=new three_core_Vector3;for(let n=0;n<S;n++){const o=n*v-b;for(let a=0;a<w;a++){const u=a*_-x;C[t]=u*i,C[e]=o*s,C[r]=M,h.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[r]=m>0?1:-1,l.push(C.x,C.y,C.z),c.push(a/f),c.push(1-n/y),A+=1}}for(let t=0;t<y;t++)for(let e=0;e<f;e++){const r=u+e+w*t,i=u+e+w*(t+1),s=u+(e+1)+w*(t+1),n=u+(e+1)+w*t;a.push(r,i,n),a.push(i,s,n),T+=6}o.addGroup(p,T,g),p+=T,u+=A}d("z","y","x",-1,-1,r,e,t,n,s,0),d("z","y","x",1,-1,r,e,-t,n,s,1),d("x","z","y",1,1,t,r,e,i,n,2),d("x","z","y",1,-1,t,r,-e,i,n,3),d("x","y","z",1,-1,t,e,r,i,s,4),d("x","y","z",-1,-1,t,e,-r,i,s,5),this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new BoxGeometry(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function cloneUniforms(t){const e={};for(const r in t){e[r]={};for(const i in t[r]){const s=t[r][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[r][i]=null):e[r][i]=s.clone():Array.isArray(s)?e[r][i]=s.slice():e[r][i]=s}}return e}function mergeUniforms(t){const e={};for(let r=0;r<t.length;r++){const i=cloneUniforms(t[r]);for(const t in i)e[t]=i[t]}return e}function cloneUniformsGroups(t){const e=[];for(let r=0;r<t.length;r++)e.push(t[r].clone());return e}function getUnlitUniformColorSpace(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:ColorManagement.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",default_fragment="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";class ShaderMaterial extends Material{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cloneUniforms(t.uniforms),this.uniformsGroups=cloneUniformsGroups(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const r in this.uniforms){const i=this.uniforms[r].value;i&&i.isTexture?e.uniforms[r]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[r]={type:"m4",value:i.toArray()}:e.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const r={};for(const t in this.extensions)!0===this.extensions[t]&&(r[t]=!0);return Object.keys(r).length>0&&(e.extensions=r),e}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const _v3$1=new three_core_Vector3,_minTarget=new Vector2,_maxTarget=new Vector2;class PerspectiveCamera extends Camera{constructor(t=50,e=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*RAD2DEG*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*DEG2RAD*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*RAD2DEG*Math.atan(Math.tan(.5*DEG2RAD*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,r){_v3$1.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(_v3$1.x,_v3$1.y).multiplyScalar(-t/_v3$1.z),_v3$1.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(_v3$1.x,_v3$1.y).multiplyScalar(-t/_v3$1.z)}getViewSize(t,e){return this.getViewBounds(t,_minTarget,_maxTarget),e.subVectors(_maxTarget,_minTarget)}setViewOffset(t,e,r,i,s,n){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*DEG2RAD*this.fov)/this.zoom,r=2*e,i=this.aspect*r,s=-.5*i;const n=this.view;if(null!==this.view&&this.view.enabled){const t=n.fullWidth,o=n.fullHeight;s+=n.offsetX*i/t,e-=n.offsetY*r/o,i*=n.width/t,r*=n.height/o}const o=this.filmOffset;0!==o&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,e,e-r,t,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(t,e,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new PerspectiveCamera(fov,aspect,t,e);i.layers=this.layers,this.add(i);const s=new PerspectiveCamera(fov,aspect,t,e);s.layers=this.layers,this.add(s);const n=new PerspectiveCamera(fov,aspect,t,e);n.layers=this.layers,this.add(n);const o=new PerspectiveCamera(fov,aspect,t,e);o.layers=this.layers,this.add(o);const a=new PerspectiveCamera(fov,aspect,t,e);a.layers=this.layers,this.add(a);const h=new PerspectiveCamera(fov,aspect,t,e);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[r,i,s,n,o,a]=e;for(const t of e)this.remove(t);if(t===WebGLCoordinateSystem)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),n.up.set(0,0,1),n.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(t!==WebGPUCoordinateSystem)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),n.up.set(0,0,-1),n.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[s,n,o,a,h,l]=this.children,c=t.getRenderTarget(),u=t.getActiveCubeFace(),p=t.getActiveMipmapLevel(),d=t.xr.enabled;t.xr.enabled=!1;const m=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,t.setRenderTarget(r,0,i),t.render(e,s),t.setRenderTarget(r,1,i),t.render(e,n),t.setRenderTarget(r,2,i),t.render(e,o),t.setRenderTarget(r,3,i),t.render(e,a),t.setRenderTarget(r,4,i),t.render(e,h),r.texture.generateMipmaps=m,t.setRenderTarget(r,5,i),t.render(e,l),t.setRenderTarget(c,u,p),t.xr.enabled=d,r.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(t=[],e=CubeReflectionMapping,r,i,s,n,o,a,h,l){super(t,e,r,i,s,n,o,a,h,l),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const r={width:t,height:t,depth:1},i=[r,r,r,r,r,r];this.texture=new CubeTexture(i),this._setTextureOptions(e),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const r={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",s="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",n=new BoxGeometry(5,5,5),o=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(r),vertexShader:i,fragmentShader:s,side:BackSide,blending:NoBlending});o.uniforms.tEquirect.value=e;const a=new Mesh(n,o),h=e.minFilter;return e.minFilter===LinearMipmapLinearFilter&&(e.minFilter=LinearFilter),new CubeCamera(1,10,this).update(t,a),e.minFilter=h,a.geometry.dispose(),a.material.dispose(),this}clear(t,e=!0,r=!0,i=!0){const s=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,r,i);t.setRenderTarget(s)}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new three_core_Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new three_core_Vector3),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new three_core_Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new three_core_Vector3),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const r of t.hand.values())this._getHandJoint(e,r)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,r){let i=null,s=null,n=null;const o=this._targetRay,a=this._grip,h=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(h&&t.hand){n=!0;for(const i of t.hand.values()){const t=e.getJointPose(i,r),s=this._getHandJoint(h,i);null!==t&&(s.matrix.fromArray(t.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,s.jointRadius=t.radius),s.visible=null!==t}const i=h.joints["index-finger-tip"],s=h.joints["thumb-tip"],o=i.position.distanceTo(s.position),a=.02,l=.005;h.inputState.pinching&&o>a+l?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!h.inputState.pinching&&o<=a-l&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(s=e.getPose(t.gripSpace,r),null!==s&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(i=e.getPose(t.targetRaySpace,r),null===i&&null!==s&&(i=s),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==s),null!==h&&(h.visible=null!==n),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const r=new Group;r.matrixAutoUpdate=!1,r.visible=!1,t.joints[e.jointName]=r,t.add(r)}return t.joints[e.jointName]}}class FogExp2{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color(t),this.density=e}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Fog{constructor(t,e=1,r=1e3){this.isFog=!0,this.name="",this.color=new Color(t),this.near=e,this.far=r}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Euler,this.environmentIntensity=1,this.environmentRotation=new Euler,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class InterleavedBuffer{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=StaticDrawUsage,this.updateRanges=[],this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,r){t*=this.stride,r*=e.stride;for(let i=0,s=this.stride;i<s;i++)this.array[t+i]=e.array[r+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(e,this.stride);return r.setUsage(this.usage),r}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$7=new three_core_Vector3;class InterleavedBufferAttribute{constructor(t,e,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,r=this.data.count;e<r;e++)_vector$7.fromBufferAttribute(this,e),_vector$7.applyMatrix4(t),this.setXYZ(e,_vector$7.x,_vector$7.y,_vector$7.z);return this}applyNormalMatrix(t){for(let e=0,r=this.count;e<r;e++)_vector$7.fromBufferAttribute(this,e),_vector$7.applyNormalMatrix(t),this.setXYZ(e,_vector$7.x,_vector$7.y,_vector$7.z);return this}transformDirection(t){for(let e=0,r=this.count;e<r;e++)_vector$7.fromBufferAttribute(this,e),_vector$7.transformDirection(t),this.setXYZ(e,_vector$7.x,_vector$7.y,_vector$7.z);return this}getComponent(t,e){let r=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(r=denormalize(r,this.array)),r}setComponent(t,e,r){return this.normalized&&(r=normalize(r,this.array)),this.data.array[t*this.data.stride+this.offset+e]=r,this}setX(t,e){return this.normalized&&(e=normalize(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=normalize(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=normalize(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=normalize(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=denormalize(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=denormalize(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=denormalize(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=denormalize(e,this.array)),e}setXY(t,e,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=normalize(e,this.array),r=normalize(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=r,this}setXYZ(t,e,r,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=normalize(e,this.array),r=normalize(r,this.array),i=normalize(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=i,this}setXYZW(t,e,r,i,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=normalize(e,this.array),r=normalize(r,this.array),i=normalize(i,this.array),s=normalize(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=i,this.data.array[t+3]=s,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const r=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[r+e])}return new BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new InterleavedBufferAttribute(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const r=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[r+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SpriteMaterial extends Material{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let _geometry;const _intersectPoint=new three_core_Vector3,_worldScale=new three_core_Vector3,_mvPosition=new three_core_Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new three_core_Vector3,_vB=new three_core_Vector3,_vC=new three_core_Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(t=new SpriteMaterial){if(super(),this.isSprite=!0,this.type="Sprite",void 0===_geometry){_geometry=new BufferGeometry;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new InterleavedBuffer(t,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(e,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(e,2,3,!1))}this.geometry=_geometry,this.material=t,this.center=new Vector2(.5,.5),this.count=1}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&_worldScale.multiplyScalar(-_mvPosition.z);const r=this.material.rotation;let i,s;0!==r&&(s=Math.cos(r),i=Math.sin(r));const n=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,n,_worldScale,i,s),transformVertex(_vB.set(.5,-.5,0),_mvPosition,n,_worldScale,i,s),transformVertex(_vC.set(.5,.5,0),_mvPosition,n,_worldScale,i,s),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1);let o=t.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint);if(null===o&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,n,_worldScale,i,s),_uvB.set(0,1),o=t.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint),null===o))return;const a=t.ray.origin.distanceTo(_intersectPoint);a<t.near||a>t.far||e.push({distance:a,point:_intersectPoint.clone(),uv:Triangle.getInterpolation(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function transformVertex(t,e,r,i,s,n){_alignedPosition.subVectors(t,r).addScalar(.5).multiply(i),void 0!==s?(_rotatedPosition.x=n*_alignedPosition.x-s*_alignedPosition.y,_rotatedPosition.y=s*_alignedPosition.x+n*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),t.copy(e),t.x+=_rotatedPosition.x,t.y+=_rotatedPosition.y,t.applyMatrix4(_viewWorldMatrix)}const _v1$2=new three_core_Vector3,_v2$1=new three_core_Vector3;class LOD extends Object3D{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,r=e.length;t<r;t++){const r=e[t];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0,r=0){e=Math.abs(e);const i=this.levels;let s;for(s=0;s<i.length&&!(e<i[s].distance);s++);return i.splice(s,0,{distance:e,hysteresis:r,object:t}),this.add(t),this}removeLevel(t){const e=this.levels;for(let r=0;r<e.length;r++)if(e[r].distance===t){const t=e.splice(r,1);return this.remove(t[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let r,i;for(r=1,i=e.length;r<i;r++){let i=e[r].distance;if(e[r].object.visible&&(i-=i*e[r].hysteresis),t<i)break}return e[r-1].object}return null}raycast(t,e){if(this.levels.length>0){_v1$2.setFromMatrixPosition(this.matrixWorld);const r=t.ray.origin.distanceTo(_v1$2);this.getObjectForDistance(r).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){_v1$2.setFromMatrixPosition(t.matrixWorld),_v2$1.setFromMatrixPosition(this.matrixWorld);const r=_v1$2.distanceTo(_v2$1)/t.zoom;let i,s;for(e[0].object.visible=!0,i=1,s=e.length;i<s;i++){let t=e[i].distance;if(e[i].object.visible&&(t-=t*e[i].hysteresis),!(r>=t))break;e[i-1].object.visible=!1,e[i].object.visible=!0}for(this._currentLevel=i-1;i<s;i++)e[i].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const r=this.levels;for(let t=0,i=r.length;t<i;t++){const i=r[t];e.object.levels.push({object:i.object.uuid,distance:i.distance,hysteresis:i.hysteresis})}return e}}const _basePosition=new three_core_Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new three_core_Vector3,_matrix4=new Matrix4,_vertex=new three_core_Vector3,_sphere$5=new Sphere,_inverseMatrix$2=new Matrix4,_ray$2=new Ray;class SkinnedMesh extends Mesh{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=AttachedBindMode,this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const r=this.material,i=this.matrixWorld;void 0!==r&&(null===this.boundingSphere&&this.computeBoundingSphere(),_sphere$5.copy(this.boundingSphere),_sphere$5.applyMatrix4(i),!1!==t.ray.intersectsSphere(_sphere$5)&&(_inverseMatrix$2.copy(i).invert(),_ray$2.copy(t.ray).applyMatrix4(_inverseMatrix$2),null!==this.boundingBox&&!1===_ray$2.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,_ray$2)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Vector4,e=this.geometry.attributes.skinWeight;for(let r=0,i=e.count;r<i;r++){t.fromBufferAttribute(e,r);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(r,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===AttachedBindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===DetachedBindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const r=this.skeleton,i=this.geometry;_skinIndex.fromBufferAttribute(i.attributes.skinIndex,t),_skinWeight.fromBufferAttribute(i.attributes.skinWeight,t),_basePosition.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const i=_skinWeight.getComponent(t);if(0!==i){const s=_skinIndex.getComponent(t);_matrix4.multiplyMatrices(r.bones[s].matrixWorld,r.boneInverses[s]),e.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),i)}}return e.applyMatrix4(this.bindMatrixInverse)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(t=null,e=1,r=1,i,s,n,o,a,h=NearestFilter,l=NearestFilter,c,u){super(null,n,o,a,h,l,i,s,c,u),this.isDataTexture=!0,this.image={data:t,width:e,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;class Skeleton{constructor(t=[],e=[]){this.uuid=generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Matrix4;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,r=this.boneMatrices,i=this.boneTexture;for(let i=0,s=t.length;i<s;i++){const s=t[i]?t[i].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(s,e[i]),_offsetMatrix.toArray(r,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const r=new DataTexture(e,t,t,RGBAFormat,FloatType);return r.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=r,this}getBoneByName(t){for(let e=0,r=this.bones.length;e<r;e++){const r=this.bones[e];if(r.name===t)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let r=0,i=t.bones.length;r<i;r++){const i=t.bones[r];let s=e[i];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),s=new Bone),this.bones.push(s),this.boneInverses.push((new Matrix4).fromArray(t.boneInverses[r]))}return this.init(),this}toJSON(){const t={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,r=this.boneInverses;for(let i=0,s=e.length;i<s;i++){const s=e[i];t.bones.push(s.uuid);const n=r[i];t.boneInverses.push(n.toArray())}return t}}class InstancedBufferAttribute extends BufferAttribute{constructor(t,e,r,i=1){super(t,e,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh$1=new Mesh,_sphere$4=new Sphere;class InstancedMesh extends Mesh{constructor(t,e,r){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(16*r),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<r;t++)this.setMatrixAt(t,_identity)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new Box3),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<e;r++)this.getMatrixAt(r,_instanceLocalMatrix),_box3.copy(t.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new Sphere),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<e;r++)this.getMatrixAt(r,_instanceLocalMatrix),_sphere$4.copy(t.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$4)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const r=e.morphTargetInfluences,i=this.morphTexture.source.data.data,s=t*(r.length+1)+1;for(let t=0;t<r.length;t++)r[t]=i[s+t]}raycast(t,e){const r=this.matrixWorld,i=this.count;if(_mesh$1.geometry=this.geometry,_mesh$1.material=this.material,void 0!==_mesh$1.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),_sphere$4.copy(this.boundingSphere),_sphere$4.applyMatrix4(r),!1!==t.ray.intersectsSphere(_sphere$4)))for(let s=0;s<i;s++){this.getMatrixAt(s,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(r,_instanceLocalMatrix),_mesh$1.matrixWorld=_instanceWorldMatrix,_mesh$1.raycast(t,_instanceIntersects);for(let t=0,r=_instanceIntersects.length;t<r;t++){const r=_instanceIntersects[t];r.instanceId=s,r.object=this,e.push(r)}_instanceIntersects.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const r=e.morphTargetInfluences,i=r.length+1;null===this.morphTexture&&(this.morphTexture=new DataTexture(new Float32Array(i*this.count),i,this.count,RedFormat,FloatType));const s=this.morphTexture.source.data.data;let n=0;for(let t=0;t<r.length;t++)n+=r[t];const o=this.geometry.morphTargetsRelative?1:1-n,a=i*t;s[a]=o,s.set(r,a+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const _vector1=new three_core_Vector3,_vector2=new three_core_Vector3,_normalMatrix=new Matrix3;class Plane{constructor(t=new three_core_Vector3(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,r,i){return this.normal.set(t,e,r),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,r){const i=_vector1.subVectors(r,e).cross(_vector2.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const r=t.delta(_vector1),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:e.copy(t.start).addScaledVector(r,s)}intersectsLine(t){const e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const r=e||_normalMatrix.getNormalMatrix(t),i=this.coplanarPoint(_vector1).applyMatrix4(t),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const _sphere$3=new Sphere,_defaultSpriteCenter=new Vector2(.5,.5),_vector$6=new three_core_Vector3;class Frustum{constructor(t=new Plane,e=new Plane,r=new Plane,i=new Plane,s=new Plane,n=new Plane){this.planes=[t,e,r,i,s,n]}set(t,e,r,i,s,n){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(r),o[3].copy(i),o[4].copy(s),o[5].copy(n),this}copy(t){const e=this.planes;for(let r=0;r<6;r++)e[r].copy(t.planes[r]);return this}setFromProjectionMatrix(t,e=WebGLCoordinateSystem,r=!1){const i=this.planes,s=t.elements,n=s[0],o=s[1],a=s[2],h=s[3],l=s[4],c=s[5],u=s[6],p=s[7],d=s[8],m=s[9],f=s[10],y=s[11],g=s[12],_=s[13],v=s[14],x=s[15];if(i[0].setComponents(h-n,p-l,y-d,x-g).normalize(),i[1].setComponents(h+n,p+l,y+d,x+g).normalize(),i[2].setComponents(h+o,p+c,y+m,x+_).normalize(),i[3].setComponents(h-o,p-c,y-m,x-_).normalize(),r)i[4].setComponents(a,u,f,v).normalize(),i[5].setComponents(h-a,p-u,y-f,x-v).normalize();else if(i[4].setComponents(h-a,p-u,y-f,x-v).normalize(),e===WebGLCoordinateSystem)i[5].setComponents(h+a,p+u,y+f,x+v).normalize();else{if(e!==WebGPUCoordinateSystem)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);i[5].setComponents(a,u,f,v).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),_sphere$3.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$3.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(_sphere$3)}intersectsSprite(t){_sphere$3.center.set(0,0,0);const e=_defaultSpriteCenter.distanceTo(t.center);return _sphere$3.radius=.7071067811865476+e,_sphere$3.applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$3)}intersectsSphere(t){const e=this.planes,r=t.center,i=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(r)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let r=0;r<6;r++){const i=e[r];if(_vector$6.x=i.normal.x>0?t.max.x:t.min.x,_vector$6.y=i.normal.y>0?t.max.y:t.min.y,_vector$6.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const _projScreenMatrix$2=new Matrix4,_frustum$1=new Frustum;class FrustumArray{constructor(){this.coordinateSystem=WebGLCoordinateSystem}intersectsObject(t,e){if(!e.isArrayCamera||0===e.cameras.length)return!1;for(let r=0;r<e.cameras.length;r++){const i=e.cameras[r];if(_projScreenMatrix$2.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),_frustum$1.setFromProjectionMatrix(_projScreenMatrix$2,i.coordinateSystem,i.reversedDepth),_frustum$1.intersectsObject(t))return!0}return!1}intersectsSprite(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let r=0;r<e.cameras.length;r++){const i=e.cameras[r];if(_projScreenMatrix$2.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),_frustum$1.setFromProjectionMatrix(_projScreenMatrix$2,i.coordinateSystem,i.reversedDepth),_frustum$1.intersectsSprite(t))return!0}return!1}intersectsSphere(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let r=0;r<e.cameras.length;r++){const i=e.cameras[r];if(_projScreenMatrix$2.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),_frustum$1.setFromProjectionMatrix(_projScreenMatrix$2,i.coordinateSystem,i.reversedDepth),_frustum$1.intersectsSphere(t))return!0}return!1}intersectsBox(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let r=0;r<e.cameras.length;r++){const i=e.cameras[r];if(_projScreenMatrix$2.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),_frustum$1.setFromProjectionMatrix(_projScreenMatrix$2,i.coordinateSystem,i.reversedDepth),_frustum$1.intersectsBox(t))return!0}return!1}containsPoint(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let r=0;r<e.cameras.length;r++){const i=e.cameras[r];if(_projScreenMatrix$2.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),_frustum$1.setFromProjectionMatrix(_projScreenMatrix$2,i.coordinateSystem,i.reversedDepth),_frustum$1.containsPoint(t))return!0}return!1}clone(){return new FrustumArray}}function ascIdSort(t,e){return t-e}function sortOpaque(t,e){return t.z-e.z}function sortTransparent(t,e){return e.z-t.z}class MultiDrawRenderList{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e,r,i){const s=this.pool,n=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const o=s[this.index];n.push(o),this.index++,o.start=t,o.count=e,o.z=r,o.index=i}reset(){this.list.length=0,this.index=0}}const _matrix$1=new Matrix4,_whiteColor=new Color(1,1,1),_frustum=new Frustum,_frustumArray=new FrustumArray,_box$1=new Box3,_sphere$2=new Sphere,_vector$5=new three_core_Vector3,_forward$1=new three_core_Vector3,_temp=new three_core_Vector3,_renderList=new MultiDrawRenderList,_mesh=new Mesh,_batchIntersects=[];function copyAttributeData(t,e,r=0){const i=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const s=t.count;for(let n=0;n<s;n++)for(let s=0;s<i;s++)e.setComponent(n+r,s,t.getComponent(n,s))}else e.array.set(t.array,r*i);e.needsUpdate=!0}function copyArrayContents(t,e){if(t.constructor!==e.constructor){const r=Math.min(t.length,e.length);for(let i=0;i<r;i++)e[i]=t[i]}else{const r=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,r))}}class BatchedMesh extends Mesh{constructor(t,e,r=2*e,i){super(new BufferGeometry,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=e,this._maxIndexCount=r,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let t=Math.sqrt(4*this._maxInstanceCount);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4),r=new DataTexture(e,t,t,RGBAFormat,FloatType);this._matricesTexture=r}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Uint32Array(t*t),r=new DataTexture(e,t,t,RedIntegerFormat,UnsignedIntType);this._indirectTexture=r}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Float32Array(t*t*4).fill(1),r=new DataTexture(e,t,t,RGBAFormat,FloatType);r.colorSpace=ColorManagement.workingColorSpace,this._colorsTexture=r}_initializeGeometry(t){const e=this.geometry,r=this._maxVertexCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in t.attributes){const s=t.getAttribute(i),{array:n,itemSize:o,normalized:a}=s,h=new n.constructor(r*o),l=new BufferAttribute(h,o,a);e.setAttribute(i,l)}if(null!==t.getIndex()){const t=r>65535?new Uint32Array(i):new Uint16Array(i);e.setIndex(new BufferAttribute(t,1))}this._geometryInitialized=!0}}_validateGeometry(t){const e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const r in e.attributes){if(!t.hasAttribute(r))throw new Error(`THREE.BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const i=t.getAttribute(r),s=e.getAttribute(r);if(i.itemSize!==s.itemSize||i.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(t){const e=this._instanceInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${t}. Instance is either out of range or has been deleted.`)}validateGeometryId(t){const e=this._geometryInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${t}. Geometry is either out of range or has been deleted.`)}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3);const t=this.boundingBox,e=this._instanceInfo;t.makeEmpty();for(let r=0,i=e.length;r<i;r++){if(!1===e[r].active)continue;const i=e[r].geometryIndex;this.getMatrixAt(r,_matrix$1),this.getBoundingBoxAt(i,_box$1).applyMatrix4(_matrix$1),t.union(_box$1)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);const t=this.boundingSphere,e=this._instanceInfo;t.makeEmpty();for(let r=0,i=e.length;r<i;r++){if(!1===e[r].active)continue;const i=e[r].geometryIndex;this.getMatrixAt(r,_matrix$1),this.getBoundingSphereAt(i,_sphere$2).applyMatrix4(_matrix$1),t.union(_sphere$2)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const e={visible:!0,active:!0,geometryIndex:t};let r=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ascIdSort),r=this._availableInstanceIds.shift(),this._instanceInfo[r]=e):(r=this._instanceInfo.length,this._instanceInfo.push(e));const i=this._matricesTexture;_matrix$1.identity().toArray(i.image.data,16*r),i.needsUpdate=!0;const s=this._colorsTexture;return s&&(_whiteColor.toArray(s.image.data,4*r),s.needsUpdate=!0),this._visibilityChanged=!0,r}addGeometry(t,e=-1,r=-1){this._initializeGeometry(t),this._validateGeometry(t);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=-1===e?t.getAttribute("position").count:e;const n=t.getIndex();if(null!==n&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=-1===r?n.count:r),-1!==i.indexStart&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let o;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ascIdSort),o=this._availableGeometryIds.shift(),s[o]=i):(o=this._geometryCount,this._geometryCount++,s.push(i)),this.setGeometryAt(o,t),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,o}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const r=this.geometry,i=null!==r.getIndex(),s=r.getIndex(),n=e.getIndex(),o=this._geometryInfo[t];if(i&&n.count>o.reservedIndexCount||e.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const a=o.vertexStart,h=o.reservedVertexCount;o.vertexCount=e.getAttribute("position").count;for(const t in r.attributes){const i=e.getAttribute(t),s=r.getAttribute(t);copyAttributeData(i,s,a);const n=i.itemSize;for(let t=i.count,e=h;t<e;t++){const e=a+t;for(let t=0;t<n;t++)s.setComponent(e,t,0)}s.needsUpdate=!0,s.addUpdateRange(a*n,h*n)}if(i){const t=o.indexStart,r=o.reservedIndexCount;o.indexCount=e.getIndex().count;for(let e=0;e<n.count;e++)s.setX(t+e,a+n.getX(e));for(let e=n.count,i=r;e<i;e++)s.setX(t+e,a);s.needsUpdate=!0,s.addUpdateRange(t,o.reservedIndexCount)}return o.start=i?o.indexStart:o.vertexStart,o.count=i?o.indexCount:o.vertexCount,o.boundingBox=null,null!==e.boundingBox&&(o.boundingBox=e.boundingBox.clone()),o.boundingSphere=null,null!==e.boundingSphere&&(o.boundingSphere=e.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._geometryInfo;if(t>=e.length||!1===e[t].active)return this;const r=this._instanceInfo;for(let e=0,i=r.length;e<i;e++)r[e].active&&r[e].geometryIndex===t&&this.deleteInstance(e);return e[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){return this.validateInstanceId(t),this._instanceInfo[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this}optimize(){let t=0,e=0;const r=this._geometryInfo,i=r.map(((t,e)=>e)).sort(((t,e)=>r[t].vertexStart-r[e].vertexStart)),s=this.geometry;for(let n=0,o=r.length;n<o;n++){const o=i[n],a=r[o];if(!1!==a.active){if(null!==s.index){if(a.indexStart!==e){const{indexStart:r,vertexStart:i,reservedIndexCount:n}=a,o=s.index,h=o.array,l=t-i;for(let t=r;t<r+n;t++)h[t]=h[t]+l;o.array.copyWithin(e,r,r+n),o.addUpdateRange(e,n),a.indexStart=e}e+=a.reservedIndexCount}if(a.vertexStart!==t){const{vertexStart:e,reservedVertexCount:r}=a,i=s.attributes;for(const s in i){const n=i[s],{array:o,itemSize:a}=n;o.copyWithin(t*a,e*a,(e+r)*a),n.addUpdateRange(t*a,r*a)}a.vertexStart=t}t+=a.reservedVertexCount,a.start=s.index?a.indexStart:a.vertexStart,this._nextIndexStart=s.index?a.indexStart+a.reservedIndexCount:0,this._nextVertexStart=a.vertexStart+a.reservedVertexCount}}return this}getBoundingBoxAt(t,e){if(t>=this._geometryCount)return null;const r=this.geometry,i=this._geometryInfo[t];if(null===i.boundingBox){const t=new Box3,e=r.index,s=r.attributes.position;for(let r=i.start,n=i.start+i.count;r<n;r++){let i=r;e&&(i=e.getX(i)),t.expandByPoint(_vector$5.fromBufferAttribute(s,i))}i.boundingBox=t}return e.copy(i.boundingBox),e}getBoundingSphereAt(t,e){if(t>=this._geometryCount)return null;const r=this.geometry,i=this._geometryInfo[t];if(null===i.boundingSphere){const e=new Sphere;this.getBoundingBoxAt(t,_box$1),_box$1.getCenter(e.center);const s=r.index,n=r.attributes.position;let o=0;for(let t=i.start,r=i.start+i.count;t<r;t++){let r=t;s&&(r=s.getX(r)),_vector$5.fromBufferAttribute(n,r),o=Math.max(o,e.center.distanceToSquared(_vector$5))}e.radius=Math.sqrt(o),i.boundingSphere=e}return e.copy(i.boundingSphere),e}setMatrixAt(t,e){this.validateInstanceId(t);const r=this._matricesTexture,i=this._matricesTexture.image.data;return e.toArray(i,16*t),r.needsUpdate=!0,this}getMatrixAt(t,e){return this.validateInstanceId(t),e.fromArray(this._matricesTexture.image.data,16*t)}setColorAt(t,e){return this.validateInstanceId(t),null===this._colorsTexture&&this._initColorsTexture(),e.toArray(this._colorsTexture.image.data,4*t),this._colorsTexture.needsUpdate=!0,this}getColorAt(t,e){return this.validateInstanceId(t),e.fromArray(this._colorsTexture.image.data,4*t)}setVisibleAt(t,e){return this.validateInstanceId(t),this._instanceInfo[t].visible===e||(this._instanceInfo[t].visible=e,this._visibilityChanged=!0),this}getVisibleAt(t){return this.validateInstanceId(t),this._instanceInfo[t].visible}setGeometryIdAt(t,e){return this.validateInstanceId(t),this.validateGeometryId(e),this._instanceInfo[t].geometryIndex=e,this}getGeometryIdAt(t){return this.validateInstanceId(t),this._instanceInfo[t].geometryIndex}getGeometryRangeAt(t,e={}){this.validateGeometryId(t);const r=this._geometryInfo[t];return e.vertexStart=r.vertexStart,e.vertexCount=r.vertexCount,e.reservedVertexCount=r.reservedVertexCount,e.indexStart=r.indexStart,e.indexCount=r.indexCount,e.reservedIndexCount=r.reservedIndexCount,e.start=r.start,e.count=r.count,e}setInstanceCount(t){const e=this._availableInstanceIds,r=this._instanceInfo;for(e.sort(ascIdSort);e[e.length-1]===r.length-1;)r.pop(),e.pop();if(t<r.length)throw new Error(`BatchedMesh: Instance ids outside the range ${t} are being used. Cannot shrink instance count.`);const i=new Int32Array(t),s=new Int32Array(t);copyArrayContents(this._multiDrawCounts,i),copyArrayContents(this._multiDrawStarts,s),this._multiDrawCounts=i,this._multiDrawStarts=s,this._maxInstanceCount=t;const n=this._indirectTexture,o=this._matricesTexture,a=this._colorsTexture;n.dispose(),this._initIndirectTexture(),copyArrayContents(n.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),copyArrayContents(o.image.data,this._matricesTexture.image.data),a&&(a.dispose(),this._initColorsTexture(),copyArrayContents(a.image.data,this._colorsTexture.image.data))}setGeometrySize(t,e){const r=[...this._geometryInfo].filter((t=>t.active));if(Math.max(...r.map((t=>t.vertexStart+t.reservedVertexCount)))>t)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${e}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...r.map((t=>t.indexStart+t.reservedIndexCount)))>e)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${e}. Cannot shrink further.`);const i=this.geometry;i.dispose(),this._maxVertexCount=t,this._maxIndexCount=e,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new BufferGeometry,this._initializeGeometry(i));const s=this.geometry;i.index&&copyArrayContents(i.index.array,s.index.array);for(const t in i.attributes)copyArrayContents(i.attributes[t].array,s.attributes[t].array)}raycast(t,e){const r=this._instanceInfo,i=this._geometryInfo,s=this.matrixWorld,n=this.geometry;_mesh.material=this.material,_mesh.geometry.index=n.index,_mesh.geometry.attributes=n.attributes,null===_mesh.geometry.boundingBox&&(_mesh.geometry.boundingBox=new Box3),null===_mesh.geometry.boundingSphere&&(_mesh.geometry.boundingSphere=new Sphere);for(let n=0,o=r.length;n<o;n++){if(!r[n].visible||!r[n].active)continue;const o=r[n].geometryIndex,a=i[o];_mesh.geometry.setDrawRange(a.start,a.count),this.getMatrixAt(n,_mesh.matrixWorld).premultiply(s),this.getBoundingBoxAt(o,_mesh.geometry.boundingBox),this.getBoundingSphereAt(o,_mesh.geometry.boundingSphere),_mesh.raycast(t,_batchIntersects);for(let t=0,r=_batchIntersects.length;t<r;t++){const r=_batchIntersects[t];r.object=this,r.batchId=n,e.push(r)}_batchIntersects.length=0}_mesh.material=null,_mesh.geometry.index=null,_mesh.geometry.attributes={},_mesh.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map((t=>({...t,boundingBox:null!==t.boundingBox?t.boundingBox.clone():null,boundingSphere:null!==t.boundingSphere?t.boundingSphere.clone():null}))),this._instanceInfo=t._instanceInfo.map((t=>({...t}))),this._availableInstanceIds=t._availableInstanceIds.slice(),this._availableGeometryIds=t._availableGeometryIds.slice(),this._nextIndexStart=t._nextIndexStart,this._nextVertexStart=t._nextVertexStart,this._geometryCount=t._geometryCount,this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._indirectTexture=t._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(t,e,r,i,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const n=i.getIndex(),o=null===n?1:n.array.BYTES_PER_ELEMENT,a=this._instanceInfo,h=this._multiDrawStarts,l=this._multiDrawCounts,c=this._geometryInfo,u=this.perObjectFrustumCulled,p=this._indirectTexture,d=p.image.data,m=r.isArrayCamera?_frustumArray:_frustum;u&&!r.isArrayCamera&&(_matrix$1.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),_frustum.setFromProjectionMatrix(_matrix$1,r.coordinateSystem,r.reversedDepth));let f=0;if(this.sortObjects){_matrix$1.copy(this.matrixWorld).invert(),_vector$5.setFromMatrixPosition(r.matrixWorld).applyMatrix4(_matrix$1),_forward$1.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(_matrix$1);for(let t=0,e=a.length;t<e;t++)if(a[t].visible&&a[t].active){const e=a[t].geometryIndex;this.getMatrixAt(t,_matrix$1),this.getBoundingSphereAt(e,_sphere$2).applyMatrix4(_matrix$1);let i=!1;if(u&&(i=!m.intersectsSphere(_sphere$2,r)),!i){const r=c[e],i=_temp.subVectors(_sphere$2.center,_vector$5).dot(_forward$1);_renderList.push(r.start,r.count,i,t)}}const t=_renderList.list,e=this.customSort;null===e?t.sort(s.transparent?sortTransparent:sortOpaque):e.call(this,t,r);for(let e=0,r=t.length;e<r;e++){const r=t[e];h[f]=r.start*o,l[f]=r.count,d[f]=r.index,f++}_renderList.reset()}else for(let t=0,e=a.length;t<e;t++)if(a[t].visible&&a[t].active){const e=a[t].geometryIndex;let i=!1;if(u&&(this.getMatrixAt(t,_matrix$1),this.getBoundingSphereAt(e,_sphere$2).applyMatrix4(_matrix$1),i=!m.intersectsSphere(_sphere$2,r)),!i){const r=c[e];h[f]=r.start*o,l[f]=r.count,d[f]=t,f++}}p.needsUpdate=!0,this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(t,e,r,i,s,n){this.onBeforeRender(t,null,i,s,n)}}class LineBasicMaterial extends Material{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const _vStart=new three_core_Vector3,_vEnd=new three_core_Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere,_intersectPointOnRay=new three_core_Vector3,_intersectPointOnSegment=new three_core_Vector3;class Line extends Object3D{constructor(t=new BufferGeometry,e=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,r=[0];for(let t=1,i=e.count;t<i;t++)_vStart.fromBufferAttribute(e,t-1),_vEnd.fromBufferAttribute(e,t),r[t]=r[t-1],r[t]+=_vStart.distanceTo(_vEnd);t.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const r=this.geometry,i=this.matrixWorld,s=t.params.Line.threshold,n=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),_sphere$1.copy(r.boundingSphere),_sphere$1.applyMatrix4(i),_sphere$1.radius+=s,!1===t.ray.intersectsSphere(_sphere$1))return;_inverseMatrix$1.copy(i).invert(),_ray$1.copy(t.ray).applyMatrix4(_inverseMatrix$1);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,h=this.isLineSegments?2:1,l=r.index,c=r.attributes.position;if(null!==l){const r=Math.max(0,n.start),i=Math.min(l.count,n.start+n.count);for(let s=r,n=i-1;s<n;s+=h){const r=l.getX(s),i=l.getX(s+1),n=checkIntersection(this,t,_ray$1,a,r,i,s);n&&e.push(n)}if(this.isLineLoop){const s=l.getX(i-1),n=l.getX(r),o=checkIntersection(this,t,_ray$1,a,s,n,i-1);o&&e.push(o)}}else{const r=Math.max(0,n.start),i=Math.min(c.count,n.start+n.count);for(let s=r,n=i-1;s<n;s+=h){const r=checkIntersection(this,t,_ray$1,a,s,s+1,s);r&&e.push(r)}if(this.isLineLoop){const s=checkIntersection(this,t,_ray$1,a,i-1,r,i-1);s&&e.push(s)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const r=t[e[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=r.length;t<e;t++){const e=r[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function checkIntersection(t,e,r,i,s,n,o){const a=t.geometry.attributes.position;if(_vStart.fromBufferAttribute(a,s),_vEnd.fromBufferAttribute(a,n),r.distanceSqToSegment(_vStart,_vEnd,_intersectPointOnRay,_intersectPointOnSegment)>i)return;_intersectPointOnRay.applyMatrix4(t.matrixWorld);const h=e.ray.origin.distanceTo(_intersectPointOnRay);return h<e.near||h>e.far?void 0:{distance:h,point:_intersectPointOnSegment.clone().applyMatrix4(t.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:t}}const _start=new three_core_Vector3,_end=new three_core_Vector3;class LineSegments extends Line{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,r=[];for(let t=0,i=e.count;t<i;t+=2)_start.fromBufferAttribute(e,t),_end.fromBufferAttribute(e,t+1),r[t]=0===t?0:r[t-1],r[t+1]=r[t]+_start.distanceTo(_end);t.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_position$2=new three_core_Vector3;class Points extends Object3D{constructor(t=new BufferGeometry,e=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const r=this.geometry,i=this.matrixWorld,s=t.params.Points.threshold,n=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),_sphere.copy(r.boundingSphere),_sphere.applyMatrix4(i),_sphere.radius+=s,!1===t.ray.intersectsSphere(_sphere))return;_inverseMatrix.copy(i).invert(),_ray.copy(t.ray).applyMatrix4(_inverseMatrix);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,h=r.index,l=r.attributes.position;if(null!==h)for(let r=Math.max(0,n.start),s=Math.min(h.count,n.start+n.count);r<s;r++){const s=h.getX(r);_position$2.fromBufferAttribute(l,s),testPoint(_position$2,s,a,i,t,e,this)}else for(let r=Math.max(0,n.start),s=Math.min(l.count,n.start+n.count);r<s;r++)_position$2.fromBufferAttribute(l,r),testPoint(_position$2,r,a,i,t,e,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const r=t[e[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=r.length;t<e;t++){const e=r[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function testPoint(t,e,r,i,s,n,o){const a=_ray.distanceSqToPoint(t);if(a<r){const r=new three_core_Vector3;_ray.closestPointToPoint(t,r),r.applyMatrix4(i);const h=s.ray.origin.distanceTo(r);if(h<s.near||h>s.far)return;n.push({distance:h,distanceToRay:Math.sqrt(a),point:r,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class VideoTexture extends Texture{constructor(t,e,r,i,s=LinearFilter,n=LinearFilter,o,a,h){super(t,e,r,i,s,n,o,a,h),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const l=this;"requestVideoFrameCallback"in t&&(this._requestVideoFrameCallbackId=t.requestVideoFrameCallback((function e(){l.needsUpdate=!0,l._requestVideoFrameCallbackId=t.requestVideoFrameCallback(e)})))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){0!==this._requestVideoFrameCallbackId&&this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),super.dispose()}}class VideoFrameTexture extends VideoTexture{constructor(t,e,r,i,s,n,o,a){super({},t,e,r,i,s,n,o,a),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(t){this.image=t,this.needsUpdate=!0}}class FramebufferTexture extends Texture{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(t,e,r,i,s,n,o,a,h,l,c,u){super(null,n,o,a,h,l,i,s,c,u),this.isCompressedTexture=!0,this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(t,e,r,i,s,n){super(t,e,r,s,n),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=ClampToEdgeWrapping,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class CompressedCubeTexture extends CompressedTexture{constructor(t,e,r){super(void 0,t[0].width,t[0].height,e,r,CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class CanvasTexture extends Texture{constructor(t,e,r,i,s,n,o,a,h){super(t,e,r,i,s,n,o,a,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class DepthTexture extends Texture{constructor(t,e,r=UnsignedIntType,i,s,n,o=NearestFilter,a=NearestFilter,h,l=DepthFormat,c=1){if(l!==DepthFormat&&l!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:t,height:e,depth:c},i,s,n,o,a,l,r,h),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new Source(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}class CapsuleGeometry extends BufferGeometry{constructor(t=1,e=1,r=4,i=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:r,radialSegments:i,heightSegments:s},e=Math.max(0,e),r=Math.max(1,Math.floor(r)),i=Math.max(3,Math.floor(i)),s=Math.max(1,Math.floor(s));const n=[],o=[],a=[],h=[],l=e/2,c=Math.PI/2*t,u=e,p=2*c+u,d=2*r+s,m=i+1,f=new three_core_Vector3,y=new three_core_Vector3;for(let g=0;g<=d;g++){let _=0,v=0,x=0,b=0;if(g<=r){const e=g/r,i=e*Math.PI/2;v=-l-t*Math.cos(i),x=t*Math.sin(i),b=-t*Math.cos(i),_=e*c}else if(g<=r+s){const i=(g-r)/s;v=i*e-l,x=t,b=0,_=c+i*u}else{const e=(g-r-s)/r,i=e*Math.PI/2;v=l+t*Math.sin(i),x=t*Math.cos(i),b=t*Math.sin(i),_=c+u+e*c}const M=Math.max(0,Math.min(1,_/p));let w=0;0===g?w=.5/i:g===d&&(w=-.5/i);for(let t=0;t<=i;t++){const e=t/i,r=e*Math.PI*2,s=Math.sin(r),n=Math.cos(r);y.x=-x*n,y.y=v,y.z=x*s,o.push(y.x,y.y,y.z),f.set(-x*n,b,x*s),f.normalize(),a.push(f.x,f.y,f.z),h.push(e+w,M)}if(g>0){const t=(g-1)*m;for(let e=0;e<i;e++){const r=t+e,i=t+e+1,s=g*m+e,o=g*m+e+1;n.push(r,i,s),n.push(i,o,s)}}}this.setIndex(n),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new CapsuleGeometry(t.radius,t.height,t.capSegments,t.radialSegments,t.heightSegments)}}class CircleGeometry extends BufferGeometry{constructor(t=1,e=32,r=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:i},e=Math.max(3,e);const s=[],n=[],o=[],a=[],h=new three_core_Vector3,l=new Vector2;n.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let s=0,c=3;s<=e;s++,c+=3){const u=r+s/e*i;h.x=t*Math.cos(u),h.y=t*Math.sin(u),n.push(h.x,h.y,h.z),o.push(0,0,1),l.x=(n[c]/t+1)/2,l.y=(n[c+1]/t+1)/2,a.push(l.x,l.y)}for(let t=1;t<=e;t++)s.push(t,t+1,0);this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("normal",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new CircleGeometry(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(t=1,e=1,r=1,i=32,s=1,n=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:i,heightSegments:s,openEnded:n,thetaStart:o,thetaLength:a};const h=this;i=Math.floor(i),s=Math.floor(s);const l=[],c=[],u=[],p=[];let d=0;const m=[],f=r/2;let y=0;function g(r){const s=d,n=new Vector2,m=new three_core_Vector3;let g=0;const _=!0===r?t:e,v=!0===r?1:-1;for(let t=1;t<=i;t++)c.push(0,f*v,0),u.push(0,v,0),p.push(.5,.5),d++;const x=d;for(let t=0;t<=i;t++){const e=t/i*a+o,r=Math.cos(e),s=Math.sin(e);m.x=_*s,m.y=f*v,m.z=_*r,c.push(m.x,m.y,m.z),u.push(0,v,0),n.x=.5*r+.5,n.y=.5*s*v+.5,p.push(n.x,n.y),d++}for(let t=0;t<i;t++){const e=s+t,i=x+t;!0===r?l.push(i,i+1,e):l.push(i+1,i,e),g+=3}h.addGroup(y,g,!0===r?1:2),y+=g}!function(){const n=new three_core_Vector3,g=new three_core_Vector3;let _=0;const v=(e-t)/r;for(let h=0;h<=s;h++){const l=[],y=h/s,_=y*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,s=e*a+o,h=Math.sin(s),m=Math.cos(s);g.x=_*h,g.y=-y*r+f,g.z=_*m,c.push(g.x,g.y,g.z),n.set(h,v,m).normalize(),u.push(n.x,n.y,n.z),p.push(e,1-y),l.push(d++)}m.push(l)}for(let r=0;r<i;r++)for(let i=0;i<s;i++){const n=m[i][r],o=m[i+1][r],a=m[i+1][r+1],h=m[i][r+1];(t>0||0!==i)&&(l.push(n,o,h),_+=3),(e>0||i!==s-1)&&(l.push(o,a,h),_+=3)}h.addGroup(y,_,0),y+=_}(),!1===n&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(c,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(p,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new CylinderGeometry(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(t=1,e=1,r=32,i=1,s=!1,n=0,o=2*Math.PI){super(0,t,e,r,i,s,n,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:n,thetaLength:o}}static fromJSON(t){return new ConeGeometry(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(t=[],e=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:i};const s=[],n=[];function o(t,e,r,i){const s=i+1,n=[];for(let i=0;i<=s;i++){n[i]=[];const o=t.clone().lerp(r,i/s),a=e.clone().lerp(r,i/s),h=s-i;for(let t=0;t<=h;t++)n[i][t]=0===t&&i===s?o:o.clone().lerp(a,t/h)}for(let t=0;t<s;t++)for(let e=0;e<2*(s-t)-1;e++){const r=Math.floor(e/2);e%2==0?(a(n[t][r+1]),a(n[t+1][r]),a(n[t][r])):(a(n[t][r+1]),a(n[t+1][r+1]),a(n[t+1][r]))}}function a(t){s.push(t.x,t.y,t.z)}function h(e,r){const i=3*e;r.x=t[i+0],r.y=t[i+1],r.z=t[i+2]}function l(t,e,r,i){i<0&&1===t.x&&(n[e]=t.x-1),0===r.x&&0===r.z&&(n[e]=i/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){const r=new three_core_Vector3,i=new three_core_Vector3,s=new three_core_Vector3;for(let n=0;n<e.length;n+=3)h(e[n+0],r),h(e[n+1],i),h(e[n+2],s),o(r,i,s,t)}(i),function(t){const e=new three_core_Vector3;for(let r=0;r<s.length;r+=3)e.x=s[r+0],e.y=s[r+1],e.z=s[r+2],e.normalize().multiplyScalar(t),s[r+0]=e.x,s[r+1]=e.y,s[r+2]=e.z}(r),function(){const t=new three_core_Vector3;for(let r=0;r<s.length;r+=3){t.x=s[r+0],t.y=s[r+1],t.z=s[r+2];const i=c(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);n.push(i,1-o)}var e;(function(){const t=new three_core_Vector3,e=new three_core_Vector3,r=new three_core_Vector3,i=new three_core_Vector3,o=new Vector2,a=new Vector2,h=new Vector2;for(let u=0,p=0;u<s.length;u+=9,p+=6){t.set(s[u+0],s[u+1],s[u+2]),e.set(s[u+3],s[u+4],s[u+5]),r.set(s[u+6],s[u+7],s[u+8]),o.set(n[p+0],n[p+1]),a.set(n[p+2],n[p+3]),h.set(n[p+4],n[p+5]),i.copy(t).add(e).add(r).divideScalar(3);const d=c(i);l(o,p+0,t,d),l(a,p+2,e,d),l(h,p+4,r,d)}})(),function(){for(let t=0;t<n.length;t+=6){const e=n[t+0],r=n[t+2],i=n[t+4],s=Math.max(e,r,i),o=Math.min(e,r,i);s>.9&&o<.1&&(e<.2&&(n[t+0]+=1),r<.2&&(n[t+2]+=1),i<.2&&(n[t+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(s.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(n,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new PolyhedronGeometry(t.vertices,t.indices,t.radius,t.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){const r=(1+Math.sqrt(5))/2,i=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new DodecahedronGeometry(t.radius,t.detail)}}const _v0=new three_core_Vector3,_v1$1=new three_core_Vector3,_normal=new three_core_Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const r=4,i=Math.pow(10,r),s=Math.cos(DEG2RAD*e),n=t.getIndex(),o=t.getAttribute("position"),a=n?n.count:o.count,h=[0,0,0],l=["a","b","c"],c=new Array(3),u={},p=[];for(let t=0;t<a;t+=3){n?(h[0]=n.getX(t),h[1]=n.getX(t+1),h[2]=n.getX(t+2)):(h[0]=t,h[1]=t+1,h[2]=t+2);const{a:e,b:r,c:a}=_triangle;if(e.fromBufferAttribute(o,h[0]),r.fromBufferAttribute(o,h[1]),a.fromBufferAttribute(o,h[2]),_triangle.getNormal(_normal),c[0]=`${Math.round(e.x*i)},${Math.round(e.y*i)},${Math.round(e.z*i)}`,c[1]=`${Math.round(r.x*i)},${Math.round(r.y*i)},${Math.round(r.z*i)}`,c[2]=`${Math.round(a.x*i)},${Math.round(a.y*i)},${Math.round(a.z*i)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let t=0;t<3;t++){const e=(t+1)%3,r=c[t],i=c[e],n=_triangle[l[t]],o=_triangle[l[e]],a=`${r}_${i}`,d=`${i}_${r}`;d in u&&u[d]?(_normal.dot(u[d].normal)<=s&&(p.push(n.x,n.y,n.z),p.push(o.x,o.y,o.z)),u[d]=null):a in u||(u[a]={index0:h[t],index1:h[e],normal:_normal.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:r}=u[t];_v0.fromBufferAttribute(o,e),_v1$1.fromBufferAttribute(o,r),p.push(_v0.x,_v0.y,_v0.z),p.push(_v1$1.x,_v1$1.y,_v1$1.z)}this.setAttribute("position",new Float32BufferAttribute(p,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(t,e){const r=this.getUtoTmapping(t);return this.getPoint(r,e)}getPoints(t=5){const e=[];for(let r=0;r<=t;r++)e.push(this.getPoint(r/t));return e}getSpacedPoints(t=5){const e=[];for(let r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let r,i=this.getPoint(0),s=0;e.push(0);for(let n=1;n<=t;n++)r=this.getPoint(n/t),s+=r.distanceTo(i),e.push(s),i=r;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e=null){const r=this.getLengths();let i=0;const s=r.length;let n;n=e||t*r[s-1];let o,a=0,h=s-1;for(;a<=h;)if(i=Math.floor(a+(h-a)/2),o=r[i]-n,o<0)a=i+1;else{if(!(o>0)){h=i;break}h=i-1}if(i=h,r[i]===n)return i/(s-1);const l=r[i];return(i+(n-l)/(r[i+1]-l))/(s-1)}getTangent(t,e){const r=1e-4;let i=t-r,s=t+r;i<0&&(i=0),s>1&&(s=1);const n=this.getPoint(i),o=this.getPoint(s),a=e||(n.isVector2?new Vector2:new three_core_Vector3);return a.copy(o).sub(n).normalize(),a}getTangentAt(t,e){const r=this.getUtoTmapping(t);return this.getTangent(r,e)}computeFrenetFrames(t,e=!1){const r=new three_core_Vector3,i=[],s=[],n=[],o=new three_core_Vector3,a=new Matrix4;for(let e=0;e<=t;e++){const r=e/t;i[e]=this.getTangentAt(r,new three_core_Vector3)}s[0]=new three_core_Vector3,n[0]=new three_core_Vector3;let h=Number.MAX_VALUE;const l=Math.abs(i[0].x),c=Math.abs(i[0].y),u=Math.abs(i[0].z);l<=h&&(h=l,r.set(1,0,0)),c<=h&&(h=c,r.set(0,1,0)),u<=h&&r.set(0,0,1),o.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],o),n[0].crossVectors(i[0],s[0]);for(let e=1;e<=t;e++){if(s[e]=s[e-1].clone(),n[e]=n[e-1].clone(),o.crossVectors(i[e-1],i[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(clamp(i[e-1].dot(i[e]),-1,1));s[e].applyMatrix4(a.makeRotationAxis(o,t))}n[e].crossVectors(i[e],s[e])}if(!0===e){let e=Math.acos(clamp(s[0].dot(s[t]),-1,1));e/=t,i[0].dot(o.crossVectors(s[0],s[t]))>0&&(e=-e);for(let r=1;r<=t;r++)s[r].applyMatrix4(a.makeRotationAxis(i[r],e*r)),n[r].crossVectors(i[r],s[r])}return{tangents:i,normals:s,binormals:n}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(t=0,e=0,r=1,i=1,s=0,n=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=r,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=n,this.aClockwise=o,this.aRotation=a}getPoint(t,e=new Vector2){const r=e,i=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const n=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(s=n?0:i),!0!==this.aClockwise||n||(s===i?s=-i:s-=i);const o=this.aStartAngle+t*s;let a=this.aX+this.xRadius*Math.cos(o),h=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),r=a-this.aX,i=h-this.aY;a=r*t-i*e+this.aX,h=r*e+i*t+this.aY}return r.set(a,h)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(t,e,r,i,s,n){super(t,e,r,r,i,s,n),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let t=0,e=0,r=0,i=0;function s(s,n,o,a){t=s,e=o,r=-3*s+3*n-2*o-a,i=2*s-2*n+o+a}return{initCatmullRom:function(t,e,r,i,n){s(e,r,n*(r-t),n*(i-e))},initNonuniformCatmullRom:function(t,e,r,i,n,o,a){let h=(e-t)/n-(r-t)/(n+o)+(r-e)/o,l=(r-e)/o-(i-e)/(o+a)+(i-r)/a;h*=o,l*=o,s(e,r,h,l)},calc:function(s){const n=s*s;return t+e*s+r*n+i*(n*s)}}}const tmp=new three_core_Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(t=[],e=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=r,this.tension=i}getPoint(t,e=new three_core_Vector3){const r=e,i=this.points,s=i.length,n=(s-(this.closed?0:1))*t;let o,a,h=Math.floor(n),l=n-h;this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/s)+1)*s:0===l&&h===s-1&&(h=s-2,l=1),this.closed||h>0?o=i[(h-1)%s]:(tmp.subVectors(i[0],i[1]).add(i[0]),o=tmp);const c=i[h%s],u=i[(h+1)%s];if(this.closed||h+2<s?a=i[(h+2)%s]:(tmp.subVectors(i[s-1],i[s-2]).add(i[s-1]),a=tmp),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(c),t),r=Math.pow(c.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(a),t);r<1e-4&&(r=1),e<1e-4&&(e=r),i<1e-4&&(i=r),px.initNonuniformCatmullRom(o.x,c.x,u.x,a.x,e,r,i),py.initNonuniformCatmullRom(o.y,c.y,u.y,a.y,e,r,i),pz.initNonuniformCatmullRom(o.z,c.z,u.z,a.z,e,r,i)}else"catmullrom"===this.curveType&&(px.initCatmullRom(o.x,c.x,u.x,a.x,this.tension),py.initCatmullRom(o.y,c.y,u.y,a.y,this.tension),pz.initCatmullRom(o.z,c.z,u.z,a.z,this.tension));return r.set(px.calc(l),py.calc(l),pz.calc(l)),r}copy(t){super.copy(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,r=this.points.length;e<r;e++){const r=this.points[e];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const r=t.points[e];this.points.push((new three_core_Vector3).fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function CatmullRom(t,e,r,i,s){const n=.5*(i-e),o=.5*(s-r),a=t*t;return(2*r-2*i+n+o)*(t*a)+(-3*r+3*i-2*n-o)*a+n*t+r}function QuadraticBezierP0(t,e){const r=1-t;return r*r*e}function QuadraticBezierP1(t,e){return 2*(1-t)*t*e}function QuadraticBezierP2(t,e){return t*t*e}function QuadraticBezier(t,e,r,i){return QuadraticBezierP0(t,e)+QuadraticBezierP1(t,r)+QuadraticBezierP2(t,i)}function CubicBezierP0(t,e){const r=1-t;return r*r*r*e}function CubicBezierP1(t,e){const r=1-t;return 3*r*r*t*e}function CubicBezierP2(t,e){return 3*(1-t)*t*t*e}function CubicBezierP3(t,e){return t*t*t*e}function CubicBezier(t,e,r,i,s){return CubicBezierP0(t,e)+CubicBezierP1(t,r)+CubicBezierP2(t,i)+CubicBezierP3(t,s)}class CubicBezierCurve extends Curve{constructor(t=new Vector2,e=new Vector2,r=new Vector2,i=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=r,this.v3=i}getPoint(t,e=new Vector2){const r=e,i=this.v0,s=this.v1,n=this.v2,o=this.v3;return r.set(CubicBezier(t,i.x,s.x,n.x,o.x),CubicBezier(t,i.y,s.y,n.y,o.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class CubicBezierCurve3 extends Curve{constructor(t=new three_core_Vector3,e=new three_core_Vector3,r=new three_core_Vector3,i=new three_core_Vector3){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=r,this.v3=i}getPoint(t,e=new three_core_Vector3){const r=e,i=this.v0,s=this.v1,n=this.v2,o=this.v3;return r.set(CubicBezier(t,i.x,s.x,n.x,o.x),CubicBezier(t,i.y,s.y,n.y,o.y),CubicBezier(t,i.z,s.z,n.z,o.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class LineCurve extends Curve{constructor(t=new Vector2,e=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Vector2){const r=e;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Vector2){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class LineCurve3 extends Curve{constructor(t=new three_core_Vector3,e=new three_core_Vector3){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new three_core_Vector3){const r=e;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new three_core_Vector3){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class QuadraticBezierCurve extends Curve{constructor(t=new Vector2,e=new Vector2,r=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=r}getPoint(t,e=new Vector2){const r=e,i=this.v0,s=this.v1,n=this.v2;return r.set(QuadraticBezier(t,i.x,s.x,n.x),QuadraticBezier(t,i.y,s.y,n.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(t=new three_core_Vector3,e=new three_core_Vector3,r=new three_core_Vector3){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=r}getPoint(t,e=new three_core_Vector3){const r=e,i=this.v0,s=this.v1,n=this.v2;return r.set(QuadraticBezier(t,i.x,s.x,n.x),QuadraticBezier(t,i.y,s.y,n.y),QuadraticBezier(t,i.z,s.z,n.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class SplineCurve extends Curve{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Vector2){const r=e,i=this.points,s=(i.length-1)*t,n=Math.floor(s),o=s-n,a=i[0===n?n:n-1],h=i[n],l=i[n>i.length-2?i.length-1:n+1],c=i[n>i.length-3?i.length-1:n+2];return r.set(CatmullRom(o,a.x,h.x,l.x,c.x),CatmullRom(o,a.y,h.y,l.y,c.y)),r}copy(t){super.copy(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const r=t.points[e];this.points.push(r.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,r=this.points.length;e<r;e++){const r=this.points[e];t.points.push(r.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,r=t.points.length;e<r;e++){const r=t.points[e];this.points.push((new Vector2).fromArray(r))}return this}}var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const r=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Curves[r](e,t))}return this}getPoint(t,e){const r=t*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=r){const t=i[s]-r,n=this.curves[s],o=n.getLength(),a=0===o?0:1-t/o;return n.getPointAt(a,e)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let r=0,i=this.curves.length;r<i;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let r;for(let i=0,s=this.curves;i<s.length;i++){const n=s[i],o=n.isEllipseCurve?2*t:n.isLineCurve||n.isLineCurve3?1:n.isSplineCurve?t*n.points.length:t,a=n.getPoints(o);for(let t=0;t<a.length;t++){const i=a[t];r&&r.equals(i)||(e.push(i),r=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,r=t.curves.length;e<r;e++){const r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,r=this.curves.length;e<r;e++){const r=this.curves[e];t.curves.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,r=t.curves.length;e<r;e++){const r=t.curves[e];this.curves.push((new Curves[r.type]).fromJSON(r))}return this}}class Path extends CurvePath{constructor(t){super(),this.type="Path",this.currentPoint=new Vector2,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const r=new LineCurve(this.currentPoint.clone(),new Vector2(t,e));return this.curves.push(r),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,r,i){const s=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(t,e),new Vector2(r,i));return this.curves.push(s),this.currentPoint.set(r,i),this}bezierCurveTo(t,e,r,i,s,n){const o=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(t,e),new Vector2(r,i),new Vector2(s,n));return this.curves.push(o),this.currentPoint.set(s,n),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),r=new SplineCurve(e);return this.curves.push(r),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,r,i,s,n){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,r,i,s,n),this}absarc(t,e,r,i,s,n){return this.absellipse(t,e,r,r,i,s,n),this}ellipse(t,e,r,i,s,n,o,a){const h=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+h,e+l,r,i,s,n,o,a),this}absellipse(t,e,r,i,s,n,o,a){const h=new EllipseCurve(t,e,r,i,s,n,o,a);if(this.curves.length>0){const t=h.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(h);const l=h.getPoint(1);return this.currentPoint.copy(l),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Shape extends Path{constructor(t){super(t),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let r=0,i=this.holes.length;r<i;r++)e[r]=this.holes[r].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,r=t.holes.length;e<r;e++){const r=t.holes[e];this.holes.push(r.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,r=this.holes.length;e<r;e++){const r=this.holes[e];t.holes.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,r=t.holes.length;e<r;e++){const r=t.holes[e];this.holes.push((new Path).fromJSON(r))}return this}}function earcut(t,e,r=2){const i=e&&e.length,s=i?e[0]*r:t.length;let n=linkedList(t,0,s,r,!0);const o=[];if(!n||n.next===n.prev)return o;let a,h,l;if(i&&(n=eliminateHoles(t,e,n,r)),t.length>80*r){a=1/0,h=1/0;let e=-1/0,i=-1/0;for(let n=r;n<s;n+=r){const r=t[n],s=t[n+1];r<a&&(a=r),s<h&&(h=s),r>e&&(e=r),s>i&&(i=s)}l=Math.max(e-a,i-h),l=0!==l?32767/l:0}return earcutLinked(n,o,r,a,h,l,0),o}function linkedList(t,e,r,i,s){let n;if(s===signedArea(t,e,r,i)>0)for(let s=e;s<r;s+=i)n=insertNode(s/i|0,t[s],t[s+1],n);else for(let s=r-i;s>=e;s-=i)n=insertNode(s/i|0,t[s],t[s+1],n);return n&&equals(n,n.next)&&(removeNode(n),n=n.next),n}function filterPoints(t,e){if(!t)return t;e||(e=t);let r,i=t;do{if(r=!1,i.steiner||!equals(i,i.next)&&0!==three_core_area(i.prev,i,i.next))i=i.next;else{if(removeNode(i),i=e=i.prev,i===i.next)break;r=!0}}while(r||i!==e);return e}function earcutLinked(t,e,r,i,s,n,o){if(!t)return;!o&&n&&indexCurve(t,i,s,n);let a=t;for(;t.prev!==t.next;){const h=t.prev,l=t.next;if(n?isEarHashed(t,i,s,n):isEar(t))e.push(h.i,t.i,l.i),removeNode(t),t=l.next,a=l.next;else if((t=l)===a){o?1===o?earcutLinked(t=cureLocalIntersections(filterPoints(t),e),e,r,i,s,n,2):2===o&&splitEarcut(t,e,r,i,s,n):earcutLinked(filterPoints(t),e,r,i,s,n,1);break}}}function isEar(t){const e=t.prev,r=t,i=t.next;if(three_core_area(e,r,i)>=0)return!1;const s=e.x,n=r.x,o=i.x,a=e.y,h=r.y,l=i.y,c=Math.min(s,n,o),u=Math.min(a,h,l),p=Math.max(s,n,o),d=Math.max(a,h,l);let m=i.next;for(;m!==e;){if(m.x>=c&&m.x<=p&&m.y>=u&&m.y<=d&&pointInTriangleExceptFirst(s,a,n,h,o,l,m.x,m.y)&&three_core_area(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function isEarHashed(t,e,r,i){const s=t.prev,n=t,o=t.next;if(three_core_area(s,n,o)>=0)return!1;const a=s.x,h=n.x,l=o.x,c=s.y,u=n.y,p=o.y,d=Math.min(a,h,l),m=Math.min(c,u,p),f=Math.max(a,h,l),y=Math.max(c,u,p),g=zOrder(d,m,e,r,i),_=zOrder(f,y,e,r,i);let v=t.prevZ,x=t.nextZ;for(;v&&v.z>=g&&x&&x.z<=_;){if(v.x>=d&&v.x<=f&&v.y>=m&&v.y<=y&&v!==s&&v!==o&&pointInTriangleExceptFirst(a,c,h,u,l,p,v.x,v.y)&&three_core_area(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=d&&x.x<=f&&x.y>=m&&x.y<=y&&x!==s&&x!==o&&pointInTriangleExceptFirst(a,c,h,u,l,p,x.x,x.y)&&three_core_area(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=g;){if(v.x>=d&&v.x<=f&&v.y>=m&&v.y<=y&&v!==s&&v!==o&&pointInTriangleExceptFirst(a,c,h,u,l,p,v.x,v.y)&&three_core_area(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=d&&x.x<=f&&x.y>=m&&x.y<=y&&x!==s&&x!==o&&pointInTriangleExceptFirst(a,c,h,u,l,p,x.x,x.y)&&three_core_area(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function cureLocalIntersections(t,e){let r=t;do{const i=r.prev,s=r.next.next;!equals(i,s)&&intersects(i,r,r.next,s)&&locallyInside(i,s)&&locallyInside(s,i)&&(e.push(i.i,r.i,s.i),removeNode(r),removeNode(r.next),r=t=s),r=r.next}while(r!==t);return filterPoints(r)}function splitEarcut(t,e,r,i,s,n){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&isValidDiagonal(o,t)){let a=splitPolygon(o,t);return o=filterPoints(o,o.next),a=filterPoints(a,a.next),earcutLinked(o,e,r,i,s,n,0),void earcutLinked(a,e,r,i,s,n,0)}t=t.next}o=o.next}while(o!==t)}function eliminateHoles(t,e,r,i){const s=[];for(let r=0,n=e.length;r<n;r++){const o=linkedList(t,e[r]*i,r<n-1?e[r+1]*i:t.length,i,!1);o===o.next&&(o.steiner=!0),s.push(getLeftmost(o))}s.sort(compareXYSlope);for(let t=0;t<s.length;t++)r=eliminateHole(s[t],r);return r}function compareXYSlope(t,e){let r=t.x-e.x;return 0===r&&(r=t.y-e.y,0===r)&&(r=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function eliminateHole(t,e){const r=findHoleBridge(t,e);if(!r)return e;const i=splitPolygon(r,t);return filterPoints(i,i.next),filterPoints(r,r.next)}function findHoleBridge(t,e){let r=e;const i=t.x,s=t.y;let n,o=-1/0;if(equals(t,r))return r;do{if(equals(t,r.next))return r.next;if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){const t=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(t<=i&&t>o&&(o=t,n=r.x<r.next.x?r:r.next,t===i))return n}r=r.next}while(r!==e);if(!n)return null;const a=n,h=n.x,l=n.y;let c=1/0;r=n;do{if(i>=r.x&&r.x>=h&&i!==r.x&&pointInTriangle(s<l?i:o,s,h,l,s<l?o:i,s,r.x,r.y)){const e=Math.abs(s-r.y)/(i-r.x);locallyInside(r,t)&&(e<c||e===c&&(r.x>n.x||r.x===n.x&&sectorContainsSector(n,r)))&&(n=r,c=e)}r=r.next}while(r!==a);return n}function sectorContainsSector(t,e){return three_core_area(t.prev,t,e.prev)<0&&three_core_area(e.next,t,t.next)<0}function indexCurve(t,e,r,i){let s=t;do{0===s.z&&(s.z=zOrder(s.x,s.y,e,r,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,sortLinked(s)}function sortLinked(t){let e,r=1;do{let i,s=t;t=null;let n=null;for(e=0;s;){e++;let o=s,a=0;for(let t=0;t<r&&(a++,o=o.nextZ,o);t++);let h=r;for(;a>0||h>0&&o;)0!==a&&(0===h||!o||s.z<=o.z)?(i=s,s=s.nextZ,a--):(i=o,o=o.nextZ,h--),n?n.nextZ=i:t=i,i.prevZ=n,n=i;s=o}n.nextZ=null,r*=2}while(e>1);return t}function zOrder(t,e,r,i,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){let e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function pointInTriangle(t,e,r,i,s,n,o,a){return(s-o)*(e-a)>=(t-o)*(n-a)&&(t-o)*(i-a)>=(r-o)*(e-a)&&(r-o)*(n-a)>=(s-o)*(i-a)}function pointInTriangleExceptFirst(t,e,r,i,s,n,o,a){return!(t===o&&e===a)&&pointInTriangle(t,e,r,i,s,n,o,a)}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!intersectsPolygon(t,e)&&(locallyInside(t,e)&&locallyInside(e,t)&&middleInside(t,e)&&(three_core_area(t.prev,t,e.prev)||three_core_area(t,e.prev,e))||equals(t,e)&&three_core_area(t.prev,t,t.next)>0&&three_core_area(e.prev,e,e.next)>0)}function three_core_area(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,r,i){const s=sign(three_core_area(t,e,r)),n=sign(three_core_area(t,e,i)),o=sign(three_core_area(r,i,t)),a=sign(three_core_area(r,i,e));return s!==n&&o!==a||!(0!==s||!onSegment(t,r,e))||!(0!==n||!onSegment(t,i,e))||!(0!==o||!onSegment(r,t,i))||!(0!==a||!onSegment(r,e,i))}function onSegment(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function sign(t){return t>0?1:t<0?-1:0}function intersectsPolygon(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&intersects(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function locallyInside(t,e){return three_core_area(t.prev,t,t.next)<0?three_core_area(t,e,t.next)>=0&&three_core_area(t,t.prev,e)>=0:three_core_area(t,e,t.prev)<0||three_core_area(t,t.next,e)<0}function middleInside(t,e){let r=t,i=!1;const s=(t.x+e.x)/2,n=(t.y+e.y)/2;do{r.y>n!=r.next.y>n&&r.next.y!==r.y&&s<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}function splitPolygon(t,e){const r=createNode(t.i,t.x,t.y),i=createNode(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,r.next=s,s.prev=r,i.next=r,r.prev=i,n.next=i,i.prev=n,i}function insertNode(t,e,r,i){const s=createNode(t,e,r);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function createNode(t,e,r){return{i:t,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function signedArea(t,e,r,i){let s=0;for(let n=e,o=r-i;n<r;n+=i)s+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return s}class Earcut{static triangulate(t,e,r=2){return earcut(t,e,r)}}class ShapeUtils{static area(t){const e=t.length;let r=0;for(let i=e-1,s=0;s<e;i=s++)r+=t[i].x*t[s].y-t[s].x*t[i].y;return.5*r}static isClockWise(t){return ShapeUtils.area(t)<0}static triangulateShape(t,e){const r=[],i=[],s=[];removeDupEndPts(t),addContour(r,t);let n=t.length;e.forEach(removeDupEndPts);for(let t=0;t<e.length;t++)i.push(n),n+=e[t].length,addContour(r,e[t]);const o=Earcut.triangulate(r,i);for(let t=0;t<o.length;t+=3)s.push(o.slice(t,t+3));return s}}function removeDupEndPts(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function addContour(t,e){for(let r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}class ExtrudeGeometry extends BufferGeometry{constructor(t=new Shape([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const r=this,i=[],s=[];for(let e=0,r=t.length;e<r;e++)n(t[e]);function n(t){const n=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1,h=void 0!==e.depth?e.depth:1;let l=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:c-.1,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3;const m=e.extrudePath,f=void 0!==e.UVGenerator?e.UVGenerator:WorldUVGenerator;let y,g,_,v,x,b=!1;m&&(y=m.getSpacedPoints(a),b=!0,l=!1,g=m.computeFrenetFrames(a,!1),_=new three_core_Vector3,v=new three_core_Vector3,x=new three_core_Vector3),l||(d=0,c=0,u=0,p=0);const M=t.extractPoints(o);let w=M.shape;const S=M.holes;if(!ShapeUtils.isClockWise(w)){w=w.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];ShapeUtils.isClockWise(e)&&(S[t]=e.reverse())}}function A(t){const e=1e-10*1e-10;let r=t[0];for(let i=1;i<=t.length;i++){const s=i%t.length,n=t[s],o=n.x-r.x,a=n.y-r.y,h=o*o+a*a,l=Math.max(Math.abs(n.x),Math.abs(n.y),Math.abs(r.x),Math.abs(r.y));h<=e*l*l?(t.splice(s,1),i--):r=n}}A(w),S.forEach(A);const T=S.length,C=w;for(let t=0;t<T;t++){const e=S[t];w=w.concat(e)}function I(t,e,r){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,r)}const k=w.length;function B(t,e,r){let i,s,n;const o=t.x-e.x,a=t.y-e.y,h=r.x-t.x,l=r.y-t.y,c=o*o+a*a,u=o*l-a*h;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(c),p=Math.sqrt(h*h+l*l),d=e.x-a/u,m=e.y+o/u,f=((r.x-l/p-d)*l-(r.y+h/p-m)*h)/(o*l-a*h);i=d+o*f-t.x,s=m+a*f-t.y;const y=i*i+s*s;if(y<=2)return new Vector2(i,s);n=Math.sqrt(y/2)}else{let t=!1;o>Number.EPSILON?h>Number.EPSILON&&(t=!0):o<-Number.EPSILON?h<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(l)&&(t=!0),t?(i=-a,s=o,n=Math.sqrt(c)):(i=o,s=a,n=Math.sqrt(c/2))}return new Vector2(i/n,s/n)}const P=[];for(let t=0,e=C.length,r=e-1,i=t+1;t<e;t++,r++,i++)r===e&&(r=0),i===e&&(i=0),P[t]=B(C[t],C[r],C[i]);const z=[];let R,V,E=P.concat();for(let t=0,e=T;t<e;t++){const e=S[t];R=[];for(let t=0,r=e.length,i=r-1,s=t+1;t<r;t++,i++,s++)i===r&&(i=0),s===r&&(s=0),R[t]=B(e[t],e[i],e[s]);z.push(R),E=E.concat(R)}if(0===d)V=ShapeUtils.triangulateShape(C,S);else{const t=[],e=[];for(let r=0;r<d;r++){const i=r/d,s=c*Math.cos(i*Math.PI/2),n=u*Math.sin(i*Math.PI/2)+p;for(let e=0,r=C.length;e<r;e++){const r=I(C[e],P[e],n);G(r.x,r.y,-s),0===i&&t.push(r)}for(let t=0,r=T;t<r;t++){const r=S[t];R=z[t];const o=[];for(let t=0,e=r.length;t<e;t++){const e=I(r[t],R[t],n);G(e.x,e.y,-s),0===i&&o.push(e)}0===i&&e.push(o)}}V=ShapeUtils.triangulateShape(t,e)}const F=V.length,O=u+p;for(let t=0;t<k;t++){const e=l?I(w[t],E[t],O):w[t];b?(v.copy(g.normals[0]).multiplyScalar(e.x),_.copy(g.binormals[0]).multiplyScalar(e.y),x.copy(y[0]).add(v).add(_),G(x.x,x.y,x.z)):G(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<k;e++){const r=l?I(w[e],E[e],O):w[e];b?(v.copy(g.normals[t]).multiplyScalar(r.x),_.copy(g.binormals[t]).multiplyScalar(r.y),x.copy(y[t]).add(v).add(_),G(x.x,x.y,x.z)):G(r.x,r.y,h/a*t)}for(let t=d-1;t>=0;t--){const e=t/d,r=c*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+p;for(let t=0,e=C.length;t<e;t++){const e=I(C[t],P[t],i);G(e.x,e.y,h+r)}for(let t=0,e=S.length;t<e;t++){const e=S[t];R=z[t];for(let t=0,s=e.length;t<s;t++){const s=I(e[t],R[t],i);b?G(s.x,s.y+y[a-1].y,y[a-1].x+r):G(s.x,s.y,h+r)}}}function L(t,e){let r=t.length;for(;--r>=0;){const i=r;let s=r-1;s<0&&(s=t.length-1);for(let t=0,r=a+2*d;t<r;t++){const r=k*t,n=k*(t+1);N(e+i+r,e+s+r,e+s+n,e+i+n)}}}function G(t,e,r){n.push(t),n.push(e),n.push(r)}function D(t,e,s){U(t),U(e),U(s);const n=i.length/3,o=f.generateTopUV(r,i,n-3,n-2,n-1);j(o[0]),j(o[1]),j(o[2])}function N(t,e,s,n){U(t),U(e),U(n),U(e),U(s),U(n);const o=i.length/3,a=f.generateSideWallUV(r,i,o-6,o-3,o-2,o-1);j(a[0]),j(a[1]),j(a[3]),j(a[1]),j(a[2]),j(a[3])}function U(t){i.push(n[3*t+0]),i.push(n[3*t+1]),i.push(n[3*t+2])}function j(t){s.push(t.x),s.push(t.y)}!function(){const t=i.length/3;if(l){let t=0,e=k*t;for(let t=0;t<F;t++){const r=V[t];D(r[2]+e,r[1]+e,r[0]+e)}t=a+2*d,e=k*t;for(let t=0;t<F;t++){const r=V[t];D(r[0]+e,r[1]+e,r[2]+e)}}else{for(let t=0;t<F;t++){const e=V[t];D(e[2],e[1],e[0])}for(let t=0;t<F;t++){const e=V[t];D(e[0]+k*a,e[1]+k*a,e[2]+k*a)}}r.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;L(C,e),e+=C.length;for(let t=0,r=S.length;t<r;t++){const r=S[t];L(r,e),e+=r.length}r.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new Float32BufferAttribute(i,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2)),this.computeVertexNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return toJSON$1(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const r=[];for(let i=0,s=t.shapes.length;i<s;i++){const s=e[t.shapes[i]];r.push(s)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new Curves[i.type]).fromJSON(i)),new ExtrudeGeometry(r,t.options)}}const WorldUVGenerator={generateTopUV:function(t,e,r,i,s){const n=e[3*r],o=e[3*r+1],a=e[3*i],h=e[3*i+1],l=e[3*s],c=e[3*s+1];return[new Vector2(n,o),new Vector2(a,h),new Vector2(l,c)]},generateSideWallUV:function(t,e,r,i,s,n){const o=e[3*r],a=e[3*r+1],h=e[3*r+2],l=e[3*i],c=e[3*i+1],u=e[3*i+2],p=e[3*s],d=e[3*s+1],m=e[3*s+2],f=e[3*n],y=e[3*n+1],g=e[3*n+2];return Math.abs(a-c)<Math.abs(o-l)?[new Vector2(o,1-h),new Vector2(l,1-u),new Vector2(p,1-m),new Vector2(f,1-g)]:[new Vector2(a,1-h),new Vector2(c,1-u),new Vector2(d,1-m),new Vector2(y,1-g)]}};function toJSON$1(t,e,r){if(r.shapes=[],Array.isArray(t))for(let e=0,i=t.length;e<i;e++){const i=t[e];r.shapes.push(i.uuid)}else r.shapes.push(t.uuid);return r.options=Object.assign({},e),void 0!==e.extrudePath&&(r.options.extrudePath=e.extrudePath.toJSON()),r}class IcosahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){const r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new IcosahedronGeometry(t.radius,t.detail)}}class LatheGeometry extends BufferGeometry{constructor(t=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],e=12,r=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:i},e=Math.floor(e),i=clamp(i,0,2*Math.PI);const s=[],n=[],o=[],a=[],h=[],l=1/e,c=new three_core_Vector3,u=new Vector2,p=new three_core_Vector3,d=new three_core_Vector3,m=new three_core_Vector3;let f=0,y=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:f=t[e+1].x-t[e].x,y=t[e+1].y-t[e].y,p.x=1*y,p.y=-f,p.z=0*y,m.copy(p),p.normalize(),a.push(p.x,p.y,p.z);break;case t.length-1:a.push(m.x,m.y,m.z);break;default:f=t[e+1].x-t[e].x,y=t[e+1].y-t[e].y,p.x=1*y,p.y=-f,p.z=0*y,d.copy(p),p.x+=m.x,p.y+=m.y,p.z+=m.z,p.normalize(),a.push(p.x,p.y,p.z),m.copy(d)}for(let s=0;s<=e;s++){const p=r+s*l*i,d=Math.sin(p),m=Math.cos(p);for(let r=0;r<=t.length-1;r++){c.x=t[r].x*d,c.y=t[r].y,c.z=t[r].x*m,n.push(c.x,c.y,c.z),u.x=s/e,u.y=r/(t.length-1),o.push(u.x,u.y);const i=a[3*r+0]*d,l=a[3*r+1],p=a[3*r+0]*m;h.push(i,l,p)}}for(let r=0;r<e;r++)for(let e=0;e<t.length-1;e++){const i=e+r*t.length,n=i,o=i+t.length,a=i+t.length+1,h=i+1;s.push(n,o,h),s.push(a,h,o)}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("uv",new Float32BufferAttribute(o,2)),this.setAttribute("normal",new Float32BufferAttribute(h,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new LatheGeometry(t.points,t.segments,t.phiStart,t.phiLength)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new OctahedronGeometry(t.radius,t.detail)}}class PlaneGeometry extends BufferGeometry{constructor(t=1,e=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:i};const s=t/2,n=e/2,o=Math.floor(r),a=Math.floor(i),h=o+1,l=a+1,c=t/o,u=e/a,p=[],d=[],m=[],f=[];for(let t=0;t<l;t++){const e=t*u-n;for(let r=0;r<h;r++){const i=r*c-s;d.push(i,-e,0),m.push(0,0,1),f.push(r/o),f.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const r=e+h*t,i=e+h*(t+1),s=e+1+h*(t+1),n=e+1+h*t;p.push(r,i,n),p.push(i,s,n)}this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new PlaneGeometry(t.width,t.height,t.widthSegments,t.heightSegments)}}class RingGeometry extends BufferGeometry{constructor(t=.5,e=1,r=32,i=1,s=0,n=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:i,thetaStart:s,thetaLength:n},r=Math.max(3,r);const o=[],a=[],h=[],l=[];let c=t;const u=(e-t)/(i=Math.max(1,i)),p=new three_core_Vector3,d=new Vector2;for(let t=0;t<=i;t++){for(let t=0;t<=r;t++){const i=s+t/r*n;p.x=c*Math.cos(i),p.y=c*Math.sin(i),a.push(p.x,p.y,p.z),h.push(0,0,1),d.x=(p.x/e+1)/2,d.y=(p.y/e+1)/2,l.push(d.x,d.y)}c+=u}for(let t=0;t<i;t++){const e=t*(r+1);for(let t=0;t<r;t++){const i=t+e,s=i,n=i+r+1,a=i+r+2,h=i+1;o.push(s,n,h),o.push(n,a,h)}}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new RingGeometry(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(t=new Shape([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const r=[],i=[],s=[],n=[];let o=0,a=0;if(!1===Array.isArray(t))h(t);else for(let e=0;e<t.length;e++)h(t[e]),this.addGroup(o,a,e),o+=a,a=0;function h(t){const o=i.length/3,h=t.extractPoints(e);let l=h.shape;const c=h.holes;!1===ShapeUtils.isClockWise(l)&&(l=l.reverse());for(let t=0,e=c.length;t<e;t++){const e=c[t];!0===ShapeUtils.isClockWise(e)&&(c[t]=e.reverse())}const u=ShapeUtils.triangulateShape(l,c);for(let t=0,e=c.length;t<e;t++){const e=c[t];l=l.concat(e)}for(let t=0,e=l.length;t<e;t++){const e=l[t];i.push(e.x,e.y,0),s.push(0,0,1),n.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],i=e[0]+o,s=e[1]+o,n=e[2]+o;r.push(i,s,n),a+=3}}this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(i,3)),this.setAttribute("normal",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(n,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return toJSON(this.parameters.shapes,t)}static fromJSON(t,e){const r=[];for(let i=0,s=t.shapes.length;i<s;i++){const s=e[t.shapes[i]];r.push(s)}return new ShapeGeometry(r,t.curveSegments)}}function toJSON(t,e){if(e.shapes=[],Array.isArray(t))for(let r=0,i=t.length;r<i;r++){const i=t[r];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}class SphereGeometry extends BufferGeometry{constructor(t=1,e=32,r=16,i=0,s=2*Math.PI,n=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:i,phiLength:s,thetaStart:n,thetaLength:o},e=Math.max(3,Math.floor(e)),r=Math.max(2,Math.floor(r));const a=Math.min(n+o,Math.PI);let h=0;const l=[],c=new three_core_Vector3,u=new three_core_Vector3,p=[],d=[],m=[],f=[];for(let p=0;p<=r;p++){const y=[],g=p/r;let _=0;0===p&&0===n?_=.5/e:p===r&&a===Math.PI&&(_=-.5/e);for(let r=0;r<=e;r++){const a=r/e;c.x=-t*Math.cos(i+a*s)*Math.sin(n+g*o),c.y=t*Math.cos(n+g*o),c.z=t*Math.sin(i+a*s)*Math.sin(n+g*o),d.push(c.x,c.y,c.z),u.copy(c).normalize(),m.push(u.x,u.y,u.z),f.push(a+_,1-g),y.push(h++)}l.push(y)}for(let t=0;t<r;t++)for(let i=0;i<e;i++){const e=l[t][i+1],s=l[t][i],o=l[t+1][i],h=l[t+1][i+1];(0!==t||n>0)&&p.push(e,s,h),(t!==r-1||a<Math.PI)&&p.push(s,o,h)}this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new SphereGeometry(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new TetrahedronGeometry(t.radius,t.detail)}}class TorusGeometry extends BufferGeometry{constructor(t=1,e=.4,r=12,i=48,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:i,arc:s},r=Math.floor(r),i=Math.floor(i);const n=[],o=[],a=[],h=[],l=new three_core_Vector3,c=new three_core_Vector3,u=new three_core_Vector3;for(let n=0;n<=r;n++)for(let p=0;p<=i;p++){const d=p/i*s,m=n/r*Math.PI*2;c.x=(t+e*Math.cos(m))*Math.cos(d),c.y=(t+e*Math.cos(m))*Math.sin(d),c.z=e*Math.sin(m),o.push(c.x,c.y,c.z),l.x=t*Math.cos(d),l.y=t*Math.sin(d),u.subVectors(c,l).normalize(),a.push(u.x,u.y,u.z),h.push(p/i),h.push(n/r)}for(let t=1;t<=r;t++)for(let e=1;e<=i;e++){const r=(i+1)*t+e-1,s=(i+1)*(t-1)+e-1,o=(i+1)*(t-1)+e,a=(i+1)*t+e;n.push(r,s,a),n.push(s,o,a)}this.setIndex(n),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new TorusGeometry(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(t=1,e=.4,r=64,i=8,s=2,n=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:i,p:s,q:n},r=Math.floor(r),i=Math.floor(i);const o=[],a=[],h=[],l=[],c=new three_core_Vector3,u=new three_core_Vector3,p=new three_core_Vector3,d=new three_core_Vector3,m=new three_core_Vector3,f=new three_core_Vector3,y=new three_core_Vector3;for(let o=0;o<=r;++o){const _=o/r*s*Math.PI*2;g(_,s,n,t,p),g(_+.01,s,n,t,d),f.subVectors(d,p),y.addVectors(d,p),m.crossVectors(f,y),y.crossVectors(m,f),m.normalize(),y.normalize();for(let t=0;t<=i;++t){const s=t/i*Math.PI*2,n=-e*Math.cos(s),d=e*Math.sin(s);c.x=p.x+(n*y.x+d*m.x),c.y=p.y+(n*y.y+d*m.y),c.z=p.z+(n*y.z+d*m.z),a.push(c.x,c.y,c.z),u.subVectors(c,p).normalize(),h.push(u.x,u.y,u.z),l.push(o/r),l.push(t/i)}}for(let t=1;t<=r;t++)for(let e=1;e<=i;e++){const r=(i+1)*(t-1)+(e-1),s=(i+1)*t+(e-1),n=(i+1)*t+e,a=(i+1)*(t-1)+e;o.push(r,s,a),o.push(s,n,a)}function g(t,e,r,i,s){const n=Math.cos(t),o=Math.sin(t),a=r/e*t,h=Math.cos(a);s.x=i*(2+h)*.5*n,s.y=i*(2+h)*o*.5,s.z=i*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new TorusKnotGeometry(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class TubeGeometry extends BufferGeometry{constructor(t=new QuadraticBezierCurve3(new three_core_Vector3(-1,-1,0),new three_core_Vector3(-1,1,0),new three_core_Vector3(1,1,0)),e=64,r=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:i,closed:s};const n=t.computeFrenetFrames(e,s);this.tangents=n.tangents,this.normals=n.normals,this.binormals=n.binormals;const o=new three_core_Vector3,a=new three_core_Vector3,h=new Vector2;let l=new three_core_Vector3;const c=[],u=[],p=[],d=[];function m(s){l=t.getPointAt(s/e,l);const h=n.normals[s],p=n.binormals[s];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,s=Math.sin(e),n=-Math.cos(e);a.x=n*h.x+s*p.x,a.y=n*h.y+s*p.y,a.z=n*h.z+s*p.z,a.normalize(),u.push(a.x,a.y,a.z),o.x=l.x+r*a.x,o.y=l.y+r*a.y,o.z=l.z+r*a.z,c.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)m(t);m(!1===s?e:0),function(){for(let t=0;t<=e;t++)for(let r=0;r<=i;r++)h.x=t/e,h.y=r/i,p.push(h.x,h.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const r=(i+1)*(t-1)+(e-1),s=(i+1)*t+(e-1),n=(i+1)*t+e,o=(i+1)*(t-1)+e;d.push(r,s,o),d.push(s,n,o)}}()}(),this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(c,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(p,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new TubeGeometry((new Curves[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class WireframeGeometry extends BufferGeometry{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],r=new Set,i=new three_core_Vector3,s=new three_core_Vector3;if(null!==t.index){const n=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,h=a.length;t<h;++t){const h=a[t],l=h.start;for(let t=l,a=l+h.count;t<a;t+=3)for(let a=0;a<3;a++){const h=o.getX(t+a),l=o.getX(t+(a+1)%3);i.fromBufferAttribute(n,h),s.fromBufferAttribute(n,l),!0===isUniqueEdge(i,s,r)&&(e.push(i.x,i.y,i.z),e.push(s.x,s.y,s.z))}}}else{const n=t.attributes.position;for(let t=0,o=n.count/3;t<o;t++)for(let o=0;o<3;o++){const a=3*t+o,h=3*t+(o+1)%3;i.fromBufferAttribute(n,a),s.fromBufferAttribute(n,h),!0===isUniqueEdge(i,s,r)&&(e.push(i.x,i.y,i.z),e.push(s.x,s.y,s.z))}}this.setAttribute("position",new Float32BufferAttribute(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function isUniqueEdge(t,e,r){const i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==r.has(i)&&!0!==r.has(s)&&(r.add(i),r.add(s),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry,CapsuleGeometry,CircleGeometry,ConeGeometry,CylinderGeometry,DodecahedronGeometry,EdgesGeometry,ExtrudeGeometry,IcosahedronGeometry,LatheGeometry,OctahedronGeometry,PlaneGeometry,PolyhedronGeometry,RingGeometry,ShapeGeometry,SphereGeometry,TetrahedronGeometry,TorusGeometry,TorusKnotGeometry,TubeGeometry,WireframeGeometry});class ShadowMaterial extends Material{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class RawShaderMaterial extends ShaderMaterial{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class MeshStandardMaterial extends Material{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class MeshPhongMaterial extends Material{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshToonMaterial extends Material{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class MeshNormalMaterial extends Material{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class MeshLambertMaterial extends Material{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshDepthMaterial extends Material{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class MeshMatcapMaterial extends Material{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class LineDashedMaterial extends LineBasicMaterial{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function convertArray(t,e){return t&&t.constructor!==e?"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t):t}function isTypedArray(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function getKeyframeOrder(t){const e=t.length,r=new Array(e);for(let t=0;t!==e;++t)r[t]=t;return r.sort((function(e,r){return t[e]-t[r]})),r}function sortedArray(t,e,r){const i=t.length,s=new t.constructor(i);for(let n=0,o=0;o!==i;++n){const i=r[n]*e;for(let r=0;r!==e;++r)s[o++]=t[i+r]}return s}function flattenJSON(t,e,r,i){let s=1,n=t[0];for(;void 0!==n&&void 0===n[i];)n=t[s++];if(void 0===n)return;let o=n[i];if(void 0!==o)if(Array.isArray(o))do{o=n[i],void 0!==o&&(e.push(n.time),r.push(...o)),n=t[s++]}while(void 0!==n);else if(void 0!==o.toArray)do{o=n[i],void 0!==o&&(e.push(n.time),o.toArray(r,r.length)),n=t[s++]}while(void 0!==n);else do{o=n[i],void 0!==o&&(e.push(n.time),r.push(o)),n=t[s++]}while(void 0!==n)}function subclip(t,e,r,i,s=30){const n=t.clone();n.name=e;const o=[];for(let t=0;t<n.tracks.length;++t){const e=n.tracks[t],a=e.getValueSize(),h=[],l=[];for(let t=0;t<e.times.length;++t){const n=e.times[t]*s;if(!(n<r||n>=i)){h.push(e.times[t]);for(let r=0;r<a;++r)l.push(e.values[t*a+r])}}0!==h.length&&(e.times=convertArray(h,e.times.constructor),e.values=convertArray(l,e.values.constructor),o.push(e))}n.tracks=o;let a=1/0;for(let t=0;t<n.tracks.length;++t)a>n.tracks[t].times[0]&&(a=n.tracks[t].times[0]);for(let t=0;t<n.tracks.length;++t)n.tracks[t].shift(-1*a);return n.resetDuration(),n}function makeClipAdditive(t,e=0,r=t,i=30){i<=0&&(i=30);const s=r.tracks.length,n=e/i;for(let e=0;e<s;++e){const i=r.tracks[e],s=i.ValueTypeName;if("bool"===s||"string"===s)continue;const o=t.tracks.find((function(t){return t.name===i.name&&t.ValueTypeName===s}));if(void 0===o)continue;let a=0;const h=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=h/3);let l=0;const c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);const u=i.times.length-1;let p;if(n<=i.times[0]){const t=a,e=h-a;p=i.values.slice(t,e)}else if(n>=i.times[u]){const t=u*h+a,e=t+h-a;p=i.values.slice(t,e)}else{const t=i.createInterpolant(),e=a,r=h-a;t.evaluate(n),p=t.resultBuffer.slice(e,r)}"quaternion"===s&&(new Quaternion).fromArray(p).normalize().conjugate().toArray(p);const d=o.times.length;for(let t=0;t<d;++t){const e=t*c+l;if("quaternion"===s)Quaternion.multiplyQuaternionsFlat(o.values,e,p,0,o.values,e);else{const t=c-2*l;for(let r=0;r<t;++r)o.values[e+r]-=p[r]}}}return t.blendMode=AdditiveAnimationBlendMode,t}class AnimationUtils{static convertArray(t,e){return convertArray(t,e)}static isTypedArray(t){return isTypedArray(t)}static getKeyframeOrder(t){return getKeyframeOrder(t)}static sortedArray(t,e,r){return sortedArray(t,e,r)}static flattenJSON(t,e,r,i){flattenJSON(t,e,r,i)}static subclip(t,e,r,i,s=30){return subclip(t,e,r,i,s)}static makeClipAdditive(t,e=0,r=t,i=30){return makeClipAdditive(t,e,r,i)}}class Interpolant{constructor(t,e,r,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(r),this.sampleValues=e,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let r=this._cachedIndex,i=e[r],s=e[r-1];t:{e:{let n;r:{i:if(!(t<i)){for(let n=r+2;;){if(void 0===i){if(t<s)break i;return r=e.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===n)break;if(s=i,i=e[++r],t<i)break e}n=e.length;break r}if(t>=s)break t;{const o=e[1];t<o&&(r=2,s=o);for(let n=r-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(r===n)break;if(i=s,s=e[--r-1],t>=s)break e}n=r,r=0}}for(;r<n;){const i=r+n>>>1;t<e[i]?n=i:r=i+1}if(i=e[r],s=e[r-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return r=e.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,i)}return this.interpolate_(r,s,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=t*i;for(let t=0;t!==i;++t)e[t]=r[s+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(t,e,r,i){super(t,e,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(t,e,r){const i=this.parameterPositions;let s=t-2,n=t+1,o=i[s],a=i[n];if(void 0===o)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:s=t,o=2*e-r;break;case WrapAroundEnding:s=i.length-2,o=e+i[s]-i[s+1];break;default:s=t,o=r}if(void 0===a)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:n=t,a=2*r-e;break;case WrapAroundEnding:n=1,a=r+i[1]-i[0];break;default:n=t-1,a=e}const h=.5*(r-e),l=this.valueSize;this._weightPrev=h/(e-o),this._weightNext=h/(a-r),this._offsetPrev=s*l,this._offsetNext=n*l}interpolate_(t,e,r,i){const s=this.resultBuffer,n=this.sampleValues,o=this.valueSize,a=t*o,h=a-o,l=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,p=this._weightNext,d=(r-e)/(i-e),m=d*d,f=m*d,y=-u*f+2*u*m-u*d,g=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*d+1,_=(-1-p)*f+(1.5+p)*m+.5*d,v=p*f-p*m;for(let t=0;t!==o;++t)s[t]=y*n[l+t]+g*n[h+t]+_*n[a+t]+v*n[c+t];return s}}class LinearInterpolant extends Interpolant{constructor(t,e,r,i){super(t,e,r,i)}interpolate_(t,e,r,i){const s=this.resultBuffer,n=this.sampleValues,o=this.valueSize,a=t*o,h=a-o,l=(r-e)/(i-e),c=1-l;for(let t=0;t!==o;++t)s[t]=n[h+t]*c+n[a+t]*l;return s}}class DiscreteInterpolant extends Interpolant{constructor(t,e,r,i){super(t,e,r,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class KeyframeTrack{constructor(t,e,r,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=convertArray(e,this.TimeBufferType),this.values=convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let r;if(e.toJSON!==this.toJSON)r=e.toJSON(t);else{r={name:t.name,times:convertArray(t.times,Array),values:convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(r.interpolation=e)}return r.type=t.ValueTypeName,r}InterpolantFactoryMethodDiscrete(t){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new LinearInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new CubicInterpolant(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case InterpolateDiscrete:e=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:e=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let r=0,i=e.length;r!==i;++r)e[r]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let r=0,i=e.length;r!==i;++r)e[r]*=t}return this}trim(t,e){const r=this.times,i=r.length;let s=0,n=i-1;for(;s!==i&&r[s]<t;)++s;for(;-1!==n&&r[n]>e;)--n;if(++n,0!==s||n!==i){s>=n&&(n=Math.max(n,1),s=n-1);const t=this.getValueSize();this.times=r.slice(s,n),this.values=this.values.slice(s*t,n*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const r=this.times,i=this.values,s=r.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let n=null;for(let e=0;e!==s;e++){const i=r[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==n&&n>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,n),t=!1;break}n=i}if(void 0!==i&&isTypedArray(i))for(let e=0,r=i.length;e!==r;++e){const r=i[e];if(isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,r),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),r=this.getValueSize(),i=this.getInterpolation()===InterpolateSmooth,s=t.length-1;let n=1;for(let o=1;o<s;++o){let s=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(i)s=!0;else{const t=o*r,i=t-r,n=t+r;for(let o=0;o!==r;++o){const r=e[t+o];if(r!==e[i+o]||r!==e[n+o]){s=!0;break}}}if(s){if(o!==n){t[n]=t[o];const i=o*r,s=n*r;for(let t=0;t!==r;++t)e[s+t]=e[i+t]}++n}}if(s>0){t[n]=t[s];for(let t=s*r,i=n*r,o=0;o!==r;++o)e[i+o]=e[t+o];++n}return n!==t.length?(this.times=t.slice(0,n),this.values=e.slice(0,n*r)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),r=new(0,this.constructor)(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}KeyframeTrack.prototype.ValueTypeName="",KeyframeTrack.prototype.TimeBufferType=Float32Array,KeyframeTrack.prototype.ValueBufferType=Float32Array,KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{constructor(t,e,r){super(t,e,r)}}BooleanKeyframeTrack.prototype.ValueTypeName="bool",BooleanKeyframeTrack.prototype.ValueBufferType=Array,BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{constructor(t,e,r,i){super(t,e,r,i)}}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{constructor(t,e,r,i){super(t,e,r,i)}}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(t,e,r,i){super(t,e,r,i)}interpolate_(t,e,r,i){const s=this.resultBuffer,n=this.sampleValues,o=this.valueSize,a=(r-e)/(i-e);let h=t*o;for(let t=h+o;h!==t;h+=4)Quaternion.slerpFlat(s,0,n,h-o,n,h,a);return s}}class QuaternionKeyframeTrack extends KeyframeTrack{constructor(t,e,r,i){super(t,e,r,i)}InterpolantFactoryMethodLinear(t){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),t)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion",QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{constructor(t,e,r){super(t,e,r)}}StringKeyframeTrack.prototype.ValueTypeName="string",StringKeyframeTrack.prototype.ValueBufferType=Array,StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{constructor(t,e,r,i){super(t,e,r,i)}}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(t="",e=-1,r=[],i=NormalAnimationBlendMode){this.name=t,this.tracks=r,this.duration=e,this.blendMode=i,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],r=t.tracks,i=1/(t.fps||1);for(let t=0,s=r.length;t!==s;++t)e.push(parseKeyframeTrack(r[t]).scale(i));const s=new this(t.name,t.duration,e,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const e=[],r=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,i=r.length;t!==i;++t)e.push(KeyframeTrack.toJSON(r[t]));return i}static CreateFromMorphTargetSequence(t,e,r,i){const s=e.length,n=[];for(let t=0;t<s;t++){let o=[],a=[];o.push((t+s-1)%s,t,(t+1)%s),a.push(0,1,0);const h=getKeyframeOrder(o);o=sortedArray(o,1,h),a=sortedArray(a,1,h),i||0!==o[0]||(o.push(s),a.push(a[0])),n.push(new NumberKeyframeTrack(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/r))}return new this(t,-1,n)}static findByName(t,e){let r=t;if(!Array.isArray(t)){const e=t;r=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<r.length;t++)if(r[t].name===e)return r[t];return null}static CreateClipsFromMorphTargetSequences(t,e,r){const i={},s=/^([\w-]*?)([\d]+)$/;for(let e=0,r=t.length;e<r;e++){const r=t[e],n=r.name.match(s);if(n&&n.length>1){const t=n[1];let e=i[t];e||(i[t]=e=[]),e.push(r)}}const n=[];for(const t in i)n.push(this.CreateFromMorphTargetSequence(t,i[t],e,r));return n}static parseAnimation(t,e){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(t,e,r,i,s){if(0!==r.length){const n=[],o=[];flattenJSON(r,n,o,i),0!==n.length&&s.push(new t(e,n,o))}},i=[],s=t.name||"default",n=t.fps||30,o=t.blendMode;let a=t.length||-1;const h=t.hierarchy||[];for(let t=0;t<h.length;t++){const s=h[t].keys;if(s&&0!==s.length)if(s[0].morphTargets){const t={};let e;for(e=0;e<s.length;e++)if(s[e].morphTargets)for(let r=0;r<s[e].morphTargets.length;r++)t[s[e].morphTargets[r]]=-1;for(const r in t){const t=[],n=[];for(let i=0;i!==s[e].morphTargets.length;++i){const i=s[e];t.push(i.time),n.push(i.morphTarget===r?1:0)}i.push(new NumberKeyframeTrack(".morphTargetInfluence["+r+"]",t,n))}a=t.length*n}else{const n=".bones["+e[t].name+"]";r(VectorKeyframeTrack,n+".position",s,"pos",i),r(QuaternionKeyframeTrack,n+".quaternion",s,"rot",i),r(VectorKeyframeTrack,n+".scale",s,"scl",i)}}return 0===i.length?null:new this(s,a,i,o)}resetDuration(){let t=0;for(let e=0,r=this.tracks.length;e!==r;++e){const r=this.tracks[e];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function parseKeyframeTrack(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=getTrackTypeForValueTypeName(t.type);if(void 0===t.times){const e=[],r=[];flattenJSON(t.keys,e,r,"value"),t.times=e,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Cache={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class LoadingManager{constructor(t,e,r){const i=this;let s,n=!1,o=0,a=0;const h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.abortController=new AbortController,this.itemStart=function(t){a++,!1===n&&void 0!==i.onStart&&i.onStart(t,o,a),n=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,a),o===a&&(n=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return h.push(t,e),this},this.removeHandler=function(t){const e=h.indexOf(t);return-1!==e&&h.splice(e,2),this},this.getHandler=function(t){for(let e=0,r=h.length;e<r;e+=2){const r=h[e],i=h[e+1];if(r.global&&(r.lastIndex=0),r.test(t))return i}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(t){this.manager=void 0!==t?t:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const r=this;return new Promise((function(i,s){r.load(t,i,e,s)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(t,e){super(t),this.response=e}}class FileLoader extends Loader{constructor(t){super(t),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(t,e,r,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=Cache.get(`file:${t}`);if(void 0!==s)return this.manager.itemStart(t),setTimeout((()=>{e&&e(s),this.manager.itemEnd(t)}),0),s;if(void 0!==loading[t])return void loading[t].push({onLoad:e,onProgress:r,onError:i});loading[t]=[],loading[t].push({onLoad:e,onProgress:r,onError:i});const n=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:"function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,a=this.responseType;fetch(n).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const r=loading[t],i=e.body.getReader(),s=e.headers.get("X-File-Size")||e.headers.get("Content-Length"),n=s?parseInt(s):0,o=0!==n;let a=0;const h=new ReadableStream({start(t){!function e(){i.read().then((({done:i,value:s})=>{if(i)t.close();else{a+=s.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:n});for(let t=0,e=r.length;t<e;t++){const e=r[t];e.onProgress&&e.onProgress(i)}t.enqueue(s),e()}}),(e=>{t.error(e)}))}()}});return new Response(h)}throw new HttpError(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(""===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),r=e&&e[1]?e[1].toLowerCase():void 0,i=new TextDecoder(r);return t.arrayBuffer().then((t=>i.decode(t)))}}})).then((e=>{Cache.add(`file:${t}`,e);const r=loading[t];delete loading[t];for(let t=0,i=r.length;t<i;t++){const i=r[t];i.onLoad&&i.onLoad(e)}})).catch((e=>{const r=loading[t];if(void 0===r)throw this.manager.itemError(t),e;delete loading[t];for(let t=0,i=r.length;t<i;t++){const i=r[t];i.onError&&i.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class AnimationLoader extends Loader{constructor(t){super(t)}load(t,e,r,i){const s=this,n=new FileLoader(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(t,(function(r){try{e(s.parse(JSON.parse(r)))}catch(e){i?i(e):console.error(e),s.manager.itemError(t)}}),r,i)}parse(t){const e=[];for(let r=0;r<t.length;r++){const i=AnimationClip.parse(t[r]);e.push(i)}return e}}class CompressedTextureLoader extends Loader{constructor(t){super(t)}load(t,e,r,i){const s=this,n=[],o=new CompressedTexture,a=new FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(s.withCredentials);let h=0;function l(l){a.load(t[l],(function(t){const r=s.parse(t,!0);n[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},h+=1,6===h&&(1===r.mipmapCount&&(o.minFilter=LinearFilter),o.image=n,o.format=r.format,o.needsUpdate=!0,e&&e(o))}),r,i)}if(Array.isArray(t))for(let e=0,r=t.length;e<r;++e)l(e);else a.load(t,(function(t){const r=s.parse(t,!0);if(r.isCubemap){const t=r.mipmaps.length/r.mipmapCount;for(let e=0;e<t;e++){n[e]={mipmaps:[]};for(let t=0;t<r.mipmapCount;t++)n[e].mipmaps.push(r.mipmaps[e*r.mipmapCount+t]),n[e].format=r.format,n[e].width=r.width,n[e].height=r.height}o.image=n}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=LinearFilter),o.format=r.format,o.needsUpdate=!0,e&&e(o)}),r,i);return o}}const _loading=new WeakMap;class ImageLoader extends Loader{constructor(t){super(t)}load(t,e,r,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,n=Cache.get(`image:${t}`);if(void 0!==n){if(!0===n.complete)s.manager.itemStart(t),setTimeout((function(){e&&e(n),s.manager.itemEnd(t)}),0);else{let t=_loading.get(n);void 0===t&&(t=[],_loading.set(n,t)),t.push({onLoad:e,onError:i})}return n}const o=createElementNS("img");function a(){l(),e&&e(this);const r=_loading.get(this)||[];for(let t=0;t<r.length;t++){const e=r[t];e.onLoad&&e.onLoad(this)}_loading.delete(this),s.manager.itemEnd(t)}function h(e){l(),i&&i(e),Cache.remove(`image:${t}`);const r=_loading.get(this)||[];for(let t=0;t<r.length;t++){const i=r[t];i.onError&&i.onError(e)}_loading.delete(this),s.manager.itemError(t),s.manager.itemEnd(t)}function l(){o.removeEventListener("load",a,!1),o.removeEventListener("error",h,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",h,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),Cache.add(`image:${t}`,o),s.manager.itemStart(t),o.src=t,o}}class CubeTextureLoader extends Loader{constructor(t){super(t)}load(t,e,r,i){const s=new CubeTexture;s.colorSpace=SRGBColorSpace;const n=new ImageLoader(this.manager);n.setCrossOrigin(this.crossOrigin),n.setPath(this.path);let o=0;function a(r){n.load(t[r],(function(t){s.images[r]=t,o++,6===o&&(s.needsUpdate=!0,e&&e(s))}),void 0,i)}for(let e=0;e<t.length;++e)a(e);return s}}class DataTextureLoader extends Loader{constructor(t){super(t)}load(t,e,r,i){const s=this,n=new DataTexture,o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(t,(function(t){let r;try{r=s.parse(t)}catch(t){if(void 0===i)return void console.error(t);i(t)}void 0!==r.image?n.image=r.image:void 0!==r.data&&(n.image.width=r.width,n.image.height=r.height,n.image.data=r.data),n.wrapS=void 0!==r.wrapS?r.wrapS:ClampToEdgeWrapping,n.wrapT=void 0!==r.wrapT?r.wrapT:ClampToEdgeWrapping,n.magFilter=void 0!==r.magFilter?r.magFilter:LinearFilter,n.minFilter=void 0!==r.minFilter?r.minFilter:LinearFilter,n.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.colorSpace&&(n.colorSpace=r.colorSpace),void 0!==r.flipY&&(n.flipY=r.flipY),void 0!==r.format&&(n.format=r.format),void 0!==r.type&&(n.type=r.type),void 0!==r.mipmaps&&(n.mipmaps=r.mipmaps,n.minFilter=LinearMipmapLinearFilter),1===r.mipmapCount&&(n.minFilter=LinearFilter),void 0!==r.generateMipmaps&&(n.generateMipmaps=r.generateMipmaps),n.needsUpdate=!0,e&&e(n,r)}),r,i),n}}class TextureLoader extends Loader{constructor(t){super(t)}load(t,e,r,i){const s=new Texture,n=new ImageLoader(this.manager);return n.setCrossOrigin(this.crossOrigin),n.setPath(this.path),n.load(t,(function(t){s.image=t,s.needsUpdate=!0,void 0!==e&&e(s)}),r,i),s}}class Light extends Object3D{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(e.object.target=this.target.uuid),e}}class HemisphereLight extends Light{constructor(t,e,r){super(t,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new three_core_Vector3,_lookTarget$1=new three_core_Vector3;class LightShadow{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.mapType=UnsignedByteType,this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,r=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(t.matrixWorld),e.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(_lookTarget$1),e.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1,e.coordinateSystem,e.reversedDepth),e.reversedDepth?r.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(_projScreenMatrix$1)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.autoUpdate=t.autoUpdate,this.needsUpdate=t.needsUpdate,this.normalBias=t.normalBias,this.blurSamples=t.blurSamples,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 1!==this.intensity&&(t.intensity=this.intensity),0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(t){const e=this.camera,r=2*RAD2DEG*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,s=t.distance||e.far;r===e.fov&&i===e.aspect&&s===e.far||(e.fov=r,e.aspect=i,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class SpotLight extends Light{constructor(t,e,r=0,i=Math.PI/3,s=0,n=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=r,this.angle=i,this.penumbra=s,this.decay=n,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new three_core_Vector3,_lookTarget=new three_core_Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new three_core_Vector3(1,0,0),new three_core_Vector3(-1,0,0),new three_core_Vector3(0,0,1),new three_core_Vector3(0,0,-1),new three_core_Vector3(0,1,0),new three_core_Vector3(0,-1,0)],this._cubeUps=[new three_core_Vector3(0,1,0),new three_core_Vector3(0,1,0),new three_core_Vector3(0,1,0),new three_core_Vector3(0,1,0),new three_core_Vector3(0,0,1),new three_core_Vector3(0,0,-1)]}updateMatrices(t,e=0){const r=this.camera,i=this.matrix,s=t.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(t.matrixWorld),r.position.copy(_lightPositionWorld),_lookTarget.copy(r.position),_lookTarget.add(this._cubeDirections[e]),r.up.copy(this._cubeUps[e]),r.lookAt(_lookTarget),r.updateMatrixWorld(),i.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix,r.coordinateSystem,r.reversedDepth)}}class PointLight extends Light{constructor(t,e,r=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new PointLightShadow}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class OrthographicCamera extends Camera{constructor(t=-1,e=1,r=1,i=-1,s=.1,n=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=r,this.bottom=i,this.near=s,this.far=n,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,r,i,s,n){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-t,n=r+t,o=i+e,a=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=t*this.view.offsetX,n=s+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(s,n,o,a,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class AmbientLight extends Light{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(t,e,r=10,i=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new three_core_Vector3)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const r=t.x,i=t.y,s=t.z,n=this.coefficients;return e.copy(n[0]).multiplyScalar(.282095),e.addScaledVector(n[1],.488603*i),e.addScaledVector(n[2],.488603*s),e.addScaledVector(n[3],.488603*r),e.addScaledVector(n[4],r*i*1.092548),e.addScaledVector(n[5],i*s*1.092548),e.addScaledVector(n[6],.315392*(3*s*s-1)),e.addScaledVector(n[7],r*s*1.092548),e.addScaledVector(n[8],.546274*(r*r-i*i)),e}getIrradianceAt(t,e){const r=t.x,i=t.y,s=t.z,n=this.coefficients;return e.copy(n[0]).multiplyScalar(.886227),e.addScaledVector(n[1],1.023328*i),e.addScaledVector(n[2],1.023328*s),e.addScaledVector(n[3],1.023328*r),e.addScaledVector(n[4],.858086*r*i),e.addScaledVector(n[5],.858086*i*s),e.addScaledVector(n[6],.743125*s*s-.247708),e.addScaledVector(n[7],.858086*r*s),e.addScaledVector(n[8],.429043*(r*r-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(t,e+3*i);return this}toArray(t=[],e=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const r=t.x,i=t.y,s=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*s,e[3]=.488603*r,e[4]=1.092548*r*i,e[5]=1.092548*i*s,e[6]=.315392*(3*s*s-1),e[7]=1.092548*r*s,e[8]=.546274*(r*r-i*i)}}class LightProbe extends Light{constructor(t=new SphericalHarmonics3,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class MaterialLoader extends Loader{constructor(t){super(t),this.textures={}}load(t,e,r,i){const s=this,n=new FileLoader(s.manager);n.setPath(s.path),n.setRequestHeader(s.requestHeader),n.setWithCredentials(s.withCredentials),n.load(t,(function(r){try{e(s.parse(JSON.parse(r)))}catch(e){i?i(e):console.error(e),s.manager.itemError(t)}}),r,i)}parse(t){const e=this.textures;function r(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const i=this.createMaterialFromType(t.type);if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=(new Color).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.dispersion&&(i.dispersion=t.dispersion),void 0!==t.iridescence&&(i.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(i.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(i.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(i.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(i.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(i.alphaHash=t.alphaHash),void 0!==t.depthFunc&&(i.depthFunc=t.depthFunc),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.blendSrc&&(i.blendSrc=t.blendSrc),void 0!==t.blendDst&&(i.blendDst=t.blendDst),void 0!==t.blendEquation&&(i.blendEquation=t.blendEquation),void 0!==t.blendSrcAlpha&&(i.blendSrcAlpha=t.blendSrcAlpha),void 0!==t.blendDstAlpha&&(i.blendDstAlpha=t.blendDstAlpha),void 0!==t.blendEquationAlpha&&(i.blendEquationAlpha=t.blendEquationAlpha),void 0!==t.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(t.blendColor),void 0!==t.blendAlpha&&(i.blendAlpha=t.blendAlpha),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),void 0!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(i.forceSinglePass=t.forceSinglePass),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const s=t.uniforms[e];switch(i.uniforms[e]={},s.type){case"t":i.uniforms[e].value=r(s.value);break;case"c":i.uniforms[e].value=(new Color).setHex(s.value);break;case"v2":i.uniforms[e].value=(new Vector2).fromArray(s.value);break;case"v3":i.uniforms[e].value=(new three_core_Vector3).fromArray(s.value);break;case"v4":i.uniforms[e].value=(new Vector4).fromArray(s.value);break;case"m3":i.uniforms[e].value=(new Matrix3).fromArray(s.value);break;case"m4":i.uniforms[e].value=(new Matrix4).fromArray(s.value);break;default:i.uniforms[e].value=s.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(i.glslVersion=t.glslVersion),void 0!==t.extensions)for(const e in t.extensions)i.extensions[e]=t.extensions[e];if(void 0!==t.lights&&(i.lights=t.lights),void 0!==t.clipping&&(i.clipping=t.clipping),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=r(t.map)),void 0!==t.matcap&&(i.matcap=r(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=r(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=r(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new Vector2).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=r(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=r(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=r(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=r(t.envMap)),void 0!==t.envMapRotation&&i.envMapRotation.fromArray(t.envMapRotation),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=r(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=r(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=r(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Vector2).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(i.iridescenceMap=r(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(i.iridescenceThicknessMap=r(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(i.transmissionMap=r(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=r(t.thicknessMap)),void 0!==t.anisotropyMap&&(i.anisotropyMap=r(t.anisotropyMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=r(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=r(t.sheenRoughnessMap)),i}setTextures(t){return this.textures=t,this}createMaterialFromType(t){return MaterialLoader.createMaterialFromType(t)}static createMaterialFromType(t){return new{ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material}[t]}}class LoaderUtils{static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class BufferGeometryLoader extends Loader{constructor(t){super(t)}load(t,e,r,i){const s=this,n=new FileLoader(s.manager);n.setPath(s.path),n.setRequestHeader(s.requestHeader),n.setWithCredentials(s.withCredentials),n.load(t,(function(r){try{e(s.parse(JSON.parse(r)))}catch(e){i?i(e):console.error(e),s.manager.itemError(t)}}),r,i)}parse(t){const e={},r={};function i(t,i){if(void 0!==e[i])return e[i];const s=t.interleavedBuffers[i],n=function(t,e){if(void 0!==r[e])return r[e];const i=t.arrayBuffers[e],s=new Uint32Array(i).buffer;return r[e]=s,s}(t,s.buffer),o=getTypedArray(s.type,n),a=new InterleavedBuffer(o,s.stride);return a.uuid=s.uuid,e[i]=a,a}const s=t.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,n=t.data.index;if(void 0!==n){const t=getTypedArray(n.type,n.array);s.setIndex(new BufferAttribute(t,1))}const o=t.data.attributes;for(const e in o){const r=o[e];let n;if(r.isInterleavedBufferAttribute){const e=i(t.data,r.data);n=new InterleavedBufferAttribute(e,r.itemSize,r.offset,r.normalized)}else{const t=getTypedArray(r.type,r.array);n=new(r.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(t,r.itemSize,r.normalized)}void 0!==r.name&&(n.name=r.name),void 0!==r.usage&&n.setUsage(r.usage),s.setAttribute(e,n)}const a=t.data.morphAttributes;if(a)for(const e in a){const r=a[e],n=[];for(let e=0,s=r.length;e<s;e++){const s=r[e];let o;if(s.isInterleavedBufferAttribute){const e=i(t.data,s.data);o=new InterleavedBufferAttribute(e,s.itemSize,s.offset,s.normalized)}else{const t=getTypedArray(s.type,s.array);o=new BufferAttribute(t,s.itemSize,s.normalized)}void 0!==s.name&&(o.name=s.name),n.push(o)}s.morphAttributes[e]=n}t.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);const h=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==h)for(let t=0,e=h.length;t!==e;++t){const e=h[t];s.addGroup(e.start,e.count,e.materialIndex)}const l=t.data.boundingSphere;return void 0!==l&&(s.boundingSphere=(new Sphere).fromJSON(l)),t.name&&(s.name=t.name),t.userData&&(s.userData=t.userData),s}}class ObjectLoader extends Loader{constructor(t){super(t)}load(t,e,r,i){const s=this,n=""===this.path?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const o=new FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(r){let n=null;try{n=JSON.parse(r)}catch(e){return void 0!==i&&i(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const o=n.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+t)),void console.error("THREE.ObjectLoader: Can't load "+t);s.parse(n,e)}),r,i)}async loadAsync(t,e){const r=""===this.path?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||r;const i=new FileLoader(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const s=await i.loadAsync(t,e),n=JSON.parse(s),o=n.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(n)}parse(t,e){const r=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),s=this.parseGeometries(t.geometries,i),n=this.parseImages(t.images,(function(){void 0!==e&&e(h)})),o=this.parseTextures(t.textures,n),a=this.parseMaterials(t.materials,o),h=this.parseObject(t.object,s,a,o,r),l=this.parseSkeletons(t.skeletons,h);if(this.bindSkeletons(h,l),this.bindLightTargets(h),void 0!==e){let t=!1;for(const e in n)if(n[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(h)}return h}async parseAsync(t){const e=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,r),s=await this.parseImagesAsync(t.images),n=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,n),a=this.parseObject(t.object,i,o,n,e),h=this.parseSkeletons(t.skeletons,a);return this.bindSkeletons(a,h),this.bindLightTargets(a),a}parseShapes(t){const e={};if(void 0!==t)for(let r=0,i=t.length;r<i;r++){const i=(new Shape).fromJSON(t[r]);e[i.uuid]=i}return e}parseSkeletons(t,e){const r={},i={};if(e.traverse((function(t){t.isBone&&(i[t.uuid]=t)})),void 0!==t)for(let e=0,s=t.length;e<s;e++){const s=(new Skeleton).fromJSON(t[e],i);r[s.uuid]=s}return r}parseGeometries(t,e){const r={};if(void 0!==t){const i=new BufferGeometryLoader;for(let s=0,n=t.length;s<n;s++){let n;const o=t[s];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":n=i.parse(o);break;default:o.type in Geometries?n=Geometries[o.type].fromJSON(o,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}n.uuid=o.uuid,void 0!==o.name&&(n.name=o.name),void 0!==o.userData&&(n.userData=o.userData),r[o.uuid]=n}}return r}parseMaterials(t,e){const r={},i={};if(void 0!==t){const s=new MaterialLoader;s.setTextures(e);for(let e=0,n=t.length;e<n;e++){const n=t[e];void 0===r[n.uuid]&&(r[n.uuid]=s.parse(n)),i[n.uuid]=r[n.uuid]}}return i}parseAnimations(t){const e={};if(void 0!==t)for(let r=0;r<t.length;r++){const i=t[r],s=AnimationClip.parse(i);e[s.uuid]=s}return e}parseImages(t,e){const r=this,i={};let s;function n(t){if("string"==typeof t){const e=t;return function(t){return r.manager.itemStart(t),s.load(t,(function(){r.manager.itemEnd(t)}),void 0,(function(){r.manager.itemError(t),r.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:r.resourcePath+e)}return t.data?{data:getTypedArray(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const r=new LoadingManager(e);s=new ImageLoader(r),s.setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const r=t[e],s=r.url;if(Array.isArray(s)){const t=[];for(let e=0,r=s.length;e<r;e++){const r=n(s[e]);null!==r&&(r instanceof HTMLImageElement?t.push(r):t.push(new DataTexture(r.data,r.width,r.height)))}i[r.uuid]=new Source(t)}else{const t=n(r.url);i[r.uuid]=new Source(t)}}}return i}async parseImagesAsync(t){const e=this,r={};let i;async function s(t){if("string"==typeof t){const r=t,s=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:e.resourcePath+r;return await i.loadAsync(s)}return t.data?{data:getTypedArray(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){i=new ImageLoader(this.manager),i.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],n=i.url;if(Array.isArray(n)){const t=[];for(let e=0,r=n.length;e<r;e++){const r=n[e],i=await s(r);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new DataTexture(i.data,i.width,i.height)))}r[i.uuid]=new Source(t)}else{const t=await s(i.url);r[i.uuid]=new Source(t)}}}return r}parseTextures(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const i={};if(void 0!==t)for(let s=0,n=t.length;s<n;s++){const n=t[s];void 0===n.image&&console.warn('THREE.ObjectLoader: No "image" specified for',n.uuid),void 0===e[n.image]&&console.warn("THREE.ObjectLoader: Undefined image",n.image);const o=e[n.image],a=o.data;let h;Array.isArray(a)?(h=new CubeTexture,6===a.length&&(h.needsUpdate=!0)):(h=a&&a.data?new DataTexture:new Texture,a&&(h.needsUpdate=!0)),h.source=o,h.uuid=n.uuid,void 0!==n.name&&(h.name=n.name),void 0!==n.mapping&&(h.mapping=r(n.mapping,TEXTURE_MAPPING)),void 0!==n.channel&&(h.channel=n.channel),void 0!==n.offset&&h.offset.fromArray(n.offset),void 0!==n.repeat&&h.repeat.fromArray(n.repeat),void 0!==n.center&&h.center.fromArray(n.center),void 0!==n.rotation&&(h.rotation=n.rotation),void 0!==n.wrap&&(h.wrapS=r(n.wrap[0],TEXTURE_WRAPPING),h.wrapT=r(n.wrap[1],TEXTURE_WRAPPING)),void 0!==n.format&&(h.format=n.format),void 0!==n.internalFormat&&(h.internalFormat=n.internalFormat),void 0!==n.type&&(h.type=n.type),void 0!==n.colorSpace&&(h.colorSpace=n.colorSpace),void 0!==n.minFilter&&(h.minFilter=r(n.minFilter,TEXTURE_FILTER)),void 0!==n.magFilter&&(h.magFilter=r(n.magFilter,TEXTURE_FILTER)),void 0!==n.anisotropy&&(h.anisotropy=n.anisotropy),void 0!==n.flipY&&(h.flipY=n.flipY),void 0!==n.generateMipmaps&&(h.generateMipmaps=n.generateMipmaps),void 0!==n.premultiplyAlpha&&(h.premultiplyAlpha=n.premultiplyAlpha),void 0!==n.unpackAlignment&&(h.unpackAlignment=n.unpackAlignment),void 0!==n.compareFunction&&(h.compareFunction=n.compareFunction),void 0!==n.userData&&(h.userData=n.userData),i[n.uuid]=h}return i}parseObject(t,e,r,i,s){let n,o,a;function h(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function l(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,s=t.length;i<s;i++){const s=t[i];void 0===r[s]&&console.warn("THREE.ObjectLoader: Undefined material",s),e.push(r[s])}return e}return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),r[t]}}function c(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),i[t]}switch(t.type){case"Scene":n=new Scene,void 0!==t.background&&(Number.isInteger(t.background)?n.background=new Color(t.background):n.background=c(t.background)),void 0!==t.environment&&(n.environment=c(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new FogExp2(t.fog.color,t.fog.density)),""!==t.fog.name&&(n.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(n.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(n.backgroundIntensity=t.backgroundIntensity),void 0!==t.backgroundRotation&&n.backgroundRotation.fromArray(t.backgroundRotation),void 0!==t.environmentIntensity&&(n.environmentIntensity=t.environmentIntensity),void 0!==t.environmentRotation&&n.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":n=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"AmbientLight":n=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":n=new DirectionalLight(t.color,t.intensity),n.target=t.target||"";break;case"PointLight":n=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new RectAreaLight(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),n.target=t.target||"";break;case"HemisphereLight":n=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"LightProbe":n=(new LightProbe).fromJSON(t);break;case"SkinnedMesh":o=h(t.geometry),a=l(t.material),n=new SkinnedMesh(o,a),void 0!==t.bindMode&&(n.bindMode=t.bindMode),void 0!==t.bindMatrix&&n.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(n.skeleton=t.skeleton);break;case"Mesh":o=h(t.geometry),a=l(t.material),n=new Mesh(o,a);break;case"InstancedMesh":o=h(t.geometry),a=l(t.material);const e=t.count,r=t.instanceMatrix,i=t.instanceColor;n=new InstancedMesh(o,a,e),n.instanceMatrix=new InstancedBufferAttribute(new Float32Array(r.array),16),void 0!==i&&(n.instanceColor=new InstancedBufferAttribute(new Float32Array(i.array),i.itemSize));break;case"BatchedMesh":o=h(t.geometry),a=l(t.material),n=new BatchedMesh(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,a),n.geometry=o,n.perObjectFrustumCulled=t.perObjectFrustumCulled,n.sortObjects=t.sortObjects,n._drawRanges=t.drawRanges,n._reservedRanges=t.reservedRanges,n._geometryInfo=t.geometryInfo.map((t=>{let e=null,r=null;return void 0!==t.boundingBox&&(e=(new Box3).fromJSON(t.boundingBox)),void 0!==t.boundingSphere&&(r=(new Sphere).fromJSON(t.boundingSphere)),{...t,boundingBox:e,boundingSphere:r}})),n._instanceInfo=t.instanceInfo,n._availableInstanceIds=t._availableInstanceIds,n._availableGeometryIds=t._availableGeometryIds,n._nextIndexStart=t.nextIndexStart,n._nextVertexStart=t.nextVertexStart,n._geometryCount=t.geometryCount,n._maxInstanceCount=t.maxInstanceCount,n._maxVertexCount=t.maxVertexCount,n._maxIndexCount=t.maxIndexCount,n._geometryInitialized=t.geometryInitialized,n._matricesTexture=c(t.matricesTexture.uuid),n._indirectTexture=c(t.indirectTexture.uuid),void 0!==t.colorsTexture&&(n._colorsTexture=c(t.colorsTexture.uuid)),void 0!==t.boundingSphere&&(n.boundingSphere=(new Sphere).fromJSON(t.boundingSphere)),void 0!==t.boundingBox&&(n.boundingBox=(new Box3).fromJSON(t.boundingBox));break;case"LOD":n=new LOD;break;case"Line":n=new Line(h(t.geometry),l(t.material));break;case"LineLoop":n=new LineLoop(h(t.geometry),l(t.material));break;case"LineSegments":n=new LineSegments(h(t.geometry),l(t.material));break;case"PointCloud":case"Points":n=new Points(h(t.geometry),l(t.material));break;case"Sprite":n=new Sprite(l(t.material));break;case"Group":n=new Group;break;case"Bone":n=new Bone;break;default:n=new Object3D}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(n.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(n.matrixAutoUpdate=t.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.up&&n.up.fromArray(t.up),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.intensity&&(n.shadow.intensity=t.shadow.intensity),void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(n.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.frustumCulled&&(n.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(n.renderOrder=t.renderOrder),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.layers&&(n.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)n.add(this.parseObject(o[t],e,r,i,s))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const r=e[t];n.animations.push(s[r])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(n.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const r=e[t],i=n.getObjectByProperty("uuid",r.object);void 0!==i&&n.addLevel(i,r.distance,r.hysteresis)}}return n}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const r=e[t.skeleton];void 0===r?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(r,t.bindMatrix)}}))}bindLightTargets(t){t.traverse((function(e){if(e.isDirectionalLight||e.isSpotLight){const r=e.target,i=t.getObjectByProperty("uuid",r);e.target=void 0!==i?i:new Object3D}}))}}const TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter},_errorMap=new WeakMap;class ImageBitmapLoader extends Loader{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(t){return this.options=t,this}load(t,e,r,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,n=Cache.get(`image-bitmap:${t}`);if(void 0!==n)return s.manager.itemStart(t),n.then?void n.then((r=>{if(!0!==_errorMap.has(n))return e&&e(r),s.manager.itemEnd(t),r;i&&i(_errorMap.get(n)),s.manager.itemError(t),s.manager.itemEnd(t)})):(setTimeout((function(){e&&e(n),s.manager.itemEnd(t)}),0),n);const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,o.signal="function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const a=fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(s.options,{colorSpaceConversion:"none"}))})).then((function(r){return Cache.add(`image-bitmap:${t}`,r),e&&e(r),s.manager.itemEnd(t),r})).catch((function(e){i&&i(e),_errorMap.set(a,e),Cache.remove(`image-bitmap:${t}`),s.manager.itemError(t),s.manager.itemEnd(t)}));Cache.add(`image-bitmap:${t}`,a),s.manager.itemStart(t)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let _context;class AudioContext{static getContext(){return void 0===_context&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context}static setContext(t){_context=t}}class AudioLoader extends Loader{constructor(t){super(t)}load(t,e,r,i){const s=this,n=new FileLoader(this.manager);function o(e){i?i(e):console.error(e),s.manager.itemError(t)}n.setResponseType("arraybuffer"),n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(t,(function(t){try{const r=t.slice(0);AudioContext.getContext().decodeAudioData(r,(function(t){e(t)})).catch(o)}catch(t){o(t)}}),r,i)}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,_projectionMatrix.copy(t.projectionMatrix);const r=e.eyeSep/2,i=r*e.near/e.focus,s=e.near*Math.tan(DEG2RAD*e.fov*.5)/e.zoom;let n,o;_eyeLeft.elements[12]=-r,_eyeRight.elements[12]=r,n=-s*e.aspect+i,o=s*e.aspect+i,_projectionMatrix.elements[0]=2*e.near/(o-n),_projectionMatrix.elements[8]=(o+n)/(o-n),this.cameraL.projectionMatrix.copy(_projectionMatrix),n=-s*e.aspect-i,o=s*e.aspect-i,_projectionMatrix.elements[0]=2*e.near/(o-n),_projectionMatrix.elements[8]=(o+n)/(o-n),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(_eyeRight)}}class ArrayCamera extends PerspectiveCamera{constructor(t=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=t}}class Clock{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=performance.now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}const _position$1=new three_core_Vector3,_quaternion$1=new Quaternion,_scale$1=new three_core_Vector3,_forward=new three_core_Vector3,_up=new three_core_Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_forward.set(0,0,-1).applyQuaternion(_quaternion$1),_up.set(0,1,0).applyQuaternion(_quaternion$1),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(_position$1.x,t),e.positionY.linearRampToValueAtTime(_position$1.y,t),e.positionZ.linearRampToValueAtTime(_position$1.z,t),e.forwardX.linearRampToValueAtTime(_forward.x,t),e.forwardY.linearRampToValueAtTime(_forward.y,t),e.forwardZ.linearRampToValueAtTime(_forward.z,t),e.upX.linearRampToValueAtTime(_up.x,t),e.upY.linearRampToValueAtTime(_up.y,t),e.upZ.linearRampToValueAtTime(_up.z,t)}else e.setPosition(_position$1.x,_position$1.y,_position$1.z),e.setOrientation(_forward.x,_forward.y,_forward.z,_up.x,_up.y,_up.z)}}class Audio extends Object3D{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(t=0){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+t),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}copy(t,e){return super.copy(t,e),"buffer"!==t.sourceType?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=t.autoplay,this.buffer=t.buffer,this.detune=t.detune,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.offset=t.offset,this.duration=t.duration,this.playbackRate=t.playbackRate,this.hasPlaybackControl=t.hasPlaybackControl,this.sourceType=t.sourceType,this.filters=t.filters.slice(),this)}clone(t){return new this.constructor(this.listener).copy(this,t)}}const _position=new three_core_Vector3,_quaternion=new Quaternion,_scale=new three_core_Vector3,_orientation=new three_core_Vector3;class PositionalAudio extends Audio{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=r,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(_position,_quaternion,_scale),_orientation.set(0,0,1).applyQuaternion(_quaternion);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(_position.x,t),e.positionY.linearRampToValueAtTime(_position.y,t),e.positionZ.linearRampToValueAtTime(_position.z,t),e.orientationX.linearRampToValueAtTime(_orientation.x,t),e.orientationY.linearRampToValueAtTime(_orientation.y,t),e.orientationZ.linearRampToValueAtTime(_orientation.z,t)}else e.setPosition(_position.x,_position.y,_position.z),e.setOrientation(_orientation.x,_orientation.y,_orientation.z)}}class AudioAnalyser{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let r=0;r<e.length;r++)t+=e[r];return t/e.length}}class PropertyMixer{constructor(t,e,r){let i,s,n;switch(this.binding=t,this.valueSize=r,e){case"quaternion":i=this._slerp,s=this._slerpAdditive,n=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,n=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:i=this._lerp,s=this._lerpAdditive,n=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=n,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const r=this.buffer,i=this.valueSize,s=t*i+i;let n=this.cumulativeWeight;if(0===n){for(let t=0;t!==i;++t)r[s+t]=r[t];n=e}else{n+=e;const t=e/n;this._mixBufferRegion(r,s,0,t,i)}this.cumulativeWeight=n}accumulateAdditive(t){const e=this.buffer,r=this.valueSize,i=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,r),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,r=this.buffer,i=t*e+e,s=this.cumulativeWeight,n=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const t=e*this._origIndex;this._mixBufferRegion(r,i,t,1-s,e)}n>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*e,1,e);for(let t=e,s=e+e;t!==s;++t)if(r[t]!==r[t+e]){o.setValue(r,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,r=this.valueSize,i=r*this._origIndex;t.getValue(e,i);for(let t=r,s=i;t!==s;++t)e[t]=e[i+t%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let r=t;r<e;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[e+r]=this.buffer[t+r]}_select(t,e,r,i,s){if(i>=.5)for(let i=0;i!==s;++i)t[e+i]=t[r+i]}_slerp(t,e,r,i){Quaternion.slerpFlat(t,e,t,e,t,r,i)}_slerpAdditive(t,e,r,i,s){const n=this._workIndex*s;Quaternion.multiplyQuaternionsFlat(t,n,t,e,t,r),Quaternion.slerpFlat(t,e,t,e,t,n,i)}_lerp(t,e,r,i,s){const n=1-i;for(let o=0;o!==s;++o){const s=e+o;t[s]=t[s]*n+t[r+o]*i}}_lerpAdditive(t,e,r,i,s){for(let n=0;n!==s;++n){const s=e+n;t[s]=t[s]+t[r+n]*i}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(t,e,r){const i=r||PropertyBinding.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(t,e)}setValue(t,e){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=r.length;i!==s;++i)r[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}class PropertyBinding{constructor(t,e,r){this.path=e,this.parsedPath=r||PropertyBinding.parseTrackName(e),this.node=PropertyBinding.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,r){return t&&t.isAnimationObjectGroup?new PropertyBinding.Composite(t,e,r):new PropertyBinding(t,e,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(t){const e=_trackRe.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=r.nodeName.substring(i+1);-1!==_supportedObjectNames.indexOf(t)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=t)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){const r=function(t){for(let i=0;i<t.length;i++){const s=t[i];if(s.name===e||s.uuid===e)return s;const n=r(s.children);if(n)return n}return null},i=r(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)t[e++]=r[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,r=e.objectName,i=e.propertyName;let s=e.propertyIndex;if(t||(t=PropertyBinding.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(r){let i=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const n=t[i];if(void 0===n){const r=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+r+"."+i+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,!0===t.isMaterial?o=this.Versioning.NeedsUpdate:!0===t.isObject3D&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[s]&&(s=t.morphTargetDictionary[s])}a=this.BindingType.ArrayElement,this.resolvedProperty=n,this.propertyIndex=s}else void 0!==n.fromArray&&void 0!==n.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=n):Array.isArray(n)?(a=this.BindingType.EntireArray,this.resolvedProperty=n):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite,PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray],PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,r=arguments.length;e!==r;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,r=this._paths,i=this._parsedPaths,s=this._bindings,n=s.length;let o,a=t.length,h=this.nCachedObjects_;for(let l=0,c=arguments.length;l!==c;++l){const c=arguments[l],u=c.uuid;let p=e[u];if(void 0===p){p=a++,e[u]=p,t.push(c);for(let t=0,e=n;t!==e;++t)s[t].push(new PropertyBinding(c,r[t],i[t]))}else if(p<h){o=t[p];const a=--h,l=t[a];e[l.uuid]=p,t[p]=l,e[u]=a,t[a]=c;for(let t=0,e=n;t!==e;++t){const e=s[t],n=e[a];let o=e[p];e[p]=n,void 0===o&&(o=new PropertyBinding(c,r[t],i[t])),e[a]=o}}else t[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h}remove(){const t=this._objects,e=this._indicesByUUID,r=this._bindings,i=r.length;let s=this.nCachedObjects_;for(let n=0,o=arguments.length;n!==o;++n){const o=arguments[n],a=o.uuid,h=e[a];if(void 0!==h&&h>=s){const n=s++,l=t[n];e[l.uuid]=h,t[h]=l,e[a]=n,t[n]=o;for(let t=0,e=i;t!==e;++t){const e=r[t],i=e[n],s=e[h];e[h]=i,e[n]=s}}}this.nCachedObjects_=s}uncache(){const t=this._objects,e=this._indicesByUUID,r=this._bindings,i=r.length;let s=this.nCachedObjects_,n=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,h=e[a];if(void 0!==h)if(delete e[a],h<s){const o=--s,a=t[o],l=--n,c=t[l];e[a.uuid]=h,t[h]=a,e[c.uuid]=o,t[o]=c,t.pop();for(let t=0,e=i;t!==e;++t){const e=r[t],i=e[o],s=e[l];e[h]=i,e[o]=s,e.pop()}}else{const s=--n,o=t[s];s>0&&(e[o.uuid]=h),t[h]=o,t.pop();for(let t=0,e=i;t!==e;++t){const e=r[t];e[h]=e[s],e.pop()}}}this.nCachedObjects_=s}subscribe_(t,e){const r=this._bindingsIndicesByPath;let i=r[t];const s=this._bindings;if(void 0!==i)return s[i];const n=this._paths,o=this._parsedPaths,a=this._objects,h=a.length,l=this.nCachedObjects_,c=new Array(h);i=s.length,r[t]=i,n.push(t),o.push(e),s.push(c);for(let r=l,i=a.length;r!==i;++r){const i=a[r];c[r]=new PropertyBinding(i,t,e)}return c}unsubscribe_(t){const e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){const i=this._paths,s=this._parsedPaths,n=this._bindings,o=n.length-1,a=n[o];e[t[o]]=r,n[r]=a,n.pop(),s[r]=s[o],s.pop(),i[r]=i[o],i.pop()}}}class AnimationAction{constructor(t,e,r=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=r,this.blendMode=i;const s=e.tracks,n=s.length,o=new Array(n),a={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let t=0;t!==n;++t){const e=s[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,r=!1){if(t.fadeOut(e),this.fadeIn(e),!0===r){const r=this._clip.duration,i=t._clip.duration,s=i/r,n=r/i;t.warp(1,s,e),this.warp(n,1,e)}return this}crossFadeTo(t,e,r=!1){return t.crossFadeFrom(this,e,r)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,r){const i=this._mixer,s=i.time,n=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,h=o.sampleValues;return a[0]=s,a[1]=s+r,h[0]=t/n,h[1]=e/n,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,r,i){if(!this.enabled)return void this._updateWeight(t);const s=this._startTime;if(null!==s){const i=(t-s)*r;i<0||0===r?e=0:(this._startTime=null,e=r*i)}e*=this._updateTimeScale(t);const n=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===AdditiveAnimationBlendMode)for(let r=0,i=t.length;r!==i;++r)t[r].evaluate(n),e[r].accumulateAdditive(o);else for(let r=0,s=t.length;r!==s;++r)t[r].evaluate(n),e[r].accumulate(i,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const r=this._weightInterpolant;if(null!==r){const i=r.evaluate(t)[0];e*=i,t>r.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const r=this._timeScaleInterpolant;null!==r&&(e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,r=this.loop;let i=this.time+t,s=this._loopCount;const n=r===LoopPingPong;if(0===t)return-1===s||!n||1&~s?i:e-i;if(r===LoopOnce){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===s&&(t>=0?(s=0,this._setEndings(!0,0===this.repetitions,n)):this._setEndings(0===this.repetitions,!0,n)),i>=e||i<0){const r=Math.floor(i/e);i-=e*r,s+=Math.abs(r);const o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,n)}else this._setEndings(!1,!1,n);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=i;if(n&&!(1&~s))return e-i}return i}_setEndings(t,e,r){const i=this._interpolantSettings;r?(i.endingStart=ZeroSlopeEnding,i.endingEnd=ZeroSlopeEnding):(i.endingStart=t?this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding,i.endingEnd=e?this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding)}_scheduleFading(t,e,r){const i=this._mixer,s=i.time;let n=this._weightInterpolant;null===n&&(n=i._lendControlInterpolant(),this._weightInterpolant=n);const o=n.parameterPositions,a=n.sampleValues;return o[0]=s,a[0]=e,o[1]=s+t,a[1]=r,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const r=t._localRoot||this._root,i=t._clip.tracks,s=i.length,n=t._propertyBindings,o=t._interpolants,a=r.uuid,h=this._bindingsByRootAndName;let l=h[a];void 0===l&&(l={},h[a]=l);for(let t=0;t!==s;++t){const s=i[t],h=s.name;let c=l[h];if(void 0!==c)++c.referenceCount,n[t]=c;else{if(c=n[t],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,a,h));continue}const i=e&&e._propertyBindings[t].binding.parsedPath;c=new PropertyMixer(PropertyBinding.create(r,h,i),s.ValueTypeName,s.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,a,h),n[t]=c}o[t].resultBuffer=c.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,r=t._clip.uuid,i=this._actionsByClip[r];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,r,e)}const e=t._propertyBindings;for(let t=0,r=e.length;t!==r;++t){const r=e[t];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,r=e.length;t!==r;++t){const r=e[t];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,r){const i=this._actions,s=this._actionsByClip;let n=s[e];if(void 0===n)n={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[e]=n;else{const e=n.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),n.actionByRoot[r]=t}_removeInactiveAction(t){const e=this._actions,r=e[e.length-1],i=t._cacheIndex;r._cacheIndex=i,e[i]=r,e.pop(),t._cacheIndex=null;const s=t._clip.uuid,n=this._actionsByClip,o=n[s],a=o.knownActions,h=a[a.length-1],l=t._byClipCacheIndex;h._byClipCacheIndex=l,a[l]=h,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete n[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,r=e.length;t!==r;++t){const r=e[t];0==--r.referenceCount&&this._removeInactiveBinding(r)}}_lendAction(t){const e=this._actions,r=t._cacheIndex,i=this._nActiveActions++,s=e[i];t._cacheIndex=i,e[i]=t,s._cacheIndex=r,e[r]=s}_takeBackAction(t){const e=this._actions,r=t._cacheIndex,i=--this._nActiveActions,s=e[i];t._cacheIndex=i,e[i]=t,s._cacheIndex=r,e[r]=s}_addInactiveBinding(t,e,r){const i=this._bindingsByRootAndName,s=this._bindings;let n=i[e];void 0===n&&(n={},i[e]=n),n[r]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const e=this._bindings,r=t.binding,i=r.rootNode.uuid,s=r.path,n=this._bindingsByRootAndName,o=n[i],a=e[e.length-1],h=t._cacheIndex;a._cacheIndex=h,e[h]=a,e.pop(),delete o[s],0===Object.keys(o).length&&delete n[i]}_lendBinding(t){const e=this._bindings,r=t._cacheIndex,i=this._nActiveBindings++,s=e[i];t._cacheIndex=i,e[i]=t,s._cacheIndex=r,e[r]=s}_takeBackBinding(t){const e=this._bindings,r=t._cacheIndex,i=--this._nActiveBindings,s=e[i];t._cacheIndex=i,e[i]=t,s._cacheIndex=r,e[r]=s}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let r=t[e];return void 0===r&&(r=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer),r.__cacheIndex=e,t[e]=r),r}_takeBackControlInterpolant(t){const e=this._controlInterpolants,r=t.__cacheIndex,i=--this._nActiveControlInterpolants,s=e[i];t.__cacheIndex=i,e[i]=t,s.__cacheIndex=r,e[r]=s}clipAction(t,e,r){const i=e||this._root,s=i.uuid;let n="string"==typeof t?AnimationClip.findByName(i,t):t;const o=null!==n?n.uuid:t,a=this._actionsByClip[o];let h=null;if(void 0===r&&(r=null!==n?n.blendMode:NormalAnimationBlendMode),void 0!==a){const t=a.actionByRoot[s];if(void 0!==t&&t.blendMode===r)return t;h=a.knownActions[0],null===n&&(n=h._clip)}if(null===n)return null;const l=new AnimationAction(this,n,e,r);return this._bindAction(l,h),this._addInactiveAction(l,o,s),l}existingAction(t,e){const r=e||this._root,i=r.uuid,s="string"==typeof t?AnimationClip.findByName(r,t):t,n=s?s.uuid:t,o=this._actionsByClip[n];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,r=this._nActiveActions,i=this.time+=t,s=Math.sign(t),n=this._accuIndex^=1;for(let o=0;o!==r;++o)e[o]._update(i,t,s,n);const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(n);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,r=t.uuid,i=this._actionsByClip,s=i[r];if(void 0!==s){const t=s.knownActions;for(let r=0,i=t.length;r!==i;++r){const i=t[r];this._deactivateAction(i);const s=i._cacheIndex,n=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,n._cacheIndex=s,e[s]=n,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[r]}}uncacheRoot(t){const e=t.uuid,r=this._actionsByClip;for(const t in r){const i=r[t].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const t in i){const e=i[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class RenderTarget3D extends RenderTarget{constructor(t=1,e=1,r=1,i={}){super(t,e,i),this.isRenderTarget3D=!0,this.depth=r,this.texture=new Data3DTexture(null,t,e,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Uniform{constructor(t){this.value=t}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}let _id=0;class UniformsGroup extends EventDispatcher{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:_id++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let t=0,r=e.length;t<r;t++){const r=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0;t<r.length;t++)this.uniforms.push(r[t].clone())}return this}clone(){return(new this.constructor).copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(t,e,r=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class GLBufferAttribute{constructor(t,e,r,i,s,n=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=r,this.elementSize=i,this.count=s,this.normalized=n,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const _matrix=new Matrix4;class Raycaster{constructor(t,e,r=0,i=1/0){this.ray=new Ray(t,e),this.near=r,this.far=i,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return _matrix.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_matrix),this}intersectObject(t,e=!0,r=[]){return intersect(t,this,r,e),r.sort(ascSort),r}intersectObjects(t,e=!0,r=[]){for(let i=0,s=t.length;i<s;i++)intersect(t[i],this,r,e);return r.sort(ascSort),r}}function ascSort(t,e){return t.distance-e.distance}function intersect(t,e,r,i){let s=!0;if(t.layers.test(e.layers)&&!1===t.raycast(e,r)&&(s=!1),!0===s&&!0===i){const i=t.children;for(let t=0,s=i.length;t<s;t++)intersect(i[t],e,r,!0)}}class Timer{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(t){this._document=t,void 0!==t.hidden&&(this._pageVisibilityHandler=handleVisibilityChange.bind(this),t.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){null!==this._pageVisibilityHandler&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(t){return this._timescale=t,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(t){return null!==this._pageVisibilityHandler&&!0===this._document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==t?t:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function handleVisibilityChange(){!1===this._document.hidden&&this.reset()}class Spherical{constructor(t=1,e=0,r=0){this.radius=t,this.phi=e,this.theta=r}set(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=clamp(this.phi,t,Math.PI-t),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,r){return this.radius=Math.sqrt(t*t+e*e+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(clamp(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Cylindrical{constructor(t=1,e=0,r=0){this.radius=t,this.theta=e,this.y=r}set(t,e,r){return this.radius=t,this.theta=e,this.y=r,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=e,this}clone(){return(new this.constructor).copy(this)}}class Matrix2{constructor(t,e,r,i){Matrix2.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==t&&this.set(t,e,r,i)}identity(){return this.set(1,0,0,1),this}fromArray(t,e=0){for(let r=0;r<4;r++)this.elements[r]=t[r+e];return this}set(t,e,r,i){const s=this.elements;return s[0]=t,s[2]=e,s[1]=r,s[3]=i,this}}const _vector$4=new Vector2;class Box2{constructor(t=new Vector2(1/0,1/0),e=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const r=_vector$4.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_vector$4).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const _startP=new three_core_Vector3,_startEnd=new three_core_Vector3,_d1=new three_core_Vector3,_d2=new three_core_Vector3,_r=new three_core_Vector3,_c1=new three_core_Vector3,_c2=new three_core_Vector3;class Line3{constructor(t=new three_core_Vector3,e=new three_core_Vector3){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){_startP.subVectors(t,this.start),_startEnd.subVectors(this.end,this.start);const r=_startEnd.dot(_startEnd);let i=_startEnd.dot(_startP)/r;return e&&(i=clamp(i,0,1)),i}closestPointToPoint(t,e,r){const i=this.closestPointToPointParameter(t,e);return this.delta(r).multiplyScalar(i).add(this.start)}distanceSqToLine3(t,e=_c1,r=_c2){const i=1e-8*1e-8;let s,n;const o=this.start,a=t.start,h=this.end,l=t.end;_d1.subVectors(h,o),_d2.subVectors(l,a),_r.subVectors(o,a);const c=_d1.dot(_d1),u=_d2.dot(_d2),p=_d2.dot(_r);if(c<=i&&u<=i)return e.copy(o),r.copy(a),e.sub(r),e.dot(e);if(c<=i)s=0,n=p/u,n=clamp(n,0,1);else{const t=_d1.dot(_r);if(u<=i)n=0,s=clamp(-t/c,0,1);else{const e=_d1.dot(_d2),r=c*u-e*e;s=0!==r?clamp((e*p-t*u)/r,0,1):0,n=(e*s+p)/u,n<0?(n=0,s=clamp(-t/c,0,1)):n>1&&(n=1,s=clamp((e-t)/c,0,1))}}return e.copy(o).add(_d1.multiplyScalar(s)),r.copy(a).add(_d2.multiplyScalar(n)),e.sub(r),e.dot(e)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const _vector$3=new three_core_Vector3;class SpotLightHelper extends Object3D{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const r=new BufferGeometry,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,r=32;t<r;t++,e++){const s=t/r*Math.PI*2,n=e/r*Math.PI*2;i.push(Math.cos(s),Math.sin(s),1,Math.cos(n),Math.sin(n),1)}r.setAttribute("position",new Float32BufferAttribute(i,3));const s=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),_vector$3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2=new three_core_Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(t){const e=getBoneList(t),r=new BufferGeometry,i=[],s=[];for(let t=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(0,0,0),s.push(0,0,0))}r.setAttribute("position",new Float32BufferAttribute(i,3)),r.setAttribute("color",new Float32BufferAttribute(s,3)),super(r,new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;const n=new Color(255),o=new Color(65280);this.setColors(n,o)}updateMatrixWorld(t){const e=this.bones,r=this.geometry,i=r.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let t=0,r=0;t<e.length;t++){const s=e[t];s.parent&&s.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,s.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),i.setXYZ(r,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,s.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),i.setXYZ(r+1,_vector$2.x,_vector$2.y,_vector$2.z),r+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}setColors(t,e){const r=this.geometry.getAttribute("color");for(let i=0;i<r.count;i+=2)r.setXYZ(i,t.r,t.g,t.b),r.setXYZ(i+1,e.r,e.g,e.b);return r.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(t){const e=[];!0===t.isBone&&e.push(t);for(let r=0;r<t.children.length;r++)e.push(...getBoneList(t.children[r]));return e}class PointLightHelper extends Mesh{constructor(t,e,r){super(new SphereGeometry(e,4,2),new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1=new three_core_Vector3,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(t,e,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const i=new OctahedronGeometry(e);i.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const s=i.getAttribute("position"),n=new Float32Array(3*s.count);i.setAttribute("color",new BufferAttribute(n,3)),this.add(new Mesh(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let t=0,r=e.count;t<r;t++){const i=t<r/2?_color1:_color2;e.setXYZ(t,i.r,i.g,i.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(t=10,e=10,r=4473924,i=8947848){r=new Color(r),i=new Color(i);const s=e/2,n=t/e,o=t/2,a=[],h=[];for(let t=0,l=0,c=-o;t<=e;t++,c+=n){a.push(-o,0,c,o,0,c),a.push(c,0,-o,c,0,o);const e=t===s?r:i;e.toArray(h,l),l+=3,e.toArray(h,l),l+=3,e.toArray(h,l),l+=3,e.toArray(h,l),l+=3}const l=new BufferGeometry;l.setAttribute("position",new Float32BufferAttribute(a,3)),l.setAttribute("color",new Float32BufferAttribute(h,3)),super(l,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(t=10,e=16,r=8,i=64,s=4473924,n=8947848){s=new Color(s),n=new Color(n);const o=[],a=[];if(e>1)for(let r=0;r<e;r++){const i=r/e*(2*Math.PI),h=Math.sin(i)*t,l=Math.cos(i)*t;o.push(0,0,0),o.push(h,0,l);const c=1&r?s:n;a.push(c.r,c.g,c.b),a.push(c.r,c.g,c.b)}for(let e=0;e<r;e++){const h=1&e?s:n,l=t-t/r*e;for(let t=0;t<i;t++){let e=t/i*(2*Math.PI),r=Math.sin(e)*l,s=Math.cos(e)*l;o.push(r,0,s),a.push(h.r,h.g,h.b),e=(t+1)/i*(2*Math.PI),r=Math.sin(e)*l,s=Math.cos(e)*l,o.push(r,0,s),a.push(h.r,h.g,h.b)}}const h=new BufferGeometry;h.setAttribute("position",new Float32BufferAttribute(o,3)),h.setAttribute("color",new Float32BufferAttribute(a,3)),super(h,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1=new three_core_Vector3,_v2=new three_core_Vector3,_v3=new three_core_Vector3;class DirectionalLightHelper extends Object3D{constructor(t,e,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",void 0===e&&(e=1);let i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const s=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(i,s),this.add(this.lightPlane),i=new BufferGeometry,i.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(i,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1.setFromMatrixPosition(this.light.matrixWorld),_v2.setFromMatrixPosition(this.light.target.matrixWorld),_v3.subVectors(_v2,_v1),this.lightPlane.lookAt(_v2),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2),this.targetLine.scale.z=_v3.length()}}const _vector=new three_core_Vector3,_camera=new Camera;class CameraHelper extends LineSegments{constructor(t){const e=new BufferGeometry,r=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],n={};function o(t,e){a(t),a(e)}function a(t){i.push(0,0,0),s.push(0,0,0),void 0===n[t]&&(n[t]=[]),n[t].push(i.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),e.setAttribute("position",new Float32BufferAttribute(i,3)),e.setAttribute("color",new Float32BufferAttribute(s,3)),super(e,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=n,this.update();const h=new Color(16755200),l=new Color(16711680),c=new Color(43775),u=new Color(16777215),p=new Color(3355443);this.setColors(h,l,c,u,p)}setColors(t,e,r,i,s){const n=this.geometry.getAttribute("color");return n.setXYZ(0,t.r,t.g,t.b),n.setXYZ(1,t.r,t.g,t.b),n.setXYZ(2,t.r,t.g,t.b),n.setXYZ(3,t.r,t.g,t.b),n.setXYZ(4,t.r,t.g,t.b),n.setXYZ(5,t.r,t.g,t.b),n.setXYZ(6,t.r,t.g,t.b),n.setXYZ(7,t.r,t.g,t.b),n.setXYZ(8,t.r,t.g,t.b),n.setXYZ(9,t.r,t.g,t.b),n.setXYZ(10,t.r,t.g,t.b),n.setXYZ(11,t.r,t.g,t.b),n.setXYZ(12,t.r,t.g,t.b),n.setXYZ(13,t.r,t.g,t.b),n.setXYZ(14,t.r,t.g,t.b),n.setXYZ(15,t.r,t.g,t.b),n.setXYZ(16,t.r,t.g,t.b),n.setXYZ(17,t.r,t.g,t.b),n.setXYZ(18,t.r,t.g,t.b),n.setXYZ(19,t.r,t.g,t.b),n.setXYZ(20,t.r,t.g,t.b),n.setXYZ(21,t.r,t.g,t.b),n.setXYZ(22,t.r,t.g,t.b),n.setXYZ(23,t.r,t.g,t.b),n.setXYZ(24,e.r,e.g,e.b),n.setXYZ(25,e.r,e.g,e.b),n.setXYZ(26,e.r,e.g,e.b),n.setXYZ(27,e.r,e.g,e.b),n.setXYZ(28,e.r,e.g,e.b),n.setXYZ(29,e.r,e.g,e.b),n.setXYZ(30,e.r,e.g,e.b),n.setXYZ(31,e.r,e.g,e.b),n.setXYZ(32,r.r,r.g,r.b),n.setXYZ(33,r.r,r.g,r.b),n.setXYZ(34,r.r,r.g,r.b),n.setXYZ(35,r.r,r.g,r.b),n.setXYZ(36,r.r,r.g,r.b),n.setXYZ(37,r.r,r.g,r.b),n.setXYZ(38,i.r,i.g,i.b),n.setXYZ(39,i.r,i.g,i.b),n.setXYZ(40,s.r,s.g,s.b),n.setXYZ(41,s.r,s.g,s.b),n.setXYZ(42,s.r,s.g,s.b),n.setXYZ(43,s.r,s.g,s.b),n.setXYZ(44,s.r,s.g,s.b),n.setXYZ(45,s.r,s.g,s.b),n.setXYZ(46,s.r,s.g,s.b),n.setXYZ(47,s.r,s.g,s.b),n.setXYZ(48,s.r,s.g,s.b),n.setXYZ(49,s.r,s.g,s.b),n.needsUpdate=!0,this}update(){const t=this.geometry,e=this.pointMap;let r,i;if(_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),!0===this.camera.reversedDepth)r=1,i=0;else if(this.camera.coordinateSystem===WebGLCoordinateSystem)r=-1,i=1;else{if(this.camera.coordinateSystem!==WebGPUCoordinateSystem)throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);r=0,i=1}setPoint("c",e,t,_camera,0,0,r),setPoint("t",e,t,_camera,0,0,i),setPoint("n1",e,t,_camera,-1,-1,r),setPoint("n2",e,t,_camera,1,-1,r),setPoint("n3",e,t,_camera,-1,1,r),setPoint("n4",e,t,_camera,1,1,r),setPoint("f1",e,t,_camera,-1,-1,i),setPoint("f2",e,t,_camera,1,-1,i),setPoint("f3",e,t,_camera,-1,1,i),setPoint("f4",e,t,_camera,1,1,i),setPoint("u1",e,t,_camera,.7,1.1,r),setPoint("u2",e,t,_camera,-.7,1.1,r),setPoint("u3",e,t,_camera,0,2,r),setPoint("cf1",e,t,_camera,-1,0,i),setPoint("cf2",e,t,_camera,1,0,i),setPoint("cf3",e,t,_camera,0,-1,i),setPoint("cf4",e,t,_camera,0,1,i),setPoint("cn1",e,t,_camera,-1,0,r),setPoint("cn2",e,t,_camera,1,0,r),setPoint("cn3",e,t,_camera,0,-1,r),setPoint("cn4",e,t,_camera,0,1,r),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(t,e,r,i,s,n,o){_vector.set(s,n,o).unproject(i);const a=e[t];if(void 0!==a){const t=r.getAttribute("position");for(let e=0,r=a.length;e<r;e++)t.setXYZ(a[e],_vector.x,_vector.y,_vector.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(t,e=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),s=new BufferGeometry;s.setIndex(new BufferAttribute(r,1)),s.setAttribute("position",new BufferAttribute(i,3)),super(s,new LineBasicMaterial({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&_box.setFromObject(this.object),_box.isEmpty())return;const t=_box.min,e=_box.max,r=this.geometry.attributes.position,i=r.array;i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=t.x,i[4]=e.y,i[5]=e.z,i[6]=t.x,i[7]=t.y,i[8]=e.z,i[9]=e.x,i[10]=t.y,i[11]=e.z,i[12]=e.x,i[13]=e.y,i[14]=t.z,i[15]=t.x,i[16]=e.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=e.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(t,e=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new BufferGeometry;i.setIndex(new BufferAttribute(r,1)),i.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new LineBasicMaterial({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(t,e=1,r=16776960){const i=r,s=new BufferGeometry;s.setAttribute("position",new Float32BufferAttribute([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),s.computeBoundingSphere(),super(s,new LineBasicMaterial({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new Mesh(n,new MeshBasicMaterial({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis=new three_core_Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(t=new three_core_Vector3(0,0,1),e=new three_core_Vector3(0,0,0),r=1,i=16776960,s=.2*r,n=.2*s){super(),this.type="ArrowHelper",void 0===_lineGeometry&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new ConeGeometry(.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(e),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,s,n)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(_axis,e)}}setLength(t,e=.2*t,r=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute(e,3)),r.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(r,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,r){const i=new Color,s=this.geometry.attributes.color.array;return i.set(t),i.toArray(s,0),i.toArray(s,3),i.set(e),i.toArray(s,6),i.toArray(s,9),i.set(r),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,r,i){return this.currentPath.quadraticCurveTo(t,e,r,i),this}bezierCurveTo(t,e,r,i,s,n){return this.currentPath.bezierCurveTo(t,e,r,i,s,n),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const r=e.length;let i=!1;for(let s=r-1,n=0;n<r;s=n++){let r=e[s],o=e[n],a=o.x-r.x,h=o.y-r.y;if(Math.abs(h)>Number.EPSILON){if(h<0&&(r=e[n],a=-a,o=e[s],h=-h),t.y<r.y||t.y>o.y)continue;if(t.y===r.y){if(t.x===r.x)return!0}else{const e=h*(t.x-r.x)-a*(t.y-r.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==r.y)continue;if(o.x<=t.x&&t.x<=r.x||r.x<=t.x&&t.x<=o.x)return!0}}return i}const r=ShapeUtils.isClockWise,i=this.subPaths;if(0===i.length)return[];let s,n,o;const a=[];if(1===i.length)return n=i[0],o=new Shape,o.curves=n.curves,a.push(o),a;let h=!r(i[0].getPoints());h=t?!h:h;const l=[],c=[];let u,p,d=[],m=0;c[m]=void 0,d[m]=[];for(let e=0,o=i.length;e<o;e++)n=i[e],u=n.getPoints(),s=r(u),s=t?!s:s,s?(!h&&c[m]&&m++,c[m]={s:new Shape,p:u},c[m].s.curves=n.curves,h&&m++,d[m]=[]):d[m].push({h:n,p:u[0]});if(!c[0])return function(t){const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r],s=new Shape;s.curves=i.curves,e.push(s)}return e}(i);if(c.length>1){let t=!1,r=0;for(let t=0,e=c.length;t<e;t++)l[t]=[];for(let i=0,s=c.length;i<s;i++){const s=d[i];for(let n=0;n<s.length;n++){const o=s[n];let a=!0;for(let s=0;s<c.length;s++)e(o.p,c[s].p)&&(i!==s&&r++,a?(a=!1,l[s].push(o)):t=!0);a&&l[i].push(o)}}r>0&&!1===t&&(d=l)}for(let t=0,e=c.length;t<e;t++){o=c[t].s,a.push(o),p=d[t];for(let t=0,e=p.length;t<e;t++)o.holes.push(p[t].h)}return a}}class Controls extends EventDispatcher{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(t){void 0!==t?(null!==this.domElement&&this.disconnect(),this.domElement=t):console.warn("THREE.Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}}function contain(t,e){const r=t.image&&t.image.width?t.image.width/t.image.height:1;return r>e?(t.repeat.x=1,t.repeat.y=r/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/r,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}function cover(t,e){const r=t.image&&t.image.width?t.image.width/t.image.height:1;return r>e?(t.repeat.x=e/r,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=r/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}function fill(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}function getByteLength(t,e,r,i){const s=getTextureTypeByteLength(i);switch(r){case AlphaFormat:return t*e;case RedFormat:case RedIntegerFormat:return t*e/s.components*s.byteLength;case RGFormat:case RGIntegerFormat:return t*e*2/s.components*s.byteLength;case RGBFormat:return t*e*3/s.components*s.byteLength;case RGBAFormat:case RGBAIntegerFormat:return t*e*4/s.components*s.byteLength;case RGB_S3TC_DXT1_Format:case RGBA_S3TC_DXT1_Format:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case RGBA_S3TC_DXT3_Format:case RGBA_S3TC_DXT5_Format:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case RGB_PVRTC_2BPPV1_Format:case RGBA_PVRTC_2BPPV1_Format:return Math.max(t,16)*Math.max(e,8)/4;case RGB_PVRTC_4BPPV1_Format:case RGBA_PVRTC_4BPPV1_Format:return Math.max(t,8)*Math.max(e,8)/2;case RGB_ETC1_Format:case RGB_ETC2_Format:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case RGBA_ETC2_EAC_Format:case RGBA_ASTC_4x4_Format:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case RGBA_ASTC_5x4_Format:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case RGBA_ASTC_5x5_Format:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case RGBA_ASTC_6x5_Format:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case RGBA_ASTC_6x6_Format:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case RGBA_ASTC_8x5_Format:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case RGBA_ASTC_8x6_Format:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case RGBA_ASTC_8x8_Format:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case RGBA_ASTC_10x5_Format:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case RGBA_ASTC_10x6_Format:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case RGBA_ASTC_10x8_Format:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case RGBA_ASTC_10x10_Format:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case RGBA_ASTC_12x10_Format:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case RGBA_ASTC_12x12_Format:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case RGBA_BPTC_Format:case RGB_BPTC_SIGNED_Format:case RGB_BPTC_UNSIGNED_Format:return Math.ceil(t/4)*Math.ceil(e/4)*16;case RED_RGTC1_Format:case SIGNED_RED_RGTC1_Format:return Math.ceil(t/4)*Math.ceil(e/4)*8;case RED_GREEN_RGTC2_Format:case SIGNED_RED_GREEN_RGTC2_Format:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${r} format.`)}function getTextureTypeByteLength(t){switch(t){case UnsignedByteType:case ByteType:return{byteLength:1,components:1};case UnsignedShortType:case ShortType:case HalfFloatType:return{byteLength:2,components:1};case UnsignedShort4444Type:case UnsignedShort5551Type:return{byteLength:2,components:4};case UnsignedIntType:case IntType:case FloatType:return{byteLength:4,components:1};case UnsignedInt5999Type:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}class TextureUtils{static contain(t,e){return contain(t,e)}static cover(t,e){return cover(t,e)}static fill(t){return fill(t)}static getByteLength(t,e,r,i){return getByteLength(t,e,r,i)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);var zero=new three_core_Vector3(0,0,0),up=new three_core_Vector3(0,0,1);function vec(t){return new three_core_Vector3(t.x,t.y,t.z)}var upCrossVec=new three_core_Vector3;function utils_upCross(t){return upCrossVec.copy(up).cross(t)}var normVec=new three_core_Vector3;function norm(t){return normVec.copy(t).normalize()}var vc=new three_core_Vector3;function passesThroughZero(t,e){return vc.copy(t).add(e).dot(t)<=0}function utils_unitAtAngle(t){return new three_core_Vector3(1,0,0).applyAxisAngle(up,t)}function round(t){return Math.sign(t)*Math.floor(1e4*(Math.abs(t)+Number.EPSILON))/1e4}function round2(t){return Math.round(100*(t+Number.EPSILON))/100}function roundVec(t){return t.x=round(t.x),t.y=round(t.y),t.z=round(t.z),t}function roundVec2(t){return t.x=round2(t.x),t.y=round2(t.y),t.z=round2(t.z),t}function utils_atan2(t,e){return Math.fround(Math.atan2(t,e))}function utils_pow(t,e){return Math.fround(Math.pow(t,e))}function utils_sin(t){return Math.sin(t)}function utils_cos(t){return Math.cos(t)}function utils_sqrt(t){return Math.sqrt(t)}function exp(t){return Math.exp(t)}function snapSmall(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6;return Math.abs(t.x)<e&&(t.x=0),Math.abs(t.y)<e&&(t.y=0),Math.abs(t.z)<e&&(t.z=0),t}function mathaven_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mathaven_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function mathaven_create_class(t,e,r){return e&&mathaven_defineProperties(t.prototype,e),r&&mathaven_defineProperties(t,r),t}function mathaven_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var mathaven_Mathaven=null,DEBUG_PHYSICS=!1;function toggleDebugPhysics(){return DEBUG_PHYSICS=!DEBUG_PHYSICS}function setDebugPhysics(t){DEBUG_PHYSICS=t}var debugVelocityArrow=null,debugVelocityArrowData=null,MU_CUSHION_MIN=.02,MU_CUSHION_MAX=.5,MU_CUSHION_BASE_SCALE=1,K_THETA_1=0,K_THETA_2=-.05,K_THETA_3=0,K_V=.06,S_REF=.5;function surfaceVelocity(t,e,r){return surfaceVelocityFull(t,e,r).setZ(0)}function physics_clamp(t,e,r){return Math.max(e,Math.min(r,t))}var sv=new three_core_Vector3;function surfaceVelocityFull(t,e,r){var i,s=null!==(i=null==r?void 0:r.R)&&void 0!==i?i:constants_R;return sv.copy(t).addScaledVector(utils_upCross(e),s)}var delta={v:new three_core_Vector3,w:new three_core_Vector3};function sliding(t,e,r){var i,s,n,o=null!==(i=null==r?void 0:r.R)&&void 0!==i?i:constants_R,a=null!==(s=null==r?void 0:r.m)&&void 0!==s?s:constants_m,h=r?refreshWithContext(r):{Mz,Mxy,I},l=null!==(n=null==r?void 0:r.muS)&&void 0!==n?n:muS,c=surfaceVelocity(t,e,r);return delta.v.copy(norm(c).multiplyScalar(-l*g)),delta.w.copy(norm(utils_upCross(c)).multiplyScalar(2.5*l*g/o)),delta.w.setZ(h.Mz/(a*o*o)*-2.5*Math.sign(e.z)),delta}function rollingFull(t,e){var r,i,s=null!==(r=null==e?void 0:e.R)&&void 0!==r?r:constants_R,n=null!==(i=null==e?void 0:e.m)&&void 0!==i?i:constants_m,o=e?refreshWithContext(e):{Mz,Mxy,I},a=new three_core_Vector3(t.x,t.y,0).length(),h=5/7*o.Mxy/(n*s)/a,l=5/7*o.Mxy/(n*s*s)/a;return delta.v.set(-h*t.y,h*t.x,0),delta.w.set(-l*t.x,-l*t.y,o.Mz/(n*s*s)*-2.5*Math.sign(t.z)),delta}function forceRoll(t,e,r){var i,s=null!==(i=null==r?void 0:r.R)&&void 0!==i?i:constants_R,n=e.z;e.copy(utils_upCross(t).multiplyScalar(1/s)),e.setZ(n)}Object.freeze(delta);var magnusForce=new three_core_Vector3,spinCrossVel=new three_core_Vector3;function magnus(t,e){var r,i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0,a=t.length(),h=null!==(r=null==o?void 0:o.m)&&void 0!==r?r:constants_m,l=null!==(i=null==o?void 0:o.R)&&void 0!==i?i:constants_R;if(a<.1)return magnusForce.set(0,0,0);if(e.length()<.1)return magnusForce.set(0,0,0);var c=n>l*airborneThresholdFactor,u=Math.pow(Math.sin(s),1),p=magnusCoeff*u;p*=c?magnusAirborneMultiplier:magnusTableMultiplier,spinCrossVel.crossVectors(e,t),spinCrossVel.z=0;var d=spinCrossVel.length();if(d<.01)return magnusForce.set(0,0,0);var m=p*d/h;return magnusForce.copy(spinCrossVel).normalize().multiplyScalar(m),magnusForce}function rotateApplyUnrotate(t,e,r,i){var s=i(e.clone().applyAxisAngle(up,t),r.clone().applyAxisAngle(up,t));return s.v.applyAxisAngle(up,-t),s.w.applyAxisAngle(up,-t),s}var epsilon=.1*constants_R,theta_a=Math.asin(epsilon/constants_R),sin_a=utils_sin(theta_a),cos_a=utils_cos(theta_a);function s0(t,e){return new three_core_Vector3(t.x*sin_a-t.z*cos_a+constants_R*e.y,-t.y-constants_R*e.z*cos_a+constants_R*e.x*sin_a)}function c0(t){return t.x*cos_a}function Pzs(t){var e=3.5/m;return t.length()/e}function Pze(t){var e=1/m,r=restitutionCushion(new Vector3(t/cos_a,0,0));return muC*((1+r)*t)/e}function isGripCushion(t,e){var r=Pze(c0(t));return Pzs(s0(t,e))<=r}function basisHan(t,e){return{c:c0(t),s:s0(t,e),A:3.5/constants_m,B:1/constants_m}}function gripHan(t,r){var i=basisHan(t,r),s=i.c,n=i.s,o=i.A,a=i.B,h=(1+e)*(s/a);return impulseToDelta(-n.x/o*sin_a-h*cos_a,n.y/o,n.x/o*cos_a-h*sin_a)}function slipHan(t,r){var i=basisHan(t,r),s=i.c,n=i.B,o=(1+e)*(s/n),a=muCushion(t,r),h=Math.atan2(t.y,t.x),l=Math.cos(h),c=Math.sin(h);return impulseToDelta(-a*o*l*cos_a-o*cos_a,a*o*c,a*o*l*cos_a-o*sin_a)}function bounceHan(t,e){return isGripCushion(t,e)?gripHan(t,e):slipHan(t,e)}function bounceHanBlend(t,e){var r=gripHan(t,e),i=slipHan(t,e),s=Math.sign(t.y)===Math.sign(e.z)?Math.cos(Math.atan2(t.y,t.x)):1;return{v:i.v.lerp(r.v,s),w:i.w.lerp(r.w,s)}}function impulseToDelta(t,e,r){return{v:new three_core_Vector3(t/constants_m,e/constants_m),w:new three_core_Vector3(-constants_R/I*e*sin_a,constants_R/I*(t*sin_a-r*cos_a),constants_R/I*e*cos_a)}}function muCushion(t,e){var r=Math.atan2(Math.abs(t.y),Math.max(1e-6,t.x)),i=s0(t,null!=e?e:new three_core_Vector3(0,0,0)).length();return physics_clamp(MU_CUSHION_BASE_SCALE*constants_w+(K_THETA_1+K_THETA_2*r+K_THETA_3*r*r)+K_V*Math.tanh(i/Math.max(1e-6,S_REF)),MU_CUSHION_MIN,MU_CUSHION_MAX)}function restitutionCushion(t){return physics_clamp(.39+.257*t.x-.044*t.x*t.x,0,1)}function cartesionToBallCentric(t,e){var r=new Mathaven(m,R,ee,μs,μw);r.solve(t.x,t.y,e.x,e.y,e.z);var i=new Vector3(r.vx,r.vy,0),s=new Vector3(r.ωx,r.ωy,r.ωz);return{v:i.sub(t),w:s.sub(e)}}function mathavenAdapter(t,e){return rotateApplyUnrotate(Math.PI/2,t,e,cartesionToBallCentric)}function physics_cueToSpinUniversal(t,e,r){var i=(new three_core_Vector3).subVectors(t,e).clone().normalize();return(new three_core_Vector3).crossVectors(i,r).multiplyScalar(5/(2*constants_R))}function cueToSpin(t,e){var r=Math.atan2(-t.x,t.y),i=2.5*e.length()*(t.length()*R)/(R*R),s=e.clone().normalize(),n=upCross(s),o=n.clone().applyAxisAngle(s,r).multiplyScalar(i);if(DEBUG_PHYSICS){console.log("🎯 cueToSpin() INPUT | Offset:(".concat(t.x.toFixed(3),",").concat(t.y.toFixed(3),",").concat(t.z.toFixed(3),") | Velocity:(").concat(e.x.toFixed(2),",").concat(e.y.toFixed(2),",").concat(e.z.toFixed(2),") | v.length:").concat(e.length().toFixed(2))),console.log("🔧 INTERMEDIATE | dir:(".concat(s.x.toFixed(3),",").concat(s.y.toFixed(3),",").concat(s.z.toFixed(3),") | upCross(dir):(").concat(n.x.toFixed(3),",").concat(n.y.toFixed(3),",").concat(n.z.toFixed(3),")"));var a=180*r/Math.PI;console.log("🌀 SPIN | spinAxis:".concat(a.toFixed(1),"° | Rate:").concat(i.toFixed(1)," → Result:(").concat(o.x.toFixed(1),",").concat(o.y.toFixed(1),",").concat(o.z.toFixed(1),") | Mag:").concat(o.length().toFixed(1))),console.log("")}return o}function addDebugVelocityArrow(t,e,r,i){if(debugVelocityArrow&&(t.remove(debugVelocityArrow),debugVelocityArrow.dispose(),debugVelocityArrow=null,debugVelocityArrowData=null),0!==r.lengthSq()){var s=4*i,n=r.clone().normalize(),o=e.clone().addScaledVector(n,-s);debugVelocityArrowData={origin:o.clone(),direction:n.clone(),length:s,hitPoint:e.clone()},debugVelocityArrow=new ArrowHelper(n,o,s,0,.15*s,.1*s),t.add(debugVelocityArrow)}}function removeDebugVelocityArrow(t){debugVelocityArrow&&(t.remove(debugVelocityArrow),debugVelocityArrow.dispose(),debugVelocityArrow=null)}function getDebugVelocityArrowInfo(){if(!debugVelocityArrowData)return null;var t=debugVelocityArrowData.hitPoint.clone(),e=debugVelocityArrowData.origin.clone(),r=debugVelocityArrowData.direction.clone();return{tip:t,tail:e,angleToGround:Math.asin(r.y)*(180/Math.PI)}}function knuckle_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function knuckle_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function knuckle_create_class(t,e,r){return e&&knuckle_defineProperties(t.prototype,e),r&&knuckle_defineProperties(t,r),t}function knuckle_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Knuckle=function(){function t(e,r){knuckle_class_call_check(this,t),knuckle_define_property(this,"pos",void 0),knuckle_define_property(this,"radius",void 0),this.pos=e,this.radius=r}return knuckle_create_class(t,[{key:"bounce",value:function(t){var r=t.pos.clone().sub(this.pos).normalize(),i=r.dot(t.vel);return t.vel.addScaledVector(r,-2*e*i),t.rvel.multiplyScalar(.5),Math.abs(i)}}],[{key:"willBounce",value:function(t,e){return e.distanceTo(t.pos)<constants_R+t.radius}},{key:"findBouncing",value:function(e,r){var i=e.futurePosition(r);return PocketGeometry.knuckles.find((function(e){return t.willBounce(e,i)}))}}]),t}();function trace_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function trace_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function trace_create_class(t,e,r){return e&&trace_defineProperties(t.prototype,e),r&&trace_defineProperties(t,r),t}function trace_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Trace=function(){function t(e,r){trace_class_call_check(this,t),trace_define_property(this,"line",void 0),trace_define_property(this,"geometry",void 0),trace_define_property(this,"positions",void 0),trace_define_property(this,"lastPos",new three_core_Vector3),trace_define_property(this,"lastVel",new three_core_Vector3),this.geometry=new BufferGeometry,this.positions=new Float32Array(3*e),this.geometry.setAttribute("position",new BufferAttribute(this.positions,3)),this.reset();var i=new LineBasicMaterial({color:r,opacity:.25,linewidth:3,transparent:!0});this.line=new Line(this.geometry,i),this.line.visible=!1}return trace_create_class(t,[{key:"reset",value:function(){this.geometry.setDrawRange(0,0),this.lastVel.setZ(1)}},{key:"forceTrace",value:function(t){this.lastVel.z=1,this.addTraceGiven(t,this.lastVel,1,.1,1)}},{key:"addTrace",value:function(t,e){if(this.line.visible&&0!==e.length()){var r=this.lastVel.angleTo(e),i=r>Math.PI/32?.01*constants_R:constants_R,s=this.lastPos.distanceTo(t);this.addTraceGiven(t,e,s,i,r)}}},{key:"addTraceGiven",value:function(t,e,r,i,s){var n=this.geometry.drawRange.count;0!==n&&r<i||(n>1&&s<1e-4&&n--,this.lastPos.copy(t),this.lastVel.copy(e),this.addPoint(t,n))}},{key:"addPoint",value:function(t,e){var r=3*e;r>this.positions.length||(this.positions[r++]=t.x,this.positions[r++]=t.y,this.positions[r]=t.z,this.geometry.setDrawRange(0,e+1),this.line.geometry.attributes.position.needsUpdate=!0)}},{key:"dispose",value:function(){try{this.line&&this.line.geometry&&this.line.geometry.dispose&&this.line.geometry.dispose()}catch(t){}try{var t=this.line&&this.line.material;Array.isArray(t)?t.forEach((function(t){return t&&t.dispose&&t.dispose()})):t&&t.dispose&&t.dispose()}catch(t){}try{this.geometry&&this.geometry.dispose&&this.geometry.dispose()}catch(t){}}}]),t}();function ballmesh_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ballmesh_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ballmesh_create_class(t,e,r){return e&&ballmesh_defineProperties(t.prototype,e),r&&ballmesh_defineProperties(t,r),t}function ballmesh_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _object_spread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),i.forEach((function(e){ballmesh_define_property(t,e,r[e])}))}return t}var DEFAULT_LIGHTING={orbitAngleDeg:270,elevationDeg:80,distanceInDiameters:24,intensity:8.4,decay:1.4,coneDeg:57,color:"#f5f8ff",shadowBias:-5e-5,shadowNormalBias:0,shadowBlur:185,shadowMapSize:2048,shadowBlurSamples:15,shadowNear:.5,shadowFar:2,castShadow:!0},clampLighting=function(t){var e,r=Number.isFinite(t.orbitAngleDeg)?t.orbitAngleDeg:DEFAULT_LIGHTING.orbitAngleDeg,i=Number.isFinite(t.elevationDeg)?t.elevationDeg:DEFAULT_LIGHTING.elevationDeg,s=Number.isFinite(t.distanceInDiameters)?t.distanceInDiameters:DEFAULT_LIGHTING.distanceInDiameters,n=Number.isFinite(t.intensity)?t.intensity:DEFAULT_LIGHTING.intensity,o=Number.isFinite(t.decay)?t.decay:DEFAULT_LIGHTING.decay,a=Number.isFinite(t.coneDeg)?t.coneDeg:DEFAULT_LIGHTING.coneDeg,h=Number.isFinite(t.shadowBias)?t.shadowBias:DEFAULT_LIGHTING.shadowBias,l=Number.isFinite(t.shadowNormalBias)?t.shadowNormalBias:DEFAULT_LIGHTING.shadowNormalBias,c=Number.isFinite(t.shadowBlur)?t.shadowBlur:DEFAULT_LIGHTING.shadowBlur,u=Number.isFinite(t.shadowMapSize)&&t.shadowMapSize>0?t.shadowMapSize:DEFAULT_LIGHTING.shadowMapSize,p=Number.isFinite(t.shadowBlurSamples)?t.shadowBlurSamples:DEFAULT_LIGHTING.shadowBlurSamples,d=Number.isFinite(t.shadowNear)&&t.shadowNear>0?t.shadowNear:DEFAULT_LIGHTING.shadowNear,m=Number.isFinite(t.shadowFar)?t.shadowFar:DEFAULT_LIGHTING.shadowFar,f=Math.pow(2,Math.round(MathUtils.clamp(Math.log2(u),8,12)));return{orbitAngleDeg:MathUtils.euclideanModulo(r,360),elevationDeg:MathUtils.clamp(i,-80,85),distanceInDiameters:Math.max(.01,s),intensity:Math.max(0,n),decay:Math.max(0,o),coneDeg:MathUtils.clamp(a,5,90),color:null!==(e=t.color)&&void 0!==e?e:DEFAULT_LIGHTING.color,shadowBias:h,shadowNormalBias:Math.max(0,l),shadowBlur:MathUtils.clamp(c,0,1e3),shadowMapSize:f,shadowBlurSamples:Math.round(MathUtils.clamp(p,1,32)),shadowNear:Math.max(.1,d),shadowFar:Math.max(Math.max(.1,d)+.1,m),castShadow:Boolean(t.castShadow)}},BallMesh=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:constants_R;ballmesh_class_call_check(this,t),ballmesh_define_property(this,"mesh",void 0),ballmesh_define_property(this,"spinAxisArrow",void 0),ballmesh_define_property(this,"velocityArrow",void 0),ballmesh_define_property(this,"trace",void 0),ballmesh_define_property(this,"color",void 0),ballmesh_define_property(this,"radius",void 0),ballmesh_define_property(this,"material",void 0),ballmesh_define_property(this,"dotMeshes",[]),this.color=new Color(e),this.radius=r,this.material=t.createBallMaterial(this.color),this.mesh=this.createBallMesh(),this.spinAxisArrow=new ArrowHelper(up,zero,2,0,.01,.01),this.spinAxisArrow.visible=!1,this.velocityArrow=new ArrowHelper(up,zero,2*this.radius,0,.015,.015),this.velocityArrow.visible=!1,this.trace=new Trace(500,e),t.instances.add(this)}return ballmesh_create_class(t,[{key:"updateAll",value:function(t,e){this.updatePosition(t.pos),this.updateArrows(t.pos,t.rvel,t.vel,t.state),0!==t.rvel.lengthSq()&&(this.updateRotation(t.rvel,e),this.trace.addTrace(t.pos,t.vel))}},{key:"updatePosition",value:function(t){this.mesh.position.copy(t)}},{key:"updateRotation",value:function(t,e){var r=t.length()*e;0!==r&&this.mesh.rotateOnWorldAxis(norm(t),r)}},{key:"updateArrows",value:function(t,e,r,i){this.spinAxisArrow.visible&&(this.spinAxisArrow.setLength(this.radius+this.radius*e.length()/2,this.radius,this.radius),this.spinAxisArrow.position.copy(t),this.spinAxisArrow.setDirection(norm(e)),i===ball_State.Rolling?this.spinAxisArrow.setColor(13369344):this.spinAxisArrow.setColor(52224)),this.velocityArrow.visible&&r.lengthSq()>0&&(this.velocityArrow.setLength(2*this.radius,.015,.015),this.velocityArrow.position.copy(t),this.velocityArrow.setDirection(norm(r)))}},{key:"addToScene",value:function(t){t.add(this.mesh),t.add(this.spinAxisArrow),t.add(this.velocityArrow),t.add(this.trace.line)}},{key:"removeFromScene",value:function(t){t.remove(this.mesh),t.remove(this.spinAxisArrow),t.remove(this.velocityArrow),t.remove(this.trace.line)}},{key:"clearDots",value:function(){var t=this;this.dotMeshes.forEach((function(e){e.geometry.dispose();var r=e.material;Array.isArray(r)?r.forEach((function(t){return t.dispose()})):r&&r.dispose(),t.mesh.remove(e)})),this.dotMeshes=[]}},{key:"applySymmetricDots",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16711680,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.089;this.clearDots();var i=this.radius*r;[new three_core_Vector3(1,0,0),new three_core_Vector3(-1,0,0),new three_core_Vector3(0,1,0),new three_core_Vector3(0,-1,0),new three_core_Vector3(0,0,1),new three_core_Vector3(0,0,-1)].forEach((function(r){var s=new CircleGeometry(i,64),n=new MeshStandardMaterial({color:e,metalness:0,roughness:.35,transparent:!1,side:DoubleSide}),o=new Mesh(s,n),a=(new Quaternion).setFromUnitVectors(new three_core_Vector3(0,0,1),r.clone().normalize());o.quaternion.copy(a);var h=r.clone().normalize().multiplyScalar(t.radius+.001*t.radius);o.position.copy(h),o.renderOrder=t.mesh.renderOrder+1,t.mesh.add(o),t.dotMeshes.push(o)}))}},{key:"updateRadius",value:function(t){this.radius!==t&&(this.radius=t,this.mesh.geometry.dispose(),this.mesh.geometry=new SphereGeometry(this.radius,64,48))}},{key:"dispose",value:function(){this.mesh.geometry.dispose(),this.material.dispose(),this.clearDots(),this.trace.dispose(),t.instances.delete(this)}},{key:"createBallMesh",value:function(){var t=new SphereGeometry(this.radius,64,48),e=new Mesh(t,this.material);return e.name="ball",e.castShadow=!0,e.receiveShadow=!0,e.renderOrder=1,e}}],[{key:"getLightingConfig",value:function(){return _object_spread({},t.lightingConfig)}},{key:"updateLightingConfig",value:function(e){var r=_object_spread({},t.lightingConfig,e);t.lightingConfig=clampLighting(r);var i=t.getLightingConfig();t.lightingListeners.forEach((function(t){return t(i)}))}},{key:"onLightingConfigChanged",value:function(e){return t.lightingListeners.add(e),e(t.getLightingConfig()),function(){t.lightingListeners.delete(e)}}},{key:"createBallMaterial",value:function(t){var e=new MeshPhysicalMaterial({color:t.clone(),roughness:.45,metalness:.25,clearcoat:.6,clearcoatRoughness:.15,reflectivity:.45});return e.needsUpdate=!0,e}}]),t}();function ball_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ball_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ball_create_class(t,e,r){return e&&ball_defineProperties(t.prototype,e),r&&ball_defineProperties(t,r),t}function ball_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ballmesh_define_property(BallMesh,"instances",new Set),ballmesh_define_property(BallMesh,"lightingConfig",_object_spread({},DEFAULT_LIGHTING)),ballmesh_define_property(BallMesh,"lightingListeners",new Set);var ball_State=function(t){return t.Stationary="Stationary",t.Rolling="Rolling",t.Sliding="Sliding",t.Falling="Falling",t.InPocket="InPocket",t}({}),Ball=function(){function t(e,r,i,s){if(ball_class_call_check(this,t),ball_define_property(this,"pos",void 0),ball_define_property(this,"vel",zero.clone()),ball_define_property(this,"rvel",zero.clone()),ball_define_property(this,"futurePos",zero.clone()),ball_define_property(this,"ballmesh",void 0),ball_define_property(this,"state","Stationary"),ball_define_property(this,"pocket",void 0),ball_define_property(this,"physicsContext",POOL_PHYSICS),ball_define_property(this,"magnusEnabled",!1),ball_define_property(this,"magnusElevation",0),ball_define_property(this,"id",t.id++),this.pos=e.clone(),i&&(this.physicsContext=i),s&&s.headless){var n={updateAll:function(){},updateRadius:function(t){},dispose:function(){},color:void 0,radius:this.physicsContext.R,mesh:void 0,trace:{reset:function(){},forceTrace:function(){},addTrace:function(){},addTraceGiven:function(){},addPoint:function(){},line:{visible:!1}}};this.ballmesh=n}else this.ballmesh=new BallMesh(r||15658734*Math.random(),this.physicsContext.R)}return ball_create_class(t,[{key:"radius",get:function(){return this.physicsContext.R}},{key:"updatePhysicsContext",value:function(t){this.physicsContext=t,this.ballmesh.updateRadius(t.R)}},{key:"update",value:function(t){this.updatePosition(t),"Falling"==this.state?this.pocket.updateFall(this,t):this.updateVelocity(t)}},{key:"updateMesh",value:function(t){this.ballmesh.updateAll(this,t)}},{key:"updatePosition",value:function(t){this.pos.addScaledVector(this.vel,t)}},{key:"updateVelocity",value:function(t){if(this.inMotion()){var e=this.physicsContext.R*airborneThresholdFactor,r=this.pos.z>e;if(r||(this.pos.z>0&&(this.pos.z=0),this.vel.z>0&&(this.vel.z=0),this.isRolling()?(this.state="Rolling",forceRoll(this.vel,this.rvel,this.physicsContext),this.addDelta(t,rollingFull(this.rvel,this.physicsContext))):(this.state="Sliding",this.addDelta(t,sliding(this.vel,this.rvel,this.physicsContext)))),this.magnusEnabled){var i=magnus(this.vel,this.rvel,this.magnusElevation,this.pos.z,this.physicsContext);this.vel.addScaledVector(i,t)}if(r){this.vel.z-=g*t;var s=Math.sqrt(this.vel.x*this.vel.x+this.vel.y*this.vel.y);if(s>.01){var n=this.physicsContext.R,o=Math.PI*n*n,a=this.physicsContext.m,h=.5*airDensity*dragCoefficient*o*s*s/a,l=Math.max(0,1-h*t/s);this.vel.x*=l,this.vel.y*=l}}else if(this.pos.z<0&&(this.pos.z=0),this.vel.z<0){var c=tableRestitution;Math.abs(this.vel.z)>.1?(this.vel.z=-this.vel.z*c,this.pos.z<e&&(this.pos.z=e),this.vel.x*=.9,this.vel.y*=.9):(this.vel.z=0,this.pos.z=0)}}}},{key:"addDelta",value:function(t,e){e.v.multiplyScalar(t),e.w.multiplyScalar(t),this.passesZero(e)||(this.vel.add(e.v),this.rvel.add(e.w))}},{key:"passesZero",value:function(t){var e,r,i=passesThroughZero(this.vel,t.v),s=passesThroughZero(this.rvel,t.w),n="Rolling"===this.state?i||s:i&&s,o=this.vel.length(),a=null!==(r=null===(e=this.physicsContext)||void 0===e?void 0:e.spinStopThreshold)&&void 0!==r?r:.01,h=this.rvel.length();return!!((n||o<.001)&&h<a)&&(this.setStationary(),!0)}},{key:"setStationary",value:function(){this.vel.copy(zero),this.rvel.copy(zero),this.state="Stationary"}},{key:"isRolling",value:function(){var e,r,i=null!==(r=null===(e=this.physicsContext)||void 0===e?void 0:e.rollingTransition)&&void 0!==r?r:t.transition;return 0!==this.vel.lengthSq()&&0!==this.rvel.lengthSq()&&surfaceVelocityFull(this.vel,this.rvel,this.physicsContext).length()<i}},{key:"onTable",value:function(){return"Falling"!==this.state&&"InPocket"!==this.state}},{key:"inMotion",value:function(){return"Rolling"===this.state||"Sliding"===this.state||this.isFalling()}},{key:"isFalling",value:function(){return"Falling"===this.state}},{key:"futurePosition",value:function(t){return this.futurePos.copy(this.pos).addScaledVector(this.vel,t),this.futurePos}},{key:"fround",value:function(){this.pos.x=Math.fround(this.pos.x),this.pos.y=Math.fround(this.pos.y),this.vel.x=Math.fround(this.vel.x),this.vel.y=Math.fround(this.vel.y),this.rvel.x=Math.fround(this.rvel.x),this.rvel.y=Math.fround(this.rvel.y),this.rvel.z=Math.fround(this.rvel.z)}},{key:"serialise",value:function(){return{pos:this.pos.clone(),id:this.id,physicsContext:this.physicsContext}}}],[{key:"fromSerialised",value:function(e,r){return t.updateFromSerialised(new t(vec(e.pos),void 0,e.physicsContext,r),e)}},{key:"updateFromSerialised",value:function(t,e){var r,i;return t.pos.copy(e.pos),t.vel.copy(null!==(r=null==e?void 0:e.vel)&&void 0!==r?r:zero),t.rvel.copy(null!==(i=null==e?void 0:e.rvel)&&void 0!==i?i:zero),t.state="Stationary",void 0!==e.id&&(t.id=e.id),t}}]),t}();function pocket_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pocket_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function pocket_create_class(t,e,r){return e&&pocket_defineProperties(t.prototype,e),r&&pocket_defineProperties(t,r),t}function pocket_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ball_define_property(Ball,"id",0),ball_define_property(Ball,"transition",.05);var Pocket=function(){function t(e,r){pocket_class_call_check(this,t),pocket_define_property(this,"pos",void 0),pocket_define_property(this,"radius",void 0),this.pos=e,this.radius=r}return pocket_create_class(t,[{key:"fall",value:function(t,e){return t.vel.z=-g*e,t.state=ball_State.Falling,t.pocket=this,t.vel.length()}},{key:"updateFall",value:function(t,e){t.vel.addScaledVector(up,10*-constants_R*e*g);var r=t.pos.z;if(t.pos.clone().setZ(0).distanceTo(this.pos)>this.radius-constants_R){var i=this.pos.clone().sub(t.pos).normalize().setZ(0);r>-constants_R/2&&(t.vel.addScaledVector(i,7*constants_R*e*g),t.rvel.addScaledVector(utils_upCross(i),7*e*g)),t.vel.dot(i)<0&&(t.ballmesh.trace.forceTrace(t.pos),t.vel.x=i.x*t.vel.length()/2,t.vel.y=i.y*t.vel.length()/2)}var s=this.restingDepth(t);r<s&&0!==t.rvel.length()&&(t.pos.z=s,t.vel.z=-constants_R/10,t.rvel.copy(zero)),r<s-constants_R&&(t.pos.z=s-constants_R,t.setStationary(),t.state=ball_State.InPocket)}},{key:"restingDepth",value:function(t){return-3*constants_R-constants_R*t.id/4}}],[{key:"willFall",value:function(t,e){return e.distanceTo(t.pos)<t.radius}},{key:"findPocket",value:function(e,r,i){var s=r.futurePosition(i);return e.find((function(e){return t.willFall(e,s)}))}}]),t}();function pocketgeometry_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pocketgeometry_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function pocketgeometry_create_class(t,e,r){return e&&pocketgeometry_defineProperties(t.prototype,e),r&&pocketgeometry_defineProperties(t,r),t}function pocketgeometry_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var PocketGeometry=function(){function t(){pocketgeometry_class_call_check(this,t)}return pocketgeometry_create_class(t,null,[{key:"scaleToRadius",value:function(e){t.PX=TableGeometry.tableX+1.6*e,t.PY=TableGeometry.tableY+1.6*e,t.knuckleInset=1.6*e/.5,t.knuckleRadius=.31*e/.5,t.middleKnuckleInset=1.385*e/.5,t.middleKnuckleRadius=.2*e/.5,t.cornerRadius=1.1*e/.5,t.middleRadius=.9*e/.5,t.pocketLayout(e),t.enumerateCenters(),t.enumerateKnuckles()}},{key:"enumerateKnuckles",value:function(){t.knuckles=[t.pockets.pocketNW.knuckleNE,t.pockets.pocketNW.knuckleSW,t.pockets.pocketN.knuckleNW,t.pockets.pocketN.knuckleNE,t.pockets.pocketS.knuckleSW,t.pockets.pocketS.knuckleSE,t.pockets.pocketNE.knuckleNW,t.pockets.pocketNE.knuckleSE,t.pockets.pocketSE.knuckleNE,t.pockets.pocketSE.knuckleSW,t.pockets.pocketSW.knuckleSE,t.pockets.pocketSW.knuckleNW]}},{key:"enumerateCenters",value:function(){t.pocketCenters=[t.pockets.pocketNW.pocket,t.pockets.pocketSW.pocket,t.pockets.pocketN.pocket,t.pockets.pocketS.pocket,t.pockets.pocketNE.pocket,t.pockets.pocketSE.pocket]}},{key:"pocketLayout",value:function(e){t.pockets={pocketNW:{pocket:new Pocket(new three_core_Vector3(-t.PX,t.PY,0),t.cornerRadius),knuckleNE:new Knuckle(new three_core_Vector3(-TableGeometry.X+t.knuckleInset,TableGeometry.Y+t.knuckleRadius,0),t.knuckleRadius),knuckleSW:new Knuckle(new three_core_Vector3(-TableGeometry.X-t.knuckleRadius,TableGeometry.Y-t.knuckleInset,0),t.knuckleRadius)},pocketN:{pocket:new Pocket(new three_core_Vector3(0,t.PY+.7*e/.5,0),t.middleRadius),knuckleNE:new Knuckle(new three_core_Vector3(t.middleKnuckleInset,TableGeometry.Y+t.middleKnuckleRadius,0),t.middleKnuckleRadius),knuckleNW:new Knuckle(new three_core_Vector3(-t.middleKnuckleInset,TableGeometry.Y+t.middleKnuckleRadius,0),t.middleKnuckleRadius)},pocketS:{pocket:new Pocket(new three_core_Vector3(0,-t.PY-.7*e/.5,0),t.middleRadius),knuckleSE:new Knuckle(new three_core_Vector3(t.middleKnuckleInset,-TableGeometry.Y-t.middleKnuckleRadius,0),t.middleKnuckleRadius),knuckleSW:new Knuckle(new three_core_Vector3(-t.middleKnuckleInset,-TableGeometry.Y-t.middleKnuckleRadius,0),t.middleKnuckleRadius)},pocketNE:{pocket:new Pocket(new three_core_Vector3(t.PX,t.PY,0),t.cornerRadius),knuckleNW:new Knuckle(new three_core_Vector3(TableGeometry.X-t.knuckleInset,TableGeometry.Y+t.knuckleRadius,0),t.knuckleRadius),knuckleSE:new Knuckle(new three_core_Vector3(TableGeometry.X+t.knuckleRadius,TableGeometry.Y-t.knuckleInset,0),t.knuckleRadius)},pocketSE:{pocket:new Pocket(new three_core_Vector3(t.PX,-t.PY,0),t.cornerRadius),knuckleNE:new Knuckle(new three_core_Vector3(TableGeometry.X+t.knuckleRadius,-TableGeometry.Y+t.knuckleInset,0),t.knuckleRadius),knuckleSW:new Knuckle(new three_core_Vector3(TableGeometry.X-t.knuckleInset,-TableGeometry.Y-t.knuckleRadius,0),t.knuckleRadius)},pocketSW:{pocket:new Pocket(new three_core_Vector3(-t.PX,-t.PY,0),t.cornerRadius),knuckleSE:new Knuckle(new three_core_Vector3(-TableGeometry.X+t.knuckleInset,-TableGeometry.Y-t.knuckleRadius,0),t.knuckleRadius),knuckleNW:new Knuckle(new three_core_Vector3(-TableGeometry.X-t.knuckleRadius,-TableGeometry.Y+t.knuckleInset,0),t.knuckleRadius)}}}}]),t}();function cushion_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cushion_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function cushion_create_class(t,e,r){return e&&cushion_defineProperties(t.prototype,e),r&&cushion_defineProperties(t,r),t}pocketgeometry_define_property(PocketGeometry,"PX",void 0),pocketgeometry_define_property(PocketGeometry,"PY",void 0),pocketgeometry_define_property(PocketGeometry,"knuckleInset",void 0),pocketgeometry_define_property(PocketGeometry,"knuckleRadius",void 0),pocketgeometry_define_property(PocketGeometry,"middleKnuckleInset",void 0),pocketgeometry_define_property(PocketGeometry,"middleKnuckleRadius",void 0),pocketgeometry_define_property(PocketGeometry,"cornerRadius",void 0),pocketgeometry_define_property(PocketGeometry,"middleRadius",void 0),pocketgeometry_define_property(PocketGeometry,"pockets",void 0),pocketgeometry_define_property(PocketGeometry,"knuckles",void 0),pocketgeometry_define_property(PocketGeometry,"pocketCenters",void 0),PocketGeometry.scaleToRadius(constants_R);var Cushion=function(){function t(){cushion_class_call_check(this,t)}return cushion_create_class(t,null,[{key:"bounceAny",value:function(e,r){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bounceHanBlend,n=e.futurePosition(r);if(t.willBounceLong(n,i)){var o=n.y>TableGeometry.tableY?-Math.PI/2:Math.PI/2;return t.bounceIn(o,e,s)}if(t.willBounceShort(n,i)){var a=n.x>TableGeometry.tableX?0:Math.PI;return t.bounceIn(a,e,s)}}},{key:"willBounceShort",value:function(e,r){return r?t.willBounceShortSegment(PocketGeometry.pockets.pocketNW.knuckleSW.pos.y,PocketGeometry.pockets.pocketSW.knuckleNW.pos.y,e):t.willBounceShortSegment(TableGeometry.Y,-TableGeometry.Y,e)}},{key:"willBounceLong",value:function(e,r){return r?t.willBounceLongSegment(PocketGeometry.pockets.pocketNW.knuckleNE.pos.x,PocketGeometry.pockets.pocketN.knuckleNW.pos.x,e)||t.willBounceLongSegment(PocketGeometry.pockets.pocketN.knuckleNE.pos.x,PocketGeometry.pockets.pocketNE.knuckleNW.pos.x,e):t.willBounceLongSegment(-TableGeometry.X,TableGeometry.X,e)}},{key:"willBounceLongSegment",value:function(t,e,r){return r.x>t&&r.x<e&&Math.abs(r.y)>TableGeometry.tableY}},{key:"willBounceShortSegment",value:function(t,e,r){return r.y>e&&r.y<t&&Math.abs(r.x)>TableGeometry.tableX}},{key:"bounceIn",value:function(t,e,r){try{e.ballmesh&&e.ballmesh.trace&&e.ballmesh.trace.forceTrace&&e.ballmesh.trace.forceTrace(e.futurePos)}catch(t){}var i=rotateApplyUnrotate(t,e.vel,e.rvel,r);return e.vel.add(i.v),e.rvel.add(i.w),i.v.length()}}]),t}();function collisionthrow_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function collisionthrow_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function collisionthrow_create_class(t,e,r){return e&&collisionthrow_defineProperties(t.prototype,e),r&&collisionthrow_defineProperties(t,r),t}function collisionthrow_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var CollisionThrow=function(){function t(){collisionthrow_class_call_check(this,t),collisionthrow_define_property(this,"normalImpulse",void 0),collisionthrow_define_property(this,"tangentialImpulse",void 0)}return collisionthrow_create_class(t,[{key:"dynamicFriction",value:function(t){return.01+.108*exp(-1.088*t)}},{key:"updateVelocities",value:function(t,e){var r=Collision.positionsAtContact(t,e);t.ballmesh.trace.forceTrace(r.a),e.ballmesh.trace.forceTrace(r.b);var i=r.b.sub(r.a).normalize(),s=new three_core_Vector3(-i.y,i.x,0),n=t.vel.clone().sub(e.vel).add(i.clone().multiplyScalar(-constants_R).cross(t.rvel).sub(i.clone().multiplyScalar(constants_R).cross(e.rvel))),o=i.dot(n),a=n.addScaledVector(i,-o),h=a.length(),l=s.dot(a),c=this.dynamicFriction(h);this.normalImpulse=-1.99*o/(2/constants_m),this.tangentialImpulse=.25*Math.min(c*Math.abs(this.normalImpulse)/h,1/7)*-l;var u=i.clone().multiplyScalar(this.normalImpulse),p=s.clone().multiplyScalar(this.tangentialImpulse);t.vel.addScaledVector(u,1/constants_m).addScaledVector(p,1/constants_m),e.vel.addScaledVector(u,-1/constants_m).addScaledVector(p,-1/constants_m);var d=i.clone().multiplyScalar(-constants_R).cross(p),m=i.clone().multiplyScalar(constants_R).cross(p);return t.rvel.addScaledVector(d,1/I),e.rvel.addScaledVector(m,1/I),o}}]),t}();function collision_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function collision_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function collision_create_class(t,e,r){return e&&collision_defineProperties(t.prototype,e),r&&collision_defineProperties(t,r),t}function collision_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var TOI_EPSILON=1e-5;function timeOfImpactBallBall(t,e,r,i){var s,n=null!==(s=null==i?void 0:i.R)&&void 0!==s?s:constants_R,o=t.pos.clone().sub(e.pos),a=t.vel.clone().sub(e.vel),h=2*n,l=a.dot(a),c=2*o.dot(a),u=o.dot(o)-h*h;if(l<=1e-12)return-1;var p=c*c-4*l*u;if(p<0)return-1;var d=Math.sqrt(p),m=(-c-d)/(2*l),f=(-c+d)/(2*l),y=Number.POSITIVE_INFINITY;return m>=0&&m<=r&&(y=Math.min(y,m)),f>=0&&f<=r&&(y=Math.min(y,f)),isFinite(y)?y:-1}var Collision=function(){function t(){collision_class_call_check(this,t)}return collision_create_class(t,null,[{key:"timeOfImpact",value:function(t,e,r,i){return timeOfImpactBallBall(t,e,r,i)}},{key:"willCollide",value:function(t,e,r,i){if(!t.onTable()||!e.onTable())return!1;if(!t.inMotion()&&!e.inMotion())return!1;var s,n=null!==(s=null==i?void 0:i.R)&&void 0!==s?s:constants_R;if(timeOfImpactBallBall(t,e,r,i)>=0)return!0;var o=t.futurePosition(r),a=e.futurePosition(r),h=o.clone().sub(a);return!(h.lengthSq()>=4*n*n)&&t.vel.clone().sub(e.vel).dot(h)<0}},{key:"separateAtImpact",value:function(t,e,r,i){var s,n=null!==(s=null==i?void 0:i.R)&&void 0!==s?s:constants_R,o=2*n,a=timeOfImpactBallBall(t,e,r,i),h=t.pos.clone(),l=e.pos.clone();a>=0&&(h.addScaledVector(t.vel,a),l.addScaledVector(e.vel,a));var c=h.clone().sub(l),u=c.length();u<TOI_EPSILON&&(c.set(1,0,0),u=Math.max(u,TOI_EPSILON));var p=c.multiplyScalar(1/u),d=o-u;if(!(d<=0)){var m,f=.5*(d+n*(null!==(m=null==i?void 0:i.collisionSeparationBias)&&void 0!==m?m:.01)),y=p.multiplyScalar(f);t.pos.add(y),e.pos.sub(y),t.futurePos.copy(t.pos),e.futurePos.copy(e.pos)}}},{key:"collide",value:function(e,r){return t.updateVelocities(e,r)}},{key:"positionsAtContact",value:function(t,e){var r=t.pos.distanceTo(e.pos),i=t.vel.clone().sub(e.vel),s=(r-2*constants_R)/i.length()||0;return{a:t.pos.clone().addScaledVector(t.vel,s),b:e.pos.clone().addScaledVector(e.vel,s)}}},{key:"updateVelocities",value:function(e,r){var i,s=null!==(i=e.physicsContext)&&void 0!==i?i:r.physicsContext,n=r.pos.clone().sub(e.pos),o=n.length(),a=0;o>1e-6?(n.multiplyScalar(1/o),a=e.vel.clone().sub(r.vel).dot(n)):n.set(0,0,0);var h=t.model.updateVelocities(e,r),l=o>1e-6?e.vel.clone().sub(r.vel).dot(n):0;if(o>1e-6&&l>0){var c=-.5*l;e.vel.addScaledVector(n,c),r.vel.addScaledVector(n,-c)}var u,p=o>1e-6?e.vel.clone().sub(r.vel).dot(n):l,d=null!==(u=null==s?void 0:s.minSeparationSpeed)&&void 0!==u?u:.004;if(o>1e-6&&Math.abs(p)<d){var m=p>=0?-1:1,f=m*d*.5;e.vel.addScaledVector(n,-f),r.vel.addScaledVector(n,f),p=m*d}return t.debugHook&&t.debugHook({relNormalBefore:a,relNormalAfterImpulse:l,relNormalAfterCorrection:p,normalImpulse:t.model.normalImpulse,tangentialImpulse:t.model.tangentialImpulse,distance:o}),e.state=ball_State.Sliding,r.state=ball_State.Sliding,h}}]),t}();function gameevent_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gameevent_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}collision_define_property(Collision,"debugHook",void 0),collision_define_property(Collision,"model",new CollisionThrow);var GameEvent=function t(){gameevent_class_call_check(this,t),gameevent_define_property(this,"type",void 0),gameevent_define_property(this,"sequence",void 0),gameevent_define_property(this,"clientId",void 0)},EventType=function(t){return t.BEGIN="BEGIN",t.BREAK="BREAK",t.WATCHAIM="WATCHAIM",t.AIM="AIM",t.HIT="HIT",t.STATIONARY="STATIONARY",t.CHAT="CHAT",t.ABORT="ABORT",t.PLACEBALL="PLACEBALL",t.REJOIN="REJOIN",t.RERACK="RERACK",t.STARTAIM="STARTAIM",t}({});function _assert_this_initialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _call_super(t,e,r){return e=_get_prototype_of(e),_possible_constructor_return(t,_is_native_reflect_construct()?Reflect.construct(e,r||[],_get_prototype_of(t).constructor):e.apply(t,r))}function aimevent_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function aimevent_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function aimevent_create_class(t,e,r){return e&&aimevent_defineProperties(t.prototype,e),r&&aimevent_defineProperties(t,r),t}function aimevent_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _get_prototype_of(t){return _get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},_get_prototype_of(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_set_prototype_of(t,e)}function _possible_constructor_return(t,e){return!e||"object"!==_type_of(e)&&"function"!=typeof e?_assert_this_initialized(t):e}function _set_prototype_of(t,e){return _set_prototype_of=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_set_prototype_of(t,e)}function _type_of(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function _is_native_reflect_construct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_is_native_reflect_construct=function(){return!!t})()}var AimEvent=function(t){function e(){var t;return aimevent_class_call_check(this,e),aimevent_define_property(t=_call_super(this,e),"offset",new three_core_Vector3(0,0,0)),aimevent_define_property(t,"angle",0),aimevent_define_property(t,"power",0),aimevent_define_property(t,"pos",new three_core_Vector3(0,0,0)),aimevent_define_property(t,"i",0),aimevent_define_property(t,"elevation",.17),t.type=EventType.AIM,t}return _inherits(e,t),aimevent_create_class(e,[{key:"applyToController",value:function(t){return t.handleAim(this)}},{key:"copy",value:function(){return e.fromJson(this)}}],[{key:"fromJson",value:function(t){var r=new e;return r.pos=vec(t.pos),r.angle=t.angle,r.offset=vec(t.offset),r.power=t.power,void 0!==t.i&&(r.i=t.i),void 0!==t.elevation&&(r.elevation=t.elevation),r}}]),e}(GameEvent);function cuemesh_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cuemesh_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function cuemesh_create_class(t,e,r){return e&&cuemesh_defineProperties(t.prototype,e),r&&cuemesh_defineProperties(t,r),t}function cuemesh_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var CueMesh=function(){function t(){cuemesh_class_call_check(this,t)}return cuemesh_create_class(t,null,[{key:"indicateValid",value:function(e){t.placermaterial.color.setHex(e?13434828:16711680)}},{key:"createPlacer",value:function(){var e=new CylinderGeometry(.01*constants_R/.5,constants_R,constants_R,4),r=new Mesh(e,t.placermaterial);return r.geometry.applyMatrix4((new Matrix4).identity().makeRotationAxis(new three_core_Vector3(1,0,0),-Math.PI/2)).applyMatrix4((new Matrix4).identity().makeTranslation(0,0,.7*constants_R/.5)),r.visible=!1,r}},{key:"createCue",value:function(e,r,i){var s=new Group;s.name="cueShaft";var n=2.2*e,o=Math.max(i-n,8*e),a=new CylinderGeometry(e,r,o,24);a.translate(0,-(o/2+n),0);var h=new Mesh(a,t.material);h.castShadow=!1,s.add(h);var l=1.08*e,c=new CylinderGeometry(l,1.18*e,n,24),u=new Mesh(c,t.ferruleMaterial);u.position.y=-n/2,u.castShadow=!1,s.add(u);var p=.98*l,d=new SphereGeometry(p,24,16,0,2*Math.PI,0,Math.PI/2);d.translate(0,-p,0);var m=new Mesh(d,t.tipMaterial);return m.castShadow=!1,m.renderOrder=2,s.add(m),s}},{key:"createHitPoint",value:function(){var t=new SphereGeometry(1.05*constants_R,32,32,0,2*Math.PI,0,.125*Math.PI);t.rotateX(Math.PI/2),t.translate(0,0,1.05*-constants_R);var e=new ShaderMaterial({uniforms:{hitColor:{value:new three_core_Vector3(72/255,72/255,206/255)},spotSize:{value:.3},sphereCenter:{value:new three_core_Vector3(0,0,1.05*-constants_R)}},vertexShader:"\n        varying vec3 vPosition;\n        varying vec3 vNormal;\n\n        void main() {\n          vPosition = position;\n          vNormal = normalize(normalMatrix * normal);\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform vec3 hitColor;\n        uniform float spotSize;\n        uniform vec3 sphereCenter;\n        varying vec3 vPosition;\n        varying vec3 vNormal;\n\n        void main() {\n          // Calculate position relative to sphere center (after geometry.translate)\n          vec3 pos = normalize(vPosition - sphereCenter);\n          vec3 northPole = vec3(0.0, 0.0, 1.0);\n          float dotProduct = dot(pos, northPole);\n          float angularDist = acos(clamp(dotProduct, -1.0, 1.0)) / 3.14159;\n          float normalizedDist = angularDist / spotSize;\n          float alpha = 1.0 - smoothstep(0.7, 1.0, normalizedDist);\n          float glow = pow(1.0 - clamp(normalizedDist, 0.0, 1.0), 2.0) * 0.8;\n          vec3 finalColor = hitColor + vec3(glow);\n          if (alpha < 0.05) discard;\n          gl_FragColor = vec4(finalColor, alpha * 0.9);\n        }\n      ",transparent:!0,depthTest:!0,depthWrite:!1,side:DoubleSide}),r=new Mesh(t,e);return r.renderOrder=10,r.visible=!0,r}},{key:"createVirtualCue",value:function(){var t=7.5/30.75*constants_R,e=100/30.75*constants_R,r=new CylinderGeometry(t,t,e,16);r.translate(0,-e/2,0);var i=new MeshPhongMaterial({color:65280,emissive:65280,emissiveIntensity:.5,transparent:!0,opacity:.85,shininess:100}),s=new Mesh(r,i);return s.renderOrder=998,s.visible=!0,s}},{key:"createCueMaterial",value:function(){var e="undefined"!=typeof document||void 0!==globalThis.OffscreenCanvas,r={color:16777215,transparent:!0,opacity:.65,depthWrite:!1,shininess:30,emissive:new Color(4859926),emissiveIntensity:.6};if(e)try{r.map=t.getWoodTexture()}catch(t){}var i=new MeshPhongMaterial(r);return i.needsUpdate=!0,i}},{key:"getWoodTexture",value:function(){if(!t.woodTexture){var e;if("undefined"!=typeof document)(e=document.createElement("canvas")).width=512,e.height=32;else{if(void 0===globalThis.OffscreenCanvas){var r,i=null===(r=globalThis.document)||void 0===r?void 0:r.createElement;if(i){var s=i.call(globalThis.document,"canvas");return s.width=1,s.height=1,t.woodTexture=new CanvasTexture(s),t.woodTexture}throw new Error("No canvas available for cue texture")}e=new globalThis.OffscreenCanvas(512,32)}var n=e.getContext("2d");if(!n)throw new Error("Unable to create canvas context for cue texture");var o=n.createLinearGradient(0,0,e.width,0);o.addColorStop(0,"#8b5a2b"),o.addColorStop(.25,"#a4703a"),o.addColorStop(.5,"#c58b4b"),o.addColorStop(.75,"#a4703a"),o.addColorStop(1,"#8b5a2b"),n.fillStyle=o,n.fillRect(0,0,e.width,e.height);for(var a=0;a<40;a++){var h=4+16*Math.random(),l=Math.random()*e.width,c=.04+.05*Math.random();n.fillStyle="rgba(60, 30, 15, ".concat(c.toFixed(3),")"),n.fillRect(l,0,h,e.height)}t.woodTexture=new CanvasTexture(e),t.woodTexture.wrapS=RepeatWrapping,t.woodTexture.wrapT=RepeatWrapping,t.woodTexture.magFilter=LinearFilter,t.woodTexture.minFilter=LinearFilter,t.woodTexture.repeat.set(6,1),t.woodTexture.needsUpdate=!0}return t.woodTexture}}]),t}();function computeHitPointAndDirection(t,e,r){var i=unitAtAngle(t.angle+Math.PI),s=new Vector3(i.x,i.y,0),n=function(t){return Math.max(-1,Math.min(1,t))},o=Math.asin(n(t.offset.x));s.applyAxisAngle(new Vector3(0,0,1),o);var a=-Math.asin(n(t.offset.y)),h=upCross(i).normalize();s.applyAxisAngle(h,a);var l=s.normalize();return{hitPoint:e.clone().addScaledVector(l,r),shotDir:l}}function applyShotKinematics(t,e,r){var i=computeHitPointAndDirection(e,t.pos,t.radius),s=i.hitPoint,n=i.shotDir;return t.state=State.Sliding,t.vel.copy(n.multiplyScalar(e.power)),t.rvel.copy(cueToSpinUniversal(s,t.pos,t.vel)),t.magnusEnabled=r>.2,t.magnusElevation=r,{hitPoint:s}}function makeShotPoseFromAim(t,e,r){var i=utils_unitAtAngle(e.angle+Math.PI),s=new three_core_Vector3(i.x*Math.cos(r),i.y*Math.cos(r),Math.sin(r)).normalize(),n=function(t){return Math.max(-1,Math.min(1,t))},o=new three_core_Vector3(i.x,i.y,0),a=-Math.asin(n(e.offset.x));o.applyAxisAngle(new three_core_Vector3(0,0,1),a);var h=utils_upCross(i).normalize(),l=-Math.asin(n(e.offset.y));return o.applyAxisAngle(h,l),o.normalize(),{cueDir:s,hitPointWorld:t.pos.clone().addScaledVector(o,t.radius),elevation:r,power:e.power}}function applyShotFromPose(t,e){var r=e.cueDir,i=e.hitPointWorld,s=e.elevation,n=e.power;t.state=ball_State.Sliding;var o=r.clone();if(Math.abs(s)>.001){var a=Math.max(0,Math.min(1,elevationVerticalImpulseScale));o.z*=a;var h=i.clone().sub(t.pos).normalize(),l=Math.min(1,Math.abs(s)/Math.max(1e-6,topHitJumpElevationRef)),c=1+topHitJumpDirectionalGain*h.z*l;o.z*=c,o.lengthSq()>0&&o.normalize()}var u=o.multiplyScalar(-n);t.vel.copy(u);try{t.initialShotSpeed=Math.max(0,u.length())}catch(t){}t.rvel.copy(physics_cueToSpinUniversal(i,t.pos,t.vel)),t.magnusEnabled=s>.2,t.magnusElevation=s}cuemesh_define_property(CueMesh,"mesh",void 0),cuemesh_define_property(CueMesh,"woodTexture",null),cuemesh_define_property(CueMesh,"material",CueMesh.createCueMaterial()),cuemesh_define_property(CueMesh,"ferruleMaterial",new MeshPhongMaterial({color:15987180,emissive:new Color(2763306),emissiveIntensity:.35,transparent:!0,opacity:.7,depthWrite:!1,shininess:60})),cuemesh_define_property(CueMesh,"tipMaterial",new MeshPhongMaterial({color:7317208,emissive:new Color(1715007),emissiveIntensity:.6,transparent:!0,opacity:.75,depthWrite:!1,shininess:80})),cuemesh_define_property(CueMesh,"placermaterial",new MeshPhongMaterial({color:13434828,wireframe:!1,flatShading:!1,transparent:!0,opacity:.5}));var ENGINE_DT=1/512,TRAJECTORY_SAMPLE_DT=.008,trace=__webpack_require__(2072);function cue_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cue_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function cue_create_class(t,e,r){return e&&cue_defineProperties(t.prototype,e),r&&cue_defineProperties(t,r),t}function cue_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Cue=function(){function t(e,r,i){cue_class_call_check(this,t),cue_define_property(this,"mesh",void 0),cue_define_property(this,"placerMesh",void 0),cue_define_property(this,"hitPointMesh",void 0),cue_define_property(this,"virtualCueMesh",void 0),cue_define_property(this,"helperGhostGroup",void 0),cue_define_property(this,"helperGhostBalls",[]),cue_define_property(this,"helperGhostMaterial",void 0),cue_define_property(this,"helperImpactGhostMaterial",void 0),cue_define_property(this,"helperGhostSourceGeometryId",void 0),cue_define_property(this,"helperVisible",!1),cue_define_property(this,"helperGhostScale",1),cue_define_property(this,"helperGhostGapDiameterMultiplier",2),cue_define_property(this,"lastHelperPoints",null),cue_define_property(this,"lastHelperHasImpact",!1),cue_define_property(this,"lastHelperImpactIsBall",!1),cue_define_property(this,"offCenterLimitMasse",.8),cue_define_property(this,"ballRadius",void 0),cue_define_property(this,"maxPower",void 0),cue_define_property(this,"defaultElevation",.17),cue_define_property(this,"t",0),cue_define_property(this,"aimInputs",void 0),cue_define_property(this,"aim",new AimEvent),cue_define_property(this,"container",void 0),cue_define_property(this,"masseMode",!0),cue_define_property(this,"elevation",.17),cue_define_property(this,"length",1*TableGeometry.tableX),this.container=e,this.ballRadius=null!=r?r:constants_R,this.maxPower=160*this.ballRadius,i?(this.mesh=void 0,this.placerMesh=void 0,this.hitPointMesh=void 0,this.virtualCueMesh=void 0,this.helperGhostGroup=new Group,this.helperGhostGroup.visible=!1,this.helperGhostGroup.name="helperGhostBalls",this.helperGhostGroup.renderOrder=0):(this.mesh=CueMesh.createCue(.05*this.ballRadius/.5,.15*this.ballRadius/.5,this.length),this.placerMesh=CueMesh.createPlacer(),this.hitPointMesh=CueMesh.createHitPoint(),this.virtualCueMesh=CueMesh.createVirtualCue(),this.helperGhostGroup=new Group,this.helperGhostGroup.visible=!1,this.helperGhostGroup.name="helperGhostBalls",this.helperGhostGroup.renderOrder=0)}return cue_create_class(t,[{key:"rotateAim",value:function(t,e){var r;this.aim.angle=this.aim.angle+t,this.aimInputs.showOverlap(),this.avoidCueTouchingOtherBall(e),null===(r=this.container)||void 0===r||r.updateTrajectoryPrediction()}},{key:"adjustPower",value:function(t){var e;this.aim.power=Math.min(this.maxPower,this.aim.power+t),this.updateAimInput(),null===(e=this.container)||void 0===e||e.updateTrajectoryPrediction()}},{key:"setPower",value:function(t){var e,r="number"==typeof t?t:parseFloat(t);if(Number.isFinite(r)){var i=Math.max(0,r);this.aim.power=i*this.maxPower,null===(e=this.container)||void 0===e||e.updateTrajectoryPrediction()}}},{key:"hit",value:function(t){var e,r,i,s;this.aim,this.t=0,t.state=ball_State.Sliding;var n=makeShotPoseFromAim(t,{angle:this.aim.angle,offset:this.aim.offset,power:this.aim.power},this.elevation),o="undefined"!=typeof performance?Math.round(performance.now()):Date.now(),a=this.container&&this.container.table&&this.container.table.serialise?this.container.table.serialise():void 0;if((0,trace.uP)("shot",{shotId:o,ballId:t.id,pos:{x:t.pos.x,y:t.pos.y,z:t.pos.z},aim:{angle:this.aim.angle,offset:{x:this.aim.offset.x,y:this.aim.offset.y,z:this.aim.offset.z},power:this.aim.power},elevation:this.elevation,cueDir:{x:n.cueDir.x,y:n.cueDir.y,z:n.cueDir.z},hitPointWorld:{x:n.hitPointWorld.x,y:n.hitPointWorld.y,z:n.hitPointWorld.z},engineDt:ENGINE_DT,table:a,tableGeometry:{tableX:TableGeometry.tableX,tableY:TableGeometry.tableY,X:TableGeometry.X,Y:TableGeometry.Y,hasPockets:TableGeometry.hasPockets}}),applyShotFromPose(t,n),this.container&&(this.container.currentShotId=o,this.container.currentCueBallId=t.id),this.container&&DEBUG_PHYSICS&&addDebugVelocityArrow(this.container.view.scene,n.hitPointWorld,t.vel,this.ballRadius),this.hitPointMesh.visible=!1,this.mesh.visible=!1,null===(r=this.container)||void 0===r||null===(e=r.trajectoryRenderer)||void 0===e||e.clearTrajectories(),null===(s=this.container)||void 0===s||null===(i=s.view)||void 0===i?void 0:i.camera){var h=this.container.view.camera;h.raiseHeightForTracking(this.ballRadius);var l=h.camera.position.clone(),c=TableGeometry.tableX,u=TableGeometry.tableY;Math.abs(l.x)<c&&Math.abs(l.y)<u&&h.moveBackwardToTableEdge(l,c,u,this.ballRadius)}}},{key:"getActualHitOffset",value:function(t){var e=this.hitPointMesh.position.clone().clone().sub(t).normalize(),r=utils_unitAtAngle(this.aim.angle),i=utils_upCross(r).normalize(),s=new three_core_Vector3(r.x,r.y,0).normalize();s.applyAxisAngle(i,-this.elevation);var n=(new three_core_Vector3).crossVectors(s,i).normalize(),o=e.dot(i),a=e.dot(n);return new three_core_Vector3(o,a,0)}},{key:"aimAtNext",value:function(t,e){if(e){var r=norm(e.pos.clone().sub(t.pos));this.aim.angle=utils_atan2(r.y,r.x)}}},{key:"adjustSpin",value:function(t,e){var r,i=this.aim.offset.clone().clone().add(t);this.setSpin(i,e),null===(r=this.container)||void 0===r||r.updateTrajectoryPrediction()}},{key:"setSpin",value:function(t,e){var r;this.aim.offset.copy(t),this.avoidCueTouchingOtherBall(e),this.updateAimInput(),null===(r=this.container)||void 0===r||r.updateTrajectoryPrediction()}},{key:"avoidCueTouchingOtherBall",value:function(t){for(var e=this.offCenterLimitMasse,r=0;r++<20&&this.intersectsAnything(t);)this.aim.offset.y+=.1,this.aim.offset.length()>e&&this.aim.offset.normalize().multiplyScalar(e);r>1&&this.updateAimInput()}},{key:"updateAimInput",value:function(){var t,e,r,i;null===(t=this.aimInputs)||void 0===t||t.updateVisualState(this.aim.offset.x,this.aim.offset.y),null===(e=this.aimInputs)||void 0===e||e.updatePowerSlider(this.aim.power/this.maxPower),null===(r=this.aimInputs)||void 0===r||r.updateElevationSlider(this.elevation),null===(i=this.aimInputs)||void 0===i||i.showOverlap()}},{key:"moveTo",value:function(t){this.aim.pos.copy(t);var e=utils_unitAtAngle(this.aim.angle+Math.PI),r=new three_core_Vector3(e.x,e.y,0),i=-this.aim.offset.x*Math.PI/2;r.applyAxisAngle(new three_core_Vector3(0,0,1),i);var s=-this.aim.offset.y*Math.PI/2,n=utils_upCross(e).normalize();r.applyAxisAngle(n,s);var o=r.normalize(),a=t.clone().addScaledVector(o,this.ballRadius),h=utils_unitAtAngle(this.aim.angle+Math.PI),l=new three_core_Vector3(h.x*Math.cos(this.elevation),h.y*Math.cos(this.elevation),Math.sin(this.elevation)).normalize(),c=100/30.75*this.ballRadius/2,u=10/30.75*this.ballRadius,p=2.5*this.ballRadius,d=c+u+p+p,m=2*(utils_sin(this.t+Math.PI/2)-1)*this.ballRadius*(this.aim.power/this.maxPower),f=a.clone().addScaledVector(l,d).addScaledVector(l,m);this.mesh.position.copy(f);var y=new three_core_Vector3(0,-1,0),g=new Quaternion;g.setFromUnitVectors(y,l),this.mesh.setRotationFromQuaternion(g),this.placerMesh.position.copy(t),this.placerMesh.rotation.z=this.t,this.updateHitPoint(t),this.updateVirtualCue(t)}},{key:"updateHitPoint",value:function(t){var e=utils_unitAtAngle(this.aim.angle+Math.PI),r=new three_core_Vector3(e.x,e.y,0),i=-Math.asin(Math.max(-1,Math.min(1,this.aim.offset.x)));r.applyAxisAngle(new three_core_Vector3(0,0,1),i);var s=-Math.asin(Math.max(-1,Math.min(1,this.aim.offset.y))),n=utils_upCross(e).normalize();r.applyAxisAngle(n,s);var o=r.normalize(),a=t.clone().addScaledVector(o,this.ballRadius);this.hitPointMesh.position.copy(a);var h=new Quaternion;h.setFromUnitVectors(new three_core_Vector3(0,0,1),o),this.hitPointMesh.setRotationFromQuaternion(h)}},{key:"updateVirtualCue",value:function(t){var e=utils_unitAtAngle(this.aim.angle+Math.PI),r=new three_core_Vector3(e.x,e.y,0),i=-this.aim.offset.x*Math.PI/2;r.applyAxisAngle(new three_core_Vector3(0,0,1),i);var s=-this.aim.offset.y*Math.PI/2,n=utils_upCross(e).normalize();r.applyAxisAngle(n,s);var o=r.normalize(),a=t.clone().addScaledVector(o,this.ballRadius);this.virtualCueMesh.position.copy(a);var h=utils_unitAtAngle(this.aim.angle+Math.PI),l=new three_core_Vector3(h.x*Math.cos(this.elevation),h.y*Math.cos(this.elevation),Math.sin(this.elevation)).normalize(),c=new three_core_Vector3(0,-1,0),u=new Quaternion;u.setFromUnitVectors(c,l),this.virtualCueMesh.setRotationFromQuaternion(u)}},{key:"toggleVirtualCue",value:function(){this.virtualCueMesh.visible=!this.virtualCueMesh.visible}},{key:"update",value:function(t){this.t+=t,this.moveTo(this.aim.pos)}},{key:"placeBallMode",value:function(){this.mesh.visible=!1,this.placerMesh.visible=!0,this.virtualCueMesh.visible=!1,this.hitPointMesh.visible=!1,this.aim.angle=0}},{key:"aimMode",value:function(){this.mesh.visible=!0,this.placerMesh.visible=!1,this.virtualCueMesh.visible=!1,this.hitPointMesh.visible=!0}},{key:"spinOffset",value:function(){return utils_upCross(utils_unitAtAngle(this.aim.angle)).clone().multiplyScalar(2*this.aim.offset.x*this.ballRadius).setZ(2*this.aim.offset.y*this.ballRadius)}},{key:"intersectsAnything",value:function(t){var e=this.spinOffset(),r=t.cueball.pos.clone().add(e),i=norm(utils_unitAtAngle(this.aim.angle+Math.PI).setZ(.1)),s=new Raycaster(r,i),n=t.balls.map((function(t){return t.ballmesh.mesh}));return t.mesh&&n.push(t.mesh),s.intersectObjects(n,!0).length>0}},{key:"showHelper",value:function(t){this.helperVisible=t,t?this.updateHelperGhostBalls(this.lastHelperPoints,this.lastHelperHasImpact,this.lastHelperImpactIsBall):this.hideHelperGhostBalls()}},{key:"toggleHelper",value:function(){this.showHelper(!this.helperVisible)}},{key:"updateHelperCurve",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.lastHelperPoints=t?t.map((function(t){return t.clone()})):null,this.lastHelperHasImpact=e,this.lastHelperImpactIsBall=r,this.helperVisible?this.updateHelperGhostBalls(this.lastHelperPoints,e,r):this.hideHelperGhostBalls()}},{key:"disposeHelperGhostResources",value:function(){var t=this;this.helperGhostBalls.forEach((function(e){e.geometry.dispose(),t.helperGhostGroup.remove(e)})),this.helperGhostBalls=[],this.helperGhostMaterial&&(Array.isArray(this.helperGhostMaterial)?this.helperGhostMaterial.forEach((function(t){return t.dispose()})):this.helperGhostMaterial.dispose()),this.helperImpactGhostMaterial&&(Array.isArray(this.helperImpactGhostMaterial)?this.helperImpactGhostMaterial.forEach((function(t){return t.dispose()})):this.helperImpactGhostMaterial.dispose()),this.helperGhostMaterial=void 0,this.helperImpactGhostMaterial=void 0,this.helperGhostSourceGeometryId=void 0,this.helperGhostGroup.visible=!1}},{key:"configureGhostMaterial",value:function(t){var e,r,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=t;if("transparent"in s&&(s.transparent=!0),"opacity"in s&&(s.opacity=i?.6:.3),"depthWrite"in s&&(s.depthWrite=!i),"depthTest"in s&&(s.depthTest=!i),"color"in s&&(null===(e=s.color)||void 0===e?void 0:e.clone)){var n=s.color.clone();n.offsetHSL&&n.offsetHSL(0,-.2,.15),s.color.copy(n)}if("emissive"in s&&(null===(r=s.emissive)||void 0===r?void 0:r.clone)){var o,a=s.emissive.clone();a.offsetHSL&&a.offsetHSL(0,-.15,.2),s.emissive.copy(a),"emissiveIntensity"in s&&(s.emissiveIntensity=Math.max(null!==(o=s.emissiveIntensity)&&void 0!==o?o:.35,.35))}return t.needsUpdate=!0,t}},{key:"cloneGhostMaterial",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.isArray(t)?t.map((function(t){return e.configureGhostMaterial(t.clone(),r)})):this.configureGhostMaterial(t.clone(),r)}},{key:"ensureHelperGhostResources",value:function(){var t,e,r,i,s=null===(i=this.container)||void 0===i||null===(r=i.table)||void 0===r||null===(e=r.cueball)||void 0===e||null===(t=e.ballmesh)||void 0===t?void 0:t.mesh;if(!s)return!1;var n=s.geometry.uuid;return this.helperGhostSourceGeometryId&&this.helperGhostSourceGeometryId!==n&&this.disposeHelperGhostResources(),this.helperGhostMaterial?this.helperGhostSourceGeometryId||(this.helperGhostSourceGeometryId=n):(this.helperGhostMaterial=this.cloneGhostMaterial(s.material,!1),this.helperImpactGhostMaterial=this.cloneGhostMaterial(s.material,!0),this.helperGhostSourceGeometryId=n),!!this.helperGhostMaterial}},{key:"ensureHelperGhostCount",value:function(t){var e,r,i,s,n=null===(s=this.container)||void 0===s||null===(i=s.table)||void 0===i||null===(r=i.cueball)||void 0===r||null===(e=r.ballmesh)||void 0===e?void 0:e.mesh;if(n&&this.helperGhostMaterial)for(;this.helperGhostBalls.length<t;){var o=n.geometry.clone(),a=this.helperGhostMaterial,h=Array.isArray(a)?a.slice():a,l=new Mesh(o,h);l.visible=!1,l.castShadow=!1,l.receiveShadow=!1,l.name="helperGhostBall-".concat(this.helperGhostBalls.length),l.renderOrder=this.helperGhostGroup.renderOrder+1,l.scale.setScalar(this.helperGhostScale),this.helperGhostGroup.add(l),this.helperGhostBalls.push(l)}}},{key:"generateStraightHelperPoints",value:function(){var t,e,r=null===(e=this.container)||void 0===e||null===(t=e.table)||void 0===t?void 0:t.cueball;if(!r)return null;var i=utils_unitAtAngle(this.aim.angle);if(0===i.lengthSq())return null;var s=i.setZ(0).normalize(),n=r.pos.clone(),o=30*this.ballRadius/.5,a=n.clone().addScaledVector(s,o);return[n,a]}},{key:"computeGhostBallPositions",value:function(t,e){if(t.length<2||e<=0)return[];for(var r=[],i=0,s=e,n=1;n<t.length;n++){var o=t[n-1],a=t[n].clone().sub(o),h=a.length();if(0!==h){for(;i+h>=s;){var l=(s-i)/h,c=o.clone().addScaledVector(a,l);if(r.push(c),s+=e,r.length>256)return r}i+=h}}return r}},{key:"hideHelperGhostBalls",value:function(){this.helperGhostBalls.forEach((function(t){t.visible=!1})),this.helperGhostGroup.visible=!1}},{key:"updateHelperGhostBalls",value:function(t,e,r){var i,s,n;if(this.helperVisible){var o=t,a=e;if((!o||o.length<2)&&(o=this.generateStraightHelperPoints(),a=!1),this.ensureHelperGhostResources()){var h,l=null!==(h=null===(n=this.container)||void 0===n||null===(s=n.table)||void 0===s||null===(i=s.cueball)||void 0===i?void 0:i.radius)&&void 0!==h?h:this.ballRadius,c=l*this.helperGhostScale,u=2*this.helperGhostGapDiameterMultiplier*l,p=Math.max(2*c+u,1e-6),d=this.computeGhostBallPositions(o,p);if(a&&o.length>0){var m=o[o.length-1],f=d[d.length-1];if(f&&f.distanceTo(m)<=1e-4||d.push(m.clone()),d.length>=2){var y=d.length-1,g=y-1;d[g].distanceTo(d[y])<2*c-1e-6&&d.splice(g,1)}}if(0!==d.length){this.ensureHelperGhostCount(d.length);for(var _=a&&d.length>0?d.length-1:-1,v=0;v<this.helperGhostBalls.length;v++){var x=this.helperGhostBalls[v];if(v<d.length){x.position.copy(d[v]),x.visible=!0;var b=v===_,M=b?this.helperImpactGhostMaterial:this.helperGhostMaterial;M&&x.material!==M&&(x.material=Array.isArray(M)?M.slice():M,x.renderOrder=b?this.helperGhostGroup.renderOrder+1e4:this.helperGhostGroup.renderOrder+1)}else x.visible=!1}this.updateGhostBallRenderOrder(),this.helperGhostGroup.visible=!0,this.lastHelperPoints=o.map((function(t){return t.clone()})),this.lastHelperHasImpact=a}else this.hideHelperGhostBalls()}else this.hideHelperGhostBalls()}else this.hideHelperGhostBalls()}},{key:"updateGhostBallRenderOrder",value:function(){var t,e,r,i=null===(r=this.container)||void 0===r||null===(e=r.view)||void 0===e||null===(t=e.camera)||void 0===t?void 0:t.camera;if(i){this.helperGhostGroup.updateMatrixWorld(!0);var s=this.helperGhostGroup.renderOrder+1,n=new three_core_Vector3,o=this.helperGhostBalls.map((function(t,e){return{mesh:t,index:e,distanceSq:t.visible?i.position.distanceToSquared(t.getWorldPosition(n)):1/0}})).filter((function(t){return t.mesh.visible&&Number.isFinite(t.distanceSq)})).sort((function(t,e){return t.distanceSq-e.distanceSq}));o.forEach((function(t,e){t.mesh.renderOrder=s+e}));var a=s+o.length;this.helperGhostBalls.forEach((function(t,e){t.visible||(t.renderOrder=a+e)}))}}},{key:"ghostBalls",get:function(){return this.helperGhostBalls}}]),t}();function outcome_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function outcome_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function outcome_create_class(t,e,r){return e&&outcome_defineProperties(t.prototype,e),r&&outcome_defineProperties(t,r),t}function outcome_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var OutcomeType=function(t){return t.Pot="Pot",t.Cushion="Cushion",t.Collision="Collision",t.Hit="Hit",t}({}),Outcome=function(){function t(e,r,i,s){outcome_class_call_check(this,t),outcome_define_property(this,"type",void 0),outcome_define_property(this,"timestamp",void 0),outcome_define_property(this,"ballA",null),outcome_define_property(this,"ballB",null),outcome_define_property(this,"incidentSpeed",void 0),this.type=e,this.ballA=r,this.ballB=i,this.incidentSpeed=s,this.timestamp=Date.now()}return outcome_create_class(t,null,[{key:"pot",value:function(e,r){return new t("Pot",e,e,r)}},{key:"cushion",value:function(e,r){return new t("Cushion",e,e,r)}},{key:"collision",value:function(e,r,i){return new t("Collision",e,r,i)}},{key:"hit",value:function(e,r){return new t("Hit",e,e,r)}},{key:"isCueBallPotted",value:function(t,e){return e.some((function(e){return"Pot"==e.type&&e.ballA===t}))}},{key:"isBallPottedNoFoul",value:function(e,r){return r.some((function(t){return"Pot"==t.type&&null!==t.ballA}))&&!t.isCueBallPotted(e,r)}},{key:"pots",value:function(t){return t.filter((function(t){return"Pot"==t.type})).map((function(t){return t.ballA}))}},{key:"potCount",value:function(t){return this.pots(t).length}},{key:"onlyRedsPotted",value:function(t){return this.pots(t).every((function(t){return t.id>6}))}},{key:"firstCollision",value:function(t){var e=t.filter((function(t){return"Collision"===t.type}));return e.length>0?e[0]:void 0}},{key:"isClearTable",value:function(t){var e=t.balls.filter((function(t){return t.onTable()}));return 1===e.length&&e[0]===t.cueball}},{key:"isThreeCushionPoint",value:function(e,r){r=t.cueBallFirst(e,r).filter((function(t){return t.ballA===e}));var i=new Set,s=0,n=!0,o=!1,a=void 0;try{for(var h,l=r[Symbol.iterator]();!(n=(h=l.next()).done);n=!0){var c=h.value;if("Cushion"===c.type&&s++,"Collision"===c.type&&(i.add(c.ballB),2===i.size))return s>=3}}catch(t){o=!0,a=t}finally{try{n||null==l.return||l.return()}finally{if(o)throw a}}return!1}},{key:"cueBallFirst",value:function(t,e){return e.forEach((function(e){"Collision"===e.type&&e.ballB===t&&(e.ballB=e.ballA,e.ballA=t)})),e}}]),t}();function shotstats_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function shotstats_object_spread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),i.forEach((function(e){shotstats_define_property(t,e,r[e])}))}return t}function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function _object_spread_props(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ownKeys(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))})),t}var hasWindow="undefined"!=typeof window,hasPerformance="undefined"!=typeof performance,now=function(){return hasPerformance?performance.now():Date.now()},FRAME_SKIP_THRESHOLD_MS=null,state={active:!1,frames:[],catapultFrames:[],startedAt:0},lastShot,round3=function(t){return Math.round(1e3*t)/1e3},summarise=function(t,e){var r=t.map((function(t){return t[e]}));if(0===r.length)return{avg:0,max:0,p95:0};r.sort((function(t,e){return t-e}));var i=r.reduce((function(t,e){return t+e}),0),s=Math.min(r.length-1,Math.floor(.95*r.length));return{avg:round3(i/r.length),max:round3(r[r.length-1]),p95:round3(r[s])}},detectCatapult=function(t){var e=[];return t.dtMs>FRAME_SKIP_THRESHOLD_MS&&e.push("dt>".concat(round3(FRAME_SKIP_THRESHOLD_MS))),t.deltaClamped&&e.push("deltaClamped"),t.hitMaxSubSteps&&e.push("hitMaxSubSteps"),(t.accumulatorClamped||t.accumulatorTrimmedPostStep)&&e.push("backlogClamped"),e},highlightCatapult=function(t){return{frame:t.frame,dtMs:round3(t.dtMs),rawElapsedMs:round3(t.rawElapsedMs),deltaMs:round3(t.deltaMs),steps:t.steps,simulatedMs:round3(t.simulatedMs),physics:round3(t.physics),process:round3(t.process),render:round3(t.render),total:round3(t.total),reasons:t.reasons.slice(),accumulatorBefore:round3(t.accumulatorBefore),accumulatorAfterAdd:round3(t.accumulatorAfterAdd),accumulatorAfter:round3(t.accumulatorAfter),backlogBefore:round3(t.backlogBefore),backlogAfter:round3(t.backlogAfter)}},buildSummary=function(t,e,r){var i={};r.forEach((function(t){t.reasons.forEach((function(t){var e;i[t]=(null!==(e=i[t])&&void 0!==e?e:0)+1}))}));var s=r.reduce((function(t,e){return t?e.dtMs>t.dtMs?e:t:e}),void 0);return{frames:t.length,durationMs:round3(e),metrics:{physics:summarise(t,"physics"),process:summarise(t,"process"),render:summarise(t,"render"),total:summarise(t,"total"),dt:summarise(t,"dtMs"),delta:summarise(t,"deltaMs"),steps:summarise(t,"steps"),simulated:summarise(t,"simulatedMs"),backlogBefore:summarise(t,"backlogBefore"),backlogAfter:summarise(t,"backlogAfter")},catapult:{frames:r.length,reasons:i,worst:s?highlightCatapult(s):void 0}}};function beginShot(){hasWindow&&(state.active&&endShot(),state.active=!0,state.frames=[],state.catapultFrames=[],state.startedAt=now())}function recordShotFrame(t){if(state.active){var e=state.frames.length,r=_object_spread_props(shotstats_object_spread({},t),{frame:e});state.frames.push(r);var i=detectCatapult(r);i.length>0&&state.catapultFrames.push(_object_spread_props(shotstats_object_spread({},r),{reasons:i}))}}function endShot(){if(!state.active)return lastShot;state.active=!1;var t=state.frames.slice(),e=state.catapultFrames.slice(),r=now()-state.startedAt,i={summary:buildSummary(t,r,e),frames:t,catapultFrames:e};return lastShot=i,hasWindow&&(window.lastShotStats=i),state.frames=[],state.catapultFrames=[],i}function isShotActive(){return state.active}function getLastShotStats(){return lastShot}function table_class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function table_defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function table_create_class(t,e,r){return e&&table_defineProperties(t.prototype,e),r&&table_defineProperties(t,r),t}function table_define_property(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Table=function(){function t(e,r){table_class_call_check(this,t),table_define_property(this,"balls",void 0),table_define_property(this,"cue",void 0),table_define_property(this,"pairs",void 0),table_define_property(this,"outcome",[]),table_define_property(this,"cueball",void 0),table_define_property(this,"cushionModel",bounceHanBlend),table_define_property(this,"mesh",void 0),r&&r.headless?this.cue=new Cue(void 0,void 0,!0):this.cue=new Cue,this.cueball=e[0],this.initialiseBalls(e)}return table_create_class(t,[{key:"initialiseBalls",value:function(t){this.balls=t,this.pairs=[];for(var e=0;e<t.length;e++)for(var r=0;r<t.length;r++)e<r&&this.pairs.push({a:t[e],b:t[r]})}},{key:"updateBallMesh",value:function(t){this.balls.forEach((function(e){e.updateMesh(t)}))}},{key:"advance",value:function(t){for(var e=0;!this.prepareAdvanceAll(t);)if(80==++e&&(console.warn("Collision resolution struggling (80 retries), applying emergency separation"),this.emergencySeparateAll()),e>100)throw console.error("Depth exceeded resolving collisions after ".concat(e," retries")),new Error("Depth exceeded resolving collisions");e>10&&console.warn("High collision retry count: ".concat(e)),this.balls.forEach((function(e){e.update(t),e.fround()}))}},{key:"emergencySeparateAll",value:function(){this.pairs.forEach((function(t){var e,r,i=t.a.pos.distanceTo(t.b.pos),s=2*(null!==(r=null===(e=t.a.physicsContext)||void 0===e?void 0:e.R)&&void 0!==r?r:constants_R);if(i<s){var n,o=t.b.pos.clone().sub(t.a.pos),a=o.length();a>1e-6?o.multiplyScalar(1/a):o.set(1,0,0);var h,l=.6*(s-i);t.a.pos.addScaledVector(o,-l),t.b.pos.addScaledVector(o,l);var c=null!==(h=null===(n=t.a.physicsContext)||void 0===n?void 0:n.minSeparationSpeed)&&void 0!==h?h:.004;t.a.vel.addScaledVector(o,-c),t.b.vel.addScaledVector(o,c)}}))}},{key:"prepareAdvanceAll",value:function(t){var e=this;return this.pairs.every((function(r){return e.prepareAdvancePair(r.a,r.b,t)}))&&this.balls.every((function(r){return e.prepareAdvanceToCushions(r,t)}))}},{key:"prepareAdvancePair",value:function(t,e,r){var i,s,n=null!==(s=null===(i=t.physicsContext)||void 0===i?void 0:i.R)&&void 0!==s?s:constants_R,o=2*n-t.pos.distanceTo(e.pos)>1e-6*n;if(Collision.willCollide(t,e,r,t.physicsContext)){if(!o)return!0;Collision.separateAtImpact(t,e,r,t.physicsContext);var a=Collision.collide(t,e);return this.outcome.push(Outcome.collision(t,e,a)),!1}return!0}},{key:"prepareAdvanceToCushions",value:function(t,e){if(!t.onTable())return!0;var r=t.futurePosition(e);if(Math.abs(r.y)<TableGeometry.tableY&&Math.abs(r.x)<TableGeometry.tableX)return!0;var i=Cushion.bounceAny(t,e,TableGeometry.hasPockets,this.cushionModel);if(i)return this.outcome.push(Outcome.cushion(t,i)),!1;var s=Knuckle.findBouncing(t,e);if(s){var n=s.bounce(t);return this.outcome.push(Outcome.cushion(t,n)),!1}var o=Pocket.findPocket(PocketGeometry.pocketCenters,t,e);if(o){var a=o.fall(t,e);return this.outcome.push(Outcome.pot(t,a)),!1}return!0}},{key:"allStationary",value:function(){return this.balls.every((function(t){return!t.inMotion()}))}},{key:"inPockets",value:function(){return this.balls.reduce((function(t,e){return e.onTable()?t:t+1}),0)}},{key:"hit",value:function(){beginShot(),this.cue.hit(this.cueball),this.balls.forEach((function(t){t.ballmesh.trace.reset()}))}},{key:"serialise",value:function(){return{balls:this.balls.map((function(t){return t.serialise()})),aim:this.cue.aim.copy(),cushionModel:this.cushionModel,cueballId:this.cueball.id}}},{key:"updateFromSerialised",value:function(t){var e=this;if(t.balls&&t.balls.forEach((function(t,r){var i=e.balls.find((function(e){return e.id===t.id}))||e.balls[r];i&&Ball.updateFromSerialised(i,t)})),t.aim&&(this.cue.aim=AimEvent.fromJson(t.aim),void 0!==t.aim.elevation&&(this.cue.elevation=t.aim.elevation)),t.cushionModel&&(this.cushionModel=t.cushionModel),void 0!==t.cueballId){var r=this.balls.find((function(e){return e.id===t.cueballId}));r&&(this.cueball=r)}}},{key:"shortSerialise",value:function(){return this.balls.map((function(t){return[t.pos.x,t.pos.y]})).reduce((function(t,e){return t.concat(e)}),[])}},{key:"updateFromShortSerialised",value:function(t){this.balls.forEach((function(e,r){e.pos.x=t[2*r],e.pos.y=t[2*r+1],e.pos.z=0,e.vel.copy(zero),e.rvel.copy(zero),e.state=ball_State.Stationary}))}},{key:"addToScene",value:function(t){this.balls.forEach((function(e){e.ballmesh.addToScene(t)})),t.add(this.cue.mesh),t.add(this.cue.helperGhostGroup),t.add(this.cue.placerMesh),t.add(this.cue.hitPointMesh),t.add(this.cue.virtualCueMesh)}},{key:"showTraces",value:function(t){this.balls.forEach((function(e){e.ballmesh.trace.line.visible=t,e.ballmesh.trace.reset()}))}},{key:"showSpin",value:function(t){this.balls.forEach((function(e){e.ballmesh.spinAxisArrow.visible=t}))}},{key:"showVirtualCue",value:function(t){this.cue.virtualCueMesh.visible=t}},{key:"halt",value:function(){this.balls.forEach((function(t){t.vel.copy(zero),t.rvel.copy(zero),t.state=ball_State.Stationary}))}},{key:"roundCueBallPosition",value:function(){var t=this.cueball.pos.clone();this.overlapsAny(t)||this.cueball.pos.copy(t)}},{key:"overlapsAny",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.cueball;return this.balls.filter((function(t){return t!==e})).some((function(e){return e.pos.distanceTo(t)<2*e.radius}))}}],[{key:"fromSerialised",value:function(e,r){var i=new t(e.balls.map((function(t){return Ball.fromSerialised(t,r)})),r);return i.updateFromSerialised(e),i}}]),t}();function _array_like_to_array(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function _array_with_holes(t){if(Array.isArray(t))return t}function _iterable_to_array_limit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,s,n=[],o=!0,a=!1;try{for(r=r.call(t);!(o=(i=r.next()).done)&&(n.push(i.value),!e||n.length!==e);o=!0);}catch(t){a=!0,s=t}finally{try{o||null==r.return||r.return()}finally{if(a)throw s}}return n}}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _sliced_to_array(t,e){return _array_with_holes(t)||_iterable_to_array_limit(t,e)||_unsupported_iterable_to_array(t,e)||_non_iterable_rest()}function _unsupported_iterable_to_array(t,e){if(t){if("string"==typeof t)return _array_like_to_array(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_array_like_to_array(t,e):void 0}}"undefined"==typeof window&&(globalThis.window={addEventListener:function(){},removeEventListener:function(){},requestAnimationFrame:function(t){return setTimeout(t,16)},cancelAnimationFrame:function(t){return clearTimeout(t)}}),"undefined"==typeof document&&(globalThis.document={createElement:function(){return{}},createElementNS:function(){return{}},addEventListener:function(){},removeEventListener:function(){},getElementById:function(){return null},querySelector:function(){return null},querySelectorAll:function(){return[]}}),"undefined"==typeof navigator&&(globalThis.navigator={userAgent:"Worker"});var greyRatio=.75,pitchFromElevation=function(t){return Math.PI/2-t};function rotateX(t,e){var r=Math.sin(e),i=Math.cos(e);return[t[0],i*t[1]-r*t[2],r*t[1]+i*t[2]]}function pushToWhiteArea(t,e){var r=_sliced_to_array(rotateX(t,e),3),i=r[0],s=r[1],n=r[2],o=1-greyRatio;if(.5*(s+1)>=o){var a=2*(o-.02)-1,h=Math.sin(e),l=Math.cos(e),c=l*a+h*n,u=-h*a+l*n,p=Math.sqrt(i*i+c*c+u*u)||1;return[i/p,c/p,u/p]}return t}function offsetToHitPoint(t){var e=-t.x,r=-t.y,i=e*e+r*r;if(i>=1){var s=Math.sqrt(i);e=e/s*.999,r=r/s*.999}return[e,r,Math.sqrt(Math.max(0,1-e*e-r*r))]}function hitPointToOffset(t){return{x:-t[0],y:-t[1]}}function isInWhiteArea(t,e){return.5*(_sliced_to_array(rotateX(t,e),2)[1]+1)<1-greyRatio}function buildOffsetsAroundWhiteCenter(t,e,r){for(var i=function(){var t=(d+.5)/c,e=Math.sqrt((1-t)*o*o+t*a*a),r=l*d,i=-e*Math.cos(r),s=-(h+e*Math.sin(r)),p=i*i+s*s;if(p>=1){var m=Math.sqrt(p)||1;i=i/m*.999,s=s/m*.999}if(isInWhiteArea([i,s,Math.sqrt(Math.max(0,1-i*i-s*s))],n)){var f={x:-i,y:-s};u.some((function(t){return Math.abs(t.x-f.x)<.001&&Math.abs(t.y-f.y)<.001}))||u.push(f)}d++},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,n=pitchFromElevation(t),o=Math.max(0,Math.min(1,e)),a=Math.max(o,Math.min(1,r)),h=Math.cos(n),l=Math.PI*(3-Math.sqrt(5)),c=Math.max(1,Math.floor(s)),u=[],p=40*c,d=0;u.length<c&&d<p;)i();for(var m=.02;u.length<c&&m<.15;){for(var f=function(t){var e=d+t,r=(e+.5)/c,i=Math.sqrt((1-r)*y*y+r*g*g),s=l*e,o=-i*Math.cos(s),a=-(h+i*Math.sin(s)),p=o*o+a*a;if(p>=1){var m=Math.sqrt(p)||1;o=o/m*.999,a=a/m*.999}if(isInWhiteArea([o,a,Math.sqrt(Math.max(0,1-o*o-a*a))],n)){var f={x:-o,y:-a};u.some((function(t){return Math.abs(t.x-f.x)<.001&&Math.abs(t.y-f.y)<.001}))||u.push(f)}},y=Math.max(0,o-m),g=Math.min(1,a+m),_=c-u.length,v=0;v<_;v++)f(v);d+=_,m+=.02}return u}function buildCandidates(t,e,r,i){for(var s=t.cue,n=function(){switch(e.searchDensity){case"low":return 16;case"high":return 36;default:return 24}}(),o=[],a=0;a<n;a++)o.push(2*a*Math.PI/n);var h=o.slice(8),l=function(t){return(t%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},c=t.cueball,u=t.balls.filter((function(t){return t!==c})),p=[];try{for(var d,m=Math.max(1e-6,null!==(d=null==c?void 0:c.radius)&&void 0!==d?d:.028),f=[.5,.2],y=0;y<Math.min(2,u.length);y++){var g=u[y];if(g){var _=g.pos.x-c.pos.x,v=g.pos.y-c.pos.y,x=Math.hypot(_,v),b=Math.max(m,g.radius||m),M=Math.atan2(v,_),w=!0,S=!1,A=void 0;try{for(var T,C=f[Symbol.iterator]();!(w=(T=C.next()).done);w=!0){var I=T.value,k=Math.asin(Math.min(.95,b*I/Math.max(1e-6,x)));(!isFinite(k)||k<=0)&&(k=.2===I?.12:.28),p.push(l(M-k),l(M+k))}}catch(t){S=!0,A=t}finally{try{w||null==C.return||C.return()}finally{if(S)throw A}}}}}catch(t){}var B=[],P=function(t){B.some((function(e){return Math.abs(Math.atan2(Math.sin(t-e),Math.cos(t-e)))<.001}))||B.push(t)};p.forEach(P),h.forEach(P);var z,R=[];if("number"==typeof r&&"number"==typeof i&&i>1)for(var V=0;V<B.length;V++)V%i===r&&R.push(B[V]);else R=B;if(!e.enabled)return{angles:R,offsets:[],elevations:[Math.max(0,null!==(z=s.defaultElevation)&&void 0!==z?z:.17)],powers:[.5*s.maxPower,.7*s.maxPower,.85*s.maxPower]};Math.PI,Math.PI,Math.PI,Math.PI,Math.PI,Math.PI,Math.PI;var E=[],F=function(t){var e=Math.max(0,Math.min(1,t));E.includes(e)||E.push(e)},O=e.minSpin,L=e.maxSpin;return F(O),F(.5*(O+L)),F(L),0===O&&F(0),{angles:R,offsets:[],elevations:[.5*(e.minElevation+e.maxElevation)],powers:[.5*(Math.max(0,Math.min(1,e.minPowerPct))*s.maxPower+Math.max(0,Math.min(1,e.maxPowerPct))*s.maxPower)]}}function scoreShot(t,e,r){return 1e3-(300*Math.hypot(t.offset.x,t.offset.y)+180*t.elevation/Math.PI*2+.002*t.power+(e?500:0)+60*(r?.1:.9))}function simulateThreeCushion(t,e,r){try{var i=t.balls.find((function(t){return t.id===e}));if(!i)return{success:!1,hadKiss:!1,firstBall:!1};t.cueball=i,t.cue.aim.i=t.balls.indexOf(i);var s={angle:r.angle,offset:new three_core_Vector3(r.offset.x,r.offset.y,0),power:r.power},n=makeShotPoseFromAim(i,s,r.elevation);applyShotFromPose(i,n);for(var o=0,a=0,h=0,l=new Set,c=new Map,u=0,p=!1,d="none",m=t.balls.filter((function(t){return t!==i})),f=new Set(m.map((function(t){return t.id}))),y=new Map,g=!1;o<12;){t.advance(ENGINE_DT),o+=ENGINE_DT;var _=t.outcome.slice(a);a=t.outcome.length;var v=!0,x=!1,b=void 0;try{for(var M,w=_[Symbol.iterator]();!(v=(M=w.next()).done);v=!0){var S=M.value;if(S.type===OutcomeType.Cushion)S.ballA===i&&("none"===d&&(d="cushion"),h++);else if(S.type===OutcomeType.Collision){var A=S.ballA,T=S.ballB,C=A===i;if(C||T===i){"none"===d&&(d="ball");var I=C?T:A;if(I&&I!==i){var k,B=I.id;l.add(B),u++;var P=null!==(k=c.get(B))&&void 0!==k?k:0;if(c.set(B,P+1),(P+1>1||u>2)&&(p=!0),y.has(B)?l.size<2&&(p=!0):y.set(B,o),l.size>=2)return{success:h>=3,hadKiss:p||g,firstBall:"ball"===d}}}else A&&T&&f.has(A.id)&&f.has(T.id)&&1===y.size&&(g=!0)}}}catch(t){x=!0,b=t}finally{try{v||null==w.return||w.return()}finally{if(x)throw b}}if(t.allStationary())break}return{success:!1,hadKiss:p,firstBall:"ball"===d}}catch(t){return{success:!1,hadKiss:!1}}finally{try{t&&Array.isArray(t.balls)&&t.balls.forEach((function(t){try{t.ballmesh&&t.ballmesh.dispose&&t.ballmesh.dispose()}catch(t){}}))}catch(t){}try{var z=t.cue,R=function(t){try{t&&t.geometry&&t.geometry.dispose&&t.geometry.dispose()}catch(t){}};R(null==z?void 0:z.mesh),R(null==z?void 0:z.placerMesh),R(null==z?void 0:z.hitPointMesh),R(null==z?void 0:z.virtualCueMesh)}catch(t){}try{t.outcome=[]}catch(t){}}}function findBest(t,e,r,i,s,n,o){"threecushion"===e&&TableGeometry.setCaromDimensions(CAROM_TABLE_LENGTH,CAROM_TABLE_WIDTH,CAROM_BALL_RADIUS);var a,h=Table.fromSerialised(t,{headless:!0});if(t.cue&&("number"==typeof t.cue.maxPower&&(h.cue.maxPower=t.cue.maxPower),"number"==typeof t.cue.defaultElevation&&(h.cue.defaultElevation=t.cue.defaultElevation)),"number"==typeof s){if(!(a=h.balls.find((function(t){return t.id===s}))))return null}else{var l="number"==typeof i&&i>=0?i:h.balls.indexOf(h.cueball);if(l<0||l>=h.balls.length)return null;a=h.balls[l]}h.cueball=a;var c=buildCandidates(h,r,n,o),u=c.angles,p=(c.offsets,c.elevations),d=c.powers,m=null,f=null,y=null,g=!r.avoidKissStrict,_=a.id,v=!0,x=!1,b=void 0,M=!0,w=!1,S=void 0;try{for(var A,T=u[Symbol.iterator]();!(M=(A=T.next()).done);M=!0){var C=A.value;try{for(var I,k=p[Symbol.iterator]();!(v=(I=k.next()).done);v=!0){var B=I.value,P=function(){switch(r.searchDensity){case"low":return 24;case"high":return 96;default:return 48}}(),z=_sliced_to_array(r.enabled?[r.minSpin,r.maxSpin]:[0,.22],2),R=buildOffsetsAroundWhiteCenter(B,z[0],z[1],P),V=!0,E=!1,F=void 0,O=!0,L=!1,G=void 0;try{for(var D,N=R[Symbol.iterator]();!(O=(D=N.next()).done);O=!0){var U=D.value;try{for(var j,$=d[Symbol.iterator]();!(V=(j=$.next()).done);V=!0){var W=j.value,H=simulateThreeCushion(Table.fromSerialised(t,{headless:!0}),_,{angle:C,offset:U,elevation:B,power:W});if(H.success){var q=scoreShot({angle:C,offset:U,elevation:B,power:W},H.hadKiss,H.firstBall),X={angle:C,offset:U,elevation:B,power:W,score:q,hadKiss:H.hadKiss};if(H.hadKiss){if(!g)continue;(!f||q>f.score)&&(f=X)}else if((!m||q>m.score)&&(m=X).score>980)return m}else{var Y=scoreShot({angle:C,offset:U,elevation:B,power:W},H.hadKiss,H.firstBall);(!y||Y>y.score)&&(y={angle:C,offset:U,elevation:B,power:W,score:Y})}}}catch(t){E=!0,F=t}finally{try{V||null==$.return||$.return()}finally{if(E)throw F}}}}catch(t){L=!0,G=t}finally{try{O||null==N.return||N.return()}finally{if(L)throw G}}}}catch(t){x=!0,b=t}finally{try{v||null==k.return||k.return()}finally{if(x)throw b}}}}catch(t){w=!0,S=t}finally{try{M||null==T.return||T.return()}finally{if(w)throw S}}try{var J;return null!==(J=null!=m?m:f)&&void 0!==J?J:y}finally{try{h&&Array.isArray(h.balls)&&h.balls.forEach((function(t){try{t.ballmesh&&t.ballmesh.dispose&&t.ballmesh.dispose()}catch(t){}}))}catch(t){}try{var Z=h.cue,K=function(t){try{t&&t.geometry&&t.geometry.dispose&&t.geometry.dispose()}catch(t){}};K(null==Z?void 0:Z.mesh),K(null==Z?void 0:Z.placerMesh),K(null==Z?void 0:Z.hitPointMesh),K(null==Z?void 0:Z.virtualCueMesh)}catch(t){}try{h.outcome=[]}catch(t){}}}self.onmessage=function(t){var e=t.data||{};if("compute"===e.type)try{var r="number"==typeof e.cueIndex?e.cueIndex:void 0,i="number"==typeof e.cueBallId?e.cueBallId:void 0,s="number"==typeof e.sliceIndex?e.sliceIndex:void 0,n="number"==typeof e.sliceCount?e.sliceCount:void 0,o=findBest(e.table,e.rulesName,e.config,r,i,s,n);self.postMessage({type:"result",best:o})}catch(t){self.postMessage({type:"result",best:null})}}})();