"use strict";(self.webpackChunkbilliards=self.webpackChunkbilliards||[]).push([[893],{12:(t,e,n)=>{n.d(e,{Dz:()=>f,F8:()=>m,FP:()=>y,KM:()=>l,RZ:()=>b,gn:()=>w,ld:()=>p,n7:()=>g,oN:()=>M,rq:()=>v,t6:()=>a,up:()=>r,v_:()=>o,xb:()=>c});var i=n(4922),o=new i.Pq0(0,0,0),r=new i.Pq0(0,0,1);function a(t){return new i.Pq0(t.x,t.y,t.z)}var s=new i.Pq0;function l(t){return s.copy(r).cross(t)}var u=new i.Pq0;function c(t){return u.copy(t).normalize()}var h=new i.Pq0;function v(t,e){return h.copy(t).add(e).dot(t)<=0}function f(t){return new i.Pq0(1,0,0).applyAxisAngle(r,t)}function d(t){return Math.sign(t)*Math.floor(1e4*(Math.abs(t)+Number.EPSILON))/1e4}function p(t){return t.x=d(t.x),t.y=d(t.y),t.z=d(t.z),t}function y(t,e){return Math.fround(Math.atan2(t,e))}function g(t,e){return Math.fround(Math.pow(t,e))}function m(t){return Math.sin(t)}function w(t){return Math.cos(t)}function b(t){return Math.sqrt(t)}function M(t){return Math.exp(t)}},3894:(t,e,n)=>{n.d(e,{F:()=>d});var i=n(8660),o=n(4922),r=n(5418),a=n(12);function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"normalImpulse",void 0),l(this,"tangentialImpulse",void 0)}var e,n;return e=t,(n=[{key:"dynamicFriction",value:function(t){return.01+.108*(0,a.oN)(-1.088*t)}},{key:"updateVelocities",value:function(t,e){var n=d.positionsAtContact(t,e);t.ballmesh.trace.forceTrace(n.a),e.ballmesh.trace.forceTrace(n.b);var i=n.b.sub(n.a).normalize(),a=new o.Pq0(-i.y,i.x,0),s=t.vel.clone().sub(e.vel).add(i.clone().multiplyScalar(-r.R).cross(t.rvel).sub(i.clone().multiplyScalar(r.R).cross(e.rvel))),l=i.dot(s),u=s.addScaledVector(i,-l),c=u.length(),h=a.dot(u),v=this.dynamicFriction(c);this.normalImpulse=-1.99*l/(2/r.m),this.tangentialImpulse=.25*Math.min(v*Math.abs(this.normalImpulse)/c,1/7)*-h;var f=i.clone().multiplyScalar(this.normalImpulse),p=a.clone().multiplyScalar(this.tangentialImpulse);t.vel.addScaledVector(f,1/r.m).addScaledVector(p,1/r.m),e.vel.addScaledVector(f,-1/r.m).addScaledVector(p,-1/r.m);var y=i.clone().multiplyScalar(-r.R).cross(p),g=i.clone().multiplyScalar(r.R).cross(p);return t.rvel.addScaledVector(y,1/r.I),e.rvel.addScaledVector(g,1/r.I),l}}])&&s(e.prototype,n),t}();function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var h,v,f,d=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"willCollide",value:function(t,e,n,i){if(!t.onTable()||!e.onTable())return!1;if(!t.inMotion()&&!e.inMotion())return!1;var o,a=null!==(o=null==i?void 0:i.R)&&void 0!==o?o:r.R,s=function(t,e,n,i){var o,a=null!==(o=null==i?void 0:i.R)&&void 0!==o?o:r.R,s=t.pos.clone().sub(e.pos),l=t.vel.clone().sub(e.vel),u=2*a,c=l.dot(l),h=2*s.dot(l),v=s.dot(s)-u*u;if(c<=1e-12)return-1;var f=h*h-4*c*v;if(f<0)return-1;var d=Math.sqrt(f),p=(-h-d)/(2*c),y=(-h+d)/(2*c),g=Number.POSITIVE_INFINITY;return p>=0&&p<=n&&(g=Math.min(g,p)),y>=0&&y<=n&&(g=Math.min(g,y)),isFinite(g)?g:-1}(t,e,n,i);return s>=0||t.futurePosition(n).distanceToSquared(e.futurePosition(n))<4*a*a}},{key:"collide",value:function(e,n){return t.updateVelocities(e,n)}},{key:"positionsAtContact",value:function(t,e){var n=t.pos.distanceTo(e.pos),i=t.vel.clone().sub(e.vel),o=(n-2*r.R)/i.length()||0;return{a:t.pos.clone().addScaledVector(t.vel,o),b:e.pos.clone().addScaledVector(e.vel,o)}}},{key:"updateVelocities",value:function(e,n){var o=t.model.updateVelocities(e,n);return e.state=i.U.Sliding,n.state=i.U.Sliding,o}}],null&&c(e.prototype,null),n&&c(e,n),t}();h=d,v="model",f=new u,v in h?Object.defineProperty(h,v,{value:f,enumerable:!0,configurable:!0,writable:!0}):h[v]=f},4057:(t,e,n)=>{var i=.1406,o=.02625,r=n(4841);function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e,n){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n||t):o.value}},l(t,e,n||t)}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}function h(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(h=function(){return!!t})()}var v=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),s(t=function(t,e,n){return e=u(e),function(t,e){return!e||"object"!=((n=e)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e;var n}(t,h()?Reflect.construct(e,n||[],u(t).constructor):e.apply(t,n))}(this,e,arguments),"h",[]),s(t,"extractValues",(function(e){return t.h.map(e).map((function(t){return null!=t?t:0}))})),t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,t),n=e,i=[{key:"updateSingleStep",value:function(t){l(u(e.prototype),"updateSingleStep",this).call(this,t),this.h.push(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){s(t,e,n[e])}))}return t}({},this))}}],i&&a(n.prototype,i),e}(r.z),f={responsive:!0,showLink:!0,plotlyServerURL:"https://chart-studio.plotly.com"},d={legend:{font:{color:"#4D5663"},bgcolor:"#e5e6F9"},title:{text:"",font:{size:11}},xaxis:{title:"impulse",tickfont:{color:"#4D5663"},gridcolor:"#E1E5ED",titlefont:{color:"#4D5663"},zerolinecolor:"#E1E5ED"},yaxis:{title:"value",tickfont:{color:"#4D5663"},zeroline:!1,gridcolor:"#E1E5ED",titlefont:{color:"#4D5663"},zerolinecolor:"#E1E5ED"},plot_bgcolor:"#F5F6F9",paper_bgcolor:"#F2F6F9"};function p(t){return"hsl(".concat(137.5*t%360,", ").concat(70,"%, ").concat(50,"%)")}function y(t,e,n,i){return{x:t,y:e,name:n,line:{color:i,width:1.3},mode:"lines",type:"scatter"}}function g(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var m=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"plot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*t/o,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5*t/o,a=new v(i,o,.98,.212,.14);try{a.solvePaper(t,e,n,r)}catch(t){console.error(t)}var s=a.extractValues,l=s((function(t){return t.P}));d.title.text="<b>Figure.12</b> Slip–impulse curves \nfor V0 = 2 m/s, α = 45◦,ωS0 = 2V0/R, and ωT0 = 1.5V0/R \n<br>(s and φ are for the slip at the cushion, \nand sʹ and φʹ are for the slip at the table)",window.Plotly.newPlot("mathaven-impulse",[y(l,s((function(t){return t.s})),"s",p(0)),y(l,s((function(t){return t.φ})),"φ",p(1)),y(l,s((function(t){return t.sʹ})),"s'",p(2)),y(l,s((function(t){return t.φʹ})),"φʹ",p(3)),y(l,s((function(t){return t.WzI})),"WzI",p(4)),y(l,s((function(t){return t.P})),"P",p(5))],d,f)}}],n&&g(e.prototype,n),t}();function w(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var b=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"getFinalState",value:function(t,e,n,a){try{var s=new r.z(i,o,.98,.212,.14);s.solvePaper(t,e,n,a);var l=s.vy,u=s.vx;return{beta:Math.atan2(-l,u)*(180/Math.PI),speed:Math.sqrt(u*u+l*l)}}catch(t){return console.error(t),{beta:NaN,speed:NaN}}}},{key:"plot",value:function(t,e,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){return 0},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(t){return t/o},a=[],s=[],l=[],u=-1;u<=2;u++){var c=[],h=[];l=[];for(var v=1;v<90;v+=9){l.push(v);var g=this.getFinalState(1,v*(Math.PI/180),i(u),r(u));c.push(g.speed),h.push(g.beta)}a.push(c),s.push(h)}var m=l;d.title.text=n,window.Plotly.newPlot(t,[y(m,a[0],"k=-1",p(0)),y(m,a[1],"k=0",p(1)),y(m,a[2],"k=1",p(2)),y(m,a[3],"k=2",p(3))],d,f),window.Plotly.newPlot(e,[y(m,s[0],"k=-1",p(0)),y(m,s[1],"k=0",p(1)),y(m,s[2],"k=1",p(2)),y(m,s[3],"k=2",p(3))],d,f)}}],n&&w(e.prototype,n),t}(),M=n(4922),P=n(8660),x=n(12),k=n(3894);function S(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function R(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var F=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),R(this,"log",void 0),this.log=e}var e,n;return e=t,(n=[{key:"dynamicFriction",value:function(e){return t.a+t.b*Math.exp(-t.c*e)}},{key:"relativeVelocity",value:function(e,n,i,o){return Math.sqrt(Math.pow(e*Math.sin(o)-i*t.R,2)+Math.pow(Math.cos(o)*n*t.R,2))}},{key:"throwAngle",value:function(e,n,i,o){var r=this.relativeVelocity(e,n,i,o),a=this.dynamicFriction(r),s=Math.min(a*e*Math.cos(o)/r,1/7)*(e*Math.sin(o)-t.R*i),l=e*Math.cos(o);return Math.atan2(s,l)}},{key:"plot",value:function(e,n,i,o){var r=new P.c(x.v_);r.vel.copy(new M.Pq0(0,e,0)),r.rvel.copy(new M.Pq0(n,0,i));var a=new M.Pq0(0,2*t.R).applyAxisAngle(x.up,o),s=new P.c(a);return k.F.model.updateVelocities(r,s),Math.atan2(k.F.model.tangentialImpulse,-k.F.model.normalImpulse)}}])&&S(e.prototype,n),t}();function z(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function A(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){A(t,e,n[e])}))}return t}R(F,"R",.029),R(F,"a",.01),R(F,"b",.108),R(F,"c",1.088);var I=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"degToRad",value:function(t){return t*(Math.PI/180)}},{key:"radToDeg",value:function(t){return t*(180/Math.PI)}},{key:"plotCutAngle",value:function(){var t=F.R;this.plot("collision-throw-roll",[.447,1.341,3.129],(function(e){return e/t})),this.plot("collision-throw-stun",[.447,1.341,3.129],(function(t){return 0})),this.plotRolls("collision-throw-varying-roll",[0,.25,.5,1],(function(e){return e/t}),(function(t){return 0}),(function(t){return t})),this.plotRolls("collision-throw-varying-side",[0,.25,.5,1],(function(e){return e/t}),(function(e){return 1/t*(e-45)/45}),(function(t){return 0})),new F((function(){})).plot(.5,-15,-10,Math.PI/8)}},{key:"plot",value:function(t,e,n){var i=this,o=[],r=[];e.forEach((function(t){var e=[];r=[];for(var a=1;a<90;a+=1){r.push(a);var s=(new F).plot(t,n(t),0,i.degToRad(a));e.push(i.radToDeg(s))}o.push(e)}));var a=O({},d);a.title.text="Throw effect (WIP)\n    <br>throw vs. cut angle for various-speed ".concat(t," shots\n    <br>from https://billiards.colostate.edu/technical_proofs/new/TP_A-14.pdf"),window.Plotly.newPlot(t,[y(r,o[0],"slow",p(4)),y(r,o[1],"medium",p(5)),y(r,o[2],"fast",p(6))],a,f)}},{key:"plotRolls",value:function(t,e,n,i,o){var r=this,a=[],s=[];e.forEach((function(t){var e=[];s=[];for(var l=1;l<90;l+=1){s.push(l);var u=(new F).plot(1,n(t),i(l),r.degToRad(o(l)));e.push(r.radToDeg(u))}a.push(e)}));var l=O({},d);l.title.text="Throw effect (WIP)\n    <br>throw vs. cut angle for various-speed ".concat(t," shots\n    <br>from https://billiards.colostate.edu/technical_proofs/new/TP_A-14.pdf"),window.Plotly.newPlot(t,[y(s,a[0],"0",p(4)),y(s,a[1],"0.25",p(5)),y(s,a[2],"0.5",p(6)),y(s,a[3],"1.0",p(7))],l,f)}}],n&&z(e.prototype,n),t}();(new m).plot(),(new b).plot("mathaven-figure9-speed","mathaven-figure9-angle","<b>Figure.9</b> Rebound speed and rebound angle versus incident angle <br>\n    for different topspins of the ball, ωT0 = kV0/R and V0 = 1 m/s with no sidespin"),(new b).plot("mathaven-figure10-speed","mathaven-figure10-angle","<b>Figure.10</b> Rebound speed and rebound angle versus incident angle <br>\nfor different sidespins of the ball,ωS0 = kV0/R and V0 = 1 m/s with the ball rolling (ωT0 = V0/R)",(function(t){return t/o}),(function(t){return 1/o})),(new I).plotCutAngle()},4841:(t,e,n)=>{n.d(e,{z:()=>s});var i=n(12),o=n(5418);function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s=function(){function t(e,n,i,o,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,"P",0),a(this,"WzI",0),a(this,"vx",void 0),a(this,"vy",void 0),a(this,"ωx",void 0),a(this,"ωy",void 0),a(this,"ωz",void 0),a(this,"s",void 0),a(this,"φ",void 0),a(this,"sʹ",void 0),a(this,"φʹ",void 0),a(this,"i",0),a(this,"N",100),a(this,"M",void 0),a(this,"R",void 0),a(this,"μs",void 0),a(this,"μw",void 0),a(this,"ee",void 0),this.M=e,this.R=n,this.ee=i,this.μs=o,this.μw=r}var e,n;return e=t,(n=[{key:"updateSlipSpeedsAndAngles",value:function(){var t=this.R,e=this.vx+this.ωy*t*o.Z3-this.ωz*t*o.o5,n=-this.vy*o.Z3+this.ωx*t,r=this.vx-this.ωy*t,a=this.vy+this.ωx*t;this.s=(0,i.RZ)((0,i.n7)(e,2)+(0,i.n7)(n,2)),this.φ=(0,i.FP)(n,e),this.φ<0&&(this.φ+=2*Math.PI),this.sʹ=(0,i.RZ)((0,i.n7)(r,2)+(0,i.n7)(a,2)),this.φʹ=(0,i.FP)(a,r),this.φʹ<0&&(this.φʹ+=2*Math.PI)}},{key:"compressionPhase",value:function(){for(var t=Math.max(this.M*this.vy/this.N,.001);this.vy>0;)this.updateSingleStep(t)}},{key:"restitutionPhase",value:function(t){var e=Math.max(t/this.N,.001);for(this.WzI=0;this.WzI<t;)this.updateSingleStep(e)}},{key:"updateSingleStep",value:function(t){if(this.updateSlipSpeedsAndAngles(),this.updateVelocity(t),this.updateAngularVelocity(t),this.updateWorkDone(t),this.i++>10*this.N)throw new Error("Solution not found")}},{key:"updateVelocity",value:function(t){var e=this.μs,n=this.μw,r=this.M;this.vx-=1/r*(n*(0,i.gn)(this.φ)+e*(0,i.gn)(this.φʹ)*(o.Z3+n*(0,i.F8)(this.φ)*o.o5))*t,this.vy-=1/r*(o.o5-n*o.Z3*(0,i.F8)(this.φ)+e*(0,i.F8)(this.φʹ)*(o.Z3+n*(0,i.F8)(this.φ)*o.o5))*t}},{key:"updateAngularVelocity",value:function(t){var e=this.μs,n=this.μw,r=this.M,a=this.R;this.ωx+=-5/(2*r*a)*(n*(0,i.F8)(this.φ)+e*(0,i.F8)(this.φʹ)*(o.Z3+n*(0,i.F8)(this.φ)*o.o5))*t,this.ωy+=-5/(2*r*a)*(n*(0,i.gn)(this.φ)*o.Z3-e*(0,i.gn)(this.φʹ)*(o.Z3+n*(0,i.F8)(this.φ)*o.o5))*t,this.ωz+=5/(2*r*a)*(n*(0,i.gn)(this.φ)*o.o5)*t}},{key:"updateWorkDone",value:function(t){var e=t*Math.abs(this.vy);this.WzI+=e,this.P+=t}},{key:"solvePaper",value:function(t,e,n,o){this.solve(t*(0,i.gn)(e),t*(0,i.F8)(e),-o*(0,i.F8)(e),o*(0,i.gn)(e),n)}},{key:"solve",value:function(t,e,n,i,o){this.vx=t,this.vy=e,this.ωx=n,this.ωy=i,this.ωz=o,this.WzI=0,this.P=0,this.i=0,this.compressionPhase();var r=this.ee*this.ee*this.WzI;this.restitutionPhase(r)}}])&&r(e.prototype,n),t}()},5418:(t,e,n)=>{n.d(e,{$0:()=>j,BY:()=>S,I:()=>r,JU:()=>Z,Mz:()=>i,Nv:()=>p,PK:()=>g,PX:()=>_,Q$:()=>V,Qg:()=>D,R:()=>z,Wv:()=>T,XF:()=>P,XM:()=>M,Ys:()=>C,Z3:()=>w,ZZ:()=>F,_m:()=>d,cM:()=>q,dM:()=>y,e:()=>h,ee:()=>v,g:()=>a,g8:()=>K,gT:()=>u,gf:()=>l,jG:()=>O,kL:()=>c,kM:()=>N,ki:()=>B,ko:()=>E,lt:()=>L,m:()=>A,mu:()=>s,o5:()=>b,oV:()=>f,oo:()=>k,vF:()=>W,wK:()=>R,x3:()=>o,xO:()=>m});var i,o,r,a=9.8,s=.00985,l=.16,u=.85,c=.034,h=.86,v=.98,f=.212,d=.14,p=.006,y=.35,g=3,m=.4,w=.4,b=Math.sqrt(21)/5,M=2.84,P=1.42,x=.028575,k=.03075,S={R:x,m:.17},R={R:.02625,m:.142},F={R:k,m:.21},z=x,A=.17;function O(t){z=t,null==I||I()}function I(){i=s*A*a*2/3*c,o=7/(5*Math.sqrt(2))*z*s*A*a,r=.4*A*z*z}function j(t){return{Mz:s*t.m*a*2/3*c,Mxy:7/(5*Math.sqrt(2))*t.R*s*t.m*a,I:.4*t.m*t.R*t.R}}function D(t){A=t,null==I||I()}function V(t){s=t,I()}function T(t){c=t,I()}function C(t){l=t}function q(t){h=t}function N(t){u=t}function E(t){f=t}function B(t){d=t}function _(t){v=t}function Z(t){p=t}function L(t){y=t}function W(t){g=t}function K(t){m=t}I()},7924:(t,e,n)=>{n.d(e,{J:()=>d,h:()=>f});var i=n(4922),o=n(8660),r=n(12),a=n(5418);function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"line",void 0),l(this,"geometry",void 0),l(this,"positions",void 0),l(this,"lastPos",new i.Pq0),l(this,"lastVel",new i.Pq0),this.geometry=new i.LoY,this.positions=new Float32Array(3*e),this.geometry.setAttribute("position",new i.THS(this.positions,3)),this.reset();var o=new i.mrM({color:n,opacity:.25,linewidth:3,transparent:!0});this.line=new i.N1A(this.geometry,o),this.line.visible=!1}var e,n;return e=t,(n=[{key:"reset",value:function(){this.geometry.setDrawRange(0,0),this.lastVel.setZ(1)}},{key:"forceTrace",value:function(t){this.lastVel.z=1,this.addTraceGiven(t,this.lastVel,1,.1,1)}},{key:"addTrace",value:function(t,e){if(this.line.visible&&0!==e.length()){var n=this.lastVel.angleTo(e),i=n>Math.PI/32?.01*a.R:a.R,o=this.lastPos.distanceTo(t);this.addTraceGiven(t,e,o,i,n)}}},{key:"addTraceGiven",value:function(t,e,n,i,o){var r=this.geometry.drawRange.count;0!==r&&n<i||(r>1&&o<1e-4&&r--,this.lastPos.copy(t),this.lastVel.copy(e),this.addPoint(t,r))}},{key:"addPoint",value:function(t,e){var n=3*e;n>this.positions.length||(this.positions[n++]=t.x,this.positions[n++]=t.y,this.positions[n]=t.z,this.geometry.setDrawRange(0,e+1),this.line.geometry.attributes.position.needsUpdate=!0)}}])&&s(e.prototype,n),t}();function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){h(t,e,n[e])}))}return t}var f={orbitAngleDeg:83,elevationDeg:39,distanceInDiameters:11.5,intensity:2.3,decay:.6,coneDeg:33,color:"#f5f8ff",shadowBias:-45e-5,shadowNormalBias:0,shadowBlur:1e3,shadowMapSize:2048,shadowBlurSamples:18,shadowNear:10,shadowFar:12,castShadow:!0},d=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.R;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,"mesh",void 0),h(this,"spinAxisArrow",void 0),h(this,"trace",void 0),h(this,"color",void 0),h(this,"radius",void 0),h(this,"material",void 0),this.color=new i.Q1f(e),this.radius=n,this.material=t.createBallMaterial(this.color),this.mesh=this.createBallMesh(),this.spinAxisArrow=new i.E0M(r.up,r.v_,2,0,.01,.01),this.spinAxisArrow.visible=!1,this.trace=new u(500,e),t.instances.add(this)}var e,n,s;return e=t,n=[{key:"updateAll",value:function(t,e){this.updatePosition(t.pos),this.updateArrows(t.pos,t.rvel,t.state),0!==t.rvel.lengthSq()&&(this.updateRotation(t.rvel,e),this.trace.addTrace(t.pos,t.vel))}},{key:"updatePosition",value:function(t){this.mesh.position.copy(t)}},{key:"updateRotation",value:function(t,e){var n=t.length()*e;0!==n&&this.mesh.rotateOnWorldAxis((0,r.xb)(t),n)}},{key:"updateArrows",value:function(t,e,n){this.spinAxisArrow.visible&&(this.spinAxisArrow.setLength(this.radius+this.radius*e.length()/2,this.radius,this.radius),this.spinAxisArrow.position.copy(t),this.spinAxisArrow.setDirection((0,r.xb)(e)),n===o.U.Rolling?this.spinAxisArrow.setColor(13369344):this.spinAxisArrow.setColor(52224))}},{key:"addToScene",value:function(t){t.add(this.mesh),t.add(this.spinAxisArrow),t.add(this.trace.line)}},{key:"removeFromScene",value:function(t){t.remove(this.mesh),t.remove(this.spinAxisArrow),t.remove(this.trace.line)}},{key:"updateRadius",value:function(t){this.radius!==t&&(this.radius=t,this.mesh.geometry.dispose(),this.mesh.geometry=new i.Gu$(this.radius,64,48))}},{key:"dispose",value:function(){this.mesh.geometry.dispose(),this.material.dispose(),this.trace.dispose(),t.instances.delete(this)}},{key:"createBallMesh",value:function(){var t=new i.Gu$(this.radius,64,48),e=new i.eaF(t,this.material);return e.name="ball",e.castShadow=!0,e.receiveShadow=!0,e.renderOrder=1,e}}],s=[{key:"getLightingConfig",value:function(){return v({},t.lightingConfig)}},{key:"updateLightingConfig",value:function(e){var n,o,r,a,s,l,u,c,h,d,p,y,g,m,w,b,M=v({},t.lightingConfig,e);t.lightingConfig=(n=M,r=Number.isFinite(n.orbitAngleDeg)?n.orbitAngleDeg:f.orbitAngleDeg,a=Number.isFinite(n.elevationDeg)?n.elevationDeg:f.elevationDeg,s=Number.isFinite(n.distanceInDiameters)?n.distanceInDiameters:f.distanceInDiameters,l=Number.isFinite(n.intensity)?n.intensity:f.intensity,u=Number.isFinite(n.decay)?n.decay:f.decay,c=Number.isFinite(n.coneDeg)?n.coneDeg:f.coneDeg,h=Number.isFinite(n.shadowBias)?n.shadowBias:f.shadowBias,d=Number.isFinite(n.shadowNormalBias)?n.shadowNormalBias:f.shadowNormalBias,p=Number.isFinite(n.shadowBlur)?n.shadowBlur:f.shadowBlur,y=Number.isFinite(n.shadowMapSize)&&n.shadowMapSize>0?n.shadowMapSize:f.shadowMapSize,g=Number.isFinite(n.shadowBlurSamples)?n.shadowBlurSamples:f.shadowBlurSamples,m=Number.isFinite(n.shadowNear)&&n.shadowNear>0?n.shadowNear:f.shadowNear,w=Number.isFinite(n.shadowFar)?n.shadowFar:f.shadowFar,b=Math.pow(2,Math.round(i.cj9.clamp(Math.log2(y),8,12))),{orbitAngleDeg:i.cj9.euclideanModulo(r,360),elevationDeg:i.cj9.clamp(a,-80,85),distanceInDiameters:Math.max(.01,s),intensity:Math.max(0,l),decay:Math.max(0,u),coneDeg:i.cj9.clamp(c,5,90),color:null!==(o=n.color)&&void 0!==o?o:f.color,shadowBias:h,shadowNormalBias:Math.max(0,d),shadowBlur:i.cj9.clamp(p,0,1e3),shadowMapSize:b,shadowBlurSamples:Math.round(i.cj9.clamp(g,1,32)),shadowNear:Math.max(.1,m),shadowFar:Math.max(Math.max(.1,m)+.1,w),castShadow:Boolean(n.castShadow)});var P=t.getLightingConfig();t.lightingListeners.forEach((function(t){return t(P)}))}},{key:"onLightingConfigChanged",value:function(e){return t.lightingListeners.add(e),e(t.getLightingConfig()),function(){t.lightingListeners.delete(e)}}},{key:"createBallMaterial",value:function(t){var e=new i.uSd({color:t.clone(),roughness:.45,metalness:.25,clearcoat:.6,clearcoatRoughness:.15,reflectivity:.45});return e.needsUpdate=!0,e}}],n&&c(e.prototype,n),s&&c(e,s),t}();h(d,"instances",new Set),h(d,"lightingConfig",v({},f)),h(d,"lightingListeners",new Set)},8090:(t,e,n)=>{n.d(e,{$8:()=>E,Gp:()=>D,Iy:()=>k,JD:()=>b,Mq:()=>g,QK:()=>S,QV:()=>N,Qy:()=>Z,Un:()=>j,c0:()=>I,lx:()=>M,p2:()=>w,s0:()=>O,t6:()=>L,yO:()=>V});var i=n(4922),o=n(12),r=n(5418),a=n(4841),s=.02,l=.5,u=1,c=0,h=-.05,v=0,f=.06,d=.5;function p(t,e,n){return Math.max(e,Math.min(n,t))}var y=new i.Pq0;function g(t,e,n){var i,a=null!==(i=null==n?void 0:n.R)&&void 0!==i?i:r.R;return y.copy(t).addScaledVector((0,o.KM)(e),a)}var m={v:new i.Pq0,w:new i.Pq0};function w(t,e,n){var i,a,s=null!==(i=null==n?void 0:n.R)&&void 0!==i?i:r.R,l=null!==(a=null==n?void 0:n.m)&&void 0!==a?a:r.m,u=n?(0,r.$0)(n):{Mz:r.Mz,Mxy:r.x3,I:r.I},c=function(t,e,n){return g(t,e,n).setZ(0)}(t,e,n);return m.v.copy((0,o.xb)(c).multiplyScalar(-r.gf*r.g)),m.w.copy((0,o.xb)((0,o.KM)(c)).multiplyScalar(2.5*r.gf*r.g/s)),m.w.setZ(u.Mz/(l*s*s)*-2.5*Math.sign(e.z)),m}function b(t,e){var n,o,a=null!==(n=null==e?void 0:e.R)&&void 0!==n?n:r.R,s=null!==(o=null==e?void 0:e.m)&&void 0!==o?o:r.m,l=e?(0,r.$0)(e):{Mz:r.Mz,Mxy:r.x3,I:r.I},u=new i.Pq0(t.x,t.y,0).length(),c=5/7*l.Mxy/(s*a)/u,h=5/7*l.Mxy/(s*a*a)/u;return m.v.set(-c*t.y,c*t.x,0),m.w.set(-h*t.x,-h*t.y,l.Mz/(s*a*a)*-2.5*Math.sign(t.z)),m}function M(t,e,n){var i,a=null!==(i=null==n?void 0:n.R)&&void 0!==i?i:r.R,s=e.z;e.copy((0,o.KM)(t).multiplyScalar(1/a)),e.setZ(s)}Object.freeze(m);var P=new i.Pq0,x=new i.Pq0;function k(t,e){var n,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,l=t.length(),u=null!==(n=null==s?void 0:s.m)&&void 0!==n?n:r.m,c=null!==(i=null==s?void 0:s.R)&&void 0!==i?i:r.R;if(l<.1)return P.set(0,0,0);if(e.length()<.1)return P.set(0,0,0);var h=a>.015*c,v=Math.pow(Math.sin(o),1),f=r.Nv*v;f*=h?r.PK:r.xO,x.crossVectors(e,t);var d=x.length();if(d<.01)return P.set(0,0,0);var p=f*d/u;return P.copy(x).normalize().multiplyScalar(p),P}function S(t,e,n,i){var r=i(e.clone().applyAxisAngle(o.up,t),n.clone().applyAxisAngle(o.up,t));return r.v.applyAxisAngle(o.up,-t),r.w.applyAxisAngle(o.up,-t),r}var R=.1*r.R,F=Math.asin(R/r.R),z=(0,o.F8)(F),A=(0,o.gn)(F);function O(t,e){return new i.Pq0(t.x*z-t.z*A+r.R*e.y,-t.y-r.R*e.z*A+r.R*e.x*z)}function I(t){return t.x*A}function j(t){var e=3.5/r.m;return t.length()/e}function D(t){var e,n=1/r.m,o=p(.39+.257*(e=new i.Pq0(t/A,0,0)).x-.044*e.x*e.x,0,1);return r.gT*((1+o)*t)/n}function V(t,e){var n=D(I(t));return j(O(t,e))<=n}function T(t,e){return{c:I(t),s:O(t,e),A:3.5/r.m,B:1/r.m}}function C(t,e){var n=T(t,e),i=n.c,o=n.s,a=n.A,s=n.B,l=(1+r.e)*(i/s);return B(-o.x/a*z-l*A,o.y/a,o.x/a*A-l*z)}function q(t,e){var n=T(t,e),o=n.c,a=n.B,y=(1+r.e)*(o/a),g=function(t,e){var n=Math.atan2(Math.abs(t.y),Math.max(1e-6,t.x)),o=O(t,null!=e?e:new i.Pq0(0,0,0)).length();return p(u*r._m+(c+h*n+v*n*n)+f*Math.tanh(o/Math.max(1e-6,d)),s,l)}(t,e),m=Math.atan2(t.y,t.x),w=Math.cos(m),b=Math.sin(m);return B(-g*y*w*A-y*A,g*y*b,g*y*w*A-y*z)}function N(t,e){return V(t,e)?C(t,e):q(t,e)}function E(t,e){var n=C(t,e),i=q(t,e),o=Math.sign(t.y)===Math.sign(e.z)?Math.cos(Math.atan2(t.y,t.x)):1;return{v:i.v.lerp(n.v,o),w:i.w.lerp(n.w,o)}}function B(t,e,n){return{v:new i.Pq0(t/r.m,e/r.m),w:new i.Pq0(-r.R/r.I*e*z,r.R/r.I*(t*z-n*A),r.R/r.I*e*A)}}function _(t,e){var n=new a.z(r.m,r.R,r.ee,r.oV,r._m);n.solve(t.x,t.y,e.x,e.y,e.z);var o=new i.Pq0(n.vx,n.vy,0),s=new i.Pq0(n.ωx,n.ωy,n.ωz);return{v:o.sub(t),w:s.sub(e)}}function Z(t,e){return S(Math.PI/2,t,e,_)}function L(t,e){var n=Math.atan2(-t.x,t.y),i=2.5*e.length()*(t.length()*r.R)/(r.R*r.R),a=e.clone().normalize();return(0,o.KM)(a).applyAxisAngle(a,n).multiplyScalar(i)}},8660:(t,e,n)=>{n.d(e,{U:()=>u,c:()=>c});var i=n(12),o=n(8090),r=n(7924),a=n(5418);function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(t){return t.Stationary="Stationary",t.Rolling="Rolling",t.Sliding="Sliding",t.Falling="Falling",t.InPocket="InPocket",t}({}),c=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"pos",void 0),l(this,"vel",i.v_.clone()),l(this,"rvel",i.v_.clone()),l(this,"futurePos",i.v_.clone()),l(this,"ballmesh",void 0),l(this,"state","Stationary"),l(this,"pocket",void 0),l(this,"physicsContext",a.BY),l(this,"magnusEnabled",!1),l(this,"magnusElevation",0),l(this,"id",t.id++),this.pos=e.clone(),o&&(this.physicsContext=o),this.ballmesh=new r.J(n||15658734*Math.random(),this.physicsContext.R)}var e,n,u;return e=t,u=[{key:"fromSerialised",value:function(e){return t.updateFromSerialised(new t((0,i.t6)(e.pos),void 0,e.physicsContext),e)}},{key:"updateFromSerialised",value:function(t,e){var n,o;return t.pos.copy(e.pos),t.vel.copy(null!==(n=null==e?void 0:e.vel)&&void 0!==n?n:i.v_),t.rvel.copy(null!==(o=null==e?void 0:e.rvel)&&void 0!==o?o:i.v_),t.state="Stationary",t}}],(n=[{key:"radius",get:function(){return this.physicsContext.R}},{key:"updatePhysicsContext",value:function(t){this.physicsContext=t,this.ballmesh.updateRadius(t.R)}},{key:"update",value:function(t){this.updatePosition(t),"Falling"==this.state?this.pocket.updateFall(this,t):this.updateVelocity(t)}},{key:"updateMesh",value:function(t){this.ballmesh.updateAll(this,t)}},{key:"updatePosition",value:function(t){this.pos.addScaledVector(this.vel,t)}},{key:"updateVelocity",value:function(t){if(this.inMotion()){if(this.isRolling()?(this.state="Rolling",(0,o.lx)(this.vel,this.rvel,this.physicsContext),this.addDelta(t,(0,o.JD)(this.rvel,this.physicsContext))):(this.state="Sliding",this.addDelta(t,(0,o.p2)(this.vel,this.rvel,this.physicsContext))),this.magnusEnabled){var e=(0,o.Iy)(this.vel,this.rvel,this.magnusElevation,this.pos.z,this.physicsContext);this.vel.addScaledVector(e,t)}var n=.01*this.physicsContext.R;if(this.pos.z>n)this.vel.z-=a.g*t;else if(this.pos.z<0&&(this.pos.z=0),this.vel.z<0){var i=a.dM;Math.abs(this.vel.z)>.1?(this.vel.z=-this.vel.z*i,this.pos.z=.5*n,this.vel.x*=.95,this.vel.y*=.95):(this.vel.z=0,this.pos.z=0)}}}},{key:"addDelta",value:function(t,e){e.v.multiplyScalar(t),e.w.multiplyScalar(t),this.passesZero(e)||(this.vel.add(e.v),this.rvel.add(e.w))}},{key:"passesZero",value:function(t){var e=(0,i.rq)(this.vel,t.v),n=(0,i.rq)(this.rvel,t.w);return!!(("Rolling"===this.state?e||n:e&&n)&&Math.abs(this.rvel.z)<.01)&&(this.setStationary(),!0)}},{key:"setStationary",value:function(){this.vel.copy(i.v_),this.rvel.copy(i.v_),this.state="Stationary"}},{key:"isRolling",value:function(){return 0!==this.vel.lengthSq()&&0!==this.rvel.lengthSq()&&(0,o.Mq)(this.vel,this.rvel).length()<t.transition}},{key:"onTable",value:function(){return"Falling"!==this.state&&"InPocket"!==this.state}},{key:"inMotion",value:function(){return"Rolling"===this.state||"Sliding"===this.state||this.isFalling()}},{key:"isFalling",value:function(){return"Falling"===this.state}},{key:"futurePosition",value:function(t){return this.futurePos.copy(this.pos).addScaledVector(this.vel,t),this.futurePos}},{key:"fround",value:function(){this.pos.x=Math.fround(this.pos.x),this.pos.y=Math.fround(this.pos.y),this.vel.x=Math.fround(this.vel.x),this.vel.y=Math.fround(this.vel.y),this.rvel.x=Math.fround(this.rvel.x),this.rvel.y=Math.fround(this.rvel.y),this.rvel.z=Math.fround(this.rvel.z)}},{key:"serialise",value:function(){return{pos:this.pos.clone(),id:this.id,physicsContext:this.physicsContext}}}])&&s(e.prototype,n),u&&s(e,u),t}();l(c,"id",0),l(c,"transition",.05)}},t=>{t(t.s=4057)}]);