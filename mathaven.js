"use strict";(self.webpackChunkbilliards=self.webpackChunkbilliards||[]).push([[893],{12:(t,e,n)=>{n.d(e,{Dz:()=>d,F8:()=>m,FP:()=>y,KM:()=>l,RZ:()=>b,gn:()=>w,ld:()=>p,n7:()=>g,oN:()=>x,rq:()=>v,t6:()=>a,up:()=>r,v_:()=>o,xb:()=>c});var i=n(4922),o=new i.Pq0(0,0,0),r=new i.Pq0(0,0,1);function a(t){return new i.Pq0(t.x,t.y,t.z)}var s=new i.Pq0;function l(t){return s.copy(r).cross(t)}var u=new i.Pq0;function c(t){return u.copy(t).normalize()}var h=new i.Pq0;function v(t,e){return h.copy(t).add(e).dot(t)<=0}function d(t){return new i.Pq0(1,0,0).applyAxisAngle(r,t)}function f(t){return Math.sign(t)*Math.floor(1e4*(Math.abs(t)+Number.EPSILON))/1e4}function p(t){return t.x=f(t.x),t.y=f(t.y),t.z=f(t.z),t}function y(t,e){return Math.fround(Math.atan2(t,e))}function g(t,e){return Math.fround(Math.pow(t,e))}function m(t){return Math.sin(t)}function w(t){return Math.cos(t)}function b(t){return Math.sqrt(t)}function x(t){return Math.exp(t)}},3894:(t,e,n)=>{n.d(e,{F:()=>f});var i=n(8660),o=n(4922),r=n(5418),a=n(12);function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"normalImpulse",void 0),l(this,"tangentialImpulse",void 0)}var e,n;return e=t,(n=[{key:"dynamicFriction",value:function(t){return.01+.108*(0,a.oN)(-1.088*t)}},{key:"updateVelocities",value:function(t,e){var n=f.positionsAtContact(t,e);t.ballmesh.trace.forceTrace(n.a),e.ballmesh.trace.forceTrace(n.b);var i=n.b.sub(n.a).normalize(),a=new o.Pq0(-i.y,i.x,0),s=t.vel.clone().sub(e.vel).add(i.clone().multiplyScalar(-r.R).cross(t.rvel).sub(i.clone().multiplyScalar(r.R).cross(e.rvel))),l=i.dot(s),u=s.addScaledVector(i,-l),c=u.length(),h=a.dot(u),v=this.dynamicFriction(c);this.normalImpulse=-1.99*l/(2/r.m),this.tangentialImpulse=.25*Math.min(v*Math.abs(this.normalImpulse)/c,1/7)*-h;var d=i.clone().multiplyScalar(this.normalImpulse),p=a.clone().multiplyScalar(this.tangentialImpulse);t.vel.addScaledVector(d,1/r.m).addScaledVector(p,1/r.m),e.vel.addScaledVector(d,-1/r.m).addScaledVector(p,-1/r.m);var y=i.clone().multiplyScalar(-r.R).cross(p),g=i.clone().multiplyScalar(r.R).cross(p);return t.rvel.addScaledVector(y,1/r.I),e.rvel.addScaledVector(g,1/r.I),l}}])&&s(e.prototype,n),t}();function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var v=1e-5;function d(t,e,n,i){var o,a=null!==(o=null==i?void 0:i.R)&&void 0!==o?o:r.R,s=t.pos.clone().sub(e.pos),l=t.vel.clone().sub(e.vel),u=2*a,c=l.dot(l),h=2*s.dot(l),v=s.dot(s)-u*u;if(c<=1e-12)return-1;var d=h*h-4*c*v;if(d<0)return-1;var f=Math.sqrt(d),p=(-h-f)/(2*c),y=(-h+f)/(2*c),g=Number.POSITIVE_INFINITY;return p>=0&&p<=n&&(g=Math.min(g,p)),y>=0&&y<=n&&(g=Math.min(g,y)),isFinite(g)?g:-1}var f=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"timeOfImpact",value:function(t,e,n,i){return d(t,e,n,i)}},{key:"willCollide",value:function(t,e,n,i){if(!t.onTable()||!e.onTable())return!1;if(!t.inMotion()&&!e.inMotion())return!1;var o,a=null!==(o=null==i?void 0:i.R)&&void 0!==o?o:r.R;if(d(t,e,n,i)>=0)return!0;var s=t.futurePosition(n),l=e.futurePosition(n),u=s.clone().sub(l);return!(u.lengthSq()>=4*a*a)&&t.vel.clone().sub(e.vel).dot(u)<0}},{key:"separateAtImpact",value:function(t,e,n,i){var o,a=null!==(o=null==i?void 0:i.R)&&void 0!==o?o:r.R,s=2*a,l=d(t,e,n,i),u=t.pos.clone(),c=e.pos.clone();l>=0&&(u.addScaledVector(t.vel,l),c.addScaledVector(e.vel,l));var h=u.clone().sub(c),f=h.length();f<v&&(h.set(1,0,0),f=Math.max(f,v));var p=h.multiplyScalar(1/f),y=s-f;if(!(y<=0)){var g,m=.5*(y+a*(null!==(g=null==i?void 0:i.collisionSeparationBias)&&void 0!==g?g:.01)),w=p.multiplyScalar(m);t.pos.add(w),e.pos.sub(w),t.futurePos.copy(t.pos),e.futurePos.copy(e.pos)}}},{key:"collide",value:function(e,n){return t.updateVelocities(e,n)}},{key:"positionsAtContact",value:function(t,e){var n=t.pos.distanceTo(e.pos),i=t.vel.clone().sub(e.vel),o=(n-2*r.R)/i.length()||0;return{a:t.pos.clone().addScaledVector(t.vel,o),b:e.pos.clone().addScaledVector(e.vel,o)}}},{key:"updateVelocities",value:function(e,n){var o,r=null!==(o=e.physicsContext)&&void 0!==o?o:n.physicsContext,a=n.pos.clone().sub(e.pos),s=a.length(),l=0;s>1e-6?(a.multiplyScalar(1/s),l=e.vel.clone().sub(n.vel).dot(a)):a.set(0,0,0);var u=t.model.updateVelocities(e,n),c=s>1e-6?e.vel.clone().sub(n.vel).dot(a):0;if(s>1e-6&&c>0){var h=-.5*c;e.vel.addScaledVector(a,h),n.vel.addScaledVector(a,-h)}var v,d=s>1e-6?e.vel.clone().sub(n.vel).dot(a):c,f=null!==(v=null==r?void 0:r.minSeparationSpeed)&&void 0!==v?v:.004;if(s>1e-6&&Math.abs(d)<f){var p=d>=0?-1:1,y=p*f*.5;e.vel.addScaledVector(a,-y),n.vel.addScaledVector(a,y),d=p*f}return t.debugHook&&t.debugHook({relNormalBefore:l,relNormalAfterImpulse:c,relNormalAfterCorrection:d,normalImpulse:t.model.normalImpulse,tangentialImpulse:t.model.tangentialImpulse,distance:s}),e.state=i.U.Sliding,n.state=i.U.Sliding,u}}],null&&c(e.prototype,null),n&&c(e,n),t}();h(f,"debugHook",void 0),h(f,"model",new u)},4057:(t,e,n)=>{var i=.1406,o=.02625,r=n(4841);function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e,n){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n||t):o.value}},l(t,e,n||t)}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}function h(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(h=function(){return!!t})()}var v=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),s(t=function(t,e,n){return e=u(e),function(t,e){return!e||"object"!=((n=e)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e;var n}(t,h()?Reflect.construct(e,n||[],u(t).constructor):e.apply(t,n))}(this,e,arguments),"h",[]),s(t,"extractValues",(function(e){return t.h.map(e).map((function(t){return null!=t?t:0}))})),t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,t),n=e,i=[{key:"updateSingleStep",value:function(t){l(u(e.prototype),"updateSingleStep",this).call(this,t),this.h.push(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){s(t,e,n[e])}))}return t}({},this))}}],i&&a(n.prototype,i),e}(r.z),d={responsive:!0,showLink:!0,plotlyServerURL:"https://chart-studio.plotly.com"},f={legend:{font:{color:"#4D5663"},bgcolor:"#e5e6F9"},title:{text:"",font:{size:11}},xaxis:{title:"impulse",tickfont:{color:"#4D5663"},gridcolor:"#E1E5ED",titlefont:{color:"#4D5663"},zerolinecolor:"#E1E5ED"},yaxis:{title:"value",tickfont:{color:"#4D5663"},zeroline:!1,gridcolor:"#E1E5ED",titlefont:{color:"#4D5663"},zerolinecolor:"#E1E5ED"},plot_bgcolor:"#F5F6F9",paper_bgcolor:"#F2F6F9"};function p(t){return"hsl(".concat(137.5*t%360,", ").concat(70,"%, ").concat(50,"%)")}function y(t,e,n,i){return{x:t,y:e,name:n,line:{color:i,width:1.3},mode:"lines",type:"scatter"}}function g(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var m=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"plot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*t/o,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5*t/o,a=new v(i,o,.98,.212,.14);try{a.solvePaper(t,e,n,r)}catch(t){console.error(t)}var s=a.extractValues,l=s((function(t){return t.P}));f.title.text="<b>Figure.12</b> Slip–impulse curves \nfor V0 = 2 m/s, α = 45◦,ωS0 = 2V0/R, and ωT0 = 1.5V0/R \n<br>(s and φ are for the slip at the cushion, \nand sʹ and φʹ are for the slip at the table)",window.Plotly.newPlot("mathaven-impulse",[y(l,s((function(t){return t.s})),"s",p(0)),y(l,s((function(t){return t.φ})),"φ",p(1)),y(l,s((function(t){return t.sʹ})),"s'",p(2)),y(l,s((function(t){return t.φʹ})),"φʹ",p(3)),y(l,s((function(t){return t.WzI})),"WzI",p(4)),y(l,s((function(t){return t.P})),"P",p(5))],f,d)}}],n&&g(e.prototype,n),t}();function w(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var b=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"getFinalState",value:function(t,e,n,a){try{var s=new r.z(i,o,.98,.212,.14);s.solvePaper(t,e,n,a);var l=s.vy,u=s.vx;return{beta:Math.atan2(-l,u)*(180/Math.PI),speed:Math.sqrt(u*u+l*l)}}catch(t){return console.error(t),{beta:NaN,speed:NaN}}}},{key:"plot",value:function(t,e,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){return 0},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(t){return t/o},a=[],s=[],l=[],u=-1;u<=2;u++){var c=[],h=[];l=[];for(var v=1;v<90;v+=9){l.push(v);var g=this.getFinalState(1,v*(Math.PI/180),i(u),r(u));c.push(g.speed),h.push(g.beta)}a.push(c),s.push(h)}var m=l;f.title.text=n,window.Plotly.newPlot(t,[y(m,a[0],"k=-1",p(0)),y(m,a[1],"k=0",p(1)),y(m,a[2],"k=1",p(2)),y(m,a[3],"k=2",p(3))],f,d),window.Plotly.newPlot(e,[y(m,s[0],"k=-1",p(0)),y(m,s[1],"k=0",p(1)),y(m,s[2],"k=1",p(2)),y(m,s[3],"k=2",p(3))],f,d)}}],n&&w(e.prototype,n),t}(),x=n(4922),M=n(8660),P=n(12),S=n(3894);function k(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function R(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var F=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),R(this,"log",void 0),this.log=e}var e,n;return e=t,(n=[{key:"dynamicFriction",value:function(e){return t.a+t.b*Math.exp(-t.c*e)}},{key:"relativeVelocity",value:function(e,n,i,o){return Math.sqrt(Math.pow(e*Math.sin(o)-i*t.R,2)+Math.pow(Math.cos(o)*n*t.R,2))}},{key:"throwAngle",value:function(e,n,i,o){var r=this.relativeVelocity(e,n,i,o),a=this.dynamicFriction(r),s=Math.min(a*e*Math.cos(o)/r,1/7)*(e*Math.sin(o)-t.R*i),l=e*Math.cos(o);return Math.atan2(s,l)}},{key:"plot",value:function(e,n,i,o){var r=new M.c(P.v_);r.vel.copy(new x.Pq0(0,e,0)),r.rvel.copy(new x.Pq0(n,0,i));var a=new x.Pq0(0,2*t.R).applyAxisAngle(P.up,o),s=new M.c(a);return S.F.model.updateVelocities(r,s),Math.atan2(S.F.model.tangentialImpulse,-S.F.model.normalImpulse)}}])&&k(e.prototype,n),t}();function z(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function A(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){A(t,e,n[e])}))}return t}R(F,"R",.029),R(F,"a",.01),R(F,"b",.108),R(F,"c",1.088);var O=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"degToRad",value:function(t){return t*(Math.PI/180)}},{key:"radToDeg",value:function(t){return t*(180/Math.PI)}},{key:"plotCutAngle",value:function(){var t=F.R;this.plot("collision-throw-roll",[.447,1.341,3.129],(function(e){return e/t})),this.plot("collision-throw-stun",[.447,1.341,3.129],(function(t){return 0})),this.plotRolls("collision-throw-varying-roll",[0,.25,.5,1],(function(e){return e/t}),(function(t){return 0}),(function(t){return t})),this.plotRolls("collision-throw-varying-side",[0,.25,.5,1],(function(e){return e/t}),(function(e){return 1/t*(e-45)/45}),(function(t){return 0})),new F((function(){})).plot(.5,-15,-10,Math.PI/8)}},{key:"plot",value:function(t,e,n){var i=this,o=[],r=[];e.forEach((function(t){var e=[];r=[];for(var a=1;a<90;a+=1){r.push(a);var s=(new F).plot(t,n(t),0,i.degToRad(a));e.push(i.radToDeg(s))}o.push(e)}));var a=I({},f);a.title.text="Throw effect (WIP)\n    <br>throw vs. cut angle for various-speed ".concat(t," shots\n    <br>from https://billiards.colostate.edu/technical_proofs/new/TP_A-14.pdf"),window.Plotly.newPlot(t,[y(r,o[0],"slow",p(4)),y(r,o[1],"medium",p(5)),y(r,o[2],"fast",p(6))],a,d)}},{key:"plotRolls",value:function(t,e,n,i,o){var r=this,a=[],s=[];e.forEach((function(t){var e=[];s=[];for(var l=1;l<90;l+=1){s.push(l);var u=(new F).plot(1,n(t),i(l),r.degToRad(o(l)));e.push(r.radToDeg(u))}a.push(e)}));var l=I({},f);l.title.text="Throw effect (WIP)\n    <br>throw vs. cut angle for various-speed ".concat(t," shots\n    <br>from https://billiards.colostate.edu/technical_proofs/new/TP_A-14.pdf"),window.Plotly.newPlot(t,[y(s,a[0],"0",p(4)),y(s,a[1],"0.25",p(5)),y(s,a[2],"0.5",p(6)),y(s,a[3],"1.0",p(7))],l,d)}}],n&&z(e.prototype,n),t}();(new m).plot(),(new b).plot("mathaven-figure9-speed","mathaven-figure9-angle","<b>Figure.9</b> Rebound speed and rebound angle versus incident angle <br>\n    for different topspins of the ball, ωT0 = kV0/R and V0 = 1 m/s with no sidespin"),(new b).plot("mathaven-figure10-speed","mathaven-figure10-angle","<b>Figure.10</b> Rebound speed and rebound angle versus incident angle <br>\nfor different sidespins of the ball,ωS0 = kV0/R and V0 = 1 m/s with the ball rolling (ωT0 = V0/R)",(function(t){return t/o}),(function(t){return 1/o})),(new O).plotCutAngle()},4841:(t,e,n)=>{n.d(e,{z:()=>s});var i=n(12),o=n(5418);function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s=function(){function t(e,n,i,o,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,"P",0),a(this,"WzI",0),a(this,"vx",void 0),a(this,"vy",void 0),a(this,"ωx",void 0),a(this,"ωy",void 0),a(this,"ωz",void 0),a(this,"s",void 0),a(this,"φ",void 0),a(this,"sʹ",void 0),a(this,"φʹ",void 0),a(this,"i",0),a(this,"N",100),a(this,"M",void 0),a(this,"R",void 0),a(this,"μs",void 0),a(this,"μw",void 0),a(this,"ee",void 0),this.M=e,this.R=n,this.ee=i,this.μs=o,this.μw=r}var e,n;return e=t,(n=[{key:"updateSlipSpeedsAndAngles",value:function(){var t=this.R,e=this.vx+this.ωy*t*o.Z3-this.ωz*t*o.o5,n=-this.vy*o.Z3+this.ωx*t,r=this.vx-this.ωy*t,a=this.vy+this.ωx*t;this.s=(0,i.RZ)((0,i.n7)(e,2)+(0,i.n7)(n,2)),this.φ=(0,i.FP)(n,e),this.φ<0&&(this.φ+=2*Math.PI),this.sʹ=(0,i.RZ)((0,i.n7)(r,2)+(0,i.n7)(a,2)),this.φʹ=(0,i.FP)(a,r),this.φʹ<0&&(this.φʹ+=2*Math.PI)}},{key:"compressionPhase",value:function(){for(var t=Math.max(this.M*this.vy/this.N,.001);this.vy>0;)this.updateSingleStep(t)}},{key:"restitutionPhase",value:function(t){var e=Math.max(t/this.N,.001);for(this.WzI=0;this.WzI<t;)this.updateSingleStep(e)}},{key:"updateSingleStep",value:function(t){if(this.updateSlipSpeedsAndAngles(),this.updateVelocity(t),this.updateAngularVelocity(t),this.updateWorkDone(t),this.i++>10*this.N)throw new Error("Solution not found")}},{key:"updateVelocity",value:function(t){var e=this.μs,n=this.μw,r=this.M;this.vx-=1/r*(n*(0,i.gn)(this.φ)+e*(0,i.gn)(this.φʹ)*(o.Z3+n*(0,i.F8)(this.φ)*o.o5))*t,this.vy-=1/r*(o.o5-n*o.Z3*(0,i.F8)(this.φ)+e*(0,i.F8)(this.φʹ)*(o.Z3+n*(0,i.F8)(this.φ)*o.o5))*t}},{key:"updateAngularVelocity",value:function(t){var e=this.μs,n=this.μw,r=this.M,a=this.R;this.ωx+=-5/(2*r*a)*(n*(0,i.F8)(this.φ)+e*(0,i.F8)(this.φʹ)*(o.Z3+n*(0,i.F8)(this.φ)*o.o5))*t,this.ωy+=-5/(2*r*a)*(n*(0,i.gn)(this.φ)*o.Z3-e*(0,i.gn)(this.φʹ)*(o.Z3+n*(0,i.F8)(this.φ)*o.o5))*t,this.ωz+=5/(2*r*a)*(n*(0,i.gn)(this.φ)*o.o5)*t}},{key:"updateWorkDone",value:function(t){var e=t*Math.abs(this.vy);this.WzI+=e,this.P+=t}},{key:"solvePaper",value:function(t,e,n,o){this.solve(t*(0,i.gn)(e),t*(0,i.F8)(e),-o*(0,i.F8)(e),o*(0,i.gn)(e),n)}},{key:"solve",value:function(t,e,n,i,o){this.vx=t,this.vy=e,this.ωx=n,this.ωy=i,this.ωz=o,this.WzI=0,this.P=0,this.i=0,this.compressionPhase();var r=this.ee*this.ee*this.WzI;this.restitutionPhase(r)}}])&&r(e.prototype,n),t}()},5418:(t,e,n)=>{n.d(e,{$0:()=>T,BY:()=>z,I:()=>r,JU:()=>K,KO:()=>b,Mz:()=>i,Nv:()=>p,PK:()=>g,PX:()=>W,Q$:()=>j,Qg:()=>C,R:()=>O,Wv:()=>E,X$:()=>w,XF:()=>k,XM:()=>S,Ys:()=>N,Z3:()=>x,ZZ:()=>I,_m:()=>f,cM:()=>B,dM:()=>y,e:()=>h,ee:()=>v,g:()=>a,g8:()=>G,gT:()=>u,gf:()=>l,jG:()=>q,kL:()=>c,kM:()=>_,ki:()=>L,ko:()=>Z,lt:()=>U,m:()=>V,mu:()=>s,o5:()=>M,oV:()=>d,oo:()=>F,v3:()=>P,vF:()=>$,wK:()=>A,x3:()=>o,xO:()=>m});var i,o,r,a=9.8,s=.00985,l=.16,u=.85,c=.04,h=.86,v=.95,d=.212,f=.14,p=.003,y=.3,g=1.2,m=.3,w=1.2,b=.47,x=.4,M=Math.sqrt(21)/5,P=.06,S=2.84,k=1.42,R=.028575,F=.03075,z={R,m:.17},A={R:.02625,m:.142},I={R:F,m:.21,mu:.0042,rho:.09,muS:.12,spinStopThreshold:.05,rollingTransition:.1},O=R,V=.17;function q(t){O=t,null==D||D()}function D(){i=s*V*a*2/3*c,o=7/(5*Math.sqrt(2))*O*s*V*a,r=.4*V*O*O}function T(t){var e,n,i=null!==(e=t.mu)&&void 0!==e?e:s,o=null!==(n=t.rho)&&void 0!==n?n:c;return{Mz:i*t.m*a*2/3*o,Mxy:7/(5*Math.sqrt(2))*t.R*i*t.m*a,I:.4*t.m*t.R*t.R}}function C(t){V=t,null==D||D()}function j(t){s=t,D()}function E(t){c=t,D()}function N(t){l=t}function B(t){h=t}function _(t){u=t}function Z(t){d=t}function L(t){f=t}function W(t){v=t}function K(t){p=t}function U(t){y=t}function $(t){g=t}function G(t){m=t}D()},7924:(t,e,n)=>{n.d(e,{J:()=>f,h:()=>d});var i=n(4922),o=n(8660),r=n(12),a=n(5418);function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"line",void 0),l(this,"geometry",void 0),l(this,"positions",void 0),l(this,"lastPos",new i.Pq0),l(this,"lastVel",new i.Pq0),this.geometry=new i.LoY,this.positions=new Float32Array(3*e),this.geometry.setAttribute("position",new i.THS(this.positions,3)),this.reset();var o=new i.mrM({color:n,opacity:.25,linewidth:3,transparent:!0});this.line=new i.N1A(this.geometry,o),this.line.visible=!1}var e,n;return e=t,(n=[{key:"reset",value:function(){this.geometry.setDrawRange(0,0),this.lastVel.setZ(1)}},{key:"forceTrace",value:function(t){this.lastVel.z=1,this.addTraceGiven(t,this.lastVel,1,.1,1)}},{key:"addTrace",value:function(t,e){if(this.line.visible&&0!==e.length()){var n=this.lastVel.angleTo(e),i=n>Math.PI/32?.01*a.R:a.R,o=this.lastPos.distanceTo(t);this.addTraceGiven(t,e,o,i,n)}}},{key:"addTraceGiven",value:function(t,e,n,i,o){var r=this.geometry.drawRange.count;0!==r&&n<i||(r>1&&o<1e-4&&r--,this.lastPos.copy(t),this.lastVel.copy(e),this.addPoint(t,r))}},{key:"addPoint",value:function(t,e){var n=3*e;n>this.positions.length||(this.positions[n++]=t.x,this.positions[n++]=t.y,this.positions[n]=t.z,this.geometry.setDrawRange(0,e+1),this.line.geometry.attributes.position.needsUpdate=!0)}}])&&s(e.prototype,n),t}();function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){h(t,e,n[e])}))}return t}var d={orbitAngleDeg:270,elevationDeg:80,distanceInDiameters:24,intensity:8.4,decay:1.4,coneDeg:57,color:"#f5f8ff",shadowBias:-5e-5,shadowNormalBias:0,shadowBlur:185,shadowMapSize:2048,shadowBlurSamples:15,shadowNear:.5,shadowFar:2,castShadow:!0},f=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.R;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,"mesh",void 0),h(this,"spinAxisArrow",void 0),h(this,"velocityArrow",void 0),h(this,"trace",void 0),h(this,"color",void 0),h(this,"radius",void 0),h(this,"material",void 0),h(this,"dotMeshes",[]),this.color=new i.Q1f(e),this.radius=n,this.material=t.createBallMaterial(this.color),this.mesh=this.createBallMesh(),this.spinAxisArrow=new i.E0M(r.up,r.v_,2,0,.01,.01),this.spinAxisArrow.visible=!1,this.velocityArrow=new i.E0M(r.up,r.v_,2*this.radius,0,.015,.015),this.velocityArrow.visible=!1,this.trace=new u(500,e),t.instances.add(this)}var e,n,s;return e=t,n=[{key:"updateAll",value:function(t,e){this.updatePosition(t.pos),this.updateArrows(t.pos,t.rvel,t.vel,t.state),0!==t.rvel.lengthSq()&&(this.updateRotation(t.rvel,e),this.trace.addTrace(t.pos,t.vel))}},{key:"updatePosition",value:function(t){this.mesh.position.copy(t)}},{key:"updateRotation",value:function(t,e){var n=t.length()*e;0!==n&&this.mesh.rotateOnWorldAxis((0,r.xb)(t),n)}},{key:"updateArrows",value:function(t,e,n,i){this.spinAxisArrow.visible&&(this.spinAxisArrow.setLength(this.radius+this.radius*e.length()/2,this.radius,this.radius),this.spinAxisArrow.position.copy(t),this.spinAxisArrow.setDirection((0,r.xb)(e)),i===o.U.Rolling?this.spinAxisArrow.setColor(13369344):this.spinAxisArrow.setColor(52224)),this.velocityArrow.visible&&n.lengthSq()>0&&(this.velocityArrow.setLength(2*this.radius,.015,.015),this.velocityArrow.position.copy(t),this.velocityArrow.setDirection((0,r.xb)(n)))}},{key:"addToScene",value:function(t){t.add(this.mesh),t.add(this.spinAxisArrow),t.add(this.velocityArrow),t.add(this.trace.line)}},{key:"removeFromScene",value:function(t){t.remove(this.mesh),t.remove(this.spinAxisArrow),t.remove(this.velocityArrow),t.remove(this.trace.line)}},{key:"clearDots",value:function(){var t=this;this.dotMeshes.forEach((function(e){e.geometry.dispose();var n=e.material;Array.isArray(n)?n.forEach((function(t){return t.dispose()})):n&&n.dispose(),t.mesh.remove(e)})),this.dotMeshes=[]}},{key:"applySymmetricDots",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16711680,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.089;this.clearDots();var o=this.radius*n;[new i.Pq0(1,0,0),new i.Pq0(-1,0,0),new i.Pq0(0,1,0),new i.Pq0(0,-1,0),new i.Pq0(0,0,1),new i.Pq0(0,0,-1)].forEach((function(n){var r=new i.tcD(o,64),a=new i._4j({color:e,metalness:0,roughness:.35,transparent:!1,side:i.$EB}),s=new i.eaF(r,a),l=(new i.PTz).setFromUnitVectors(new i.Pq0(0,0,1),n.clone().normalize());s.quaternion.copy(l);var u=n.clone().normalize().multiplyScalar(t.radius+.001*t.radius);s.position.copy(u),s.renderOrder=t.mesh.renderOrder+1,t.mesh.add(s),t.dotMeshes.push(s)}))}},{key:"updateRadius",value:function(t){this.radius!==t&&(this.radius=t,this.mesh.geometry.dispose(),this.mesh.geometry=new i.Gu$(this.radius,64,48))}},{key:"dispose",value:function(){this.mesh.geometry.dispose(),this.material.dispose(),this.clearDots(),this.trace.dispose(),t.instances.delete(this)}},{key:"createBallMesh",value:function(){var t=new i.Gu$(this.radius,64,48),e=new i.eaF(t,this.material);return e.name="ball",e.castShadow=!0,e.receiveShadow=!0,e.renderOrder=1,e}}],s=[{key:"getLightingConfig",value:function(){return v({},t.lightingConfig)}},{key:"updateLightingConfig",value:function(e){var n,o,r,a,s,l,u,c,h,f,p,y,g,m,w,b,x=v({},t.lightingConfig,e);t.lightingConfig=(n=x,r=Number.isFinite(n.orbitAngleDeg)?n.orbitAngleDeg:d.orbitAngleDeg,a=Number.isFinite(n.elevationDeg)?n.elevationDeg:d.elevationDeg,s=Number.isFinite(n.distanceInDiameters)?n.distanceInDiameters:d.distanceInDiameters,l=Number.isFinite(n.intensity)?n.intensity:d.intensity,u=Number.isFinite(n.decay)?n.decay:d.decay,c=Number.isFinite(n.coneDeg)?n.coneDeg:d.coneDeg,h=Number.isFinite(n.shadowBias)?n.shadowBias:d.shadowBias,f=Number.isFinite(n.shadowNormalBias)?n.shadowNormalBias:d.shadowNormalBias,p=Number.isFinite(n.shadowBlur)?n.shadowBlur:d.shadowBlur,y=Number.isFinite(n.shadowMapSize)&&n.shadowMapSize>0?n.shadowMapSize:d.shadowMapSize,g=Number.isFinite(n.shadowBlurSamples)?n.shadowBlurSamples:d.shadowBlurSamples,m=Number.isFinite(n.shadowNear)&&n.shadowNear>0?n.shadowNear:d.shadowNear,w=Number.isFinite(n.shadowFar)?n.shadowFar:d.shadowFar,b=Math.pow(2,Math.round(i.cj9.clamp(Math.log2(y),8,12))),{orbitAngleDeg:i.cj9.euclideanModulo(r,360),elevationDeg:i.cj9.clamp(a,-80,85),distanceInDiameters:Math.max(.01,s),intensity:Math.max(0,l),decay:Math.max(0,u),coneDeg:i.cj9.clamp(c,5,90),color:null!==(o=n.color)&&void 0!==o?o:d.color,shadowBias:h,shadowNormalBias:Math.max(0,f),shadowBlur:i.cj9.clamp(p,0,1e3),shadowMapSize:b,shadowBlurSamples:Math.round(i.cj9.clamp(g,1,32)),shadowNear:Math.max(.1,m),shadowFar:Math.max(Math.max(.1,m)+.1,w),castShadow:Boolean(n.castShadow)});var M=t.getLightingConfig();t.lightingListeners.forEach((function(t){return t(M)}))}},{key:"onLightingConfigChanged",value:function(e){return t.lightingListeners.add(e),e(t.getLightingConfig()),function(){t.lightingListeners.delete(e)}}},{key:"createBallMaterial",value:function(t){var e=new i.uSd({color:t.clone(),roughness:.45,metalness:.25,clearcoat:.6,clearcoatRoughness:.15,reflectivity:.45});return e.needsUpdate=!0,e}}],n&&c(e.prototype,n),s&&c(e,s),t}();h(f,"instances",new Set),h(f,"lightingConfig",v({},d)),h(f,"lightingListeners",new Set)},8090:(t,e,n)=>{n.d(e,{$8:()=>Z,AL:()=>Q,Gf:()=>U,Gp:()=>C,Iy:()=>F,JD:()=>P,Mq:()=>b,QK:()=>z,QV:()=>_,Qy:()=>K,Un:()=>T,c0:()=>D,jj:()=>G,kY:()=>s,lq:()=>l,lx:()=>S,p2:()=>M,s0:()=>q,t6:()=>$,yO:()=>j});var i=n(4922),o=n(12),r=n(5418),a=n(4841),s=!1;function l(){return s=!s}var u=null,c=.02,h=.5,v=1,d=0,f=-.05,p=0,y=.06,g=.5;function m(t,e,n){return Math.max(e,Math.min(n,t))}var w=new i.Pq0;function b(t,e,n){var i,a=null!==(i=null==n?void 0:n.R)&&void 0!==i?i:r.R;return w.copy(t).addScaledVector((0,o.KM)(e),a)}var x={v:new i.Pq0,w:new i.Pq0};function M(t,e,n){var i,a,s,l=null!==(i=null==n?void 0:n.R)&&void 0!==i?i:r.R,u=null!==(a=null==n?void 0:n.m)&&void 0!==a?a:r.m,c=n?(0,r.$0)(n):{Mz:r.Mz,Mxy:r.x3,I:r.I},h=null!==(s=null==n?void 0:n.muS)&&void 0!==s?s:r.gf,v=function(t,e,n){return b(t,e,n).setZ(0)}(t,e,n);return x.v.copy((0,o.xb)(v).multiplyScalar(-h*r.g)),x.w.copy((0,o.xb)((0,o.KM)(v)).multiplyScalar(2.5*h*r.g/l)),x.w.setZ(c.Mz/(u*l*l)*-2.5*Math.sign(e.z)),x}function P(t,e){var n,o,a=null!==(n=null==e?void 0:e.R)&&void 0!==n?n:r.R,s=null!==(o=null==e?void 0:e.m)&&void 0!==o?o:r.m,l=e?(0,r.$0)(e):{Mz:r.Mz,Mxy:r.x3,I:r.I},u=new i.Pq0(t.x,t.y,0).length(),c=5/7*l.Mxy/(s*a)/u,h=5/7*l.Mxy/(s*a*a)/u;return x.v.set(-c*t.y,c*t.x,0),x.w.set(-h*t.x,-h*t.y,l.Mz/(s*a*a)*-2.5*Math.sign(t.z)),x}function S(t,e,n){var i,a=null!==(i=null==n?void 0:n.R)&&void 0!==i?i:r.R,s=e.z;e.copy((0,o.KM)(t).multiplyScalar(1/a)),e.setZ(s)}Object.freeze(x);var k=new i.Pq0,R=new i.Pq0;function F(t,e){var n,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,l=t.length(),u=null!==(n=null==s?void 0:s.m)&&void 0!==n?n:r.m,c=null!==(i=null==s?void 0:s.R)&&void 0!==i?i:r.R;if(l<.1)return k.set(0,0,0);if(e.length()<.1)return k.set(0,0,0);var h=a>c*r.v3,v=Math.pow(Math.sin(o),1),d=r.Nv*v;d*=h?r.PK:r.xO,R.crossVectors(e,t),R.z=0;var f=R.length();if(f<.01)return k.set(0,0,0);var p=d*f/u;return k.copy(R).normalize().multiplyScalar(p),k}function z(t,e,n,i){var r=i(e.clone().applyAxisAngle(o.up,t),n.clone().applyAxisAngle(o.up,t));return r.v.applyAxisAngle(o.up,-t),r.w.applyAxisAngle(o.up,-t),r}var A=.1*r.R,I=Math.asin(A/r.R),O=(0,o.F8)(I),V=(0,o.gn)(I);function q(t,e){return new i.Pq0(t.x*O-t.z*V+r.R*e.y,-t.y-r.R*e.z*V+r.R*e.x*O)}function D(t){return t.x*V}function T(t){var e=3.5/r.m;return t.length()/e}function C(t){var e,n=1/r.m,o=m(.39+.257*(e=new i.Pq0(t/V,0,0)).x-.044*e.x*e.x,0,1);return r.gT*((1+o)*t)/n}function j(t,e){var n=C(D(t));return T(q(t,e))<=n}function E(t,e){return{c:D(t),s:q(t,e),A:3.5/r.m,B:1/r.m}}function N(t,e){var n=E(t,e),i=n.c,o=n.s,a=n.A,s=n.B,l=(1+r.e)*(i/s);return L(-o.x/a*O-l*V,o.y/a,o.x/a*V-l*O)}function B(t,e){var n=E(t,e),o=n.c,a=n.B,s=(1+r.e)*(o/a),l=function(t,e){var n=Math.atan2(Math.abs(t.y),Math.max(1e-6,t.x)),o=q(t,null!=e?e:new i.Pq0(0,0,0)).length();return m(v*r._m+(d+f*n+p*n*n)+y*Math.tanh(o/Math.max(1e-6,g)),c,h)}(t,e),u=Math.atan2(t.y,t.x),w=Math.cos(u),b=Math.sin(u);return L(-l*s*w*V-s*V,l*s*b,l*s*w*V-s*O)}function _(t,e){return j(t,e)?N(t,e):B(t,e)}function Z(t,e){var n=N(t,e),i=B(t,e),o=Math.sign(t.y)===Math.sign(e.z)?Math.cos(Math.atan2(t.y,t.x)):1;return{v:i.v.lerp(n.v,o),w:i.w.lerp(n.w,o)}}function L(t,e,n){return{v:new i.Pq0(t/r.m,e/r.m),w:new i.Pq0(-r.R/r.I*e*O,r.R/r.I*(t*O-n*V),r.R/r.I*e*V)}}function W(t,e){var n=new a.z(r.m,r.R,r.ee,r.oV,r._m);n.solve(t.x,t.y,e.x,e.y,e.z);var o=new i.Pq0(n.vx,n.vy,0),s=new i.Pq0(n.ωx,n.ωy,n.ωz);return{v:o.sub(t),w:s.sub(e)}}function K(t,e){return z(Math.PI/2,t,e,W)}function U(t,e,n){var o=(new i.Pq0).subVectors(t,e).clone().normalize();return(new i.Pq0).crossVectors(o,n).multiplyScalar(5/(2*r.R))}function $(t,e){var n=Math.atan2(-t.x,t.y),i=2.5*e.length()*(t.length()*r.R)/(r.R*r.R),a=e.clone().normalize(),l=(0,o.KM)(a),u=l.clone().applyAxisAngle(a,n).multiplyScalar(i);if(s){console.log("🎯 cueToSpin() INPUT | Offset:(".concat(t.x.toFixed(3),",").concat(t.y.toFixed(3),",").concat(t.z.toFixed(3),") | Velocity:(").concat(e.x.toFixed(2),",").concat(e.y.toFixed(2),",").concat(e.z.toFixed(2),") | v.length:").concat(e.length().toFixed(2))),console.log("🔧 INTERMEDIATE | dir:(".concat(a.x.toFixed(3),",").concat(a.y.toFixed(3),",").concat(a.z.toFixed(3),") | upCross(dir):(").concat(l.x.toFixed(3),",").concat(l.y.toFixed(3),",").concat(l.z.toFixed(3),")"));var c=180*n/Math.PI;console.log("🌀 SPIN | spinAxis:".concat(c.toFixed(1),"° | Rate:").concat(i.toFixed(1)," → Result:(").concat(u.x.toFixed(1),",").concat(u.y.toFixed(1),",").concat(u.z.toFixed(1),") | Mag:").concat(u.length().toFixed(1))),console.log("")}return u}function G(t,e,n,o){if(u&&(t.remove(u),u.dispose(),u=null),0!==n.lengthSq()){var r=4*o,a=n.clone().normalize(),s=e.clone().addScaledVector(a,-r);s.clone(),a.clone(),e.clone(),u=new i.E0M(a,s,r,0,.15*r,.1*r),t.add(u)}}function Q(t){u&&(t.remove(u),u.dispose(),u=null)}},8660:(t,e,n)=>{n.d(e,{U:()=>u,c:()=>c});var i=n(12),o=n(8090),r=n(7924),a=n(5418);function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(t){return t.Stationary="Stationary",t.Rolling="Rolling",t.Sliding="Sliding",t.Falling="Falling",t.InPocket="InPocket",t}({}),c=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"pos",void 0),l(this,"vel",i.v_.clone()),l(this,"rvel",i.v_.clone()),l(this,"futurePos",i.v_.clone()),l(this,"ballmesh",void 0),l(this,"state","Stationary"),l(this,"pocket",void 0),l(this,"physicsContext",a.BY),l(this,"magnusEnabled",!1),l(this,"magnusElevation",0),l(this,"id",t.id++),this.pos=e.clone(),o&&(this.physicsContext=o),this.ballmesh=new r.J(n||15658734*Math.random(),this.physicsContext.R)}var e,n,u;return e=t,u=[{key:"fromSerialised",value:function(e){return t.updateFromSerialised(new t((0,i.t6)(e.pos),void 0,e.physicsContext),e)}},{key:"updateFromSerialised",value:function(t,e){var n,o;return t.pos.copy(e.pos),t.vel.copy(null!==(n=null==e?void 0:e.vel)&&void 0!==n?n:i.v_),t.rvel.copy(null!==(o=null==e?void 0:e.rvel)&&void 0!==o?o:i.v_),t.state="Stationary",void 0!==e.id&&(t.id=e.id),t}}],(n=[{key:"radius",get:function(){return this.physicsContext.R}},{key:"updatePhysicsContext",value:function(t){this.physicsContext=t,this.ballmesh.updateRadius(t.R)}},{key:"update",value:function(t){this.updatePosition(t),"Falling"==this.state?this.pocket.updateFall(this,t):this.updateVelocity(t)}},{key:"updateMesh",value:function(t){this.ballmesh.updateAll(this,t)}},{key:"updatePosition",value:function(t){this.pos.addScaledVector(this.vel,t)}},{key:"updateVelocity",value:function(t){if(this.inMotion()){var e=this.physicsContext.R*a.v3,n=this.pos.z>e;if(n||(this.pos.z>0&&(this.pos.z=0),this.vel.z>0&&(this.vel.z=0),this.isRolling()?(this.state="Rolling",(0,o.lx)(this.vel,this.rvel,this.physicsContext),this.addDelta(t,(0,o.JD)(this.rvel,this.physicsContext))):(this.state="Sliding",this.addDelta(t,(0,o.p2)(this.vel,this.rvel,this.physicsContext)))),this.magnusEnabled){var i=(0,o.Iy)(this.vel,this.rvel,this.magnusElevation,this.pos.z,this.physicsContext);this.vel.addScaledVector(i,t)}if(n){this.vel.z-=a.g*t;var r=Math.sqrt(this.vel.x*this.vel.x+this.vel.y*this.vel.y);if(r>.01){var s=this.physicsContext.R,l=Math.PI*s*s,u=this.physicsContext.m,c=.5*a.X$*a.KO*l*r*r/u,h=Math.max(0,1-c*t/r);this.vel.x*=h,this.vel.y*=h}}else if(this.pos.z<0&&(this.pos.z=0),this.vel.z<0){var v=a.dM;Math.abs(this.vel.z)>.1?(this.vel.z=-this.vel.z*v,this.pos.z<e&&(this.pos.z=e),this.vel.x*=.9,this.vel.y*=.9):(this.vel.z=0,this.pos.z=0)}}}},{key:"addDelta",value:function(t,e){e.v.multiplyScalar(t),e.w.multiplyScalar(t),this.passesZero(e)||(this.vel.add(e.v),this.rvel.add(e.w))}},{key:"passesZero",value:function(t){var e,n,o=(0,i.rq)(this.vel,t.v),r=(0,i.rq)(this.rvel,t.w),a="Rolling"===this.state?o||r:o&&r,s=this.vel.length(),l=null!==(n=null===(e=this.physicsContext)||void 0===e?void 0:e.spinStopThreshold)&&void 0!==n?n:.01,u=this.rvel.length();return!!((a||s<.001)&&u<l)&&(this.setStationary(),!0)}},{key:"setStationary",value:function(){this.vel.copy(i.v_),this.rvel.copy(i.v_),this.state="Stationary"}},{key:"isRolling",value:function(){var e,n,i=null!==(n=null===(e=this.physicsContext)||void 0===e?void 0:e.rollingTransition)&&void 0!==n?n:t.transition;return 0!==this.vel.lengthSq()&&0!==this.rvel.lengthSq()&&(0,o.Mq)(this.vel,this.rvel,this.physicsContext).length()<i}},{key:"onTable",value:function(){return"Falling"!==this.state&&"InPocket"!==this.state}},{key:"inMotion",value:function(){return"Rolling"===this.state||"Sliding"===this.state||this.isFalling()}},{key:"isFalling",value:function(){return"Falling"===this.state}},{key:"futurePosition",value:function(t){return this.futurePos.copy(this.pos).addScaledVector(this.vel,t),this.futurePos}},{key:"fround",value:function(){this.pos.x=Math.fround(this.pos.x),this.pos.y=Math.fround(this.pos.y),this.vel.x=Math.fround(this.vel.x),this.vel.y=Math.fround(this.vel.y),this.rvel.x=Math.fround(this.rvel.x),this.rvel.y=Math.fround(this.rvel.y),this.rvel.z=Math.fround(this.rvel.z)}},{key:"serialise",value:function(){return{pos:this.pos.clone(),id:this.id,physicsContext:this.physicsContext}}}])&&s(e.prototype,n),u&&s(e,u),t}();l(c,"id",0),l(c,"transition",.05)}},t=>{t(t.s=4057)}]);